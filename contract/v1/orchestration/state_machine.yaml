version: v1
authoritative: true

states:
  - STATE_IDLE
  - STATE_PROCESSING
  - STATE_FACTS_READY
  - STATE_TAGGED
  - STATE_COMPOSITE_READY
  - STATE_MAPPED
  - STATE_COA_EVALUATED
  - STATE_REASONED
  - STATE_SUPERSEDED
  - STATE_BLOCKED
  - STATE_IDLE_PENDING_DECISION

events:
  - EVT_UPLOAD_STORED
  - EVT_RERUN_REQUESTED
  - EVT_RERUN_APPROVED
  - EVT_RERUN_DECLINED
  - EVT_RERUN_COMPLETED
  - EVT_RUN_SUPERSEDED
  - EVT_FAILURE_BLOCKING

transitions:
  - from: STATE_IDLE
    event: EVT_RERUN_REQUESTED
    to: STATE_PROCESSING

  - from: STATE_PROCESSING
    event: EVT_RERUN_COMPLETED
    to: STATE_FACTS_READY

  - from: STATE_FACTS_READY
    event: EVT_RERUN_COMPLETED
    to: STATE_TAGGED

  - from: STATE_TAGGED
    event: EVT_RERUN_COMPLETED
    to: STATE_COMPOSITE_READY

  - from: STATE_COMPOSITE_READY
    event: EVT_RERUN_COMPLETED
    to: STATE_MAPPED

  - from: STATE_MAPPED
    event: EVT_RERUN_COMPLETED
    to: STATE_COA_EVALUATED

  - from: STATE_COA_EVALUATED
    event: EVT_RERUN_COMPLETED
    to: STATE_REASONED

  - from: STATE_COA_EVALUATED
    event: EVT_UPLOAD_STORED
    to: STATE_IDLE_PENDING_DECISION

  - from: STATE_IDLE_PENDING_DECISION
    event: EVT_RERUN_APPROVED
    to: STATE_PROCESSING

  - from: STATE_IDLE_PENDING_DECISION
    event: EVT_RERUN_DECLINED
    to: STATE_IDLE

  - from: "*"
    event: EVT_FAILURE_BLOCKING
    to: STATE_BLOCKED