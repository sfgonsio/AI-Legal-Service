<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AI Legal Services Web Application</title>
  <link rel="stylesheet" href="ai-legal-spec.css"/>
</head>
<body>
  <div class="container">
	<div id="doc-controls">
	  <div class="row">
		<strong>View:</strong>
		<label><input type="checkbox" id="show-h2" checked> H2</label>
		<label><input type="checkbox" id="show-h3" checked> H3</label>
		<label><input type="checkbox" id="show-h4" checked> H4</label>

		<button id="expand-all" type="button">Expand all</button>
		<button id="collapse-all" type="button">Collapse all</button>
	  </div>
	</div> 
    <div class="header">
      <h1>AI Legal Services Web Application</h1>
      <div class="meta">Generated from DOCX → HTML (deterministic conversion). Headings, lists, and tables preserved.</div>
    </div>
    <div class="toc">
<h2>Table of Contents</h2>
<ul>
<li><a href="#objective">OBJECTIVE</a></li>
<li><a href="#antigravity-build-contract-definition-of-done-acceptance-criteria">Antigravity Build Contract: Definition of Done + Acceptance Criteria</a></li>
<li><a href="#definitions-governing-principles">DEFINITIONS &amp; GOVERNING PRINCIPLES</a></li>
<li><a href="#defined-terms">Defined Terms</a></li>
<li><a href="#core-governing-principles">Core Governing Principles</a></li>
<li><a href="#authority-mutation-matrix-hard-no-ambiguity">Authority &amp; Mutation Matrix (Hard) — No Ambiguity)</a></li>
<li><a href="#document-style-numbering-standard-authoritative">DOCUMENT STYLE &amp; NUMBERING STANDARD (AUTHORITATIVE)</a></li>
<li><a href="#global-typography-rules-mandatory">Global Typography Rules (Mandatory)</a></li>
<li><a href="#heading-style-rules-mandatory">Heading Style Rules (Mandatory)</a></li>
<li><a href="#body-text-rules-mandatory">Body Text Rules (Mandatory)</a></li>
<li><a href="#bullet-and-list-rules-mandatory">Bullet and List Rules (Mandatory)</a></li>
<li><a href="#numbering-rules-mandatory">Numbering Rules (Mandatory)</a></li>
<li><a href="#tables-if-used">Tables (If Used)</a></li>
<li><a href="#artifact-naming-agent-naming-convention-locked">Artifact Naming / Agent Naming Convention (Locked)</a></li>
<li><a href="#modules">MODULES</a></li>
<li><a href="#intake-case-formation">Intake &amp; Case Formation</a></li>
<li><a href="#evidence-data-processing">Evidence &amp; Data Processing</a></li>
<li><a href="#pleadings-coa-construction">Pleadings &amp; COA Construction</a></li>
<li><a href="#mapping-traceability">Mapping &amp; Traceability</a></li>
<li><a href="#discovery-interrogatories">Discovery &amp; Interrogatories</a></li>
<li><a href="#deposition-preparation-processing">Deposition Preparation &amp; Processing</a></li>
<li><a href="#subpoena-evidence-gap-identification">Subpoena &amp; Evidence Gap Identification</a></li>
<li><a href="#trial-preparation-strategy">Trial Preparation &amp; Strategy</a></li>
<li><a href="#case-integrity-validation">Case Integrity &amp; Validation</a></li>
<li><a href="#adversarial-exposure-analysis">Adversarial Exposure Analysis</a></li>
<li><a href="#workflow-governance-readiness">Workflow Governance &amp; Readiness</a></li>
<li><a href="#role-permission-policy-governance">Role, Permission &amp; Policy Governance</a></li>
<li><a href="#audit-logging-observability">Audit, Logging &amp; Observability</a></li>
<li><a href="#integration-tool-mediation">Integration &amp; Tool Mediation</a></li>
<li><a href="#service-agents">SERVICE AGENTS</a></li>
<li><a href="#interview_intake_agent">INTERVIEW_INTAKE_AGENT</a></li>
<li><a href="#onboard_agent">ONBOARD_AGENT</a></li>
<li><a href="#file_intake_agent">FILE_INTAKE_AGENT</a></li>
<li><a href="#processing_agent">PROCESSING_AGENT</a></li>
<li><a href="#pleading_agent">PLEADING_AGENT</a></li>
<li><a href="#complaint_agent">COMPLAINT_AGENT</a></li>
<li><a href="#coa_agent">COA_AGENT</a></li>
<li><a href="#response_agent">RESPONSE_AGENT</a></li>
<li><a href="#mapping_agent">MAPPING_AGENT</a></li>
<li><a href="#interrogatory_agent">INTERROGATORY_AGENT</a></li>
<li><a href="#deposition_prep_agent">DEPOSITION_PREP_AGENT</a></li>
<li><a href="#deposition_processing_agent">DEPOSITION_PROCESSING_AGENT</a></li>
<li><a href="#subpoena_agent">SUBPOENA_AGENT</a></li>
<li><a href="#trial_agent">TRIAL_AGENT</a></li>
<li><a href="#evidence_correlation_agent">EVIDENCE_CORRELATION_AGENT</a></li>
<li><a href="#witness_tracking_agent">WITNESS_TRACKING_AGENT</a></li>
<li><a href="#timeline_agent">TIMELINE_AGENT</a></li>
<li><a href="#trial_calendar_agent">TRIAL_CALENDAR_AGENT</a></li>
<li><a href="#objection_library_agent">OBJECTION_LIBRARY_AGENT</a></li>
<li><a href="#outcome_model_agent">OUTCOME_MODEL_AGENT</a></li>
<li><a href="#evidence_audit_agent">EVIDENCE_AUDIT_AGENT</a></li>
<li><a href="#opposition_agent">OPPOSITION_AGENT</a></li>
<li><a href="#conductor_agent">CONDUCTOR_AGENT</a></li>
<li><a href="#knowledge_index_agent">KNOWLEDGE_INDEX_AGENT</a></li>
<li><a href="#system-components">SYSTEM COMPONENTS</a></li>
<li><a href="#presentation-layer-web-application-ui">PRESENTATION LAYER (WEB APPLICATION UI)</a></li>
<li><a href="#applicationapi-layer-web-api-workflow-services">APPLICATION/API LAYER (WEB API + WORKFLOW SERVICES)</a></li>
<li><a href="#agent-orchestration-layer-agent-runtime-job-control">AGENT ORCHESTRATION LAYER (AGENT RUNTIME + JOB CONTROL)</a></li>
<li><a href="#integration-layer-mcp-api-gateways-tool-mediation">INTEGRATION LAYER (MCP / API GATEWAYS / TOOL MEDIATION)</a></li>
<li><a href="#document-media-processing-engine">DOCUMENT &amp; MEDIA PROCESSING ENGINE</a></li>
<li><a href="#case-database-case-scoped-system-of-record">CASE DATABASE (CASE-SCOPED SYSTEM OF RECORD)</a></li>
<li><a href="#artifact-store-versioned-immutable-output-repository">ARTIFACT STORE (VERSIONED, IMMUTABLE OUTPUT REPOSITORY)</a></li>
<li><a href="#authorization-permissions-engine-rbacabac">AUTHORIZATION &amp; PERMISSIONS ENGINE (RBAC/ABAC)</a></li>
<li><a href="#workflow-state-machine-service">WORKFLOW STATE MACHINE SERVICE</a></li>
<li><a href="#issue-task-management-service">ISSUE &amp; TASK MANAGEMENT SERVICE</a></li>
<li><a href="#communications-service-auditable-case-messaging">COMMUNICATIONS SERVICE (AUDITABLE CASE MESSAGING)</a></li>
<li><a href="#audit-logging-observability-stack">AUDIT LOGGING &amp; OBSERVABILITY STACK</a></li>
<li><a href="#cost-usage-accounting-service">COST &amp; USAGE ACCOUNTING SERVICE</a></li>
<li><a href="#system-architecture-overview">SYSTEM ARCHITECTURE OVERVIEW</a></li>
<li><a href="#architectural-goals-authoritative">Architectural Goals (Authoritative)</a></li>
<li><a href="#layered-architecture-authoritative">Layered Architecture (Authoritative)</a></li>
<li><a href="#trust-boundaries-enforcement-points">Trust Boundaries &amp; Enforcement Points</a></li>
<li><a href="#runtime-topology-services-and-workers">Runtime Topology (Services and Workers)</a></li>
<li><a href="#canonical-data-flow-end-to-end">Canonical Data Flow (End-to-End)</a></li>
<li><a href="#availability-domains-dikw-aware">Availability Domains (DIKW-Aware)</a></li>
<li><a href="#determinism-reproducibility-controls">Determinism &amp; Reproducibility Controls</a></li>
<li><a href="#idempotency-correlation-hard">Idempotency &amp; Correlation (Hard)</a></li>
<li><a href="#build-ready-interfaces-what-antigravity-must-implement">Build-Ready Interfaces (What Antigravity Must Implement)</a></li>
<li><a href="#canonical-interface-contracts-hard-minimum-required-endpoints">Canonical Interface Contracts (Hard) — Minimum Required Endpoints</a></li>
<li><a href="#workflow-state-machine-spec-authoritative">WORKFLOW STATE MACHINE SPEC (Authoritative)</a></li>
<li><a href="#event-model-event-schemas-authoritative">EVENT MODEL &amp; EVENT SCHEMAS (AUTHORITATIVE)</a></li>
<li><a href="#access-control-portal-security-model-authoritative">ACCESS CONTROL &amp; PORTAL SECURITY MODEL (AUTHORITATIVE)</a></li>
<li><a href="#deployment-environment-model-authoritative">DEPLOYMENT &amp; ENVIRONMENT MODEL (AUTHORITATIVE)</a></li>
<li><a href="#dikw-intelligence-architecture-authoritative">DIKW INTELLIGENCE ARCHITECTURE (AUTHORITATIVE)</a></li>
<li><a href="#security-architecture-trust-boundaries-authoritative">SECURITY ARCHITECTURE &amp; TRUST BOUNDARIES (AUTHORITATIVE)</a></li>
<li><a href="#performance-scalability-capacity-architecture-authoritative">PERFORMANCE, SCALABILITY &amp; CAPACITY ARCHITECTURE (AUTHORITATIVE)</a></li>
<li><a href="#backup-disaster-recovery-business-continuity-authoritative">BACKUP, DISASTER RECOVERY &amp; BUSINESS CONTINUITY (AUTHORITATIVE)</a></li>
<li><a href="#deployment-environment-strategy-release-governance-authoritative">DEPLOYMENT, ENVIRONMENT STRATEGY &amp; RELEASE GOVERNANCE (AUTHORITATIVE)</a></li>
<li><a href="#security-access-control-role-governance-authoritative">SECURITY, ACCESS CONTROL &amp; ROLE GOVERNANCE (AUTHORITATIVE)</a></li>
<li><a href="#performance-scalability-capacity-planning-authoritative">PERFORMANCE, SCALABILITY &amp; CAPACITY PLANNING (AUTHORITATIVE)</a></li>
<li><a href="#environment-model-deployment-architecture-authoritative">ENVIRONMENT MODEL &amp; DEPLOYMENT ARCHITECTURE (AUTHORITATIVE)</a></li>
<li><a href="#security-architecture-access-control-model-authoritative">SECURITY ARCHITECTURE &amp; ACCESS CONTROL MODEL (AUTHORITATIVE)</a></li>
<li><a href="#logical-schema-contracts-authoritative-build-level-minimum">LOGICAL SCHEMA CONTRACTS (AUTHORITATIVE; BUILD-LEVEL MINIMUM)</a></li>
<li><a href="#event-model-workflow-state-machine-authoritative">EVENT MODEL &amp; WORKFLOW STATE MACHINE (AUTHORITATIVE)</a></li>
<li><a href="#agent-execution-contract-authoritative">AGENT EXECUTION CONTRACT (AUTHORITATIVE)</a></li>
<li><a href="#deterministic-reproducibility-model-governance-authoritative">DETERMINISTIC REPRODUCIBILITY &amp; MODEL GOVERNANCE (AUTHORITATIVE)</a></li>
<li><a href="#external-integration-contract-authoritative">EXTERNAL INTEGRATION CONTRACT (AUTHORITATIVE)</a></li>
<li><a href="#deployment-architecture-authoritative">DEPLOYMENT ARCHITECTURE (AUTHORITATIVE)</a></li>
<li><a href="#performance-scalability-authoritative">PERFORMANCE &amp; SCALABILITY (AUTHORITATIVE)</a></li>
<li><a href="#observability-monitoring-authoritative">OBSERVABILITY &amp; MONITORING (AUTHORITATIVE)</a></li>
<li><a href="#testing-validation-strategy-authoritative">TESTING &amp; VALIDATION STRATEGY (AUTHORITATIVE)</a></li>
<li><a href="#production-readiness-criteria-authoritative">PRODUCTION READINESS CRITERIA (AUTHORITATIVE)</a></li>
<li><a href="#technical-specification-translation-framework-authoritative">TECHNICAL SPECIFICATION TRANSLATION FRAMEWORK (AUTHORITATIVE)</a></li>
<li><a href="#workflow">WORKFLOW</a></li>
<li><a href="#workflow-modeling-rule">Workflow Modeling Rule</a></li>
<li><a href="#canonical-workflow-states">Canonical Workflow States</a></li>
<li><a href="#workflow-step-definitions-authoritative">Workflow Step Definitions (Authoritative)</a></li>
<li><a href="#optional-conditional-workflow-steps-invoked-as-needed">OPTIONAL / CONDITIONAL WORKFLOW STEPS (INVOKED AS NEEDED)</a></li>
<li><a href="#workflow-governance-readiness-and-publishexport-gating">Workflow Governance (Readiness and Publish/Export Gating)</a></li>
<li><a href="#failure-taxonomy-hard-deterministic-handling-required">Failure Taxonomy (Hard) — Deterministic Handling Required</a></li>
<li><a href="#workflow-modeling-rules">Workflow Modeling Rules</a></li>
<li><a href="#data-architecture">DATA ARCHITECTURE</a></li>
<li><a href="#data-domains-and-boundaries-authoritative">Data Domains and Boundaries (Authoritative)</a></li>
<li><a href="#tenancy-and-case-isolation-model-authoritative">Tenancy and Case Isolation Model (Authoritative)</a></li>
<li><a href="#identifier-and-integrity-requirements-authoritative">Identifier and Integrity Requirements (Authoritative)</a></li>
<li><a href="#evidence-traceability-hard-citation-format-validation">Evidence Traceability (Hard) — Citation Format &amp; Validation</a></li>
<li><a href="#storage-components-logical">Storage Components (Logical)</a></li>
<li><a href="#high-level-entity-map-conceptual-minimum">High-Level Entity Map (Conceptual; Minimum)</a></li>
<li><a href="#indexing-and-query-requirements-minimum">Indexing and Query Requirements (Minimum)</a></li>
<li><a href="#data-lifecycle-retention-and-archival-hooks">Data Lifecycle (Retention and Archival Hooks)</a></li>
<li><a href="#data-architecture-build-checklist-antigravity">Data Architecture Build Checklist (Antigravity)</a></li>
<li><a href="#operational-data-semantics-authoritative">Operational Data Semantics (Authoritative)</a></li>
<li><a href="#case-perspective-operationalization-contract-authoritative">Case Perspective Operationalization Contract (Authoritative)</a></li>
<li><a href="#agent-architecture">AGENT ARCHITECTURE</a></li>
<li><a href="#intake_agent">INTAKE_AGENT</a></li>
<li><a href="#processing_agent-2">PROCESSING_AGENT</a></li>
<li><a href="#mapping_agent-2">MAPPING_AGENT</a></li>
<li><a href="#evidence_audit_agent-2">EVIDENCE_AUDIT_AGENT</a></li>
<li><a href="#onboard_agent-2">ONBOARD_AGENT</a></li>
<li><a href="#file_intake_agent-authoritative">FILE_INTAKE_AGENT (Authoritative)</a></li>
<li><a href="#pleading_agent-2">PLEADING_AGENT</a></li>
<li><a href="#interrogatory_agent-2">INTERROGATORY_AGENT</a></li>
<li><a href="#deposition_prep_agent-2">DEPOSITION_PREP_AGENT</a></li>
<li><a href="#deposition_processing_agent-authoritative-consolidated">DEPOSITION_PROCESSING_AGENT (Authoritative; Consolidated)</a></li>
<li><a href="#subpoena_agent-authoritative">SUBPOENA_AGENT (Authoritative)</a></li>
<li><a href="#trial_agent-authoritative">TRIAL_AGENT (Authoritative)</a></li>
<li><a href="#supporting-evidence-strategy-agents-authoritative-case-scoped">SUPPORTING EVIDENCE &amp; STRATEGY AGENTS (Authoritative; Case-Scoped)</a></li>
<li><a href="#evidence_correlation_agent-2">EVIDENCE_CORRELATION_AGENT</a></li>
<li><a href="#timeline_agent-2">TIMELINE_AGENT</a></li>
<li><a href="#trial_calendar_agent-2">TRIAL_CALENDAR_AGENT</a></li>
<li><a href="#objection_library_agent-directive-gated">OBJECTION_LIBRARY_AGENT (Directive-Gated)</a></li>
<li><a href="#outcome_model_agent-optional-non-determinative">OUTCOME_MODEL_AGENT (Optional; Non-Determinative)</a></li>
<li><a href="#opposition_agent-deterministic-non-destructive-adversarial-analysis">OPPOSITION_AGENT (Deterministic; Non-Destructive; Adversarial Analysis)</a></li>
<li><a href="#conductor_agent-deterministic-workflow-integrity-governor">CONDUCTOR_AGENT (Deterministic; Workflow Integrity Governor)</a></li>
<li><a href="#appendix-appendices">APPENDIX / APPENDICES</a></li>
<li><a href="#appendix-a-case_context_playbook-schema-authoritative-build-level-contract">APPENDIX A — CASE_CONTEXT_PLAYBOOK Schema (Authoritative; Build-Level Contract)</a></li>
<li><a href="#appendix-b-canonical-artifact-schemas-authoritative-build-level-minimum">APPENDIX B — CANONICAL ARTIFACT SCHEMAS (Authoritative; Build-Level Minimum)</a></li>
<li><a href="#build-requirements-antigravity-what-must-be-implemented">Build Requirements (Antigravity) — What MUST Be Implemented</a></li>
<li><a href="#architecture-visuals">Architecture Visuals</a></li>
</ul></div>
    <h1 id="ai-legal-services-web-application">AI Legal Services Web Application</h1><section><h2 id="objective">OBJECTIVE</h2><p>Design and build a production-grade, AI-driven legal platform that supports secure client intake, defensible data processing, contextual case construction, procedural document generation, and ongoing, auditable interaction between clients and the firm.</p><p>This platform is holistic and extensible. Prior proof-of-concept work may inform patterns but does not constrain architecture, schemas, agent behavior, implementation choices, or integration strategy.</p><p>The system creates competitive advantage by improving efficiency, traceability, and strategic defensibility in:</p><p>Client intake and onboarding</p><ul><li>Evidence ingestion, processing, parsing, and authoritative file management</li><li>Case construction, factual organization, and traceability</li><li>Development of complaints and responses</li><li>Causes of Action (COA) preparation and element validation</li><li>Subpoena preparation</li><li>Interrogatories and discovery workflows</li><li>Deposition preparation and deposition processing</li><li>Trial preparation and trial execution readiness</li></ul><p>The platform is designed to scale structured legal intelligence over time using a governed Data–Information–Knowledge–Wisdom (DIKW) framework. Intelligence improvements occur through artifact accumulation, structured indexing, controlled knowledge promotion, and attorney-governed validation — not through uncontrolled model retraining or autonomous heuristic mutation.</p><p>The system is user-centric and supports clients, attorneys/partners, paralegals/staff, office operations, and case accounting through a secure web application powered by AI agents, mediated integrations, and the Model Context Protocol (MCP).</p><p>The platform must be defensible and auditable by design, including:</p><p>Case-scoped isolation and permissioned access for all actions</p><ul><li>Versioned artifacts with provenance and reproducibility for deterministic outputs</li><li>Structured workflow governance with explicit blocking and approval controls</li><li>Continuous case integrity validation</li><li>Advisory adversarial exposure review</li><li>Readiness validation prior to publish/export or major workflow transitions</li></ul><p>All external integrations (LLMs, transcription, OCR, legal libraries, and other tools) must be mediated through governed system layers to enforce policy, cost controls, audit logging, reproducibility, and case isolation.</p><h3 id="antigravity-build-contract-definition-of-done-acceptance-criteria">Antigravity Build Contract: Definition of Done + Acceptance Criteria</h3><p><strong>Purpose:</strong> This document is an executable specification. Antigravity’s implementation is considered “Done” only when all conditions below are true:</p><h4 id="a-functional-completeness-minimum">A) Functional Completeness (Minimum)</h4><ul><li>All Modules and Service Agents defined in this document exist as callable services (or clearly implemented equivalents) with documented endpoints and execution envelopes.</li><li>The Workflow State Machine is implemented as an enforceable state machine (not ad hoc logic) and blocks transitions that violate rules.</li><li>Artifact versioning is enforced: no overwrite, immutable versions, lineage preserved.</li><li>Case-scoped isolation is enforced at every layer (UI/API/Orchestrator/Data/Tool Mediation).</li></ul><h4 id="b-determinism-replay-hard">B) Determinism &amp; Replay (Hard)</h4><ul><li>For every deterministic agent/job: identical inputs + pinned versions (model/tool/prompt/schema/config) produce reproducible outputs.</li><li>Deterministic replay is supported from audit logs + artifacts, including job envelope reconstruction.</li><li>Idempotency keys are enforced for all state-modifying operations.</li></ul><h4 id="c-governance-authority-hard">C) Governance &amp; Authority (Hard)</h4><ul><li>Only authorized roles may trigger privileged operations (Directive, Override, Publish/Export, Policy change).</li><li>Every privileged operation produces an immutable audit event, including actor, reason, timestamp, correlation id, and affected artifact version(s).</li><li>Advisory outputs cannot modify authoritative state without explicit approval and new versioned artifacts.</li></ul><h4 id="d-security-privacy-hard">D) Security &amp; Privacy (Hard)</h4><ul><li>Role-based access and case isolation are validated by test evidence.</li><li>Secrets are never logged; sensitive text redaction policies are enforceable.</li></ul><h4 id="e-operational-readiness-minimum">E) Operational Readiness (Minimum)</h4><ul><li>Monitoring, audit query APIs (role-gated), and failure alerting exist.</li><li>Backup and restore procedures exist and are test-verified.</li></ul><h4 id="f-test-evidence-required-hard">F) Test Evidence Required (Hard)</h4><ul><li>Antigravity must provide an implementation checklist mapping each “Hard” requirement to: code location, config location, test name(s), and proof artifact(s).</li></ul></section><section><h2 id="definitions-governing-principles">DEFINITIONS &amp; GOVERNING PRINCIPLES</h2><p>This section establishes the authoritative definitions and execution principles that govern the entire platform. All subsequent sections (Modules, Service Agents, System Components, Workflow, API, Orchestration, Governance) shall conform to these definitions.</p><hr/><h3 id="defined-terms">Defined Terms</h3><p>Agent</p><p>A governed software service operating within the Agent Orchestration Layer that performs structured tasks using defined inputs and produces versioned outputs (artifacts). Agents operate under policy constraints, permission controls, and audit requirements.</p><p>Deterministic Execution</p><p>An execution mode in which identical inputs, model versions, tool versions, prompts, and context produce reproducible outputs. Deterministic execution is mandatory for agents that influence case record integrity, readiness gating, or publish/export actions.</p><p>Non-Deterministic Execution</p><p>An execution mode that allows exploratory or advisory analysis. Non-deterministic outputs may inform strategy but may not automatically modify case artifacts or advance workflow state.</p><p>Artifact</p><p>A versioned, immutable output produced by an agent or user action. Artifacts include but are not limited to pleadings, mapping outputs, transcripts, audit reports, readiness reports, exposure analyses, discovery drafts, and structured data extracts. All artifacts must preserve provenance metadata.</p><p>Versioning</p><p>The requirement that all artifacts are immutable once created. New outputs must generate new versions. Historical versions must remain accessible and auditable.</p><p>Case Perspective</p><p>The structured, client-validated summary of facts, claims, damages, and contextual framing captured during intake. It forms the foundational reference for downstream case construction and mapping.</p><p>Directive</p><p>An explicit, auditable authorization recorded by a privileged role (e.g., Attorney/Partner) permitting access to gated external systems (e.g., legal research libraries) or privileged operations.</p><p>Workflow State</p><p>The current structured stage of a case within the defined Workflow sequence. Workflow transitions may require validation, approvals, and readiness checks.</p><p>Publish/Export</p><p>Any action that produces outward-facing legal artifacts, including pleadings, discovery packages, deposition designations, or trial materials. Publish/Export actions are subject to readiness validation and audit logging.</p><p>Override</p><p>A privileged action that bypasses a blocking condition. Overrides must be role-restricted, explicitly recorded, justified, and audit-logged.</p><p>Case Isolation</p><p>The strict separation of data, artifacts, context, and execution between cases. Agents may not access or compare data across cases unless explicitly authorized by system-level governance.</p><p>Tool Mediation</p><p>The requirement that all external integrations (LLMs, transcription, OCR, legal research systems, analytics engines, dictation services, APIs) are accessed exclusively through governed system layers. No direct UI or agent access to external tools is permitted.</p><p>DIKW (Data, Information, Knowledge, Wisdom)</p><p>The platform improves context, prediction, and automation across time and experience to scale the Data accumulation to Information structuring, to Knowledge indexing, to Wisdom constraints (governed decision support). The system scales intelligence through structured DIKW layering.</p><p>No agent may autonomously modify legal heuristics, cross-case knowledge, or workflow authority without explicit versioning and policy-defined approval.</p><h3 id="core-governing-principles">Core Governing Principles</h3><p>1. Case-Scoped Isolation</p><p>All data access, agent execution, and integrations must be restricted to the active case context unless explicitly authorized under system-level governance.</p><p>2. Deterministic Control Where Required</p><p>Agents that impact case integrity, readiness gating, publish/export actions, or structured legal outputs must execute deterministically. Advisory agents may operate in non-deterministic mode but may not alter authoritative artifacts without approval.</p><p>3. Artifact Immutability &amp; Provenance</p><p>All agent outputs and structured artifacts must:</p><p>• Be versioned</p><p>• Preserve provenance metadata</p><p>• Record originating agent</p><p>• Record execution mode</p><p>• Be auditable by timestamp, role, and correlation identifier</p><p>4. Policy-Gated Authority</p><p>Privileged operations (legal research access, publish/export, overrides, cross-role access modification) must:</p><p>• Require explicit authorization</p><p>• Be policy-validated</p><p>• Be audit logged</p><p>5. Separation of Advisory vs Blocking Agents</p><p>Advisory agents may:</p><p>• Generate reports</p><p>• Identify risks</p><p>• Recommend actions</p><p>Blocking agents may:</p><p>• Prevent workflow transitions</p><p>• Prevent publish/export</p><p>• Require override</p><p>Advisory agents may not silently assume blocking authority.</p><p>6. Structured Workflow Enforcement</p><p>Workflow progression must be explicit, state-driven, and validated. Major transitions require:</p><p>• Required artifacts present</p><p>• Blocking issues resolved</p><p>• Required approvals recorded</p><p>7. Auditability by Design</p><p>All privileged actions, artifact generations, agent runs, and overrides must emit structured audit events. Audit logs must be immutable and retrievable.</p><p>8. External Integration Governance</p><p>All external systems (LLMs, transcription engines, OCR services, legal research libraries, analytics tools) must:</p><p>• Be accessed only via the Integration Layer</p><p>• Enforce cost controls</p><p>• Enforce role-based permissions</p><p>• Enforce deterministic pinning where required</p><p>• Be logged</p><p>9. No Silent Mutation of Case Record</p><p>No agent may modify:</p><p>• Pleadings</p><p>• Mapping artifacts</p><p>• Case Perspective</p><p>• COA structures</p><p>without producing a new artifact version and recording the action.</p><p>10. Implementation-Ready Design</p><p>This document is intended for AI-driven implementation platforms (e.g., Antigravity) and must be interpreted as executable specification. Ambiguity should be resolved through explicit clarification, not inferred expansion.</p><h3 id="authority-mutation-matrix-hard-no-ambiguity">Authority &amp; Mutation Matrix (Hard) — No Ambiguity)</h3><p><strong>Purpose:</strong> The system enforces and eliminates ambiguity “who may modify what,” and all other operations are read-only or advisory. If an operation is not explicitly permitted below, it is prohibited.</p><h4 id="authoritative-data-state">Authoritative Data / State</h4><ul><li>Case Workflow State: modifiable only by Workflow State Machine Service and CONDUCTOR_AGENT authorization (deterministic).</li><li>Case Database Records: modifiable only via API Layer using validated commands with idempotency keys; agents do not write directly.</li><li>Policy &amp; Configuration: modifiable only by privileged firm roles; all changes versioned and audit logged.</li><li>Directives &amp; Overrides: modifiable only by Attorney/Partner (or explicitly designated role); reason required; immutable audit trail.</li></ul><h4 id="artifacts">Artifacts</h4><ul><li>Artifacts are immutable. “Edit” means “create a new version.”</li><li>Publish/Export packages may only be generated from approved artifact versions.</li></ul><h4 id="advisory-output">Advisory Output</h4><ul><li>Advisory agents may generate recommendations but cannot mutate authoritative state or advance workflow.</li><li>Any advisory-to-authoritative promotion requires explicit approval and produces a new artifact version + audit event.</li></ul><hr/></section><section><h2 id="document-style-numbering-standard-authoritative">DOCUMENT STYLE &amp; NUMBERING STANDARD (AUTHORITATIVE)</h2><h3 id="global-typography-rules-mandatory">Global Typography Rules (Mandatory)</h3><p>• Font: Aptos</p><p>• Font Size: 11 pt for all body content, bullets, and 10 pt for tables tables unless explicitly defined otherwise below. Word styles must be configured to match Aptos 11/10”</p><p>• Line Spacing: Single.</p><p>• Paragraph Spacing: 0 pt before / 0 pt after (unless otherwise specified).</p><p>• Margins: 1 inch (document-level).</p><p>• No manual spacing: do not “fake” spacing using repeated line breaks; use paragraph rules only.</p><h3 id="heading-style-rules-mandatory">Heading Style Rules (Mandatory)</h3><p>Headings MUST use Word heading styles (not manual bold/size).</p><p>• Heading 1: Document title only (single instance).</p><p>• Heading 2: Major sections (Objective, Definitions, Modules, etc.).</p><p>• Heading 3: Subsections under major sections (e.g., “9 AGENT ARCHITECTURE”).</p><p>• Heading 4: Individual agent headings (e.g., “9.1 INTAKE_AGENT”).</p><p>• Heading 5: Agent subsections (Description, Inputs, Outputs, etc.).</p><p>• Heading 6/7: Only if absolutely required for deep nesting; otherwise prohibited.</p><p>• Heading text is not italicized. Bold is handled by the heading style, not manual formatting.</p><h3 id="body-text-rules-mandatory">Body Text Rules (Mandatory)</h3><p>• Normal paragraphs MUST use Normal style (Aptos 11 point font).</p><p>• Use bold only for emphasis of terms/labels (short phrases).</p><p>• Use italics only for defined semantic purpose (e.g., artifact type names, variable-like tokens), not decoration.</p><p>• Do not mix manual indenting with styles.</p><h3 id="bullet-and-list-rules-mandatory">Bullet and List Rules (Mandatory)</h3><p>• All bulleted lists MUST use a single consistent bullet style:</p><p>o Bullet level 1: standard dot bullet</p><p>o Bullet level 2: dot bullet (indented)</p><p>o Bullet level 3: dot bullet (indented)</p><p>• No manual numbering inside bullets.</p><p>• All list indentation MUST be style-driven and consistent (no tabs/spaces).</p><p>• Bullets should not contain paragraph breaks unless a sub-bullet is required.</p><p>• List text remains Aptos 11, single spaced.</p><h3 id="numbering-rules-mandatory">Numbering Rules (Mandatory)</h3><p>• Section numbering MUST be hierarchical and stable: X, X.Y, X.Y.Z.</p><p>• Numbering is part of the heading text and must match the Heading level (e.g., Heading 4 uses “9.1”).</p><p>• New insertions use decimal expansion (e.g., insert between 9.2 and 9.3 becomes 9.2.1 or 9.2A per policy — pick one convention and apply consistently).</p><p>• Renumbering is prohibited unless a controlled revision is explicitly performed across the whole document.</p><h3 id="tables-if-used">Tables (If Used)</h3><p>• Table text: Aptos 10, single spaced.</p><p>• No nested tables.</p><p>• Header row uses bold.</p><p>• Columns use consistent alignment (left for text; right for numbers).</p><p>• Avoid tables when a bullet list expresses the contract more clearly.</p><h3 id="artifact-naming-agent-naming-convention-locked">Artifact Naming / Agent Naming Convention (Locked)</h3><p>• All agent names MUST be ALL CAPS with underscore connector, e.g., INTAKE_AGENT, FILE_INTAKE_AGENT.</p><p>• Artifact types use consistent casing and underscore form where defined (e.g., CASE_PERSPECTIVE, CASE_CONTEXT_PLAYBOOK, TEXT_VAULT, TEXT_CHUNKS).</p><p>• No alternate aliases (e.g., do not use EvidenceAgent when EVIDENCE_AUDIT_AGENT is authoritative).</p><hr/></section><section><h2 id="modules">MODULES</h2><p>This section defines the authoritative capability domains of the platform. Modules represent structured functional groupings that organize system behavior, agent responsibilities, data structures, workflow integration, and UI workspaces.</p><p>Modules are capability domains — not UI pages and not individual agents.</p><p>Each Module may contain multiple Service Agents and may span multiple system layers.</p><hr/><h3 id="intake-case-formation">Intake &amp; Case Formation</h3><p>This Module governs structured client onboarding, narrative capture, validation, and foundational case context construction.</p><p>Scope:</p><ul><li>Account creation and authentication</li><li>Guided interview process</li><li>Clarifying question loops</li><li>Structured case perspective creation</li><li>Client validation of firm understanding</li><li>Initial complaint and COA intake or generation</li><li>Dashboard state initialization</li></ul><p>Primary Service Agents:</p><ul><li>INTERVIEW_INTAKE_AGENT</li><li>ONBOARD_AGENT</li></ul><p>Outputs:</p><ul><li>Validated Case Perspective artifact</li><li>Initial workflow state</li><li>Intake audit record</li></ul><hr/><h3 id="evidence-data-processing">Evidence &amp; Data Processing</h3><p>This Module governs ingestion, validation, parsing, structuring, tagging, and database population of evidentiary material.</p><p>Scope:</p><ul><li>File upload session management</li><li>Authoritative file confirmation</li><li>Duplicate detection</li><li>Hashing and integrity validation</li><li>OCR and transcription mediation</li><li>Structured data extraction</li><li>Database population</li></ul><p>Primary Service Agents:</p><ul><li>FILE_INTAKE_AGENT</li><li>PROCESSING_AGENT</li></ul><p>Outputs:</p><ul><li>Structured evidence records</li><li>Versioned processed artifacts</li><li>Ingestion audit trail</li></ul><hr/><h3 id="pleadings-coa-construction">Pleadings &amp; COA Construction</h3><p>This Module governs complaint drafting, response drafting, COA structuring, element validation, and statutory alignment.</p><p>Scope:</p><ul><li>Complaint generation (Plaintiff)</li><li>Response generation (Defendant)</li><li>COA structuring and validation</li><li>Element completeness verification</li><li>Legal research mediation via Directive</li><li>Template alignment</li></ul><p>Primary Service Agents:</p><ul><li>PLEADING_AGENT</li><li>COMPLAINT_AGENT</li><li>COA_AGENT</li><li>RESPONSE_AGENT</li></ul><p>Outputs:</p><ul><li>Versioned pleadings</li><li>Structured COA artifact</li><li>Element validation report</li></ul><hr/><h3 id="mapping-traceability">Mapping &amp; Traceability</h3><p>This Module governs structured linkage between facts, evidence, pleadings, COA elements, discovery artifacts, and testimony.</p><p>Scope:</p><ul><li>Fact-to-evidence linkage</li><li>Evidence-to-COA mapping</li><li>Witness association</li><li>Chronological event construction</li><li>Traceability enforcement</li></ul><p>Primary Service Agents:</p><ul><li>MAPPING_AGENT</li><li>EVIDENCE_CORRELATION_AGENT</li><li>TIMELINE_AGENT</li></ul><p>Outputs:</p><ul><li>Mapping artifact</li><li>Traceability matrix</li><li>Chronology artifact</li></ul><hr/><h3 id="discovery-interrogatories">Discovery &amp; Interrogatories</h3><p>This Module governs structured interrogatory preparation, discovery compliance, objection management, and discovery artifact generation.</p><p>Scope:</p><ul><li>Interrogatory drafting</li><li>Objection standard validation</li><li>Discovery rule alignment</li><li>Privilege awareness</li><li>Specificity enforcement</li></ul><p>Primary Service Agents:</p><ul><li>INTERROGATORY_AGENT</li><li>OBJECTION_LIBRARY_AGENT</li></ul><p>Outputs:</p><p>• Interrogatory artifact</p><p>• Objection guidance artifact</p><hr/><h3 id="deposition-preparation-processing">Deposition Preparation &amp; Processing</h3><p>This Module governs deposition planning, transcript processing, testimony decomposition, contradiction detection, and designation preparation.</p><p>Scope:</p><ul><li>Deposition outline construction</li><li>Exhibit linkage</li><li>Testimony transcription ingestion</li><li>Semantic tagging</li><li>Contradiction detection</li><li>Designation recommendation</li><li>Cross-deposition comparison</li></ul><p>Primary Service Agents:</p><ul><li>DEPOSITION_PREP_AGENT</li><li>DEPOSITION_PROCESSING_AGENT</li></ul><p>Outputs:</p><ul><li>Deposition outline artifact</li><li>Transcript decomposition artifact</li><li>Contradiction analysis report</li><li>Designation recommendation artifact</li></ul><hr/><h3 id="subpoena-evidence-gap-identification">Subpoena &amp; Evidence Gap Identification</h3><p>This Module governs identification of missing evidence and structured subpoena generation.</p><p>Scope:</p><ul><li>Evidence gap analysis</li><li>Source identification</li><li>Subpoena type determination</li><li>Legal rule mediation via Directive</li><li>Enforceability validation</li></ul><p>Primary Service Agents:</p><ul><li>SUBPOENA_AGENT</li></ul><p>Outputs:</p><ul><li>Subpoena artifact</li><li>Evidence gap report</li></ul><hr/><h3 id="trial-preparation-strategy">Trial Preparation &amp; Strategy</h3><p>This Module governs structured trial readiness, burden alignment, admissibility analysis, strategic countering, and execution planning.</p><p>Scope:</p><ul><li>Trial strategy construction</li><li>Admissibility validation</li><li>Burden-shifting analysis</li><li>Evidence designation readiness</li><li>Defense prediction modeling</li></ul><p>Primary Service Agents:</p><ul><li>TRIAL_AGENT</li><li>OUTCOME_MODEL_AGENT</li></ul><p>Outputs:</p><ul><li>Trial strategy artifact</li><li>Admissibility validation artifact</li><li>Strategic risk assessment</li></ul><hr/><h3 id="case-integrity-validation">Case Integrity &amp; Validation</h3><p>This Module governs case completeness, artifact linkage validation, and defensibility enforcement.</p><p>Scope:</p><ul><li>Case-wide completeness review</li><li>Orphan artifact detection</li><li>Unsupported allegation detection</li><li>Contradiction detection</li><li>Missing artifact identification</li><li>Blocking condition creation</li></ul><p>Primary Service Agents:</p><ul><li>EVIDENCE_AUDIT_AGENT</li></ul><p>Outputs:</p><ul><li>evidence_audit_report artifact</li><li>Issue creation events</li><li>Blocking flags (policy-controlled)</li></ul><hr/><h3 id="adversarial-exposure-analysis">Adversarial Exposure Analysis</h3><p>This Module governs structured opposition-perspective review and counter-strategy modeling.</p><p>Scope:</p><ul><li>Weakness identification</li><li>Gap analysis</li><li>Inconsistency exposure</li><li>Defense strategy simulation</li><li>Counter-counter strategy recommendation</li></ul><p>Primary Service Agents:</p><ul><li>OPPOSITION_AGENT</li></ul><p>Outputs:</p><ul><li>Exposure analysis artifact</li><li>Counter-strategy report</li></ul><hr/><h3 id="workflow-governance-readiness">Workflow Governance &amp; Readiness</h3><p>This Module governs transition validation, publish/export gating, and structured readiness enforcement.</p><p>Scope:</p><ul><li>Workflow state validation</li><li>Required artifact verification</li><li>Approval validation</li><li>Blocking condition enforcement</li><li>Override logging</li></ul><p>Primary Service Agents:</p><ul><li>CONDUCTOR_AGENT</li></ul><p>Outputs:</p><ul><li>Readiness validation artifact</li><li>Blocking or approval signal</li></ul><hr/><h3 id="role-permission-policy-governance">Role, Permission &amp; Policy Governance</h3><p>This Module governs RBAC/ABAC enforcement, capability flags, and privileged action gating.</p><p>Scope:</p><ul><li>Role template enforcement</li><li>Capability flag issuance</li><li>Directive recording</li><li>Permission evaluation</li><li>Override logging</li></ul><p>Primary Service Components:</p><ul><li>Policy &amp; Configuration Store</li><li>Authorization Engine</li></ul><hr/><h3 id="audit-logging-observability">Audit, Logging &amp; Observability</h3><p>This Module governs immutable audit records, system traceability, and execution observability.</p><p>Scope:</p><ul><li>Privileged action logging</li><li>Agent execution logging</li><li>Artifact version tracking</li><li>Correlation ID propagation</li><li>Failure classification tracking</li></ul><hr/><h3 id="integration-tool-mediation">Integration &amp; Tool Mediation</h3><p>This Module governs controlled access to external services.</p><p>Scope:</p><ul><li>LLM provider mediation</li><li>Transcription services</li><li>OCR services</li><li>Legal research libraries</li><li>Analytics tools</li><li>Cost enforcement</li><li>Deterministic pinning where required</li></ul><p>Execution Constraint:</p><p>No external system may be accessed outside governed integration pathways.</p><p>3.15 Intelligence &amp; Knowledge Management Module</p><p>Supports:</p><ul><li>Knowledge indexing</li><li>Research caching</li><li>Cross-case pattern storage</li><li>Heuristic version control</li><li>Sanitized knowledge promotion</li><li>Knowledge rebuild from source cases</li></ul><p>This module is advisory only and cannot override case-scoped authority.</p><hr/></section><section><h2 id="service-agents">SERVICE AGENTS</h2><p>This section defines the authoritative catalog of Service Agents. Each Agent operates within governed system layers and conforms to the Definitions &amp; Governing Principles section.</p><p>All Agent names must appear in ALL CAPS with underscore and must match exactly across all sections of this document.</p><p>Each Agent definition uses the following persona-driven structure:</p><p>Description</p><p>Execution Mode</p><p>Responsibilities</p><p>Key Inputs</p><p>Key Outputs</p><p>Interacting Agents</p><p>Blocking Authority</p><p>Failure Classification</p><h3 id="interview_intake_agent">INTERVIEW_INTAKE_AGENT</h3><p>Description</p><p>Responsible for secure client onboarding and creation of the client-approved Case Perspective. Conducts guided intake, captures narrative, resolves ambiguity through clarifying questions, plays back the story in structured form, and requires explicit client validation prior to downstream processing.</p><p>Execution Mode</p><p>Non-Deterministic (interview, analysis, clarifying questions)</p><p>Deterministic (final Case Perspective artifact generation)</p><p>Responsibilities</p><ul><li>Create secure client account and activate login</li><li>Send authentication credentials and support secure access to the web application</li><li>Schedule and conduct guided interview</li><li>Prepare client with interview coaching and question framing</li><li>Ask structured and clarifying questions until deep case understanding is achieved</li><li>Detect ambiguity, contradiction, or incomplete narratives and resolve via follow-up questioning</li><li>Play back the client story in structured format</li><li>Produce text-based summary for client approval</li><li>Require explicit client validation before proceeding</li><li>Create case perspective rules, contextual narrative framework, and initial issue tagging</li><li>Capture preliminary complaint/COA status (existing vs create)</li><li>Prompt client to upload complaint/COA files if available or select “create”</li><li>Update dashboard status</li></ul><p>Key Inputs</p><ul><li>Client-provided narrative</li><li>Client identity and contact metadata</li><li>Uploaded initial documents (optional)</li><li>Interview configuration template</li><li>Firm intake policy templates (case-scoped)</li></ul><p>Key Outputs</p><ul><li>Versioned Case Perspective artifact (client-approved)</li><li>Intake transcript artifact (if audio/video captured)</li><li>Client validation approval record</li><li>Initial issue tagging artifact (case-scoped)</li><li>Complaint/COA status flag (existing vs create)</li><li>Audit events for all privileged intake actions</li></ul><p>Interacting Agents</p><ul><li>ONBOARD_AGENT</li><li>FILE_INTAKE_AGENT</li><li>PROCESSING_AGENT</li><li>PLEADING_AGENT</li><li>MAPPING_AGENT</li></ul><p>Blocking Authority</p><p>Blocks progression to downstream steps until Case Perspective is explicitly client-approved.</p><p>Failure Classification</p><p>Blocking — unresolved ambiguity or missing client validation prevents advancement.</p><hr/><h3 id="onboard_agent">ONBOARD_AGENT</h3><p>Description</p><p>Performs firm-level triage, conflict-of-interest screening, fit assessment, and acceptance routing. Produces a recommendation and routes the case for Partner confirmation consistent with firm rules.</p><p>Execution Mode</p><p>Deterministic</p><p>Responsibilities</p><ul><li>Conduct COI screening</li><li>Perform fit triage (practice area, risk, resource alignment)</li><li>Estimate projected case value</li><li>Generate recommendation to Partners (firm ownership)</li><li>Route case for acceptance or rejection</li><li>Apply system acceptance/rejection rules</li><li>Update dashboard status</li></ul><p>Key Inputs</p><ul><li>Case Perspective artifact</li><li>Client identity metadata</li><li>Firm COI rules and conflict datasets</li><li>Firm acceptance/rejection policy templates</li></ul><p>Key Outputs</p><ul><li>Conflict check artifact</li><li>Fit triage artifact</li><li>Case value estimate artifact (advisory)</li><li>Routing recommendation to Partners</li><li>Workflow state update</li><li>Audit events for screening and routing actions</li></ul><p>Interacting Agents</p><ul><li>INTERVIEW_INTAKE_AGENT</li><li>FILE_INTAKE_AGENT</li><li>CONDUCTOR_AGENT</li></ul><p>Blocking Authority</p><p>May block case activation if COI detected or if Partner confirmation is not recorded.</p><p>Failure Classification</p><p>Blocking — COI or missing Partner confirmation prevents case activation.</p><hr/><h3 id="file_intake_agent">FILE_INTAKE_AGENT</h3><p>Description</p><p>Authoritative file ingestion manager. Invites and supports client uploads, enforces accepted file types, tracks upload sessions, detects duplicates, establishes authoritative file set, and requires explicit client confirmation of session completion before processing.</p><p>Execution Mode</p><p>Deterministic</p><p>Responsibilities</p><ul><li>Invite and support client uploading case files</li><li>Restrict uploads to accepted file types</li><li>Track uploads by intake session</li><li>Detect duplicates using filename, file size, file type, hash comparison, and sample content comparison</li><li>Establish authoritative file set</li><li>Flag conflicting versions and track discrepancy corrections</li><li>Require client validation of upload session completion</li><li>Initiate PROCESSING_AGENT</li><li>Update dashboard status</li></ul><p>Key Inputs</p><ul><li>Client uploaded files</li><li>Upload session metadata</li><li>Accepted file type policy</li><li>Duplicate detection configuration</li></ul><p>Key Outputs</p><ul><li>Authoritative file set artifact</li><li>File hash registry artifact</li><li>Upload session completion record (client-confirmed)</li><li>Duplicate/conflict report artifact</li><li>Audit events for intake session actions</li></ul><p>Interacting Agents</p><ul><li>INTERVIEW_INTAKE_AGENT</li><li>PROCESSING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>CONDUCTOR_AGENT</li></ul><p>Blocking Authority</p><p>Blocks PROCESSING_AGENT invocation until upload session is validated and client confirms completion.</p><p>Failure Classification</p><p>Blocking — missing session confirmation prevents processing.</p><hr/><h3 id="processing_agent">PROCESSING_AGENT</h3><p>Description</p><p>System-of-record builder for case truth (non-advocacy). Consumes client-approved Case Perspective and authoritative files, performs OCR/STT/table extraction/entity extraction, builds the case database instance, assigns canonical IDs/hashes/tags/linkages, and flags ambiguity and discrepancies for human review.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Deterministic (database population, hashing, canonical IDs, structured extraction outputs)</p><p>Non-Deterministic (interpretive summarization components where used; outputs must be versioned)</p><p>Responsibilities</p><ul><li>Consume Case Perspective, approved interview data, and authoritative file set</li><li>Perform OCR, speech-to-text, table extraction, and entity extraction via Tool Mediation</li><li>Build database instance and populate structured records</li><li>Assign complaint linkage, COA tagging, evidence tagging, hashing, and canonical IDs</li><li>Highlight discrepancies, conflicting testimony, missing information, and ambiguities requiring human review</li><li>Log ingestion integrity</li><li>Update dashboard status</li></ul><p>Key Inputs</p><ul><li>Client-approved Case Perspective artifact</li><li>Authoritative file set artifact</li><li>Tool mediation configuration (OCR/STT/table extraction)</li><li>Case processing rules and extraction templates</li></ul><p>Key Outputs</p><ul><li>Structured evidence records (case database)</li><li>Parsed text artifacts (versioned)</li><li>Extraction outputs (tables/entities)</li><li>Ingestion integrity log artifact</li><li>Discrepancy and ambiguity report artifact</li><li>Audit events for processing runs</li></ul><p>Interacting Agents</p><ul><li>FILE_INTAKE_AGENT</li><li>MAPPING_AGENT</li><li>PLEADING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>OPPOSITION_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Blocking — failure to produce required structured outputs prevents downstream mapping/drafting readiness.</p><hr/><h3 id="pleading_agent">PLEADING_AGENT</h3><p>Description</p><p>Drafting authority for pleadings. Determines whether pleadings/COA exist or must be created, ingests existing pleadings where available, proposes new or revised pleadings, ensures structural sufficiency, and supports attorney review. Legal research access is Directive-gated and audit logged.</p><p>Execution Mode</p><p>Non-Deterministic (draft generation and proposal)</p><p>Deterministic (finalized artifact versioning, element checklist generation)</p><p>Responsibilities</p><ul><li>Determine whether complaint/COA exists or must be created</li><li>Ingest existing pleadings where available</li><li>Propose new or revised complaint/COA</li><li>Structure allegations using template standards</li><li>Confirm required legal elements are present</li><li>Ensure no statutory components are omitted</li><li>Notify attorney for review and update dashboard status</li></ul><p>Key Inputs</p><ul><li>Case Perspective artifact</li><li>Structured evidence records</li><li>Existing pleadings (if provided)</li><li>Pleading templates and standards</li><li>COA taxonomy (case-scoped)</li></ul><p>Key Outputs</p><ul><li>Versioned pleading draft artifacts</li><li>Element completeness report artifact</li><li>Proposed revisions artifact</li><li>Audit events for drafting and proposal actions</li></ul><p>Interacting Agents</p><ul><li>COMPLAINT_AGENT</li><li>COA_AGENT</li><li>RESPONSE_AGENT</li><li>MAPPING_AGENT</li><li>INTERROGATORY_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>CONDUCTOR_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — attorney approval required for use; cannot auto-publish.</p><hr/><h3 id="complaint_agent">COMPLAINT_AGENT</h3><p>Description</p><p>Sub-agent of PLEADING_AGENT responsible for plaintiff complaint creation or revision using templates and structured case record inputs, producing versioned complaint artifacts for attorney review.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Non-Deterministic (drafting)</p><p>Deterministic (versioned artifact output)</p><p>Responsibilities</p><ul><li>Draft or revise plaintiff complaint</li><li>Structure allegations consistently with templates</li><li>Maintain linkage readiness to COA elements and mapped evidence</li><li>Produce versioned complaint artifact for attorney review</li></ul><p>Key Inputs</p><ul><li>Case Perspective artifact</li><li>Structured evidence records</li><li>Complaint templates</li></ul><p>Key Outputs</p><ul><li>Versioned complaint artifact</li><li>Draft notes and change rationale artifact</li></ul><p>Interacting Agents</p><ul><li>PLEADING_AGENT</li><li>COA_AGENT</li><li>MAPPING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — attorney review required.</p><hr/><h3 id="coa_agent">COA_AGENT</h3><p>Description</p><p>Sub-agent of PLEADING_AGENT responsible for COA drafting/structuring and ensuring each COA includes required elements and is prepared for mapping to evidence and facts.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Non-Deterministic (COA drafting/proposal)</p><p>Deterministic (versioned COA artifact and element checklist)</p><p>Responsibilities</p><ul><li>Create or revise COA structure</li><li>Confirm element presence and completeness</li><li>Maintain mapping readiness for MAPPING_AGENT</li><li>Produce versioned COA artifact and element checklist</li></ul><p>Key Inputs</p><ul><li>Case Perspective artifact</li><li>Structured evidence records</li><li>COA taxonomy (case-scoped)</li></ul><p>Key Outputs</p><ul><li>Versioned COA artifact</li><li>COA element checklist artifact</li></ul><p>Interacting Agents</p><ul><li>PLEADING_AGENT</li><li>COMPLAINT_AGENT</li><li>MAPPING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — attorney review required.</p><hr/><h3 id="response_agent">RESPONSE_AGENT</h3><p>Description</p><p>Sub-agent of PLEADING_AGENT responsible for defendant response drafting or revision based on case record inputs and templates, producing versioned response artifacts for attorney review.</p><p>Execution Mode</p><p>Non-Deterministic (drafting)</p><p>Deterministic (versioned artifact output)</p><p>Responsibilities</p><ul><li>Draft or revise response pleadings</li><li>Ensure response structure conforms to standards</li><li>Produce versioned response artifact for attorney review</li><li>Key Inputs</li><li>Case record inputs</li><li>Response templates</li></ul><p>Key Outputs</p><ul><li>Versioned response artifact</li><li>Draft notes and change rationale artifact</li></ul><p>Interacting Agents</p><ul><li>PLEADING_AGENT</li><li>MAPPING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — attorney review required.</p><hr/><h3 id="mapping_agent">MAPPING_AGENT</h3><p>Description</p><p>Legal element and evidence correlation authority. Maps people, documents, evidence, and facts and connects each to complaint allegations and COA elements. Ensures traceability from fact → evidence → pleading and preserves audit trail of mapping decisions.</p><p>Execution Mode</p><p>Deterministic</p><p>Responsibilities</p><ul><li>Map people, documents, evidence, and facts</li><li>Connect mappings to complaint allegations and COA elements</li><li>Verify evidentiary support for each element</li><li>Ensure traceability from fact → evidence → pleading</li><li>Update dashboard status</li></ul><p>Key Inputs</p><ul><li>Structured evidence records</li><li>Pleading artifacts</li><li>COA artifact</li><li>Entity extraction outputs</li></ul><p>Key Outputs</p><ul><li>Mapping artifact</li><li>Traceability matrix artifact</li><li>Mapping decision audit events</li></ul><p>Interacting Agents</p><ul><li>PROCESSING_AGENT</li><li>PLEADING_AGENT</li><li>INTERROGATORY_AGENT</li><li>DEPOSITION_PREP_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>OPPOSITION_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — mapping gaps require correction prior to publish/export gating.</p><hr/><h3 id="interrogatory_agent">INTERROGATORY_AGENT</h3><p>Description</p><p>Discovery interrogatory drafting authority. Reviews case database for existing interrogatories, drafts interrogatories based on mapped COA and evidence gaps, ensures specificity and procedural compliance, suggests objections, and updates database with interrogatory mapping for attorney review.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Non-Deterministic (drafting and proposal)</p><p>Deterministic (versioned interrogatory artifact and mapping updates)</p><p>Responsibilities</p><ul><li>Review for existing interrogatories</li><li>Draft interrogatories aligned to mapped COA and evidence gaps</li><li>Ensure specificity and procedural compliance</li><li>Suggest objection language where appropriate</li><li>Prevent waiver of rights</li><li>Update database with interrogatory mapping</li><li>Notify attorney for review</li></ul><p>Key Inputs</p><ul><li>Mapping artifact</li><li>COA artifact</li><li>Structured evidence records</li><li>Discovery policy templates</li><li>Jurisdiction configuration (if applicable)</li></ul><p>Key Outputs</p><p>• Versioned interrogatory artifact</p><ul><li>Interrogatory mapping artifact</li><li>Objection suggestions artifact</li><li>Audit events for creation and updates</li></ul><p>Interacting Agents</p><ul><li>MAPPING_AGENT</li><li>OBJECTION_LIBRARY_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>CONDUCTOR_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — attorney review required.</p><hr/><h3 id="deposition_prep_agent">DEPOSITION_PREP_AGENT</h3><p>Description</p><p>Deposition strategy and outline builder. Reviews pleadings, discovery, and mapped evidence to build structured deposition outlines with exhibits, admission targets, and objection planning; prioritizes and sequences depositions and links evidence directly into the prep workspace.</p><p>Execution Mode</p><p>Non-Deterministic (outline drafting and strategy proposal)</p><p>Deterministic (versioned deposition outline artifact)</p><p>Responsibilities</p><ul><li>Determine existing deposition materials</li><li>Review pleadings, discovery, and mapped evidence</li><li>Build structured deposition outline: key inquiry areas, exhibits, admission targets, statements, anticipated objections</li><li>Prioritize and sequence depositions</li><li>Link documents and evidence into prep workspace</li><li>Design questioning strategy to obtain clear, admissible admissions aligned with Case Perspective</li><li>Notify attorney for review</li><li>Update dashboard status</li><li>Key Inputs</li><li>Pleading artifacts</li><li>Mapping artifact</li><li>Discovery artifacts</li><li>Witness profiles (if present)</li></ul><p>Key Outputs</p><ul><li>Versioned deposition outline artifact</li><li>Exhibit linkage list artifact</li><li>Deposition sequencing recommendation artifact</li></ul><p>Interacting Agents</p><ul><li>MAPPING_AGENT</li><li>WITNESS_TRACKING_AGENT</li><li>OBJECTION_LIBRARY_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>CONDUCTOR_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — attorney review required.</p><hr/><h3 id="deposition_processing_agent">DEPOSITION_PROCESSING_AGENT</h3><p>Description</p><p>Testimony analysis and contradiction detection authority. Ingests deposition audio/video, produces transcript via STT, applies semantic time markers, links testimony to complaint/COA elements, identifies contradictions and admissions, and prepares summaries, breakdowns, and designation recommendations.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Deterministic (ingestion, transcript generation, semantic time markers, linkage, tagging)</p><p>Non-Deterministic (summarization and narrative decomposition; outputs must be versioned)</p><p>Responsibilities</p><ul><li>Ingest video/audio depositions</li><li>Generate transcript via STT</li><li>Apply semantically labeled time markers</li><li>Connect testimony to complaint allegations and COA elements</li><li>Identify contradictions, inconsistencies, key admissions</li><li>Identify evidence supportive and damaging to client case</li><li>Perform cross-deposition comparisons</li><li>Identify non-determinative credibility indicators</li><li>Prepare summaries, issue-based breakdowns, designation recommendations, transcript/time alignment exports</li><li>Update database</li><li>Notify attorney</li></ul><p>Key Inputs</p><ul><li>Deposition media files</li><li>Pleading artifacts</li><li>COA artifact</li><li>Mapping artifact</li></ul><p>Key Outputs</p><ul><li>Versioned deposition transcript artifact</li><li>Time-marker index artifact</li><li>Contradiction and admissions report artifact</li><li>Issue-based breakdown artifact</li><li>Designation recommendation artifact</li><li>Transcript/time alignment export artifact</li></ul><p>Interacting Agents</p><ul><li>DEPOSITION_PREP_AGENT</li><li>MAPPING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>OPPOSITION_AGENT</li><li>CONDUCTOR_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — outputs require attorney review; blocking only when required artifacts fail to generate.</p><hr/><h3 id="subpoena_agent">SUBPOENA_AGENT</h3><p>Description</p><p>Evidence gap identification and subpoena drafting authority. Detects missing evidence/facts, identifies sources, determines subpoena type, generates subpoena targets and requested documents, and drafts subpoena language for attorney review.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Non-Deterministic (drafting)</p><p>Deterministic (versioned subpoena package artifact)</p><p>Responsibilities</p><ul><li>Detect missing evidence/facts</li><li>Identify source of missing information</li><li>Determine appropriate subpoena type</li><li>Generate list of subpoena targets</li><li>Specify documents/information requested</li><li>Draft subpoena language</li></ul><p>Key Inputs</p><ul><li>Evidence gap indicators</li><li>Mapping artifact</li><li>Case record evidence inventory</li><li>Jurisdiction configuration (if applicable)</li></ul><p>Key Outputs</p><ul><li>Versioned subpoena package artifact</li><li>Evidence gap report artifact</li><li>Subpoena target list artifact</li></ul><p>Interacting Agents</p><ul><li>MAPPING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>CONDUCTOR_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — attorney review required.</p><hr/><h3 id="trial_agent">TRIAL_AGENT</h3><p>Description</p><p>Trial strategy and tactical preparation authority. Consumes the structured case database and produces advisory trial strategy outputs, anticipates defense strategies, identifies weaknesses and mitigation plans, and prepares trial execution roadmap for attorney review.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Non-Deterministic; Advisory</p><p>Responsibilities</p><ul><li>Consume full case database</li><li>Propose trial strategy</li><li>Anticipate defense strategies</li><li>Identify weaknesses and mitigation strategies</li><li>Apply admissibility standards</li><li>Align depositions/interrogatories/discovery for trial use</li><li>Identify potential trial risks</li><li>Provide structured trial execution roadmap</li></ul><p>Key Inputs</p><ul><li>Full structured case record</li><li>Pleading artifacts</li><li>Discovery artifacts</li><li>Deposition artifacts</li><li>Court rule configuration (if applicable)</li></ul><p>Key Outputs</p><ul><li>Trial strategy artifact (advisory)</li><li>Trial execution roadmap artifact (advisory)</li><li>Risk and mitigation report artifact (advisory)</li></ul><p>Interacting Agents</p><ul><li>EVIDENCE_AUDIT_AGENT</li><li>OPPOSITION_AGENT</li><li>CONDUCTOR_AGENT</li><li>TIMELINE_AGENT</li><li>TRIAL_CALENDAR_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory — attorney decisions remain authoritative.</p><hr/><h3 id="evidence_correlation_agent">EVIDENCE_CORRELATION_AGENT</h3><p>Description</p><p>Performs advanced cross-reference of facts, documents, and testimony; identifies cross-document patterns and link candidates for mapping review.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Non-Deterministic (pattern discovery)</p><p>Deterministic (versioned link-candidate artifact)</p><p>Responsibilities</p><ul><li>Identify cross-document patterns</li><li>Propose link candidates for mapping review</li><li>Highlight duplicate or conflicting claims across sources</li></ul><p>Key Inputs</p><ul><li>Structured evidence records</li><li>Parsed text artifacts</li><li>Deposition artifacts (if present)</li></ul><p>Key Outputs</p><ul><li>Link-candidate artifact</li><li>Correlation summary artifact</li></ul><p>Interacting Agents</p><ul><li>MAPPING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>OPPOSITION_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory</p><hr/><h3 id="witness_tracking_agent">WITNESS_TRACKING_AGENT</h3><p>Description</p><p>Maintains witness profiles, testimony history, and links witnesses to exhibits and events derived from existing evidence and transcripts.</p><p>Execution Mode</p><p>Deterministic</p><p>Responsibilities</p><ul><li>Maintain witness profiles</li><li>Maintain testimony history</li><li>Link witnesses to exhibits and events</li><li>Preserve provenance of witness-related notes</li></ul><p>Key Inputs</p><ul><li>Structured entities</li><li>Deposition transcripts</li><li>Evidence artifacts</li></ul><p>Key Outputs</p><ul><li>Witness profile artifacts</li><li>Witness-to-exhibit linkage artifact</li></ul><p>Interacting Agents</p><ul><li>MAPPING_AGENT</li><li>DEPOSITION_PREP_AGENT</li><li>DEPOSITION_PROCESSING_AGENT</li><li>TIMELINE_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory</p><hr/><h3 id="timeline_agent">TIMELINE_AGENT</h3><p>Description</p><p>Constructs event chronology tied to evidence and testimony; supports visualization, contradiction detection, and trial sequencing.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Deterministic</p><p>Responsibilities</p><ul><li>Build event chronology</li><li>Link events to evidence and testimony</li><li>Support contradiction detection via timeline inconsistencies</li><li>Produce timeline suitable for trial sequencing</li></ul><p>Key Inputs</p><ul><li>Mapping artifact</li><li>Evidence artifacts</li><li>Deposition artifacts</li></ul><p>Key Outputs</p><ul><li>Timeline artifact</li><li>Event-to-evidence linkage artifact</li></ul><p>Interacting Agents</p><ul><li>MAPPING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>TRIAL_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory</p><hr/><h3 id="trial_calendar_agent">TRIAL_CALENDAR_AGENT</h3><p>Description</p><p>Integrates court deadlines and procedural milestones and supports reminders and task assignments aligned to trial readiness.</p><p>Execution Mode</p><p>Deterministic</p><p>Responsibilities</p><ul><li>Track court deadlines and milestones</li><li>Generate reminders and task triggers aligned to readiness</li><li>Support scheduling visibility for case team</li></ul><p>Key Inputs</p><ul><li>Court deadline data (entered or imported)</li><li>Case workflow state</li><li>Task and issue records</li></ul><p>Key Outputs</p><ul><li>Trial calendar artifact</li><li>Deadline reminder events</li><li>Task trigger events</li></ul><p>Interacting Agents</p><ul><li>CONDUCTOR_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>TRIAL_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory</p><hr/><h3 id="objection_library_agent">OBJECTION_LIBRARY_AGENT</h3><p>Description</p><p>Structured repository of objection language and standards; directive-gated where jurisdiction-specific legal research is required.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Deterministic (library retrieval and formatting)</p><p>Non-Deterministic (optional synthesis; outputs versioned)</p><p>Responsibilities</p><ul><li>Provide objection templates and standards</li><li>Support interrogatory and deposition workflows</li><li>Enforce directive-gating for jurisdiction-specific research where required</li></ul><p>Key Inputs</p><ul><li>Objection library repository</li><li>Jurisdiction configuration (if applicable)</li><li>Attorney Directive (if required)</li></ul><p>Key Outputs</p><ul><li>Objection guidance artifact</li><li>Template retrieval artifact</li></ul><p>Interacting Agents</p><ul><li>INTERROGATORY_AGENT</li><li>DEPOSITION_PREP_AGENT</li><li>PLEADING_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory</p><hr/><h3 id="outcome_model_agent">OUTCOME_MODEL_AGENT</h3><p>Description</p><p>Optional scenario modeling based on structured case data. Outputs are advisory only and cannot be used to auto-advance workflow or generate publishable legal conclusions.</p><p>Execution Mode</p><p>Non-Deterministic; Advisory</p><p>Responsibilities</p><ul><li>Generate scenario models and outcome ranges</li><li>Identify sensitivity factors within the structured case record</li><li>Provide advisory insights only</li></ul><p>Key Inputs</p><ul><li>Structured case record</li><li>Case financial analysis (if present)</li></ul><p>Key Outputs</p><ul><li>Outcome scenario artifact (advisory)</li></ul><p>Interacting Agents</p><ul><li>TRIAL_AGENT</li><li>OPPOSITION_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory</p><hr/><h3 id="evidence_audit_agent">EVIDENCE_AUDIT_AGENT</h3><p>Description</p><p>Performs scheduled and event-driven case-wide integrity checks to ensure all evidence and facts are accounted for and properly linked to Case Perspective, pleadings, COA elements, and downstream artifacts (interrogatories, depositions, subpoenas, trial prep).</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Deterministic; Non-Destructive</p><p>Responsibilities</p><ul><li>Validate completeness and traceability across Case Perspective, authoritative uploads, pleadings/COA, mapping, discovery artifacts, deposition artifacts, subpoena artifacts, trial prep artifacts, and financial evidence (if applicable)</li><li>Identify missing required artifacts for current workflow state</li><li>Identify orphan artifacts not mapped to allegations/COA</li><li>Identify COA elements lacking evidentiary support</li><li>Identify contradictions between Case Perspective and evidence, and across evidence sources</li><li>Identify unresolved issues blocking defensible outputs</li><li>Create Issues and Tasks (policy controlled) assigned to appropriate party with due dates and recommended disposition paths</li><li>Produce versioned evidence_audit_report artifact</li><li>Does not modify pleadings, mapping, Case Perspective, or COA taxonomy</li><li>Does not advance workflow automatically</li></ul><p>Key Inputs</p><ul><li>Full case artifact inventory</li><li>Mapping artifact</li><li>Current workflow state</li><li>Policy configuration for audit cadence and gating</li></ul><p>Key Outputs</p><ul><li>evidence_audit_report artifact (versioned)</li><li>Issue and Task creation events (policy controlled)</li><li>Blocking flags (policy controlled)</li></ul><p>Interacting Agents</p><ul><li>FILE_INTAKE_AGENT</li><li>PROCESSING_AGENT</li><li>MAPPING_AGENT</li><li>PLEADING_AGENT</li><li>INTERROGATORY_AGENT</li><li>DEPOSITION_PREP_AGENT</li><li>DEPOSITION_PROCESSING_AGENT</li><li>SUBPOENA_AGENT</li><li>TRIAL_AGENT</li><li>CONDUCTOR_AGENT</li></ul><p>Blocking Authority</p><p>Policy-controlled; may block publish/export and/or workflow transitions when required by configured governance.</p><p>Failure Classification</p><p>Blocking when policy requires; otherwise advisory with required remediation outputs.</p><hr/><h3 id="opposition_agent">OPPOSITION_AGENT</h3><p>Description</p><p>Simulates opposing counsel strategy using the current structured case record. Identifies exposure risks, credibility vulnerabilities, procedural weaknesses, strategic counterarguments, and evidence insufficiencies.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Deterministic; Non-Destructive; Advisory</p><p>Responsibilities</p><ul><li>Analyze case record from opposition perspective using only the case record</li><li>Identify exposure risks and weaknesses</li><li>Identify credibility vulnerabilities based on existing artifacts</li><li>Identify procedural weaknesses and potential objection strategies</li><li>Identify strategic counterarguments and evidence insufficiencies</li><li>Produce versioned opposition_exposure_report artifact</li><li>Does not modify case artifacts</li><li>Does not advance workflow automatically</li></ul><p>Key Inputs</p><ul><li>Structured case record</li><li>Pleading and mapping artifacts</li><li>Discovery and deposition artifacts (if present)</li><li>Evidence audit outputs (if present)</li></ul><p>Key Outputs</p><ul><li>opposition_exposure_report artifact (versioned)</li><li>Advisory counter-strategy recommendations artifact</li></ul><p>Interacting Agents</p><ul><li>EVIDENCE_AUDIT_AGENT</li><li>MAPPING_AGENT</li><li>TRIAL_AGENT</li><li>CONDUCTOR_AGENT</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Advisory</p><hr/><h3 id="conductor_agent">CONDUCTOR_AGENT</h3><p>Description</p><p>Workflow Integrity Governor. Validates readiness conditions before major workflow transitions and publish/export actions to enforce defensible progression.</p><p>Evidence Integrity Enforcement</p><p>Operates under Zero Hallucination Rule (see 9.2B).</p><ul><li>May not generate or imply facts not traceable to authoritative case sources.</li><li>All outputs must include evidence trace references.</li><li>Insufficient evidence results in Issue creation, not inference.</li><li>Deterministic execution required for artifact generation.</li></ul><p>Execution Mode</p><p>Deterministic</p><p>Responsibilities</p><ul><li>Validate readiness conditions prior to workflow stage transition</li><li>Validate required artifacts exist for current stage</li><li>Ensure EVIDENCE_AUDIT_AGENT is current when required</li><li>Ensure required approvals are recorded</li><li>Ensure blocking issues resolved or attorney override recorded</li><li>Produce versioned conductor_readiness_report artifact</li><li>Gate publish/export actions where policy requires</li><li>Does not modify case artifacts</li></ul><p>Key Inputs</p><ul><li>Workflow state</li><li>Artifact inventory</li><li>Approval records</li><li>evidence_audit_report artifact (when required)</li><li>Policy gating configuration</li></ul><p>Key Outputs</p><ul><li>conductor_readiness_report artifact (versioned)</li><li>Workflow transition authorization or block decision</li><li>Publish/export authorization or block decision</li></ul><p>Interacting Agents</p><ul><li>All workflow agents (case-scoped)</li><li>EVIDENCE_AUDIT_AGENT</li><li>OPPOSITION_AGENT</li></ul><p>Blocking Authority</p><p>Yes — may block workflow transitions and publish/export actions unless attorney override is recorded.</p><p>Failure Classification</p><p>Blocking</p><h3 id="knowledge_index_agent">KNOWLEDGE_INDEX_AGENT</h3><p>Description</p><p>Indexes structured information and artifacts into versioned Knowledge Store entries.</p><p>Execution Mode</p><p>Deterministic; Non-Destructive</p><p>Responsibilities</p><ul><li>Extract reusable structured patterns</li><li>Store source-case references</li><li>Maintain versioned heuristic registry</li><li>Support rebuild operations</li></ul><p>Blocking Authority</p><p>None</p><p>Failure Classification</p><p>Integrity-critical — rebuildable from case data</p><hr/></section><section><h2 id="system-components">SYSTEM COMPONENTS</h2><p>This section defines the authoritative system components required to implement the platform. Components are organized to support modularity, case isolation, governed tool mediation, auditability, and agent orchestration.</p><p>All components must enforce:</p><p>Case-scoped isolation</p><ul><li>RBAC/ABAC permission controls</li><li>Directive-gated privileged actions</li><li>Versioned artifacts with provenance</li><li>Audit logging with correlation identifiers</li><li>Deterministic execution where required</li></ul><hr/><h3 id="presentation-layer-web-application-ui">PRESENTATION LAYER (WEB APPLICATION UI)</h3><p>Description</p><p>Role-based portals and workspaces for Clients and Firm users. Provides workflow-aligned workspaces, governance controls, and auditable communications. The UI does not directly access databases or external services.</p><p>Capabilities</p><ul><li>Role-based portals: Client, Attorney/Partner, Paralegal/Staff, Office Operations, Case Accounting (and optional Firm Accounting if enabled)</li><li>Workspaces aligned to workflow steps: intake/interview, file upload, pleadings/COA, mapping, discovery, deposition, subpoenas, trial prep</li><li>Governance workspaces: directives/approvals, policy/case settings, audit views, billing/cost visibility, secure messaging, issues and tasks</li><li>Dashboard status visibility per case with readiness and blocking signals</li></ul><p>Controls</p><ul><li>All reads/writes must occur through authenticated Application/API endpoints</li><li>UI must rely on server-provided capability flags for permission gating</li><li>UI must emit auditable actions for privileged and case-impacting events</li><li>UI must support out-of-box firm default policy templates with minimal configuration</li></ul><p>Primary Interfaces</p><ul><li>HTTPS Web UI (authenticated)</li><li>Secure portal messaging interface (via API)</li></ul><hr/><h3 id="applicationapi-layer-web-api-workflow-services">APPLICATION/API LAYER (WEB API + WORKFLOW SERVICES)</h3><p>Description</p><p>Authoritative server-side layer that enforces permissions, case isolation, workflow state transitions, artifact versioning, audit logging, and orchestration invocation. All UI and system actions route through this layer.</p><p>Core Responsibilities</p><ul><li>Authentication and session management</li><li>RBAC/ABAC authorization evaluation</li><li>Capability flag issuance to UI</li><li>Workflow state machine enforcement</li><li>Case-scoped service endpoints for reading/writing structured data</li><li>Directive recording and privileged action gating</li><li>Artifact creation, immutability, and version management</li><li>Issue and task lifecycle management</li><li>Audit event emission and correlation propagation</li><li>Invocation contract to Agent Orchestration Layer</li></ul><p>Controls</p><ul><li>No UI direct database access</li><li>No Agent direct database access (Agents act through orchestration contracts)</li><li>All external integrations invoked only through the Integration Layer</li><li>Deterministic enforcement for blocking operations</li></ul><hr/><h3 id="agent-orchestration-layer-agent-runtime-job-control">AGENT ORCHESTRATION LAYER (AGENT RUNTIME + JOB CONTROL)</h3><p>Description</p><p>Runs governed Service Agents, enforces execution mode constraints, manages job scheduling, coordinates multi-agent flows, and ensures deterministic/non-deterministic separation. This layer is the exclusive execution environment for all Agent operations.</p><p>Core Responsibilities</p><ul><li>Agent invocation and lifecycle control</li><li>Job queue management and retries</li><li>Policy evaluation for agent triggers (scheduled and event-driven)</li><li>Execution mode enforcement (deterministic vs non-deterministic)</li><li>Context assembly for agent execution (case-scoped)</li><li>Artifact generation and versioning coordination</li><li>Failure handling, classification, and escalation</li><li>Tool requests routing through Integration Layer gateways</li><li>Produces job telemetry and audit hooks to API Layer</li></ul><p>Controls</p><ul><li>Agents may not directly call external APIs</li><li>Agents may not directly access databases</li><li>Agents may not modify authoritative artifacts without producing versioned outputs</li><li>Blocking Agents must execute deterministically</li></ul><hr/><h3 id="integration-layer-mcp-api-gateways-tool-mediation">INTEGRATION LAYER (MCP / API GATEWAYS / TOOL MEDIATION)</h3><p>Description</p><p>Governed mediation layer for all external tools and systems. All LLM providers and tool services are accessed exclusively through this layer to enforce policy, cost controls, audit logging, and case isolation.</p><p>Tool Mediation Scope</p><ul><li>LLM providers (e.g., Claude or equivalent)</li><li>Dictation and transcription services (e.g., Otter or equivalent)</li><li>OCR services</li><li>Table extraction services</li><li>External legal library systems (directive-gated)</li><li>Notification services (email/SMS/in-app)</li><li>File storage repositories (if externalized)</li></ul><p>Core Responsibilities</p><ul><li>Enforce tool access permissions and directive gating</li><li>Enforce case-scoped isolation for tool requests and responses</li><li>Enforce cost caps and usage accounting</li><li>Pin tool/model versions where deterministic execution is required</li><li>Emit tool invocation audit events</li><li>Maintain provider configuration, failover rules, and allowlists/denylists</li></ul><p>Controls</p><ul><li>No direct tool calls from UI</li><li>No direct tool calls from Agents</li><li>All tool invocations must include correlation identifier and case identifier</li><li>Legal library access must require explicit Directive</li></ul><hr/><h3 id="document-media-processing-engine">DOCUMENT &amp; MEDIA PROCESSING ENGINE</h3><p>Description</p><p>Internal service set responsible for OCR, STT, table extraction, and normalization pipelines used by PROCESSING_AGENT and DEPOSITION_PROCESSING_AGENT. Uses Integration Layer mediation for external engines.</p><p>Capabilities</p><ul><li>OCR and page-level text extraction</li><li>Audio/video speech-to-text transcription</li><li>Table extraction and structured conversion</li><li>Entity extraction and normalization</li><li>File format normalization and preview generation</li><li>Quality checks and confidence scoring (where supported)</li></ul><p>Controls</p><ul><li>Must preserve original file integrity</li><li>Must produce versioned outputs (no overwrite)</li><li>Must log provenance: tool, version, timestamp, correlation identifier</li></ul><hr/><h3 id="case-database-case-scoped-system-of-record">CASE DATABASE (CASE-SCOPED SYSTEM OF RECORD)</h3><p>Description</p><p>Authoritative case database instance storing structured case data, evidence linkages, artifacts, mappings, and workflow state references. Supports strict case isolation.</p><p>Data Scope</p><ul><li>Case metadata and parties</li><li>Case Perspective (versioned)</li><li>Evidence inventory and hashes</li><li>Structured facts and entities</li><li>Mapping and traceability records</li><li>Discovery artifacts and linkages</li><li>Deposition artifacts and linkages</li><li>Subpoena artifacts and linkages</li><li>Trial preparation artifacts and linkages</li><li>Case financial analysis (evidentiary domain)</li></ul><p>Controls</p><ul><li>Case isolation enforced by design</li><li>All writes via API Layer and governed orchestration contracts</li><li>All changes create new versions or immutable records as defined</li><li>Supports audit log correlation</li></ul><hr/><h3 id="artifact-store-versioned-immutable-output-repository">ARTIFACT STORE (VERSIONED, IMMUTABLE OUTPUT REPOSITORY)</h3><p>Description</p><p>Stores all versioned artifacts generated by Agents and privileged user actions. Provides immutable retention with provenance metadata and retrieval for defensibility.</p><p>Capabilities</p><ul><li>Immutable artifact storage</li><li>Version lineage tracking</li><li>Artifact typing and schema enforcement</li><li>Retrieval and export packaging (directive-gated)</li></ul><p>Controls</p><ul><li>No overwrite permitted</li><li>All artifacts must include provenance metadata</li><li>Export must be audit logged and readiness gated where required</li></ul><hr/><p>Description</p><p>Holds firm-wide and case-scoped policies controlling permissions, workflow gating, agent triggers, retention rules, cost caps, and directive requirements.</p><p>Policy Scope</p><ul><li>Role templates and permissions (RBAC/ABAC rules)</li><li>Capability flag rules for UI gating</li><li>Workflow required artifact rules</li><li>Publish/export gating rules</li><li>Evidence audit cadence and triggers</li><li>Tool mediation allowlists and provider routing</li><li>Cost caps and usage thresholds</li><li>Retention and privacy rules</li></ul><p>Controls</p><ul><li>Policy changes must be audit logged</li><li>Policy changes must be versioned</li><li>Case-scoped policies override firm defaults only when explicitly configured</li></ul><hr/><h3 id="authorization-permissions-engine-rbacabac">AUTHORIZATION &amp; PERMISSIONS ENGINE (RBAC/ABAC)</h3><p>Description</p><p>Evaluates role-based and attribute-based permissions for every privileged and case-impacting action. Issues capability flags used by the UI and enforces directive-gated actions.</p><p>Capabilities</p><ul><li>Evaluate permissions for API requests</li><li>Issue capability flags to UI per user per case</li><li>Enforce directive gating for privileged actions</li><li>Support just-in-time approvals to reduce attorney overhead</li></ul><hr/><h3 id="workflow-state-machine-service">WORKFLOW STATE MACHINE SERVICE</h3><p>Description</p><p>Implements authoritative workflow progression rules and gating conditions. Ensures workflow transitions are explicit, validated, and auditable.</p><p>Capabilities</p><ul><li>Maintain case workflow state</li><li>Validate required artifacts prior to transition</li><li>Enforce blocking conditions and overrides</li><li>Coordinate readiness gating with CONDUCTOR_AGENT</li><li>Emit workflow audit events</li></ul><hr/><h3 id="issue-task-management-service">ISSUE &amp; TASK MANAGEMENT SERVICE</h3><p>Description</p><p>Tracks issue lifecycle and task assignments across client and firm roles. Supports closure discipline, due dates, escalations, and linkage to artifacts and communications.</p><p>Capabilities</p><ul><li>Issue creation, assignment, status progression</li><li>Task creation, assignment, due dates, escalation rules</li><li>Link issues/tasks to artifacts, messages, approvals, workflow stage</li><li>Dashboard rollups and backlog views</li></ul><hr/><h3 id="communications-service-auditable-case-messaging">COMMUNICATIONS SERVICE (AUDITABLE CASE MESSAGING)</h3><p>Description</p><p>Provides secure, auditable communications between client and firm members and across firm roles. All communications are stored as case artifacts and linked to issues and decisions where applicable.</p><p>Capabilities</p><ul><li>Secure portal messaging</li><li>Threading and issue linkage</li><li>Decision capture and acknowledgment workflows</li><li>Notification triggers (via Integration Layer)</li></ul><p>Controls</p><ul><li>All messages are immutable records (append-only)</li><li>All message actions must be audit logged</li><li>Cross-case visibility prohibited</li></ul><hr/><h3 id="audit-logging-observability-stack">AUDIT LOGGING &amp; OBSERVABILITY STACK</h3><p>Description</p><p>Immutable audit logging and operational observability spanning UI actions, API calls, agent runs, tool invocations, artifact creation, policy changes, directives, overrides, and publish/export events.</p><p>Audit Coverage</p><ul><li>User actions (privileged and case-impacting)</li><li>Agent executions and job results</li><li>Tool invocations and cost accounting</li><li>Artifact creation and version lineage</li><li>Workflow transitions and overrides</li><li>Policy modifications</li></ul><p>Controls</p><ul><li>Audit logs are immutable</li><li>Audit logs include correlation identifiers</li><li>Audit logs support defensibility and reproducibility</li></ul><hr/><h3 id="cost-usage-accounting-service">COST &amp; USAGE ACCOUNTING SERVICE</h3><p>Description</p><p>Tracks system usage, tool consumption, and cost attribution by case and by role. Supports cost caps, anomaly detection, and billing exports.</p><p>Capabilities</p><ul><li>Per-case usage ledger</li><li>Per-tool usage tracking (LLM/OCR/STT/legal research)</li><li>Cost caps and budget alerts</li><li>Exportable billing summaries (role-gated)</li><li>Anomaly detection triggers (policy controlled)</li></ul><p>Controls</p><ul><li>No exposure of case evidence in operational cost views beyond attribution metadata</li><li>Billing exports are audit logged and readiness gated where required</li><li>5.15 Knowledge Store (Versioned; Rebuildable)</li></ul><p>Purpose</p><p>Stores structured, versioned Knowledge artifacts derived from case data.</p><p>Constraints</p><ul><li>Rebuildable from source cases</li><li>Permission-scoped</li><li>Sanitized for cross-case use</li><li>Separate from Active Case DB</li><li>Versioned and audit-tracked</li></ul><hr/></section><section><h2 id="system-architecture-overview">SYSTEM ARCHITECTURE OVERVIEW</h2><p>This section defines the layered, production-grade architecture required for an Antigravity-built implementation. The architecture enforces case isolation, auditability, deterministic governance, and mediated tool access, while supporting DIKW intelligence scaling through controlled, versioned artifacts and governed knowledge promotion.</p><h3 id="architectural-goals-authoritative">Architectural Goals (Authoritative)</h3><p>Enforce strict case-scoped isolation for all data, artifacts, agent actions, and permissions.</p><p>Provide deterministic workflow gating and reproducibility (pinned models/tools where required).</p><p>Ensure every privileged or case-impacting action is auditable, versioned, and reconstructable.</p><p>Support high-throughput ingestion (TEXT_VAULT + TEXT_CHUNK) and scalable retrieval for UI workspaces.</p><p>Enable mediated integrations (LLMs/OCR/STT/legal libraries) with policy, cost controls, and audit hooks.</p><p>Support DIKW scaling via a rebuildable Knowledge Store and governed cross-case promotion.</p><p>Isolate failure domains so external outages do not corrupt workflow state or case integrity.</p><h3 id="layered-architecture-authoritative">Layered Architecture (Authoritative)</h3><p>All reads/writes and all external tool usage must pass through governed layers. The Presentation Layer may not directly access databases or external services.</p><p>Layers:</p><h4 id="presentation-layer-web-ui-portals">Presentation Layer (Web UI Portals)</h4><ul><li>Role-based portals and workspaces (Client, Attorney/Partner, Staff, Operations, Accounting).</li><li>No direct DB access; no direct external API access.</li><li>Uses server-provided capability flags for permission gating and emits auditable UI events.</li></ul><h4 id="applicationapi-layer-web-api-workflow-services-2">Application/API Layer (Web API + Workflow Services)</h4><ul><li>Authentication, authorization (RBAC/ABAC), directives, issues/tasks, artifact APIs.</li><li>Workflow state machine enforcement and dashboard state contract.</li><li>Invokes Agent Orchestration Layer for drafting/analysis operations.</li></ul><h4 id="agent-orchestration-layer">Agent Orchestration Layer</h4><ul><li>Runs agent plans, coordinates multi-agent execution, and enforces deterministic vs non-deterministic boundaries.</li><li>Schedules jobs (ProcessingJob, EvidenceAuditJob, DepositionProcessingJob, etc.) via the Job/Queue subsystem.</li><li>Captures invocation lineage, inputs, outputs, and audit hooks for each agent run.</li><li>Integration / Tool Mediation Layer (MCP + Connectors)</li><li>Single controlled gateway for all external tools: LLM providers (e.g., Claude), OCR, STT/dictation, legal libraries, email/calendar, storage.</li><li>Enforces policies: data scope, redaction/PII rules, caching rules, quotas/caps, provider allowlist, and audit logging.</li><li>Provides provider abstraction (swap providers without changing upstream layers).</li><li>Document &amp; Media Processing Engine</li><li>OCR, STT, table extraction, normalization, and content decomposition.</li><li>Produces TEXT_VAULT and TEXT_CHUNK outputs with provenance and integrity metadata.</li><li>Runs as workers behind orchestration; never directly exposed to UI.</li></ul><h4 id="data-layer">Data Layer</h4><ul><li>Data Stores (Authoritative + Derived)</li><li>Active Case Store (authoritative case record).</li><li>Artifact Store (versioned immutable artifacts and exports).</li><li>Audit Log Store (immutable append-only).</li><li>Archive Store (closed cases; read-only by default).</li><li>Knowledge Store (derived, rebuildable; sanitized and permission-scoped).</li><li>Operational Finance Store (firm operations; separated from case evidence).</li></ul><h4 id="policy-configuration-layer">Policy &amp; Configuration layer</h4><ul><li>Firm templates, retention policies, budgets/caps, directive rules, permission templates.</li><li>Versioned policy changes and effective-dated configuration.</li></ul><h4 id="observability-operations-layer">Observability &amp; Operations layer</h4><ul><li>Centralized logs, metrics, traces, alerting, usage/cost ledger, anomaly detection.</li><li>Runbooks and admin endpoints; no direct access to case evidence unless explicitly authorized.</li></ul><h3 id="trust-boundaries-enforcement-points">Trust Boundaries &amp; Enforcement Points</h3><p>Trust boundaries define where authentication, authorization, policy enforcement, and auditing must occur. These are mandatory enforcement points.</p><p><strong>UI Boundary:</strong> authenticated session + capability flags; no privileged action without server validation.</p><p><strong>API Boundary:</strong> RBAC/ABAC enforcement, directive enforcement, audit emission, case isolation enforcement.</p><p><strong>Orchestration Boundary:</strong> agent invocation controls, deterministic pinning, input/output lineage capture.</p><p><strong>Tool Boundary:</strong> Integration Layer gateway is mandatory; no direct external calls permitted.</p><p><strong>Data Boundary:</strong> case isolation enforced at query, storage, and encryption key scopes (policy-defined).</p><p><strong>Audit Boundary:</strong> immutable append-only; tamper detection and reconstruction support.</p><h3 id="runtime-topology-services-and-workers">Runtime Topology (Services and Workers)</h3><p>The platform runs as a set of stateless services plus stateful data stores. Long-running or heavy operations execute in worker pools.</p><p>7.4.1 Core Runtime Components</p><p>Web Frontend (Presentation Layer).</p><p>API Service (Application/API Layer).</p><p>Auth Service (may be embedded or separate) with MFA/step-up enforcement.</p><p>Workflow Service (state machine) (may be embedded or separate).</p><p>Agent Orchestrator Service.</p><p>Job Queue + Scheduler (supports retries, idempotency, DLQ).</p><p>Processing Workers (OCR/STT/table extraction/entity extraction).</p><p>Drafting/Analysis Workers (agent runs, report generation).</p><p>Search/Index Service (optional; supports text/chunk retrieval and filtering).</p><h3 id="canonical-data-flow-end-to-end">Canonical Data Flow (End-to-End)</h3><p>This flow is authoritative and must be implemented exactly as layered interactions.</p><h4 id="client-and-staff-interactions">Client and Staff Interactions</h4><ul><li>User action in UI → API request with auth token + correlation_id.</li><li>API validates RBAC/ABAC + case scope + directives (if needed).</li><li>API writes/reads only through data access services; emits audit events.</li><li>If operation requires agent work: API → Orchestrator Invocation Contract → enqueue job(s).</li><li>Workers execute job(s), storing outputs as versioned artifacts and updating workflow state.</li><li>API updates dashboard state contract; UI reads updated state and renders capability-gated actions.</li></ul><h4 id="tool-invocation-flow-mediated">Tool Invocation Flow (Mediated)</h4><ul><li>Orchestrator/Workers request tool use via Integration Layer gateway.</li><li>Integration Layer enforces: provider allowlist, data minimization, redaction, budgets/caps, caching, and audit hooks.</li><li>Tool results are stored as artifacts (or cached knowledge) with provenance and version metadata.</li><li>No raw external tool outputs may be treated as authoritative evidence without linkage to source and validation rules.</li></ul><h3 id="availability-domains-dikw-aware">Availability Domains (DIKW-Aware)</h3><p>Availability is multi-domain due to active cases, archives, knowledge indexing, and mediated external dependencies.</p><p><strong>Transactional Availability:</strong> UI/API/orchestration for active cases.</p><p><strong>Authoritative Data Availability:</strong> Active Case Store + Artifact Store + Audit Store.</p><p><strong>Knowledge Availability:</strong> Knowledge Store and Research Cache (derived and rebuildable).</p><p><strong>External Dependency Availability:</strong> legal library APIs, OCR/STT providers, LLM providers.</p><p>Failure isolation rules:</p><p>Active case execution must continue if Archive Store is unavailable.</p><p>Active case execution must continue if Knowledge Store is unavailable (knowledge is advisory).</p><p>External legal library outages must fall back to cached research when permitted; otherwise require directive-based retry.</p><p>No external outage may corrupt workflow state; jobs must be idempotent and resumable.</p><h3 id="determinism-reproducibility-controls">Determinism &amp; Reproducibility Controls</h3><p>Deterministic gating jobs (EVIDENCE_AUDIT_AGENT, CONDUCTOR_AGENT) must use version-pinned models/tools and produce reproducible outputs.</p><p><strong>All artifacts must store provenance:</strong> inputs, tool/model versions, correlation_id, and run metadata.</p><p>Workflow transitions must be deterministic and replayable from artifacts and audit logs.</p><h3 id="idempotency-correlation-hard">Idempotency &amp; Correlation (Hard)</h3><p>All state-modifying operations and all artifact-producing jobs must be idempotent.</p><h4 id="required-fields">Required Fields</h4><ul><li>correlation_id: required for every API request, agent job, tool call, artifact write, audit event</li><li>idempotency_key: required for every mutation or artifact write request</li><li>request_hash: hash of canonicalized inputs used for deterministic replay</li></ul><h4 id="required-rules">Required Rules</h4><ul><li>Duplicate idempotency_key within the same case scope must not create additional artifacts or state changes; it must return the existing result reference.</li><li>correlation_id must propagate end-to-end across: UI → API → Orchestrator → Integration Layer → Tool Provider → back.</li><li>If correlation_id is missing, the request is rejected (HTTP 400 or equivalent).</li></ul><h3 id="build-ready-interfaces-what-antigravity-must-implement">Build-Ready Interfaces (What Antigravity Must Implement)</h3><p>This section defines the minimum set of architectural interfaces required to implement the platform.</p><p>Authenticated API surface implementing the dashboard contract, artifact APIs, directives, issues/tasks, and role/capability flags.</p><p>Agent invocation contract between API and Orchestrator (job enqueue + run metadata + callbacks).</p><p>Integration Layer gateway APIs for all tools/providers, including caching and cost ledger hooks.</p><p>Data access layer enforcing case isolation and separation of authoritative vs derived stores.</p><p>Immutable audit store with query APIs (role-gated).</p><h3 id="canonical-interface-contracts-hard-minimum-required-endpoints">Canonical Interface Contracts (Hard) — Minimum Required Endpoints</h3><p>Antigravity must implement an authenticated API surface with the minimum semantic groups below. Exact paths may vary, but capability must match.</p><h4 id="a-case-identity">A) Case &amp; Identity</h4><ul><li>Create/read/update case metadata (case-scoped)</li><li>Role assignment and capability flags issuance (role-gated)</li><li>Session/auth endpoints</li></ul><h4 id="b-workflow-state-machine">B) Workflow State Machine</h4><ul><li>Get current workflow state + allowed next transitions</li><li>Request transition (validates gates, artifacts, blockers, approvals)</li><li>Override transition (Attorney-only; reason required; audit event required)</li></ul><h4 id="c-artifact-store">C) Artifact Store</h4><ul><li>Create artifact version (immutable write)</li><li>Retrieve artifact version(s) and lineage</li><li>Generate export package (publish/export gating enforced)</li><li>Artifact schema validation endpoint (reject nonconforming payloads)</li></ul><h4 id="d-agent-orchestration">D) Agent Orchestration</h4><ul><li>Enqueue job with AGENT_EXECUTION envelope</li><li>Job status and results retrieval</li><li>Deterministic replay request (reconstruct envelope + rerun pinned versions)</li></ul><h4 id="e-audit-event-query">E) Audit &amp; Event Query</h4><ul><li>Append audit event (system-only write)</li><li>Role-gated query APIs by case, time window, correlation id, actor, event type</li></ul><h4 id="f-issuestasks">F) Issues/Tasks</h4><ul><li>Create/update/close Issues and Tasks (with linkage to artifacts and workflow stage)</li><li>Query open blockers for readiness</li><li>All endpoints must require: (case_id, correlation_id, actor_id, role, capability flags) and must emit audit events for privileged operations.</li></ul><h3 id="workflow-state-machine-spec-authoritative">WORKFLOW STATE MACHINE SPEC (Authoritative)</h3><p>Purpose</p><p>This section defines the authoritative workflow state machine governing case lifecycle transitions. It formalizes stage transitions, required artifacts, blocking conditions, readiness gates, override rules, and event triggers.</p><p>No case-state transition may occur outside this state machine.</p><p>This state machine is deterministic, auditable, and replayable.</p><h4 id="core-principles">Core Principles</h4><ul><li>Workflow state transitions are event-driven.</li><li>Transitions are validated against readiness gates.</li><li>Readiness gates are enforced via EVIDENCE_AUDIT_AGENT.</li><li>Overrides require privileged role + justification + audit record.</li><li>Agents may not advance workflow autonomously unless explicitly authorized.</li><li>All transitions must emit WorkflowTransitioned event.</li></ul><hr/><h4 id="workflow-state-model-authoritative">Workflow State Model (Authoritative)</h4><p>Each case has:</p><ul><li>case_id</li><li>current_stage</li><li>current_step_state</li><li>stage_entered_timestamp</li><li>transition_history[]</li><li>blocking_issues_count</li><li>readiness_gate_status</li><li>last_successful_evidence_audit_version_id</li></ul><hr/><h4 id="canonical-workflow-stages">Canonical Workflow Stages</h4><p>Stages are hierarchical and must be stable.</p><p>Stage 0 — Intake</p><ul><li>INTAKE_AGENT active</li><li>CASE_PERSPECTIVE generation</li><li>No evidence processing allowed</li></ul><p>Stage 1 — Onboarded / Active</p><ul><li>Attorney acceptance recorded</li><li>CASE_ACTIVATED</li><li>Policy profile locked</li></ul><p>Stage 2 — Evidence Intake &amp; Processing</p><ul><li>FILE_INTAKE_AGENT sessions</li><li>PROCESSING_AGENT runs</li><li>Mapping optional but not required</li></ul><p>Stage 3 — Mapping &amp; Legal Structuring</p><ul><li>MAPPING_AGENT required</li><li>COA elements finalized or confirmed</li><li>Coverage summaries required</li></ul><p>Stage 4 — Discovery / Interrogatories</p><ul><li>Discovery artifact generation</li><li>Deposition preparation begins</li></ul><p>Stage 5 — Deposition / Witness Phase</p><ul><li>Deposition processing</li><li>Transcript ingestion</li><li>Mapping revalidation required</li></ul><p>Stage 6 — Pre-Trial</p><ul><li>Trial artifact readiness validation</li><li>Exposure and coverage review</li></ul><p>Stage 7 — Publish / Filing</p><ul><li>Publish/export gating enforced</li><li>Evidence audit freshness required</li></ul><p>Stage 8 — Closed / Archived</p><ul><li>Case archived</li><li>Read-only default state</li></ul><hr/><h4 id="stage-transition-rules">Stage Transition Rules</h4><p>Transition requires:</p><ul><li>No blocking issues</li><li>Evidence audit freshness within policy window</li><li>Required artifacts for stage present</li><li>Required approvals recorded</li><li>No unresolved contradictions flagged as blocking</li></ul><p>If any requirement fails:</p><ul><li>Transition prohibited</li><li>Issue surfaced</li><li>ReadinessGateBlocked event emitted</li></ul><hr/><h4 id="readiness-gate-model">Readiness Gate Model</h4><p>Each stage defines:</p><ul><li>Required artifact types</li><li>Required mapping completeness level</li><li>Required evidence audit recency</li><li>Required attorney approval</li></ul><p>Example:</p><p>Pre-Publish Gate requires:</p><ul><li>Latest evidence_audit_report within freshness window</li><li>No blocking issues</li><li>All COA elements status != unsupported (unless attorney override)</li><li>Mapping package present</li><li>Required pleadings artifact version exists</li></ul><hr/><h4 id="workflow-transition-event-contract">Workflow Transition Event Contract</h4><p>On transition:</p><p><strong>Event:</strong> WorkflowTransitioned</p><p>Attributes:</p><ul><li>case_id</li><li>from_stage</li><li>to_stage</li><li>triggered_by (user_id or system)</li><li>override_flag</li><li>override_reason (if applicable)</li><li>correlation_id</li><li>timestamp</li></ul><hr/><h4 id="override-governance">Override Governance</h4><p>Overrides:</p><ul><li>Must be performed by Attorney or higher role.</li><li>Must include justification.</li><li>Must emit AttorneyOverrideRecorded.</li><li>Must not suppress audit trail.</li><li>Must not modify artifacts.</li><li>May bypass readiness gate but must record risk acknowledgement.</li></ul><hr/><h4 id="deterministic-replay-requirement">Deterministic Replay Requirement</h4><p>The workflow engine must support deterministic replay of:</p><ul><li>Stage transitions</li><li>Readiness evaluations</li><li>Evidence audit validations</li><li>Override records</li></ul><p>Replay must reconstruct:</p><ul><li>Transition history</li><li>Audit events</li><li>Readiness states at time of decision</li></ul><hr/><h4 id="failure-handling">Failure Handling</h4><p>Blocking:</p><ul><li>Missing required artifact</li><li>Missing evidence audit</li><li>Blocking Issue present</li><li>Policy denial</li></ul><p>Integrity:</p><ul><li>Artifact lineage mismatch</li><li>Missing artifact version</li><li>Invalid readiness evaluation</li></ul><p>All failures:</p><ul><li>Emit WorkflowTransitionBlocked</li><li>Create Issue (policy-controlled)</li><li>Surface in dashboard</li></ul><hr/><h4 id="build-requirements-antigravity">Build Requirements (Antigravity)</h4><p>Antigravity must implement:</p><ul><li>Deterministic workflow state machine engine</li><li>Stage configuration table</li><li>Readiness gate rule engine</li><li>Transition validator</li><li>Override logging enforcement</li><li>Event emission hooks</li><li>Dashboard stage visualization</li><li>Replay API</li></ul><h3 id="event-model-event-schemas-authoritative">EVENT MODEL &amp; EVENT SCHEMAS (AUTHORITATIVE)</h3><hr/><h4 id="purpose">Purpose</h4><p>This section defines the authoritative event model governing all system execution, agent orchestration, workflow transitions, audit logging, and inter-component communication.</p><p>All agent coordination, workflow state changes, readiness gates, artifact creation, overrides, and integrity checks must be event-driven.</p><p>No agent may directly invoke another agent.</p><p>All downstream activity must occur via event emission and orchestration rules.</p><p>The event model is:</p><ul><li>Deterministic</li><li>Auditable</li><li>Replayable</li><li>Idempotent</li><li>Case-isolated</li></ul><hr/><h4 id="core-event-architecture-principles">Core Event Architecture Principles</h4><p>All case-impacting operations must emit an event.</p><ul><li>Events must be immutable and append-only.</li><li>Events must include correlation_id.</li><li>Events must be stored in durable, ordered event store.</li><li>Event processing must be idempotent.</li><li>Replay of events must reconstruct case state.</li><li>Events may not contain inferred or hallucinated data.</li></ul><hr/><h4 id="event-domains">Event Domains</h4><p>Events are partitioned into domains:</p><ul><li>Case Domain Events</li><li>Case-specific lifecycle, artifact, and agent events.</li><li>Workflow Domain Events</li><li>Stage transitions and readiness gating.</li><li>Agent Execution Events</li><li>Agent job lifecycle and artifact production.</li><li>Integrity &amp; Audit Events</li><li>Contradictions, insufficiencies, overrides.</li><li>Operational Domain Events</li></ul><p>Billing, usage, performance, system metrics.</p><p>Cross-case event visibility is prohibited unless policy-authorized.</p><hr/><h4 id="canonical-event-envelope-mandatory-schema">Canonical Event Envelope (Mandatory Schema)</h4><p>All events must conform to the following envelope:</p><p>Required Attributes:</p><ul><li>event_id (UUID)</li><li>event_type</li><li>case_id (nullable only for operational domain)</li><li>domain</li><li>source_component (agent/system/user)</li><li>triggered_by (user_id or system)</li><li>role</li><li>correlation_id</li><li>causation_id (parent event, if applicable)</li><li>idempotency_key (if job-based)</li><li>timestamp_utc</li><li>event_version</li><li>payload_hash</li><li>payload (structured JSON)</li><li>signature_hash (optional but recommended)</li></ul><p>Hard Requirements:</p><p>event_id must be globally unique.</p><p>• payload_hash must be cryptographic hash.</p><p>• event_version required for schema evolution.</p><p>• Events are immutable once written.</p><hr/><h4 id="event-categories-authoritative-list">Event Categories (Authoritative List)</h4><p>Intake Events</p><ul><li>InterviewStarted</li><li>InterviewPaused</li><li>InterviewResumed</li><li>CasePerspectiveProposed</li><li>CasePerspectiveAmended</li><li>CasePerspectiveApproved</li><li>IntakeTranscriptCreated</li><li>InitialIssueTaggingCreated</li></ul><hr/><p>Onboarding Events</p><ul><li>AttorneyAcceptedCase</li><li>AttorneyRejectedCase</li><li>CaseActivated</li><li>EngagementArtifactCreated</li><li>WorkflowStateInitialized</li></ul><hr/><p>File Intake Events</p><ul><li>FileUploaded</li><li>DuplicateDetected</li><li>ThreadGroupCreated</li><li>UploadSessionClosed</li><li>UploadImpactReportCreated</li><li>AttorneyDispositionRecorded</li></ul><hr/><p>Processing Events</p><ul><li>ProcessingStarted</li><li>FileProcessingStarted</li><li>FileProcessingCompleted</li><li>TextVaultCreated</li><li>TextChunksCreated</li><li>ProcessingCompleted</li><li>ExtractionFailed</li><li>AmbiguityFlagged</li><li>ContradictionFlagged</li></ul><hr/><p>Mapping Events</p><ul><li>MappingStarted</li><li>MappingCandidateProposed</li><li>AllegationMappingCreated</li><li>COAElementMappingCreated</li><li>CoverageSummaryCreated</li><li>OrphanArtifactDetected</li><li>UnsupportedElementFlagged</li><li>MappingCompleted</li></ul><hr/><p>Evidence Audit Events</p><ul><li>EvidenceAuditStarted</li><li>EvidenceAuditCompleted</li><li>EvidenceAuditReportGenerated</li><li>ReadinessGateBlocked</li><li>AttorneyOverrideRecorded</li></ul><hr/><p>Workflow Events</p><ul><li>WorkflowTransitionRequested</li><li>WorkflowTransitionValidated</li><li>WorkflowTransitionBlocked</li><li>WorkflowTransitioned</li></ul><hr/><p>Publish / Export Events</p><ul><li>PublishRequested</li><li>PublishBlocked</li><li>PublishApproved</li><li>PublishCompleted</li></ul><hr/><p>Issue / Task Events</p><ul><li>IssueCreated</li><li>IssueUpdated</li><li>IssueClosed</li><li>TaskCreated</li><li>TaskCompleted</li></ul><hr/><p>Operational Events</p><ul><li>UsageLogged</li><li>BillingAttributionRecorded</li><li>PolicyUpdated</li><li>SystemAlertRaised</li></ul><hr/><h4 id="event-persistence-requirements">Event Persistence Requirements</h4><p>The platform must implement:</p><p>Durable event store (append-only)</p><ul><li>Ordered event indexing by:</li><li>case_id</li><li>timestamp</li><li>correlation_id</li><li>event_type</li><li>Event replay capability</li><li>Tamper-evident integrity protection</li><li>Event retention policies (effective-dated)</li></ul><p>Events must not be stored solely in log files.</p><hr/><h4 id="idempotency-model-mandatory">Idempotency Model (Mandatory)</h4><p>All job-triggered events must include idempotency_key.</p><p>Rules:</p><p>Repeated submissions with same idempotency_key must not create duplicate artifacts.</p><ul><li>Replayed events must not duplicate Issue/Task creation.</li><li>ArtifactVersionCreated must check for prior identical payload_hash.</li><li>Idempotency must be enforced at database level.</li></ul><hr/><h4 id="orchestration-model">Orchestration Model</h4><p>Agents do not call agents.</p><p>Instead:</p><ul><li>Agent emits completion event.</li><li>Orchestration layer evaluates routing rules.</li><li>Workflow state machine evaluates gating.</li><li>Downstream jobs are enqueued.</li></ul><p>Example:</p><p>UploadSessionClosed</p><p>→ Enqueue ProcessingJob</p><p>→ OnProcessingCompleted</p><p>→ Enqueue MappingJob</p><p>→ OnMappingCompleted</p><p>→ Enqueue EvidenceAuditJob</p><p>All routing must be configuration-driven, not hard-coded inside agents.</p><hr/><h4 id="event-replay-requirements">Event Replay Requirements</h4><p>The system must support deterministic replay for:</p><p>Agent execution chains</p><ul><li>Workflow transitions</li><li>Evidence audits</li><li>Publish gating decisions</li></ul><p>Replay must:</p><ul><li>Reconstruct artifact lineage</li><li>Recompute readiness gate status</li><li>Validate determinism against stored payload_hash</li></ul><p>Replay API required:</p><p>GET /api/cases/{case_id}/events/replay</p><hr/><h4 id="event-schema-versioning">Event Schema Versioning</h4><p>Each event_type must include event_version.</p><p>Schema evolution rules:</p><p>Backward compatibility required</p><ul><li>Deprecated fields must not be reused</li><li>Schema registry must be maintained</li><li>Version mismatch must produce integrity event</li></ul><hr/><h4 id="event-security-isolation">Event Security &amp; Isolation</h4><p>All events must enforce case_id isolation.</p><ul><li>Cross-case subscription prohibited by default.</li><li>Event consumers must validate role permissions.</li><li>Sensitive payload data must respect encryption policies.</li></ul><hr/><h4 id="failure-handling-2">Failure Handling</h4><p>Retryable:</p><ul><li>Temporary queue failure</li><li>Consumer timeout</li></ul><p>Blocking:</p><ul><li>Missing case_id</li><li>Invalid event schema</li><li>Signature mismatch</li><li>Idempotency violation</li></ul><p>Integrity:</p><ul><li>Payload hash mismatch</li><li>Causation chain broken</li></ul><p>All integrity failures:</p><ul><li>Emit SystemAlertRaised</li><li>Create Issue (policy controlled)</li><li>Prevent downstream processing</li></ul><hr/><h4 id="build-requirements-antigravity-2">Build Requirements (Antigravity)</h4><p>Antigravity must implement:</p><p>Durable append-only event store</p><ul><li>Idempotency enforcement layer</li><li>Orchestration router</li><li>Schema registry</li><li>Replay engine</li><li>Event audit API</li><li>Role-gated event query interface</li><li>Correlation tracing across agents</li><li>Failure dead-letter queue</li></ul><hr/><h4 id="deterministic-enforcement">Deterministic Enforcement</h4><p>Events that lead to:</p><p>Artifact creation</p><ul><li>Workflow transition</li><li>Publish/export</li><li>Issue creation</li><li>Override</li></ul><p>must record deterministic_run_metadata including:</p><p>Input artifact version IDs</p><ul><li>Context snapshot IDs</li><li>Template version IDs</li><li>Tool/provider metadata</li><li>Model version (if used)</li><li>correlation_id</li></ul><h3 id="access-control-portal-security-model-authoritative">ACCESS CONTROL &amp; PORTAL SECURITY MODEL (AUTHORITATIVE)</h3><hr/><h4 id="purpose-2">Purpose</h4><p>This section defines the authoritative identity, authentication, authorization, and portal security model governing all access to the platform.</p><p>The system must enforce:</p><ul><li>Strict case isolation</li><li>Role-based access control (RBAC)</li><li>Policy-driven privilege gating</li><li>Zero cross-case leakage</li><li>Full auditability of privileged operations</li><li>Secure client portal separation from firm operations</li></ul><p>No access path may bypass this model.</p><hr/><h4 id="core-security-principles">Core Security Principles</h4><p>The platform enforces the following non-negotiable principles:</p><p>Least privilege by default</p><ul><li>Case-scoped access required for all case data</li><li>No cross-case access without explicit governance</li><li>Role-based privilege enforcement</li><li>Directive-required access for gated operations</li><li>MFA required for privileged roles</li><li>All privileged actions auditable</li><li>Override actions logged with justification</li><li>Zero trust internal design</li></ul><hr/><h4 id="identity-model">Identity Model</h4><h4 id="user-types">User Types</h4><p>The system supports the following identity categories:</p><p>Client Users</p><ul><li>Individual clients</li><li>Entity representatives</li><li>Multi-party client participants</li></ul><p>Firm Users</p><ul><li>Attorney</li><li>Partner</li><li>Paralegal</li><li>Litigation Support</li><li>Analyst</li><li>Administrator</li></ul><p>System Roles</p><ul><li>Agent execution identity</li><li>Orchestration identity</li><li>System monitoring identity</li></ul><p>Each user must have:</p><ul><li>user_id (UUID)</li><li>identity_provider_reference</li><li>role(s)</li><li>active_status</li><li>mfa_status</li><li>created_timestamp</li><li>last_login_timestamp</li></ul><hr/><h4 id="authentication-requirements">Authentication Requirements</h4><p>Mandatory Authentication Controls</p><p>MFA required for all firm users</p><ul><li>2FA minimum for clients (configurable escalation to MFA)</li><li>Token-based authentication (short-lived access tokens)</li><li>Refresh token rotation required</li><li>Device session tracking</li><li>Forced logout on role downgrade</li></ul><h4 id="session-security">Session Security</h4><p>Sessions must include:</p><ul><li>session_id</li><li>user_id</li><li>role</li><li>device_fingerprint (if enabled)</li><li>IP metadata</li><li>issued_timestamp</li><li>expiration_timestamp</li></ul><p>Sessions must auto-expire per policy.</p><hr/><h4 id="role-based-access-control-rbac">Role-Based Access Control (RBAC)</h4><p>Access control must be enforced at:</p><ul><li>API layer</li><li>Service layer</li><li>Agent orchestration layer</li><li>Data access layer</li><li>Event query layer</li></ul><p>Minimum Role Matrix</p><p>Client</p><ul><li>View own case documents (restricted)</li><li>Upload files</li><li>Participate in intake</li><li>Approve Case Perspective</li><li>View status dashboard</li><li>Cannot view internal mapping, audit, or legal strategy layers</li></ul><p>Attorney</p><ul><li>Full case read/write</li><li>Approve artifacts</li><li>Override blocking gates</li><li>Issue directives</li><li>Trigger publish/export</li><li>Authorize legal research access</li></ul><p>Paralegal / Staff</p><ul><li>Upload and manage files</li><li>View mappings</li><li>Generate drafts (non-publish)</li><li>Cannot override readiness gates</li></ul><p>Partner</p><ul><li>Same as attorney + cross-case operational reporting (no cross-case data exposure without governance)</li></ul><p>Administrator</p><ul><li>Operational configuration</li><li>Policy configuration</li><li>No case evidence access unless explicitly granted</li></ul><hr/><h4 id="case-isolation-enforcement">Case Isolation Enforcement</h4><p>Data Access Constraints</p><p>All case queries must include case_id filter</p><ul><li>Database layer must enforce row-level security</li><li>Cross-case joins prohibited by default</li><li>Cross-case analytics permitted only in Knowledge Domain (sanitized)</li></ul><p>Encryption Boundaries</p><p>Recommended:</p><ul><li>Per-case encryption keys (DEK)</li><li>Envelope encryption via KMS</li><li>Separate encryption scopes for:</li><li>Case data</li><li>Operational data</li><li>Knowledge store</li></ul><p>Encryption keys must never be directly accessible to agents.</p><hr/><h4 id="portal-separation-model">Portal Separation Model</h4><p>Client Portal Constraints</p><p>Client portal must:</p><p>Only display client-approved artifacts</p><ul><li>Not expose:</li><li>Mapping artifacts</li><li>Evidence audit reports</li><li>Internal issues (unless attorney-approved)</li><li>Strategy artifacts</li><li>Coverage summaries</li><li>Not allow access to other parties in multi-party matters unless authorized</li></ul><p>Firm Portal Constraints</p><p>Firm portal must:</p><ul><li>Clearly label artifact layer (intake, processing, mapping, audit, trial)</li><li>Display readiness gates</li><li>Display unresolved issues</li><li>Require confirmation for override actions</li></ul><hr/><h4 id="directive-privileged-operation-model">Directive &amp; Privileged Operation Model</h4><p>Certain actions require explicit Directive.</p><p>Examples:</p><p>Access to external legal research systems</p><ul><li>Cross-case knowledge queries</li><li>Override readiness gate</li><li>Publish/export override</li><li>COA taxonomy modification</li><li>Policy profile modification</li></ul><p>Directive must include:</p><ul><li>directive_id</li><li>case_id</li><li>requested_by</li><li>approved_by</li><li>scope</li><li>timestamp</li><li>expiration (optional)</li><li>justification</li></ul><p>• audit reference</p><p>No privileged action may execute without directive validation.</p><hr/><h4 id="override-governance-2">Override Governance</h4><p>Override must require:</p><p>Attorney role</p><ul><li>Justification text</li><li>Explicit acknowledgment of risk</li><li>Audit log entry</li><li>Event emission (AttorneyOverrideRecorded)</li></ul><p>Overrides must not:</p><p>Modify underlying artifacts silently</p><ul><li>Remove issues automatically</li><li>Suppress audit records</li></ul><hr/><h4 id="zero-cross-case-leakage-controls">Zero Cross-Case Leakage Controls</h4><p>The system must enforce:</p><p>No LLM context containing multi-case content</p><ul><li>No embedding index spanning cases without sanitization</li><li>No agent access to multiple case stores simultaneously</li><li>No cached responses reused across cases</li><li>No derived knowledge promoted without governance approval</li></ul><p>All cross-case knowledge must originate from sanitized Knowledge Domain.</p><hr/><h4 id="api-security-requirements">API Security Requirements</h4><p>All APIs must enforce:</p><p>Role validation</p><ul><li>Case scope validation</li><li>Input schema validation</li><li>Rate limiting</li><li>CSRF protection (if browser-based)</li><li>Audit event emission</li><li>Correlation_id enforcement</li></ul><p>No direct database access from UI permitted.</p><hr/><h4 id="data-protection-pii-controls">Data Protection &amp; PII Controls</h4><p>The system must:</p><p>Encrypt data at rest</p><ul><li>Encrypt data in transit (TLS 1.2+)</li><li>Encrypt backups</li><li>Restrict PII visibility to minimum required role</li><li>Log PII access</li><li>Support redaction workflows</li><li>Support legal hold</li></ul><p>PII categories must be classified:</p><ul><li>High sensitivity (SSN, financial, medical)</li><li>Moderate sensitivity</li><li>Low sensitivity</li></ul><p>Access to high sensitivity requires elevated role validation.</p><hr/><h4 id="agent-access-constraints">Agent Access Constraints</h4><p>Agents must:</p><p>Operate within case-scoped identity</p><ul><li>Not elevate privileges</li><li>Not query operational stores unless explicitly authorized</li><li>Not access cross-case data</li><li>Not access legal libraries without Directive</li></ul><p>Agent execution identity must be logged.</p><hr/><h4 id="audit-requirements">Audit Requirements</h4><p>All access events must log:</p><ul><li>user_id</li><li>role</li><li>case_id</li><li>action_type</li><li>target_resource</li><li>correlation_id</li><li>timestamp</li><li>result</li></ul><p>Audit logs must be immutable and tamper-evident.</p><hr/><p>Security Incident Handling Hooks</p><p>Security events must trigger:</p><p>SystemAlertRaised event</p><ul><li>Potential automatic session revocation</li><li>Mandatory audit entry</li><li>Optional Issue creation</li><li>Notification to administrator</li></ul><hr/><h4 id="build-requirements-antigravity-3">Build Requirements (Antigravity)</h4><p>Antigravity must implement:</p><p>Identity provider integration</p><ul><li>MFA enforcement</li><li>RBAC enforcement at API + DB</li><li>Row-level security</li><li>Encryption-at-rest architecture</li><li>KMS integration</li><li>Directive validation layer</li><li>Override workflow</li><li>Portal visibility segmentation</li><li>Immutable audit logging</li><li>Case-scoped agent identity execution</li></ul><hr/><h4 id="deterministic-security-enforcement">Deterministic Security Enforcement</h4><p>All privileged operations must record:</p><ul><li>directive_id (if applicable)</li><li>authorization_snapshot</li><li>role_snapshot</li><li>correlation_id</li><li>deterministic_run_metadata (if artifact-producing)</li></ul><p>Failure to record authorization metadata must block execution.</p><h3 id="deployment-environment-model-authoritative">DEPLOYMENT &amp; ENVIRONMENT MODEL (AUTHORITATIVE)</h3><hr/><h4 id="purpose-3">Purpose</h4><p>This section defines the required environment segregation, release controls, infrastructure isolation, model governance, and deployment lifecycle necessary to operate a defensible AI-driven legal platform.</p><p>The system must support:</p><ul><li>Safe development</li><li>Controlled testing</li><li>Deterministic staging validation</li><li>Production-grade case isolation</li><li>Controlled knowledge promotion</li><li>Zero environment bleed</li><li>Zero cross-case contamination</li><li>Full auditability of deployments</li></ul><p>No environment may share live case data without explicit governance.</p><hr/><h4 id="environment-segmentation-model">Environment Segmentation Model</h4><p>The platform must operate with, at minimum, the following environments:</p><p>DEV</p><ul><li>STAGE</li><li>PROD</li></ul><p>Optional (recommended):</p><p>SECURITY_TEST</p><ul><li>LOAD_TEST</li><li>ARCHIVE_REBUILD</li></ul><p>Each environment must be physically and logically isolated.</p><hr/><h4 id="environment-purpose-definitions">Environment Purpose Definitions</h4><h4 id="dev-development">DEV (Development)</h4><p>Purpose:</p><p>• Feature development</p><p>• Schema evolution</p><p>• Agent behavior iteration</p><p>• Prompt engineering (non-production)</p><p>Constraints:</p><p>• No live production case data</p><p>• Only synthetic or sanitized datasets</p><p>• No production encryption keys</p><p>• No cross-environment data reads</p><p>Model behavior may be exploratory.</p><hr/><h4 id="stage-pre-production-validation">STAGE (Pre-Production Validation)</h4><p>Purpose:</p><p>• Deterministic replay validation</p><p>• Integration testing</p><p>• Security testing</p><p>• Readiness gating verification</p><p>• Workflow state machine validation</p><p>Constraints:</p><p>• Sanitized production-like datasets only</p><p>• Identical configuration to PROD</p><p>• Production model versions must be mirrored</p><p>• Release candidate validation required</p><p>All artifact-producing agent runs must be replayable and compared to baseline.</p><hr/><h4 id="prod-production">PROD (Production)</h4><p>Purpose:</p><p>• Live case execution</p><p>• Authoritative artifact generation</p><p>• Publish/export actions</p><p>• Legal research integrations</p><p>• Knowledge accumulation</p><p>Constraints:</p><p>• Strict case isolation</p><p>• Deterministic artifact generation</p><p>• Immutable audit logging</p><p>• No experimental model changes</p><p>• No direct prompt editing</p><p>Production changes require governed deployment.</p><hr/><h4 id="infrastructure-isolation-requirements">Infrastructure Isolation Requirements</h4><p>Each environment must have:</p><p>Separate databases</p><ul><li>Separate object storage buckets</li><li>Separate encryption keys (KMS)</li><li>Separate API endpoints</li><li>Separate identity provider configurations</li><li>Separate logging infrastructure</li></ul><p>Secrets must never be shared across environments.</p><p>No PROD credentials may exist in DEV.</p><hr/><h4 id="configuration-policy-management">Configuration &amp; Policy Management</h4><p>The platform must externalize:</p><p>Policy profiles</p><ul><li>Retention rules</li><li>Chunk sizing rules</li><li>Stage artifact requirements</li><li>Agent gating conditions</li><li>Legal research integration settings</li></ul><p>Configuration must be:</p><ul><li>Versioned</li><li>Environment-scoped</li><li>Auditable</li><li>Immutable once promoted to PROD</li></ul><hr/><h4 id="cicd-governance-model">CI/CD Governance Model</h4><p>Required Pipeline Stages</p><ul><li>Code commit</li><li>Automated unit testing</li><li>Security scanning</li><li>Schema validation</li><li>Agent contract validation</li><li>Deterministic replay validation (artifact comparison)</li><li>Integration testing</li><li>Stage approval gate</li><li>Production deployment</li><li>Post-deploy validation audit</li></ul><p>No manual production deployments allowed outside pipeline.</p><hr/><h4 id="deterministic-artifact-validation">Deterministic Artifact Validation</h4><p>Before promotion to PROD:</p><p>Representative agent runs must be replayed in STAGE</p><ul><li>Artifact payloads must match expected schema</li><li>Evidence traceability must validate</li><li>No new uncontrolled artifact fields permitted</li><li>No silent model drift allowed</li></ul><p>If deterministic replay fails → deployment blocked.</p><hr/><h4 id="model-version-governance">Model Version Governance</h4><p>All model providers (LLMs, OCR, STT, analytics engines) must be:</p><p>Version-tagged</p><ul><li>Captured in deterministic_run_metadata</li><li>Environment-scoped</li><li>Promotion-controlled</li></ul><p>Model version change requires:</p><ul><li>Stage validation</li><li>Replay testing</li><li>Approval record</li><li>Release note entry</li><li>Audit logging</li></ul><p>No silent provider upgrades allowed.</p><hr/><h4 id="prompt-agent-contract-governance">Prompt &amp; Agent Contract Governance</h4><p>Prompts used by agents must be:</p><p>Version-controlled</p><ul><li>Immutable once deployed</li><li>Environment-specific</li><li>Auditable</li></ul><p>Any prompt change in PROD requires:</p><ul><li>New version ID</li><li>Deployment pipeline</li><li>Audit entry</li><li>Impact analysis</li></ul><hr/><h4 id="schema-migration-governance">Schema Migration Governance</h4><p>Database schema changes must:</p><p>Be backward compatible where possible</p><ul><li>Include migration script version ID</li><li>Be tested in STAGE</li><li>Include rollback strategy</li><li>Be logged in deployment audit</li></ul><p>Schema changes affecting:</p><ul><li>Artifact structures</li><li>Mapping tables</li><li>Trace references</li><li>Case isolation boundaries</li></ul><p>Require explicit approval.</p><hr/><h4 id="secrets-key-management">Secrets &amp; Key Management</h4><p>All environments must use:</p><p>Centralized KMS integration</p><ul><li>Key rotation policy</li><li>Envelope encryption</li><li>Secret vault for API keys</li><li>No plaintext credentials in code</li></ul><p>Key compromise procedures must be documented and testable.</p><hr/><h4 id="knowledge-domain-promotion-controls">Knowledge Domain Promotion Controls</h4><p>Derived knowledge promotion must follow:</p><ul><li>Sanitization verification</li><li>Cross-case leak testing</li><li>Metadata tagging</li><li>Governance approval</li><li>Versioned knowledge index creation</li></ul><p>Knowledge artifacts must remain rebuildable.</p><p>No live case data may directly enter Knowledge Domain.</p><hr/><h4 id="backup-disaster-recovery-model">Backup &amp; Disaster Recovery Model</h4><p>Each environment must define:</p><p>RPO (Recovery Point Objective)</p><ul><li>RTO (Recovery Time Objective)</li><li>Backup frequency</li><li>Encrypted backup storage</li><li>Restoration validation testing</li></ul><p>PROD backups must:</p><ul><li>Be immutable</li><li>Be encrypted</li><li>Be periodically restoration-tested</li></ul><p>Archive restoration must not overwrite active PROD cases.</p><hr/><h4 id="observability-monitoring">Observability &amp; Monitoring</h4><p>Each environment must implement:</p><p>Centralized structured logging</p><ul><li>Metrics collection</li><li>Agent execution monitoring</li><li>Workflow transition tracking</li><li>Anomaly detection</li><li>Security alerting</li></ul><p>Logs must include:</p><ul><li>case_id</li><li>agent_name</li><li>job_id</li><li>correlation_id</li><li>environment_id</li></ul><hr/><h4 id="change-control-governance">Change Control Governance</h4><p>Production changes require:</p><p>Change ticket</p><ul><li>Impact analysis</li><li>Rollback plan</li><li>Approval record</li><li>Deployment log entry</li></ul><p>Emergency patches require:</p><p>Expedited approval</p><ul><li>Post-hoc audit</li><li>Root cause documentation</li></ul><hr/><p>Environment Access Controls</p><p>DEV access may include engineers.</p><ul><li>STAGE access restricted to engineers + approved testers.</li><li>PROD access restricted to authorized operators only.</li><li>No shared admin credentials.</li><li>All privileged access logged.</li></ul><hr/><h4 id="zero-environment-bleed-rule">Zero Environment Bleed Rule</h4><p>The platform must guarantee:</p><p>No PROD data in DEV</p><ul><li>No DEV artifacts in PROD</li><li>No shared embedding indexes</li><li>No shared model context caches</li><li>No shared encryption keys</li><li>No shared audit logs</li></ul><p>Violation constitutes critical security breach.</p><hr/><h4 id="build-requirements-antigravity-4">Build Requirements (Antigravity)</h4><p>Antigravity must implement:</p><p>Multi-environment infrastructure</p><ul><li>Environment-specific config loading</li><li>KMS-based encryption</li><li>CI/CD pipeline with gated release</li><li>Deterministic artifact replay validation</li><li>Model version registry</li><li>Prompt version registry</li><li>Schema migration framework</li><li>Centralized logging &amp; monitoring</li><li>Automated backup &amp; restoration validation</li></ul><hr/><h4 id="deterministic-deployment-record">Deterministic Deployment Record</h4><p>Each production deployment must record:</p><p>deployment_id</p><p>• commit_hash</p><p>• schema_version</p><p>• model_versions</p><p>• prompt_versions</p><p>• configuration_snapshot</p><p>• approval_record</p><p>• timestamp</p><p>• environment_id</p><p>Deployment records must be immutable.</p><h3 id="dikw-intelligence-architecture-authoritative">DIKW INTELLIGENCE ARCHITECTURE (AUTHORITATIVE)</h3><hr/><h4 id="purpose-4">Purpose</h4><p>This section defines how the platform scales intelligence over time using a structured DIKW (Data → Information → Knowledge → Wisdom) framework.</p><p>The DIKW architecture ensures:</p><p>• Case-scoped defensibility</p><p>• Deterministic artifact integrity</p><p>• Structured context propagation</p><p>• Controlled cross-case learning</p><p>• Zero hallucination enforcement</p><p>• Governance over advisory intelligence</p><p>• Long-term system intelligence scaling without contaminating live cases</p><p>The system must become more effective over time without violating case isolation, evidence integrity, or attorney authority.</p><hr/><h4 id="dikw-layering-model">DIKW Layering Model</h4><p>The platform must strictly separate and govern the following layers:</p><ul><li>DATA</li><li>INFORMATION</li><li>KNOWLEDGE</li><li>WISDOM</li></ul><p>Each layer has distinct storage boundaries, governance controls, and operational constraints.</p><p>No layer may collapse into another.</p><hr/><h4 id="data-layer-authoritative-case-scoped">DATA Layer (Authoritative; Case-Scoped)</h4><p>Definition</p><p>Raw, immutable, authoritative inputs.</p><p>Includes</p><p>Uploaded files</p><ul><li>TEXT_VAULT</li><li>TEXT_CHUNKS</li><li>Transcripts</li><li>CASE_PERSPECTIVE</li><li>CASE_CONTEXT_PLAYBOOK</li><li>Raw artifacts</li><li>Audit logs</li><li>Mapping links</li></ul><p>Constraints</p><p>Immutable once written</p><ul><li>Case-isolated</li><li>Encrypted</li><li>Trace-referenced</li><li>Deterministic replay supported</li></ul><p>No cross-case operations permitted at DATA layer.</p><hr/><h4 id="information-layer-structured-case-record">INFORMATION Layer (Structured Case Record)</h4><p>Definition</p><p>Structured representations derived from DATA.</p><p>Includes</p><p>Normalized entities</p><ul><li>Role bindings</li><li>Timeline anchors</li><li>Facts</li><li>Evidence references</li><li>Mapping links</li><li>Coverage summaries</li><li>Contradiction flags</li><li>Structured discovery artifacts</li></ul><p>Characteristics</p><p>Case-scoped</p><ul><li>Deterministic derivation from DATA</li><li>Fully traceable</li><li>Versioned</li><li>Governed by CASE_CONTEXT_PLAYBOOK</li></ul><p>No probabilistic assumptions allowed.</p><hr/><h4 id="knowledge-layer-derived-rebuildable-advisory">KNOWLEDGE Layer (Derived; Rebuildable; Advisory)</h4><p>Definition</p><p>Structured, sanitized, cross-case abstractions derived from completed or governed cases.</p><p>Knowledge is:</p><p>Non-authoritative</p><ul><li>Advisory only</li><li>Rebuildable</li><li>Governance-controlled</li></ul><p>Examples</p><p>Pattern registries (common contradiction types)</p><ul><li>Extraction heuristics tuning</li><li>Thread detection improvements</li><li>Coverage gap typologies</li><li>Jurisdiction-tagged element interpretation rules</li><li>Legal research cache (non-evidentiary)</li></ul><p>Hard Constraints</p><p>Must never contain raw case data</p><ul><li>Must never contain identifiable party names unless sanitized</li><li>Must reference source-case IDs only through sanitized tokens</li><li>Must pass cross-case leakage testing</li><li>Must be versioned and promotion-controlled</li></ul><p>Knowledge cannot modify case state.</p><hr/><h4 id="wisdom-layer-governed-decision-support">WISDOM Layer (Governed Decision Support)</h4><p>Definition</p><p>Structured advisory insights generated from Information + Knowledge.</p><p>Examples</p><p>Risk exposure simulations</p><ul><li>Strategy scenario comparisons</li><li>Coverage risk forecasting</li><li>Deposition vulnerability signals</li><li>Settlement readiness indicators</li></ul><p>Constraints</p><p>Advisory only</p><ul><li>Cannot modify case artifacts</li><li>Cannot advance workflow</li><li>Cannot auto-file pleadings</li><li>Must reference underlying INFORMATION artifacts</li><li>Must include advisory disclaimer metadata</li></ul><p>WISDOM cannot override attorney judgment.</p><hr/><h4 id="dikw-transition-controls">DIKW Transition Controls</h4><p>Each transition must be explicit and governed.</p><p>DATA → INFORMATION</p><p>Must be:</p><p>Deterministic</p><ul><li>Replayable</li><li>Trace-linked</li><li>CASE_CONTEXT_PLAYBOOK constrained</li></ul><p>Performed by:</p><p>PROCESSING_AGENT</p><ul><li>MAPPING_AGENT</li><li>DEPOSITION_PROCESSING_AGENT</li></ul><hr/><p>INFORMATION → KNOWLEDGE</p><p>Requires:</p><p>Case closure OR governance approval</p><ul><li>Sanitization pipeline</li><li>Cross-case leakage validation</li><li>Promotion approval record</li><li>Knowledge artifact versioning</li></ul><p>Performed by:</p><p>KNOWLEDGE_PROMOTION_PIPELINE (system component; not advisory agent)</p><hr/><p>KNOWLEDGE → WISDOM</p><p>Must:</p><p>Be advisory-only</p><ul><li>Record knowledge_version_ids used</li><li>Not modify case state</li><li>Not create authoritative artifacts</li></ul><p>Performed by:</p><p>OUTCOME_MODEL_AGENT</p><ul><li>OPPOSITION_AGENT (advisory mode)</li><li>TRIAL_AGENT (advisory mode only)</li></ul><hr/><h4 id="case_context_playbook-as-intelligence-anchor">CASE_CONTEXT_PLAYBOOK as Intelligence Anchor</h4><p>The CASE_CONTEXT_PLAYBOOK is the binding constraint set for the DATA → INFORMATION transformation.</p><p>It ensures:</p><p>Actor canonicalization</p><ul><li>Role time bounds</li><li>Event anchor constraints</li><li>Disambiguation rules</li><li>Document routing expectations</li><li>Coherence enforcement</li></ul><p>Every deterministic run must record:</p><p>perspective_context_snapshot_id</p><ul><li>rules_applied[]</li><li>unresolved_disambiguations[]</li></ul><p>No INFORMATION generation is permitted without loading the context snapshot.</p><hr/><h4 id="cross-case-knowledge-governance">Cross-Case Knowledge Governance</h4><p>Cross-case intelligence scaling must:</p><p>Never access active case DATA</p><ul><li>Operate only on sanitized knowledge artifacts</li><li>Be governed by promotion approval</li><li>Be reversible (knowledge rebuildable)</li><li>Be logged and auditable</li></ul><p>Cross-case access to INFORMATION is prohibited.</p><hr/><h4 id="learning-without-contamination">Learning Without Contamination</h4><p>The platform must improve:</p><p>Thread detection accuracy</p><ul><li>Duplicate detection logic</li><li>Extraction tuning</li><li>Mapping heuristics</li><li>Coverage gap detection</li><li>Risk modeling</li></ul><p>Without:</p><p>Reusing case data</p><ul><li>Leaking identities</li><li>Sharing embeddings across cases</li><li>Mixing vector indexes between tenants</li></ul><p>Learning occurs through:</p><p>Pattern abstraction</p><ul><li>Aggregated metadata</li><li>Sanitized derived structures</li><li>Controlled knowledge promotion</li></ul><hr/><h4 id="intelligence-scaling-requirements-antigravity">Intelligence Scaling Requirements (Antigravity)</h4><p>Antigravity must implement:</p><p>DIKW-layered storage separation</p><ul><li>Knowledge promotion pipeline</li><li>Sanitization engine</li><li>Cross-case leakage testing</li><li>Advisory-only enforcement for WISDOM</li><li>Model version registry</li><li>Prompt version registry</li><li>Deterministic replay validation</li><li>Case-context snapshot enforcement</li><li>Knowledge version tagging in advisory outputs</li></ul><hr/><h4 id="zero-hallucination-enforcement-across-dikw">Zero-Hallucination Enforcement Across DIKW</h4><p>The Zero Hallucination Rule applies differently per layer:</p><p>DATA:</p><ul><li>No modification allowed.</li></ul><p>INFORMATION:</p><ul><li>No unsupported inference.</li><li>All facts must be trace-linked.</li></ul><p>KNOWLEDGE:</p><ul><li>Must not embed case-identifiable information.</li></ul><p>WISDOM:</p><ul><li>Must not assert facts beyond INFORMATION layer.</li><li>Must not auto-modify case state.</li></ul><p>Any violation must create Issue and log integrity event.</p><hr/><h4 id="intelligence-auditability">Intelligence Auditability</h4><p>Every advisory output must record:</p><p>knowledge_version_ids used</p><ul><li>model_version</li><li>prompt_version</li><li>deterministic_run_metadata (if applicable)</li><li>advisory_flag = true</li></ul><p>Advisory outputs must be distinguishable from authoritative artifacts.</p><hr/><h4 id="dikw-failure-conditions">DIKW Failure Conditions</h4><p>Blocking:</p><p>Attempt to use cross-case DATA</p><ul><li>Missing CASE_CONTEXT_PLAYBOOK</li><li>Unsanitized knowledge promotion</li><li>Deterministic run without context snapshot</li></ul><p>Integrity:</p><p>Knowledge artifact containing PII</p><ul><li>Advisory output without trace references</li><li>Unauthorized workflow advancement</li></ul><p>All must:</p><p>Create Issue</p><ul><li>Emit audit event</li><li>Block further promotion</li></ul><hr/><h4 id="long-term-intelligence-strategy">Long-Term Intelligence Strategy</h4><p>The platform must support:</p><p>Progressive pattern abstraction</p><ul><li>Improved coverage risk prediction</li><li>Reduced external legal library calls</li><li>Refined extraction accuracy</li><li>Enhanced advisory simulation</li></ul><p>Without compromising:</p><p>Case isolation</p><ul><li>Evidence integrity</li><li>Attorney authority</li><li>Deterministic artifact reproducibility</li></ul><hr/><h4 id="dikw-architecture-completion-criteria">DIKW Architecture Completion Criteria</h4><p>The DIKW architecture is considered implemented when:</p><p>DATA and INFORMATION layers are strictly separated</p><ul><li>KNOWLEDGE is rebuildable and sanitized</li><li>WISDOM is advisory-only</li><li>Cross-case leakage tests pass</li><li>Deterministic replay validation succeeds</li><li>Context snapshots are enforced</li><li>All advisory outputs are labeled</li><li>Governance auditability is complete</li></ul><h3 id="security-architecture-trust-boundaries-authoritative">SECURITY ARCHITECTURE &amp; TRUST BOUNDARIES (AUTHORITATIVE)</h3><hr/><h4 id="purpose-5">Purpose</h4><p>This section defines the mandatory security architecture, trust boundaries, access controls, encryption requirements, identity governance, and breach response constraints for the platform.</p><p>The system processes:</p><p>Attorney–client privileged material</p><ul><li>Litigation-sensitive evidence</li><li>PII</li><li>PHI (potentially)</li><li>Financial records</li><li>Deposition transcripts</li><li>Strategy documents</li></ul><p>Therefore, the security posture must assume:</p><p>Zero-trust internal architecture</p><ul><li>Tenant-level isolation</li><li>Encryption everywhere</li><li>Explicit privilege boundaries</li><li>Auditability of all sensitive actions</li></ul><p>Security is not a feature — it is a structural requirement.</p><hr/><h4 id="security-design-principles-mandatory">Security Design Principles (Mandatory)</h4><p>The platform must operate under the following principles:</p><p>Zero Trust — no implicit internal trust</p><ul><li>Least Privilege — access granted per role and case</li><li>Case Isolation — hard multi-tenant separation</li><li>Defense in Depth — layered controls</li><li>Deterministic Auditability — all sensitive actions logged</li><li>Explicit Override Logging — privileged bypasses recorded</li><li>Encryption by Default — no plaintext persistence</li><li>Tool Mediation — no direct third-party access</li><li>Zero Hallucination Enforcement (security implication)</li></ul><hr/><h4 id="identity-access-management-iam">Identity &amp; Access Management (IAM)</h4><p>Authentication Requirements</p><p>The system must support:</p><p>MFA (Mandatory for Attorneys, Partners, Admin roles)</p><ul><li>2FA minimum for all users</li><li>Hardware-backed MFA support (recommended)</li><li>Session expiration policies</li><li>IP anomaly detection (optional but recommended)</li><li>Device fingerprinting (optional but recommended)</li></ul><p>Authentication provider must support:</p><p>OIDC or SAML</p><ul><li>Enterprise identity integration (optional)</li><li>Secure token lifecycle</li><li>Refresh token rotation</li></ul><hr/><h4 id="authorization-model">Authorization Model</h4><p>Authorization must be:</p><p>Role-Based (RBAC)</p><ul><li>Case-scoped</li><li>Policy-driven</li><li>Explicitly evaluated per request</li></ul><p>Minimum roles:</p><p>CLIENT</p><ul><li>PARALEGAL</li><li>ATTORNEY</li><li>PARTNER</li><li>ADMIN</li><li>SYSTEM_SERVICE_ACCOUNT</li></ul><p>Each request must evaluate:</p><p>user_role</p><p>• case_id scope</p><p>• artifact access level</p><p>• override status</p><p>• policy profile</p><p>No cross-case access permitted without system-level governance approval.</p><hr/><h4 id="case-isolation-enforcement-2">Case Isolation Enforcement</h4><p>Case isolation must include:</p><p>Logical DB partitioning by case_id</p><ul><li>Row-level security enforcement</li><li>Separate encryption keys per case (recommended)</li><li>Vector index isolation per case</li><li>Cache isolation per case</li><li>No shared embeddings across cases</li></ul><p>Cross-case knowledge must pass sanitization pipeline (see DIKW section).</p><hr/><h4 id="encryption-architecture">Encryption Architecture</h4><p>Data at Rest</p><p>All data must be encrypted at rest:</p><p>Database storage</p><ul><li>Object storage (files)</li><li>Artifact store</li><li>Audit logs</li><li>Backups</li><li>Knowledge registry</li></ul><p>Encryption requirements:</p><p>AES-256 minimum</p><ul><li>Case-scoped encryption keys (recommended)</li><li>Managed key vault integration</li><li>Key rotation support</li><li>Audit logging of key access</li></ul><p>No plaintext storage permitted.</p><hr/><h4 id="data-in-transit">Data in Transit</h4><p>All traffic must use:</p><p>TLS 1.2 minimum (1.3 recommended)</p><ul><li>HSTS enforcement</li><li>Internal service mTLS (recommended)</li><li>API gateway TLS enforcement</li></ul><p>No unsecured HTTP allowed.</p><hr/><h4 id="data-in-use-processing-security">Data in Use (Processing Security)</h4><p>Sensitive processing (AI inference, extraction, mapping) must:</p><p>Occur within secured service boundary</p><ul><li>Never expose raw case data externally</li><li>Use mediated LLM access layer</li><li>Strip unnecessary context from external calls</li><li>Enforce case_id boundary per invocation</li></ul><hr/><h4 id="tool-mediation-security">Tool Mediation Security</h4><p>All external integrations must be accessed exclusively through a mediated layer.</p><p>Includes:</p><p>LLM providers</p><ul><li>Transcription services</li><li>OCR services</li><li>Legal research APIs</li><li>Analytics engines</li></ul><p>The mediation layer must:</p><p>Strip non-required context</p><ul><li>Log all requests</li><li>Log all responses</li><li>Enforce cost controls</li><li>Enforce case_id scoping</li><li>Record model_version + prompt_version</li></ul><p>Direct UI-to-LLM calls are prohibited.</p><hr/><h4 id="pii-phi-handling">PII &amp; PHI Handling</h4><p>The platform must treat all client data as sensitive by default.</p><p>PII Classification</p><p>PII includes but is not limited to:</p><p>Name</p><ul><li>Address</li><li>Phone</li><li>Email</li><li>SSN</li><li>DOB</li><li>Financial account numbers</li><li>Government IDs</li></ul><p>PII handling rules:</p><p>Encrypted at rest</p><ul><li>Masked in non-privileged views</li><li>Not included in cross-case knowledge</li><li>Redaction support required</li><li>Access logged</li></ul><hr/><h4 id="phi-handling-if-applicable">PHI Handling (If Applicable)</h4><p>If health-related data is stored:</p><p>HIPAA-aligned safeguards required</p><ul><li>Audit trail retention extended</li><li>Access restricted to authorized roles</li><li>Separate classification flag at case level</li></ul><hr/><h4 id="session-security-2">Session Security</h4><p>Session requirements:</p><p>Secure, HTTP-only cookies</p><ul><li>SameSite=strict</li><li>CSRF protection</li><li>Automatic expiration</li><li>Idle timeout</li><li>Absolute timeout</li><li>Token revocation capability</li></ul><hr/><h4 id="dashboard-portal-security">Dashboard &amp; Portal Security</h4><p>Client Portal must:</p><p>Restrict access to client case only</p><ul><li>Hide legal strategy artifacts</li><li>Mask privileged internal notes</li><li>Prevent raw database views</li><li>Prevent upload bypass</li><li>Prevent unauthorized reprocessing triggers</li></ul><p>Attorney Dashboard must:</p><p>Display override actions clearly</p><ul><li>Require confirmation for sensitive actions</li><li>Enforce readiness gates</li><li>Record disposition decisions</li></ul><hr/><h4 id="trust-boundary-model">Trust Boundary Model</h4><p>The system must explicitly define trust boundaries between:</p><p>Browser UI</p><ul><li>API Gateway</li><li>Application Layer</li><li>Agent Orchestration Layer</li><li>Data Layer</li><li>External Tool Mediation Layer</li><li>Knowledge Registry</li><li>Backup &amp; Archive</li></ul><p>Each boundary must enforce:</p><p>Authentication</p><ul><li>Authorization</li><li>Input validation</li><li>Output validation</li><li>Logging</li></ul><hr/><h4 id="threat-model-minimum-coverage">Threat Model (Minimum Coverage)</h4><p>Antigravity must model threats including:</p><p>Data exfiltration</p><ul><li>Cross-tenant leakage</li><li>Prompt injection</li><li>Model poisoning</li><li>Unauthorized override</li><li>Privilege escalation</li><li>Ransomware</li><li>Hash collision attack</li><li>Vector index contamination</li><li>Cross-case embedding leakage</li></ul><p>Mitigations must be documented.</p><hr/><h4 id="incident-breach-response-governance">Incident &amp; Breach Response Governance</h4><p>The system must include:</p><p>Security event detection</p><ul><li>Anomaly detection alerts</li><li>Breach classification framework</li><li>Forensic logging retention</li><li>Immutable audit logs</li><li>Key revocation capability</li><li>Tenant notification support</li></ul><p>All security incidents must create:</p><p>SecurityIncident record</p><ul><li>Audit event</li><li>Administrative notification</li></ul><hr/><h4 id="logging-audit-integrity">Logging &amp; Audit Integrity</h4><p>Security-relevant actions must log:</p><p>user_id</p><ul><li>role</li><li>case_id</li><li>action_type</li><li>timestamp</li><li>source_ip</li><li>override_flag</li><li>correlation_id</li></ul><p>Logs must be:</p><p>Immutable</p><ul><li>Tamper-evident</li><li>Retained per policy</li><li>Exportable for forensic review</li></ul><hr/><h4 id="security-overrides">Security Overrides</h4><p>Overrides must:</p><p>Require privileged role</p><ul><li>Require justification text</li><li>Record timestamp</li><li>Record user identity</li><li>Record impacted artifact</li><li>Emit audit event</li><li>Be reversible where applicable</li></ul><p>Overrides must never be silent.</p><hr/><h4 id="deployment-security-requirements">Deployment Security Requirements</h4><p>Production environment must:</p><p>Be isolated from dev/stage</p><ul><li>Use separate credentials</li><li>Use separate encryption keys</li><li>Prohibit direct DB access</li><li>Restrict admin console access</li><li>Enforce CI/CD signed artifacts</li></ul><p>No shared credentials between environments.</p><hr/><h4 id="security-completion-criteria">Security Completion Criteria</h4><p>Security architecture is considered complete when:</p><p>All data encrypted at rest and in transit</p><ul><li>MFA enforced for privileged roles</li><li>Case isolation tested</li><li>Cross-case leakage tests pass</li><li>Prompt injection mitigations implemented</li><li>Audit logs immutable</li><li>Override tracking functional</li><li>Incident response framework documented</li><li>Threat model reviewed</li></ul><h3 id="performance-scalability-capacity-architecture-authoritative">PERFORMANCE, SCALABILITY &amp; CAPACITY ARCHITECTURE (AUTHORITATIVE)</h3><hr/><h4 id="purpose-6">Purpose</h4><p>This section defines the mandatory performance characteristics, scaling model, workload isolation, concurrency governance, and capacity planning rules required for production deployment.</p><p>The system must support:</p><p>Large evidence volumes (multi-GB cases)</p><ul><li>High-concurrency uploads</li><li>Deterministic agent replays</li><li>Vector search at scale</li><li>Long-lived litigation timelines</li><li>Controlled AI cost scaling</li></ul><p>Performance is not a convenience layer — it is structural to defensibility and usability.</p><hr/><h4 id="performance-design-principles-mandatory">Performance Design Principles (Mandatory)</h4><p>The platform must operate under:</p><p>Horizontal Scalability</p><ul><li>Stateless Agent Execution</li><li>Asynchronous Job Queuing</li><li>Backpressure Protection</li><li>Deterministic Replay Capability</li><li>Resource Isolation by Case</li><li>Cost-Aware AI Invocation</li><li>Bounded Context Loading</li></ul><p>No component may assume single-threaded or low-volume operation.</p><hr/><h4 id="file-volume-storage-scaling">File Volume &amp; Storage Scaling</h4><p>File Size Requirements</p><p>The system must support:</p><p>Individual files up to policy-defined size (recommended ≥ 2GB)</p><ul><li>Upload sessions containing hundreds or thousands of files</li><li>Long-running cases with tens of thousands of artifacts</li></ul><p>Object Storage Requirements</p><p>File storage must:</p><p>Use scalable object storage</p><ul><li>Support streaming uploads</li><li>Support resumable uploads</li><li>Store files immutably</li><li>Enforce hash validation</li><li>Support parallel read for processing</li></ul><p>Storage must not degrade under large case loads.</p><hr/><h4 id="text_vault-text_chunks-scaling">TEXT_VAULT &amp; TEXT_CHUNKS Scaling</h4><p>Chunking Scalability Requirements</p><p>Chunking must support:</p><p>Files generating tens of thousands of chunks</p><ul><li>Stable ordering</li><li>Efficient pagination</li><li>Efficient chunk lookup by ID</li><li>Fast pinpoint citation retrieval</li></ul><p>Chunk indexing must be:</p><p>Case-scoped</p><ul><li>Sharded or partitioned</li><li>Query-optimized</li></ul><p>Reconstruction Performance</p><p>Full-file reassembly from TEXT_CHUNKS must:</p><p>Occur deterministically</p><ul><li>Preserve original order</li><li>Be performant for large files</li><li>Support streaming output</li></ul><hr/><h4 id="agent-execution-scalability">Agent Execution Scalability</h4><p>Agent Orchestration Requirements</p><p>All agents must execute via:</p><p>Distributed job queue</p><ul><li>Horizontal worker scaling</li><li>Idempotent job execution</li><li>Retry governance</li><li>Dead-letter queue handling</li></ul><p>Agents must be stateless.</p><p>All execution state must persist in the database.</p><hr/><h4 id="concurrency-controls">Concurrency Controls</h4><p>System must support:</p><p>Parallel ProcessingJobs</p><ul><li>Parallel MappingJobs</li><li>Parallel UploadSession intake</li><li>Parallel EvidenceAuditJobs</li></ul><p>Concurrency must be governed by:</p><p>Case-scoped locks where required</p><ul><li>Optimistic concurrency control</li><li>Transaction isolation</li></ul><p>No race condition may corrupt artifacts or overwrite versions.</p><hr/><h4 id="vector-semantic-search-scaling">Vector &amp; Semantic Search Scaling</h4><p>Vector Store Requirements</p><p>Vector indexes must:</p><p>Be case-scoped</p><ul><li>Not mix embeddings across cases</li><li>Support incremental indexing</li><li>Support re-index on reprocessing</li><li>Support deletion by case</li></ul><p>Search Performance Targets</p><p>Search must support:</p><p>Sub-second chunk retrieval for typical queries</p><ul><li>Pagination</li><li>Stable ranking</li><li>Deterministic filters</li></ul><p>Search must never substitute for authoritative mapping.</p><p>Vector search is advisory — not evidentiary.</p><hr/><h4 id="ai-cost-throughput-governance">AI Cost &amp; Throughput Governance</h4><p>LLM Invocation Controls</p><p>The system must:</p><p>Track token usage per job</p><ul><li>Track cost per case</li><li>Enforce case-level cost caps (policy-driven)</li><li>Enforce per-run token limits</li><li>Capture model_version + prompt_version</li></ul><p>No unbounded AI invocation allowed.</p><hr/><h4 id="context-window-management">Context Window Management</h4><p>Agents must:</p><p>Avoid loading entire case context into LLM</p><ul><li>Use chunk-level references</li><li>Enforce maximum context size</li><li>Load only case-scoped data</li></ul><p>Context must be bounded and deterministic.</p><hr/><h4 id="workflow-performance-expectations">Workflow Performance Expectations</h4><p>The system must meet:</p><p>Upload responsiveness under load</p><ul><li>Non-blocking UI behavior</li><li>Async status updates</li><li>Dashboard refresh under 2 seconds (recommended target)</li><li>Publish/export gating response &lt; 5 seconds</li></ul><p>Processing-heavy jobs must:</p><p>Execute asynchronously</p><ul><li>Provide progress tracking</li><li>Emit job status events</li></ul><hr/><h4 id="backpressure-throttling">Backpressure &amp; Throttling</h4><p>The system must include:</p><p>Rate limiting per user</p><ul><li>Rate limiting per case</li><li>Upload size throttling</li><li>API request throttling</li><li>LLM request throttling</li><li>Tool mediation backoff logic</li></ul><p>When overloaded:</p><p>System must degrade gracefully</p><ul><li>Must not corrupt artifacts</li><li>Must not drop audit events</li></ul><hr/><h4 id="large-case-handling-model">Large Case Handling Model</h4><p>Large litigation matters may include:</p><p>100,000+ chunks</p><ul><li>10,000+ artifacts</li><li>Multi-year timeline</li></ul><p>The system must support:</p><p>Partitioned indexing</p><ul><li>Paginated dashboard views</li><li>Streaming artifact access</li><li>Incremental reprocessing</li><li>Partial mapping updates</li></ul><p>Full-case reload must not be required for minor updates.</p><hr/><p>Retry &amp; Failure Recovery Model</p><p>All jobs must support:</p><p>Retryable failures</p><ul><li>Deterministic replay</li><li>Exponential backoff</li><li>Dead-letter queue</li><li>Manual requeue capability</li></ul><p>Replay must not duplicate artifacts.</p><p>Replay must preserve idempotency.</p><hr/><h4 id="capacity-planning-requirements">Capacity Planning Requirements</h4><p>Antigravity must design for:</p><p>Multi-tenant production scale</p><ul><li>Growth of data footprint over years</li><li>Predictable scaling cost model</li><li>Separate compute scaling from storage scaling</li></ul><p>Capacity planning must include:</p><p>Storage growth projections</p><ul><li>Compute scaling curves</li><li>LLM cost projections</li><li>Backup growth rate</li></ul><hr/><h4 id="monitoring-observability">Monitoring &amp; Observability</h4><p>The system must include:</p><p>Structured logging</p><ul><li>Metrics collection</li><li>Distributed tracing</li><li>Agent execution metrics</li><li>Queue depth monitoring</li><li>Cost monitoring</li><li>Error rate dashboards</li></ul><p>Performance metrics must include:</p><p>Average ProcessingJob duration</p><ul><li>MappingJob duration</li><li>AuditJob duration</li><li>Upload throughput</li><li>Search latency</li></ul><hr/><h4 id="performance-testing-requirements">Performance Testing Requirements</h4><p>Before production:</p><p>Load testing must simulate multi-GB case</p><ul><li>Concurrent upload testing</li><li>Agent queue stress testing</li><li>Cross-case isolation testing</li><li>Vector search scaling test</li><li>Replay testing for deterministic runs</li></ul><p>Performance validation must be documented.</p><hr/><h4 id="completion-criteria">Completion Criteria</h4><p>Performance architecture is considered complete when:</p><p>Horizontal scaling validated</p><p>• Large case stress tests pass</p><p>• No race conditions detected</p><p>• Idempotency confirmed</p><p>• Cost governance enforced</p><p>• Vector isolation validated</p><p>• Replay stability confirmed</p><h3 id="backup-disaster-recovery-business-continuity-authoritative">BACKUP, DISASTER RECOVERY &amp; BUSINESS CONTINUITY (AUTHORITATIVE)</h3><hr/><h4 id="purpose-7">Purpose</h4><p>This section defines mandatory requirements for:</p><p>Data durability</p><ul><li>Disaster recovery</li><li>System continuity</li><li>Legal defensibility under infrastructure failure</li><li>Long-term litigation preservation</li></ul><p>Because the platform manages legal evidence and case artifacts, data loss is unacceptable. Recovery must be deterministic, auditable, and integrity-preserving.</p><hr/><h4 id="governing-principles">Governing Principles</h4><p>The system must guarantee:</p><p>No silent data loss</p><ul><li>No silent artifact corruption</li><li>No cross-case data bleed during recovery</li><li>Cryptographic integrity preservation</li><li>Reproducible restoration</li><li>Audit continuity</li></ul><p>Backups must preserve:</p><p>Artifact immutability</p><ul><li>Version history</li><li>Hash integrity</li><li>Audit log completeness</li><li>Case isolation</li></ul><hr/><h4 id="data-classification-for-backup">Data Classification for Backup</h4><p>All data falls into one of four categories:</p><p>Authoritative Evidence Layer (Highest Criticality)</p><p>Includes:</p><p>Original uploaded files</p><ul><li>TEXT_VAULT</li><li>TEXT_CHUNKS</li><li>Artifact binaries</li><li>Hash records</li></ul><p>Recovery Requirement:</p><p>Zero loss tolerance.</p><hr/><p>Structured Case Record Layer</p><p>Includes:</p><p>ACTIVE_CASE_STORE tables</p><ul><li>Mapping tables</li><li>Issue/Task records</li><li>Workflow state</li><li>Policy snapshots</li></ul><p>Recovery Requirement:</p><p>Zero logical inconsistency permitted.</p><hr/><h4 id="operational-governance-layer">Operational Governance Layer</h4><p>Includes:</p><p>Audit logs</p><p>• Agent execution logs</p><p>• Job records</p><p>• Idempotency keys</p><p>• Cost tracking records</p><p>Recovery Requirement:</p><p>Complete historical traceability required.</p><hr/><h4 id="derivedregenerable-layer">Derived/Regenerable Layer</h4><p>Includes:</p><p>Vector embeddings</p><p>• Search indexes</p><p>• Caches</p><p>• Performance metrics</p><p>Recovery Requirement:</p><p>May be regenerated deterministically from authoritative sources.</p><hr/><h4 id="backup-frequency">Backup Frequency</h4><p>Minimum requirements:</p><p><strong>Authoritative storage:</strong> continuous replication + daily snapshot</p><ul><li>Databases: p?on change</li></ul><p>Backup windows must not block production operation.</p><hr/><h4 id="backup-integrity-validation">Backup Integrity Validation</h4><p>Backups must:</p><p>Be encrypted at rest</p><ul><li>Be checksum validated</li><li>Be periodically restoration-tested</li><li>Preserve content_hash for all files</li><li>Preserve artifact_version lineage</li></ul><p>Quarterly restoration validation is mandatory.</p><hr/><h4 id="disaster-recovery-objectives">Disaster Recovery Objectives</h4><p>Antigravity must define and implement:</p><p>RPO (Recovery Point Objective)</p><ul><li>RTO (Recovery Time Objective)</li></ul><p>Recommended baseline targets:</p><p><strong>RPO:</strong> ≤ 15 minutes</p><ul><li>RTO: ≤ 4 hours</li></ul><p>Final values must be formally documented.</p><hr/><h4 id="geographic-redundancy">Geographic Redundancy</h4><p>Production architecture must support:</p><p>Multi-zone deployment</p><ul><li>Cross-region backup replication</li><li>Object storage replication</li><li>Database replica in secondary region</li></ul><p>Failover must:</p><p>Preserve case isolation</p><ul><li>Preserve encryption keys</li><li>Preserve artifact integrity</li></ul><hr/><h4 id="encryption-key-management-during-recovery">Encryption &amp; Key Management During Recovery</h4><p>The system must:</p><p>Use managed key rotation</p><ul><li>Preserve key continuity across failover</li><li>Prevent key mismatch during restore</li><li>Log all key access events</li></ul><p>Loss of encryption keys must be treated as catastrophic event.</p><p>Key backups must be separately secured.</p><hr/><h4 id="deterministic-restoration-requirements">Deterministic Restoration Requirements</h4><p>Upon restore:</p><p>Artifact versions must remain intact</p><ul><li>Hash values must match original</li><li>TEXT_VAULT / TEXT_CHUNKS relationships must remain valid</li><li>Mapping references must not break</li><li>Audit logs must reflect restoration event</li></ul><p>Post-restore validation must include:</p><p>Hash revalidation sampling</p><ul><li>Referential integrity checks</li><li>Artifact lineage verification</li></ul><hr/><h4 id="incident-response-protocol">Incident Response Protocol</h4><p>The system must define:</p><p>Incident classification tiers</p><ul><li>Escalation chain</li><li>Communication policy</li><li>Forensic preservation rules</li></ul><p>During incident:</p><p>No artifact deletion permitted</p><ul><li>All diagnostic actions logged</li><li>Attorney notification required for material impact</li></ul><hr/><h4 id="business-continuity-plan">Business Continuity Plan</h4><p>In extended outage scenario:</p><p>The system must support:</p><p>Read-only access mode</p><ul><li>Restricted publish/export mode</li><li>Deferred job queueing</li><li>Preservation of UploadSessions in-progress</li></ul><p>Manual fallback procedures must include:</p><p>Secure file receipt protocol</p><ul><li>Emergency storage vault</li><li>Controlled later ingestion</li></ul><p>All emergency actions must be auditable.</p><hr/><h4 id="data-retention-archival">Data Retention &amp; Archival</h4><p>The system must support:</p><p>Long-term archival of closed cases</p><ul><li>Glacier-tier storage (or equivalent)</li><li>Retrieval on demand</li><li>Retention policies by jurisdiction</li></ul><p>Archival must preserve:</p><p>Artifact versions</p><ul><li>Hashes</li><li>Audit logs</li><li>Mapping lineage</li></ul><p>Deletion must require:</p><p>Explicit authorized action</p><ul><li>Retention policy validation</li><li>Audit event emission</li></ul><hr/><h4 id="legal-hold-enforcement">Legal Hold Enforcement</h4><p>If Legal Hold is applied:</p><p>No deletion allowed</p><ul><li>No archival transition allowed</li><li>No purge allowed</li><li>Hold must be recorded as artifact</li></ul><p>All hold actions must be auditable.</p><hr/><h4 id="backup-recovery-testing-requirements">Backup &amp; Recovery Testing Requirements</h4><p>Before production:</p><p>Full database restore test</p><ul><li>Object storage restore test</li><li>Cross-region failover test</li><li>Agent replay validation post-restore</li><li>Mapping integrity test</li><li>Hash consistency test</li></ul><p>Testing must be documented and versioned.</p><hr/><h4 id="recovery-logging-audit">Recovery Logging &amp; Audit</h4><p>All recovery events must produce:</p><p>DisasterRecoveryInitiated</p><ul><li>DisasterRecoveryCompleted</li><li>RegionFailoverExecuted</li><li>RestorationValidated</li><li>LegalHoldApplied (if relevant)</li></ul><p>Audit logs must survive recovery.</p><hr/><h4 id="completion-criteria-2">Completion Criteria</h4><p>Disaster recovery architecture is complete when:</p><p>Backup automation validated</p><ul><li>Cross-region replication active</li><li>Restore testing documented</li><li>RPO/RTO documented and approved</li><li>Encryption key continuity validated</li><li>Post-restore deterministic replay validated</li></ul><h3 id="deployment-environment-strategy-release-governance-authoritative">DEPLOYMENT, ENVIRONMENT STRATEGY &amp; RELEASE GOVERNANCE (AUTHORITATIVE)</h3><hr/><h4 id="purpose-8">Purpose</h4><p>This section defines the mandatory deployment architecture, environment separation model, release governance controls, and production protection standards required to build and operate the platform safely.</p><p>Because the platform handles legal evidence and defensible artifacts, deployment discipline is not optional. Development shortcuts that introduce drift, configuration ambiguity, or untested production changes are prohibited.</p><hr/><h4 id="environment-separation-model-mandatory">Environment Separation Model (Mandatory)</h4><p>Antigravity must implement strict environment isolation.</p><p>Minimum required environments:</p><p>Development (DEV)</p><ul><li>Integration/Test (TEST)</li><li>Staging (STAGE)</li><li>Production (PROD)</li></ul><p>Each environment must:</p><p>Use separate infrastructure</p><ul><li>Use separate databases</li><li>Use separate object storage buckets</li><li>Use separate encryption scopes</li><li>Use separate API credentials</li><li>Use separate integration keys</li></ul><p>No shared database instances across environments.</p><p>No shared encryption keys across environments.</p><hr/><h4 id="environment-data-rules">Environment Data Rules</h4><p>Production Data Protection</p><p>Production data:</p><p>Must never be copied into DEV or TEST without formal anonymization</p><ul><li>Must never be used for prompt experimentation</li><li>Must never be exposed to non-production integrations</li></ul><p>If test data is needed:</p><p>Synthetic data must be generated</p><ul><li>OR anonymized dataset must be created under documented process</li></ul><hr/><h4 id="staging-environment-requirements">Staging Environment Requirements</h4><p>STAGE must:</p><p>Mirror production infrastructure topology</p><p>• Mirror production configuration</p><p>• Use separate case data</p><p>• Support full workflow execution</p><p>• Support full agent orchestration</p><p>STAGE is the only environment authorized for final pre-production validation.</p><hr/><h4 id="deployment-architecture-requirements">Deployment Architecture Requirements</h4><p>Antigravity must implement:</p><p>Infrastructure-as-Code (IaC)</p><ul><li>Versioned configuration</li><li>Immutable deployment artifacts</li><li>Environment-specific configuration injection</li></ul><p>Manual configuration in cloud console is prohibited.</p><p>All infrastructure must be reproducible via code.</p><hr/><h4 id="cicd-pipeline-requirements">CI/CD Pipeline Requirements</h4><p>Continuous Integration / Continuous Deployment must include:</p><p>Code linting and formatting validation</p><ul><li>Static analysis</li><li>Security vulnerability scanning</li><li>Dependency audit</li><li>Unit test suite execution</li><li>Integration test suite execution</li><li>Schema migration validation</li><li>Artifact contract validation</li></ul><p>Deployment to:</p><ul><li>DEV — automated</li><li>TEST — automated</li><li>STAGE — gated approval</li><li>PROD — controlled approval only</li></ul><hr/><h4 id="database-migration-governance">Database Migration Governance</h4><p>Schema changes must:</p><p>Be versioned</p><ul><li>Be backward-compatible where possible</li><li>Be reversible</li><li>Be tested in TEST and STAGE</li><li>Include migration validation scripts</li></ul><p>Production schema changes require:</p><p>Change approval</p><ul><li>Backup verification</li><li>Rollback plan</li><li>Post-migration validation</li></ul><hr/><h4 id="artifact-contract-stability">Artifact Contract Stability</h4><p>Any change affecting:</p><p>Artifact schema</p><ul><li>CASE_CONTEXT_PLAYBOOK structure</li><li>TEXT_VAULT / TEXT_CHUNKS structure</li><li>Mapping artifact structure</li><li>Audit event schema</li></ul><p>Must require:</p><p>Version increment</p><ul><li>Backward compatibility assessment</li><li>Documentation update</li><li>Approval prior to production release</li></ul><p>Breaking artifact schema without versioning is prohibited.</p><hr/><h4 id="feature-flag-governance">Feature Flag Governance</h4><p>The system must support feature flags.</p><p>Feature flags must:</p><p>Be environment-specific</p><ul><li>Be role-gated where appropriate</li><li>Be audit-logged when toggled</li><li>Not alter deterministic behavior without version tagging</li></ul><p>Experimental features:</p><p>Must not modify case record</p><ul><li>Must not bypass readiness gates</li><li>Must not override EvidenceAudit requirements</li></ul><hr/><h4 id="release-classification">Release Classification</h4><p>Every deployment must be classified as:</p><p>Patch (bug fix only)</p><ul><li>Minor (non-breaking feature addition)</li><li>Major (artifact or workflow contract change)</li><li>Emergency (incident mitigation)</li></ul><p>Each classification requires:</p><p>Change log entry</p><ul><li>Approval workflow</li><li>Version tag</li><li>Rollback plan</li></ul><hr/><h4 id="production-deployment-guardrails">Production Deployment Guardrails</h4><p>Production release requires:</p><p>STAGE validation completed</p><ul><li>All automated tests passing</li><li>Security scan passed</li><li>Migration dry-run successful</li><li>Rollback strategy documented</li><li>Responsible engineer recorded</li><li>Deployment window recorded</li></ul><p>Deployment must emit:</p><p>ReleaseStarted</p><ul><li>ReleaseCompleted</li><li>ReleaseFailed (if applicable)</li></ul><hr/><h4 id="rollback-strategy">Rollback Strategy</h4><p>Rollback must support:</p><p>Application version rollback</p><ul><li>Database rollback (if reversible)</li><li>Configuration rollback</li><li>Feature flag rollback</li></ul><p>Rollback must not:</p><p>Corrupt artifact version history</p><ul><li>Remove audit records</li><li>Break idempotency guarantees</li></ul><p>Post-rollback validation must include:</p><p>Workflow integrity check</p><ul><li>Mapping integrity check</li><li>EvidenceAuditJob validation</li></ul><hr/><h4 id="production-monitoring-requirements">Production Monitoring Requirements</h4><p>Monitoring must include:</p><p>API health</p><ul><li>Agent job failure rate</li><li>Queue backlog</li><li>Processing latency</li><li>Mapping failure rates</li><li>EvidenceAudit failures</li><li>Database performance</li><li>Storage capacity</li><li>Error rates by endpoint</li></ul><p>Alerts must:</p><p>Be severity-tiered</p><ul><li>Escalate based on criticality</li><li>Log acknowledgment events</li></ul><hr/><h4 id="logging-observability-standards">Logging &amp; Observability Standards</h4><p>The system must implement:</p><p>Structured logging</p><ul><li>Correlation_id propagation across services</li><li>Centralized log aggregation</li><li>Environment tagging</li><li>Agent name tagging</li><li>Case_id tagging (when appropriate)</li></ul><p>Sensitive data must never be logged.</p><p>Logs must be retained per policy.</p><hr/><h4 id="change-governance-approval">Change Governance &amp; Approval</h4><p>Changes affecting:</p><p>Agent deterministic behavior</p><ul><li>Artifact schema</li><li>Workflow state machine</li><li>Readiness gating</li><li>Encryption or security posture</li></ul><p>Require:</p><p>Formal change record</p><ul><li>Risk classification</li><li>Technical review</li><li>Legal governance review (if applicable)</li><li>Approval prior to deployment</li></ul><hr/><h4 id="incident-driven-emergency-deployment">Incident-Driven Emergency Deployment</h4><p>Emergency releases must:</p><p>Be limited to minimal fix scope</p><ul><li>Be documented post-release</li><li>Be followed by root cause analysis</li><li>Be followed by permanent fix deployment</li></ul><p>Emergency deployments must still:</p><p>Preserve audit logging</p><ul><li>Preserve deterministic contracts</li><li>Preserve artifact integrity</li></ul><hr/><h4 id="completion-criteria-3">Completion Criteria</h4><p>Deployment governance is complete when:</p><p>All environments isolated</p><ul><li>CI/CD fully automated</li><li>Schema migration protocol defined</li><li>Rollback plan tested</li><li>Feature flag governance implemented</li><li>Monitoring active</li><li>Release logging validated</li></ul><h3 id="security-access-control-role-governance-authoritative">SECURITY, ACCESS CONTROL &amp; ROLE GOVERNANCE (AUTHORITATIVE)</h3><hr/><h4 id="purpose-9">Purpose</h4><p>This section defines mandatory security architecture, access controls, encryption standards, role governance, override controls, and privileged operation restrictions.</p><p>Because the platform handles legal evidence, client-sensitive data, and litigation artifacts, security is not a feature — it is a structural requirement.</p><p>No agent, user, or system component may bypass these controls.</p><hr/><h4 id="security-design-principles-mandatory-2">Security Design Principles (Mandatory)</h4><p>The platform must enforce:</p><p>Zero Trust architecture</p><ul><li>Least privilege access</li><li>Case-scoped isolation</li><li>Deterministic audit logging</li><li>Explicit privilege escalation controls</li><li>Encryption at rest and in transit</li><li>No cross-case data leakage</li></ul><p>No implicit trust between services.</p><p>No shared secrets embedded in code.</p><hr/><h4 id="identity-authentication-model">Identity &amp; Authentication Model</h4><p>Authentication Requirements</p><p>All users must authenticate via:</p><p>Strong password policy</p><ul><li>Multi-Factor Authentication (MFA)</li><li>Session expiration with idle timeout</li><li>Device/session logging</li></ul><p>Support:</p><p>Staff authentication</p><ul><li>Client portal authentication</li><li>API authentication (service accounts)</li></ul><hr/><h4 id="token-requirements">Token Requirements</h4><p>All API access must use short-lived signed tokens</p><ul><li>Tokens must include role claims</li><li>Tokens must include case scope (when applicable)</li><li>Tokens must include correlation_id</li></ul><p>Refresh tokens must be stored securely.</p><hr/><h4 id="role-based-access-control-rbac-2">Role-Based Access Control (RBAC)</h4><p>The system must implement strict RBAC.</p><p>Minimum roles (expandable but not reducible):</p><p>Client</p><ul><li>Attorney</li><li>Partner</li><li>Paralegal</li><li>CaseStaff</li><li>SystemAdmin</li><li>ComplianceOfficer</li><li>ServiceAccount (non-human)</li></ul><p>Each role must:</p><p>Have explicit permission matrix</p><ul><li>Be auditable</li><li>Be environment-specific</li></ul><hr/><h4 id="permission-model-authoritative">Permission Model (Authoritative)</h4><p>Permissions must be:</p><p>Explicitly defined</p><ul><li>Deny-by-default</li><li>Case-scoped where applicable</li><li>Logged on execution</li></ul><p>Permission categories include:</p><p>Read artifact</p><ul><li>Create artifact</li><li>Approve artifact</li><li>Override readiness gate</li><li>Initiate publish/export</li><li>Access external research tools</li><li>Modify workflow state</li><li>Manage users</li><li>Configure policy</li></ul><p>No role may have implicit wildcard permission.</p><hr/><h4 id="case-isolation-enforcement-3">Case Isolation Enforcement</h4><p>All case-scoped access must:</p><p>Require case_id in request</p><ul><li>Validate user role against case membership</li><li>Enforce row-level security</li><li>Enforce encryption scope</li></ul><p>Cross-case queries are prohibited unless:</p><p>Explicitly authorized by governance</p><ul><li>Logged</li><li>Policy-approved</li></ul><p>Agents must not access other cases unless explicitly allowed by policy.</p><hr/><h4 id="encryption-standards">Encryption Standards</h4><p>Data at Rest</p><p>All case-scoped data must be encrypted at rest.</p><p>Recommended:</p><p>AES-256 encryption</p><ul><li>Envelope encryption</li><li>Per-case Data Encryption Keys (DEK)</li></ul><p>Key management must:</p><p>Be centralized</p><ul><li>Be auditable</li><li>Support key rotation</li></ul><hr/><p>Data in Transit</p><p>All communication must use:</p><p>TLS 1.2 or higher</p><ul><li>Mutual TLS for internal services (recommended)</li></ul><p>No plaintext internal traffic.</p><hr/><h4 id="privileged-operations-directive-governance">Privileged Operations &amp; Directive Governance</h4><p>Certain operations require Directive authorization.</p><p>Examples:</p><p>Legal research tool access</p><ul><li>Publish/export release</li><li>Workflow override</li><li>Readiness gate bypass</li><li>COA taxonomy modification</li><li>Artifact deletion (if ever allowed)</li></ul><p>Directive must include:</p><p>directive_id</p><ul><li>case_id</li><li>authorized_by</li><li>scope</li><li>timestamp</li><li>expiration (if applicable)</li><li>justification</li></ul><p>All Directive use must be audit-logged.</p><hr/><h4 id="override-controls-authoritative">Override Controls (Authoritative)</h4><p>Override is a privileged action.</p><p>Override rules:</p><p>Role-restricted (Attorney/Partner minimum)</p><ul><li>Justification required</li><li>Explicitly logged</li><li>Cannot delete history</li><li>Cannot erase audit trail</li><li>Cannot modify immutable artifacts</li></ul><p>Override must generate:</p><p>OverrideRecorded</p><ul><li>CaseStateUpdated</li><li>Audit event with full metadata</li></ul><p>Overrides must be visible in dashboard.</p><hr/><h4 id="external-tool-mediation-security">External Tool Mediation Security</h4><p>All external integrations must:</p><p>Be accessed only through Integration Layer</p><ul><li>Use secure credential vault</li><li>Enforce rate limiting</li><li>Enforce cost caps</li><li>Log request metadata</li></ul><p>No agent may call external API directly.</p><p>No UI may directly call external LLM or OCR service.</p><hr/><h4 id="agent-execution-security">Agent Execution Security</h4><p>Agents must:</p><p>Operate under service identity</p><ul><li>Use scoped permissions</li><li>Not escalate privileges</li><li>Not access data outside provided context</li><li>Not modify other agent artifacts</li></ul><p>Each agent run must:</p><p>Record initiating identity</p><p>• Record effective role</p><p>• Record case scope</p><p>• Record policy snapshot</p><hr/><h4 id="data-access-logging-mandatory">Data Access Logging (Mandatory)</h4><p>Every data access must log:</p><p>user_id or service_account_id</p><ul><li>role</li><li>case_id</li><li>action_type</li><li>artifact_id or entity_id</li><li>correlation_id</li><li>timestamp</li><li>result (success/failure)</li></ul><p>High-sensitivity access (evidence, transcripts) must include additional logging.</p><hr/><p>Audit Log Protection</p><p>Audit logs must:</p><p>Be append-only</p><ul><li>Be tamper-evident</li><li>Be encrypted</li><li>Be access-restricted</li><li>Support retention policies</li></ul><p>No user, including SystemAdmin, may delete audit records.</p><hr/><h4 id="data-retention-legal-hold">Data Retention &amp; Legal Hold</h4><p>Retention rules must support:</p><p>Case-specific retention class</p><h4 id="legal-hold-flag">• Legal hold flag</h4><h4 id="suspension-of-deletion">• Suspension of deletion</h4><h4 id="audit-logging-of-hold-events">• Audit logging of hold events</h4><p>Legal hold must prevent:</p><p>File deletion</p><h4 id="artifact-purge">• Artifact purge</h4><h4 id="audit-log-deletion">• Audit log deletion</h4><hr/><h4 id="sensitive-data-controls">Sensitive Data Controls</h4><p>The system must:</p><p>Prevent logging of raw evidence content</p><ul><li>Mask sensitive values in logs</li><li>Prevent prompt injection persistence</li><li>Prevent LLM output injection into system state without deterministic validation</li></ul><p>No external provider may store case data beyond policy.</p><hr/><h4 id="security-monitoring-alerts">Security Monitoring &amp; Alerts</h4><p>Security monitoring must include:</p><p>Unauthorized access attempts</p><ul><li>Privilege escalation attempts</li><li>Repeated failed logins</li><li>Cross-case access attempts</li><li>Override frequency anomalies</li><li>Directive misuse</li></ul><p>Alerts must:</p><p>Escalate based on severity</p><ul><li>Record acknowledgment</li><li>Be auditable</li></ul><hr/><h4 id="separation-of-duties">Separation of Duties</h4><p>The system must enforce:</p><p>Developers cannot access production case data</p><ul><li>SystemAdmin cannot modify case artifacts</li><li>Attorneys cannot modify audit logs</li><li>ComplianceOfficer can review logs but not alter artifacts</li></ul><p>Separation of duties must be policy-enforced.</p><hr/><h4 id="incident-response-hooks">Incident Response Hooks</h4><p>Security incidents must trigger:</p><p>Incident record creation</p><ul><li>Audit trail capture</li><li>Containment workflow</li><li>Notification workflow</li><li>Post-incident review requirement</li></ul><p>Incident metadata must be preserved.</p><hr/><h4 id="completion-criteria-4">Completion Criteria</h4><p>Security governance is complete when:</p><p>RBAC matrix fully defined</p><ul><li>Case isolation verified</li><li>Encryption validated</li><li>Directive system implemented</li><li>Override governance implemented</li><li>Audit logging validated</li><li>Monitoring active</li></ul><h3 id="performance-scalability-capacity-planning-authoritative">PERFORMANCE, SCALABILITY &amp; CAPACITY PLANNING (AUTHORITATIVE)</h3><hr/><h4 id="purpose-10">Purpose</h4><p>This section defines the performance, scalability, throughput, and system capacity requirements necessary to ensure:</p><p>Deterministic execution integrity</p><ul><li>Large file handling capability</li><li>Multi-case concurrency</li><li>DIKW knowledge scaling</li><li>External integration reliability</li><li>Long-term operational stability</li></ul><p>Performance must never compromise:</p><p>Case isolation</p><ul><li>Evidence integrity</li><li>Audit completeness</li><li>Deterministic reproducibility</li></ul><hr/><h4 id="performance-design-principles">Performance Design Principles</h4><p>The system must enforce:</p><p>Horizontal scalability</p><ul><li>Asynchronous processing for heavy workloads</li><li>Event-driven orchestration</li><li>Idempotent job execution</li><li>Controlled concurrency</li><li>Backpressure mechanisms</li><li>No blocking UI calls for long-running jobs</li></ul><p>Agents must never execute synchronously within UI request-response loops if execution time exceeds threshold policy.</p><hr/><h4 id="concurrency-model">Concurrency Model</h4><p>The system must support:</p><p>Multiple concurrent cases</p><ul><li>Multiple concurrent UploadSessions</li><li>Multiple parallel ProcessingJobs</li><li>Independent MappingJobs per case</li><li>Independent EvidenceAuditJobs</li></ul><p>Concurrency constraints:</p><p>No cross-case locking</p><ul><li>No global mutable state</li><li>Per-case isolation in memory and persistence</li><li>Job-level idempotency keys</li></ul><hr/><h4 id="asynchronous-job-architecture">Asynchronous Job Architecture</h4><p>All heavy workloads must execute via:</p><p>Job Queue</p><ul><li>Orchestration Layer</li><li>Worker Pools</li></ul><p>Long-running workloads include:</p><p>OCR</p><ul><li>STT</li><li>Chunking</li><li>Extraction indexing</li><li>Mapping</li><li>Evidence audit</li><li>Deposition processing</li><li>Trial artifact generation</li></ul><p>Workers must:</p><p>Be stateless</p><ul><li>Use correlation_id</li><li>Record deterministic_run_metadata</li><li>Respect retry policies</li></ul><hr/><h4 id="throughput-requirements-baseline-targets">Throughput Requirements (Baseline Targets)</h4><p>The platform must be architected to support:</p><p>100+ concurrent active cases (initial target; scalable beyond)</p><ul><li>1,000+ uploaded files per case</li><li>Multi-GB file support (policy controlled)</li><li>Tens of thousands of TEXT_CHUNKS per case</li><li>Parallel agent runs without cross-impact</li></ul><p>These are architectural constraints, not current volume claims.</p><hr/><h4 id="large-file-handling">Large File Handling</h4><p>The system must support:</p><p>Multi-MB and multi-GB files</p><ul><li>Streaming upload</li><li>Chunked upload transfer</li><li>Hash computation during stream</li><li>Background integrity validation</li></ul><p>Constraints:</p><p>No file fully loaded into memory if size exceeds threshold</p><ul><li>Use streaming pipelines for OCR/STT</li><li>Preserve original bytes</li></ul><hr/><h4 id="text_vault-chunk-scalability">TEXT_VAULT &amp; Chunk Scalability</h4><p>Chunking must:</p><p>Be policy-driven (token/character size)</p><ul><li>Support overlap configuration</li><li>Preserve stable ordering</li><li>Support deterministic reassembly</li><li>Scale to large transcript sets</li></ul><p>Indexing must support:</p><p>Case-scoped full-text search</p><ul><li>Efficient retrieval by vault_id</li><li>Efficient retrieval by chunk_id</li></ul><p>Re-index operations must be idempotent.</p><hr/><h4 id="database-scalability-requirements">Database Scalability Requirements</h4><p>The data layer must support:</p><p>Partitioning by case_id</p><ul><li>Indexing by case_id + artifact_id</li><li>Efficient mapping joins</li><li>Append-only audit storage at scale</li></ul><p>Design must avoid:</p><p>Global table locks</p><ul><li>Unbounded table scans</li><li>Cross-case aggregation queries</li></ul><p>Archival processes must reduce load on active database.</p><hr/><h4 id="caching-strategy-governed">Caching Strategy (Governed)</h4><p>Caching may be used only for:</p><p>Non-authoritative advisory views</p><ul><li>Legal research references</li><li>Derived knowledge indices</li><li>UI performance optimization</li></ul><p>Caching must not:</p><p>Modify authoritative records</p><ul><li>Bypass audit logging</li><li>Bypass policy validation</li></ul><p>Cache invalidation must be deterministic and auditable where necessary.</p><hr/><h4 id="external-integration-performance-controls">External Integration Performance Controls</h4><p>All external calls must:</p><p>Be rate-limited</p><ul><li>Have timeout thresholds</li><li>Use retry logic with backoff</li><li>Respect cost caps</li><li>Record latency metrics</li></ul><p>Failure to reach external services must:</p><p>Fail gracefully</p><ul><li>Create Issue if blocking</li><li>Not corrupt case state</li></ul><p>No external call may block case isolation or system responsiveness.</p><hr/><h4 id="backpressure-resource-governance">Backpressure &amp; Resource Governance</h4><p>The system must include:</p><p>Queue depth monitoring</p><ul><li>Worker scaling thresholds</li><li>Circuit breakers</li><li>Automatic job throttling</li></ul><p>When resource limits are reached:</p><p>Lower priority advisory jobs may pause</p><ul><li>Deterministic evidence jobs must be prioritized</li><li>No job may be silently dropped</li></ul><p>All throttling events must be logged.</p><hr/><h4 id="deterministic-performance-guarantees">Deterministic Performance Guarantees</h4><p>Performance optimizations must never:</p><p>Skip required validation</p><ul><li>Collapse multiple runs into one without trace</li><li>Drop trace metadata</li><li>Modify execution order in a way that changes reproducibility</li></ul><p>Deterministic_run_metadata must include:</p><p>Model version</p><ul><li>Tool version</li><li>Template version</li><li>Policy snapshot</li><li>Timestamp</li><li>Context snapshot</li></ul><hr/><h4 id="scaling-the-dikw-model">Scaling the DIKW Model</h4><p>As cases increase:</p><p>DATA layer grows (files, chunks)</p><ul><li>INFORMATION layer grows (normalized entities, mappings)</li><li>KNOWLEDGE layer grows (sanitized derived insights)</li></ul><p>Scaling rules:</p><p>Derived Knowledge Store must be rebuildable</p><ul><li>Cross-case promotion must be governance-controlled</li><li>Knowledge must never auto-modify active case records</li></ul><p>Intelligence scaling must not introduce cross-case contamination.</p><hr/><h4 id="monitoring-observability-2">Monitoring &amp; Observability</h4><p>The system must monitor:</p><p>Job durations</p><ul><li>Queue depths</li><li>Worker CPU/memory</li><li>DB query performance</li><li>External API latency</li><li>Artifact generation time</li><li>Audit write performance</li></ul><p>Metrics must be:</p><p>Case-scoped where relevant</p><ul><li>Environment-scoped (Dev/Stage/Prod)</li><li>Role-restricted for viewing</li></ul><hr/><h4 id="service-level-objectives-slo-framework">Service Level Objectives (SLO) Framework</h4><p>The platform must define SLOs for:</p><p>Upload completion</p><ul><li>Processing time per file</li><li>Mapping completion latency</li><li>Evidence audit latency</li><li>Publish/export readiness checks</li></ul><p>SLO breaches must:</p><p>Trigger alert</p><ul><li>Be logged</li><li>Be reviewable</li></ul><p>SLOs are governance metrics, not legal guarantees.</p><hr/><h4 id="disaster-resilience-performance-interaction">Disaster Resilience (Performance Interaction)</h4><p>Performance scaling must integrate with:</p><p>Backup policies</p><ul><li>Replication</li><li>Archive separation</li><li>Failover environments</li></ul><p>Performance optimization must not compromise:</p><p>Backup integrity</p><ul><li>Replication completeness</li><li>Audit log durability</li></ul><hr/><h4 id="horizontal-scaling-model">Horizontal Scaling Model</h4><p>The system must support:</p><p>Multiple stateless API instances</p><ul><li>Multiple worker instances</li><li>Scalable job queue</li><li>Scalable storage backends</li><li>Independent environment scaling</li></ul><p>No component may require single-instance execution.</p><hr/><h4 id="capacity-planning-requirements-2">Capacity Planning Requirements</h4><p>The system must support:</p><p>Projected case growth forecasting</p><ul><li>Storage growth forecasting</li><li>Artifact volume forecasting</li><li>Chunk index growth forecasting</li></ul><p>Capacity thresholds must trigger:</p><p>Administrative alerts</p><ul><li>Infrastructure scaling recommendations</li></ul><hr/><h4 id="performance-governance">Performance Governance</h4><p>Performance tuning must:</p><p>Be version-controlled</p><ul><li>Be documented</li><li>Not alter deterministic behavior</li><li>Not alter evidence trace guarantees</li></ul><p>No silent configuration drift allowed.</p><hr/><h4 id="completion-criteria-5">Completion Criteria</h4><p>This section is complete when:</p><p>Asynchronous job architecture defined</p><ul><li>Scaling model documented</li><li>Queue system defined</li><li>DB partitioning defined</li><li>Large file handling supported</li><li>Backpressure mechanisms implemented</li><li>Deterministic metadata preserved</li></ul><h3 id="environment-model-deployment-architecture-authoritative">ENVIRONMENT MODEL &amp; DEPLOYMENT ARCHITECTURE (AUTHORITATIVE)</h3><hr/><h4 id="purpose-11">Purpose</h4><p>This section defines the mandatory environment separation, deployment governance, release control, and infrastructure isolation model required to ensure:</p><p>Deterministic reproducibility</p><ul><li>Evidence integrity protection</li><li>Audit immutability</li><li>No cross-environment contamination</li><li>Controlled promotion to production</li></ul><p>This section is non-optional for system defensibility.</p><hr/><h4 id="environment-separation-model">Environment Separation Model</h4><p>The platform must operate in at least three strictly separated environments:</p><p>DEV (Development)</p><ul><li>STAGE (Staging / Pre-Production)</li><li>PROD (Production)</li></ul><p>Optional additional environments may include:</p><p>QA (formal validation)</p><ul><li>TRAINING (non-live demonstration)</li></ul><p>Environment boundaries must be enforced at:</p><p>Network level</p><ul><li>Database level</li><li>Storage level</li><li>Encryption key level</li><li>API gateway level</li><li>Queue / worker layer</li></ul><p>No shared databases across environments.</p><hr/><h4 id="dev-environment-non-authoritative">DEV Environment (Non-Authoritative)</h4><p>Purpose:</p><p>Active development</p><ul><li>Feature implementation</li><li>Schema evolution</li><li>Agent logic refinement</li><li>Non-sensitive test data</li></ul><p>Rules:</p><p>No real client data</p><ul><li>No production encryption keys</li><li>No real legal research credentials</li><li>No cross-case production knowledge</li></ul><p>DEV may:</p><p>Use synthetic data</p><ul><li>Use masked datasets</li><li>Use mock integrations</li></ul><p>DEV outputs are not authoritative and may not be exported externally.</p><hr/><h4 id="stage-environment-pre-production-validation">STAGE Environment (Pre-Production Validation)</h4><p>Purpose:</p><p>Full-system validation</p><ul><li>Deterministic execution verification</li><li>Release candidate testing</li><li>Security validation</li><li>Performance validation</li></ul><p>Rules:</p><p>Must mirror PROD architecture</p><ul><li>May use sanitized/masked case data</li><li>Must use separate encryption keys</li><li>Must test migration scripts</li></ul><p>All agent workflows must pass STAGE before PROD deployment.</p><hr/><h4 id="prod-environment-authoritative">PROD Environment (Authoritative)</h4><p>Purpose:</p><p>Active case processing</p><ul><li>Evidence storage</li><li>Mapping and audit generation</li><li>Publish/export readiness</li><li>Client and attorney interaction</li></ul><p>PROD constraints:</p><ul><li>Strict case isolation</li><li>Immutable audit logging</li><li>Controlled legal research access</li><li>No debugging shortcuts</li><li>No direct DB manipulation</li></ul><p>All artifacts in PROD are authoritative.</p><hr/><h4 id="infrastructure-isolation-requirements-2">Infrastructure Isolation Requirements</h4><p>Each environment must have:</p><p>Separate databases</p><ul><li>Separate object storage buckets</li><li>Separate job queues</li><li>Separate cache instances</li><li>Separate encryption key management</li><li>Separate monitoring systems</li></ul><p>Environment variables must never overlap.</p><p>Secrets must be environment-scoped.</p><hr/><h4 id="encryption-key-separation">Encryption Key Separation</h4><p>Encryption must enforce:</p><p>Separate root keys per environment</p><ul><li>Separate per-case DEKs in PROD</li><li>No key reuse across environments</li><li>Key rotation policies</li></ul><p>DEV keys must never decrypt PROD data.</p><hr/><h4 id="deployment-model">Deployment Model</h4><p>All deployments must be:</p><p>Version-controlled</p><ul><li>Tagged with release version</li><li>Traceable to commit hash</li><li>Logged in release registry</li></ul><p>Deployment must include:</p><p>Schema migration step</p><ul><li>Artifact compatibility validation</li><li>Agent compatibility validation</li><li>Rollback capability</li></ul><p>No manual production edits allowed.</p><hr/><h4 id="schema-migration-governance-2">Schema Migration Governance</h4><p>All schema changes must:</p><p>Be versioned</p><ul><li>Include forward migration script</li><li>Include rollback script</li><li>Be tested in DEV and STAGE</li><li>Be audited at PROD deployment</li></ul><p>Migration must not:</p><p>Modify immutable artifacts</p><ul><li>Break historical artifact interpretation</li><li>Alter deterministic replay</li></ul><p>Backward compatibility must be maintained.</p><hr/><h4 id="agent-version-control">Agent Version Control</h4><p>Each agent must:</p><p>Have explicit version identifier</p><ul><li>Store version in deterministic_run_metadata</li><li>Maintain compatibility with prior artifact formats</li><li>Log version in audit events</li></ul><p>Agent upgrades must:</p><p>Be tested against historical artifact sets</p><ul><li>Not corrupt reproducibility</li><li>Not silently change deterministic outputs</li></ul><hr/><h4 id="release-governance">Release Governance</h4><p>Release to PROD requires:</p><p>Successful STAGE validation</p><ul><li>Security verification</li><li>Deterministic replay validation</li><li>Migration dry run</li><li>Approval by authorized role</li></ul><p>Release approval must be:</p><p>Documented</p><ul><li>Audited</li><li>Versioned</li></ul><p>Emergency releases must be separately logged and reviewed.</p><hr/><h4 id="rollback-requirements">Rollback Requirements</h4><p>System must support:</p><p>Application rollback</p><ul><li>Schema rollback (where safe)</li><li>Worker rollback</li><li>Configuration rollback</li></ul><p>Rollback must not:</p><p>Remove audit logs</p><ul><li>Delete artifact versions</li><li>Break case reproducibility</li></ul><p>Rollback events must be logged.</p><hr/><p>Configuration Management</p><p>All configuration must be:</p><p>Environment-scoped</p><ul><li>Version-controlled</li><li>Change-tracked</li><li>Audit-logged</li></ul><p>Includes:</p><p>Policy profiles</p><ul><li>Cost caps</li><li>Integration credentials</li><li>Queue limits</li><li>Rate limits</li></ul><p>No runtime configuration drift permitted.</p><hr/><p>Secrets &amp; Credential Management</p><p>All secrets must:</p><p>Be stored in managed secret store</p><ul><li>Be encrypted at rest</li><li>Be rotated per policy</li><li>Be environment-isolated</li></ul><p>Secrets must never be:</p><p>Stored in source code</p><ul><li>/dded in artifacts</li></ul><hr/><h4 id="logging-monitoring-separation">Logging &amp; Monitoring Separation</h4><p>Monitoring systems must:</p><p>Not expose cross-environment data</p><ul><li>Not store sensitive evidence in logs</li><li>Mask PII where required</li><li>Preserve audit integrity</li></ul><p>PROD logs must have stricter access controls than DEV/STAGE.</p><hr/><h4 id="environment-data-movement-rules">Environment Data Movement Rules</h4><p>Data movement between environments must follow:</p><p>No PROD → DEV transfer</p><ul><li>PROD → STAGE only if sanitized</li><li>No DEV → PROD data injection</li><li>No STAGE → PROD artifact migration</li></ul><p>Authoritative artifacts must only originate in PROD.</p><hr/><h4 id="backup-replication-per-environment">Backup &amp; Replication Per Environment</h4><p>Each environment must have:</p><p>Independent backup policy</p><ul><li>Independent restore testing</li><li>Independent replication configuration</li></ul><p>PROD backups must meet highest durability standard.</p><hr/><h4 id="multi-region-strategy-if-implemented">Multi-Region Strategy (If Implemented)</h4><p>If multi-region deployment is implemented:</p><p>Case isolation must persist across regions</p><ul><li>Encryption keys must remain environment-scoped</li><li>Replication must preserve artifact immutability</li><li>Audit logs must replicate append-only</li></ul><p>No cross-region merging of case data permitted.</p><hr/><h4 id="infrastructure-as-code-mandatory">Infrastructure as Code (Mandatory)</h4><p>All infrastructure must be:</p><p>Defined in code</p><ul><li>Version-controlled</li><li>Reviewed before deployment</li><li>Reproducible</li></ul><p>Manual infrastructure configuration is prohibited.</p><hr/><h4 id="environment-health-gates">Environment Health Gates</h4><p>Before enabling:</p><p>Publish/Export</p><ul><li>Major workflow stage transition</li><li>External legal research</li></ul><p>System must confirm:</p><p>Environment healthy</p><ul><li>Audit subsystem operational</li><li>Encryption subsystem operational</li><li>Queue subsystem operational</li></ul><p>Failure must block outward-facing actions.</p><hr/><h4 id="completion-criteria-6">Completion Criteria</h4><p>This section is complete when:</p><p>DEV/STAGE/PROD separation defined</p><ul><li>Encryption isolation enforced</li><li>Schema migration governed</li><li>Agent versioning controlled</li><li>Deployment rollback defined</li><li>Infrastructure-as-code required</li></ul><h3 id="security-architecture-access-control-model-authoritative">SECURITY ARCHITECTURE &amp; ACCESS CONTROL MODEL (AUTHORITATIVE)</h3><hr/><h4 id="purpose-12">Purpose</h4><p>This section defines the mandatory security, identity, authorization, encryption, and access governance controls required to protect:</p><p>Client data</p><p>• Evidence artifacts</p><p>• Case-scoped records</p><p>• Privileged legal materials</p><p>• Audit logs</p><p>• External integrations</p><p>Security is not advisory. It is a system-enforced requirement.</p><hr/><p>Security Model Principles</p><p>The platform must operate under:</p><p>Zero-Trust Architecture</p><ul><li>Least Privilege Access</li><li>Explicit Case Scoping</li><li>Role-Governed Authorization</li><li>Deterministic Audit Logging</li><li>Encryption Everywhere</li><li>No Direct Tool Access</li></ul><p>Security must be enforced at:</p><p>Identity layer</p><ul><li>API layer</li><li>Data layer</li><li>Agent orchestration layer</li><li>Infrastructure layer</li></ul><hr/><h4 id="identity-authentication-model-2">Identity &amp; Authentication Model</h4><p>Identity Providers</p><p>The system must support:</p><p>Firm internal users (attorneys, paralegals, staff)</p><ul><li>External client users</li><li>Service accounts (system agents)</li></ul><p>Authentication must support:</p><p>Multi-Factor Authentication (MFA) (mandatory for firm users)</p><ul><li>Two-Factor Authentication (2FA) minimum baseline</li><li>Password complexity enforcement</li><li>Session expiration</li><li>Device trust policy (optional)</li></ul><p>No shared user accounts permitted.</p><hr/><p>Session Security</p><p>Each session must:</p><p>Be cryptographically signed</p><ul><li>Expire per policy</li><li>Be invalidated on logout</li><li>Be invalidated on privilege change</li><li>Be invalidated on suspicious activity</li></ul><p>Session tokens must never:</p><p>Contain raw case data</p><ul><li>Contain PII</li><li>Contain artifact payloads</li></ul><hr/><h4 id="role-based-access-control-rbac-3">Role-Based Access Control (RBAC)</h4><p>Access must be role-based and case-scoped.</p><p>Minimum roles:</p><p>Client</p><ul><li>Attorney/Partner</li><li>Paralegal/Staff</li><li>Operations/Admin</li><li>System Agent (non-human)</li></ul><p>Each role must have:</p><p>Explicit permissions matrix</p><ul><li>Case-scoped constraints</li><li>Explicit override rules (if permitted)</li></ul><p>Permissions must control:</p><p>Artifact view</p><ul><li>Artifact creation</li><li>Artifact modification (new version only)</li><li>Issue/task disposition</li><li>Publish/export</li><li>Legal research access</li><li>Override actions</li></ul><p>No role may implicitly inherit cross-case visibility.</p><hr/><h4 id="case-isolation-enforcement-4">Case Isolation Enforcement</h4><p>All requests must include:</p><p>case_id (except operational endpoints)</p><p>System must:</p><p>Enforce case_id at data access layer</p><ul><li>Prevent cross-case joins</li><li>Log cross-case attempts</li><li>Block unauthorized cross-case reads</li></ul><p>Cross-case knowledge access is permitted only through:</p><p>Knowledge Store (sanitized, advisory only)</p><ul><li>Governance-approved promotion</li></ul><hr/><h4 id="encryption-model">Encryption Model</h4><p>Encryption at Rest</p><p>Must encrypt:</p><p>Databases</p><ul><li>Object storage</li><li>Backups</li><li>Logs containing sensitive data</li></ul><p>Recommended:</p><p>Envelope encryption</p><ul><li>Per-case Data Encryption Key (DEK)</li><li>Root key rotation policy</li></ul><hr/><h4 id="encryption-in-transit">Encryption in Transit</h4><p>All data transport must use:</p><p>TLS 1.2+ minimum</p><ul><li>Certificate validation</li><li>Encrypted internal service communication</li></ul><p>No plaintext communication permitted between services.</p><hr/><h4 id="field-level-encryption-where-required">Field-Level Encryption (Where Required)</h4><p>Highly sensitive fields may require additional encryption:</p><p>SSN</p><ul><li>Financial identifiers</li><li>Medical data</li><li>Privileged notes</li></ul><p>Field-level encryption must be policy-defined.</p><hr/><h4 id="pii-sensitive-data-handling">PII &amp; Sensitive Data Handling</h4><p>The system must classify:</p><p>Personally Identifiable Information (PII)</p><ul><li>Privileged Legal Material</li><li>Financial Data</li><li>Medical/Health Data</li><li>Sensitive Client Communications</li></ul><p>Security controls must include:</p><p>Masking in logs</p><ul><li>Restricted export</li><li>Access restrictions by role</li><li>Audit of PII access</li></ul><p>No PII may be exposed in:</p><p>Debug logs</p><ul><li>Monitoring tools</li><li>Non-production environments</li></ul><hr/><h4 id="portal-security-requirements">Portal Security Requirements</h4><p>Client portal must enforce:</p><p>MFA (policy-defined, recommended mandatory)</p><ul><li>Session timeout</li><li>Download restrictions</li><li>Access expiration controls</li><li>Consent capture before uploads</li><li>Upload virus/malware scanning</li></ul><p>Client portal must not:</p><p>Allow raw DB queries</p><ul><li>Expose mapping layers directly</li><li>Expose legal research credentials</li></ul><hr/><h4 id="agent-security-constraints">Agent Security Constraints</h4><p>All agents must:</p><p>Operate under service account identity</p><ul><li>Have least privilege DB access</li><li>Be case-scoped</li><li>Log all artifact modifications</li><li>Use mediated tool access only</li></ul><p>Agents must not:</p><p>Store secrets locally</p><ul><li>Bypass orchestration</li><li>Call external services directly</li></ul><hr/><h4 id="legal-research-external-tool-gating">Legal Research &amp; External Tool Gating</h4><p>Access to:</p><p>Legal research libraries</p><ul><li>AI/LLM providers</li><li>Transcription engines</li><li>OCR engines</li></ul><p>Must be:</p><p>Mediated by Integration Layer</p><ul><li>Gated by Directive (attorney authorization)</li><li>Logged with correlation_id</li><li>Cost-attributed</li><li>Rate-limited</li></ul><p>Legal research results must:</p><p>Be stored as versioned artifacts</p><ul><li>Never be treated as evidence</li></ul><hr/><h4 id="override-governance-3">Override Governance</h4><p>Override actions must:</p><p>Be role-restricted</p><ul><li>Require justification text</li><li>Be audit logged</li><li>Capture timestamp</li><li>Capture prior state</li></ul><p>Override types may include:</p><p>Readiness gate bypass</p><ul><li>Evidence audit bypass</li><li>Thread authoritative override</li><li>Publish/export override</li></ul><p>Overrides must not:</p><p>Modify raw evidence</p><ul><li>Delete artifacts</li><li>Remove audit logs</li></ul><hr/><h4 id="audit-logging-security">Audit Logging Security</h4><p>Audit logs must:</p><p>Be append-only</p><ul><li>Be tamper-evident</li><li>Include correlation_id</li><li>Include actor identity</li><li>Include case_id</li><li>Include action_type</li><li>Include target_id</li></ul><p>Audit logs must not be:</p><p>Editable</p><ul><li>Soft-deletable</li><li>Truncated without retention policy</li></ul><hr/><h4 id="intrusion-anomaly-monitoring">Intrusion &amp; Anomaly Monitoring</h4><p>System must detect:</p><p>Excessive failed login attempts</p><ul><li>Cross-case access attempts</li><li>Unusual export patterns</li><li>Large data exfiltration attempts</li><li>Privilege escalation attempts</li></ul><p>Alerts must:</p><p>Be logged</p><ul><li>Notify administrators</li><li>Preserve forensic trail</li></ul><hr/><h4 id="data-retention-legal-hold-security">Data Retention &amp; Legal Hold Security</h4><p>When legal hold is active:</p><p>No deletion allowed</p><ul><li>No retention expiration allowed</li><li>All hold actions logged</li></ul><p>Retention must:</p><p>Be policy-controlled</p><ul><li>Be effective-dated</li><li>Be role-gated</li></ul><hr/><p>Backup Security</p><p>Backups must:</p><p>Be encrypted</p><ul><li>Be environment-isolated</li><li>Be access-restricted</li><li>Be integrity-verified</li></ul><p>Backup restore must:</p><p>Be logged</p><ul><li>Require elevated authorization</li></ul><hr/><h4 id="security-testing-requirements">Security Testing Requirements</h4><p>Before PROD deployment:</p><p>Penetration testing required</p><ul><li>Role access validation required</li><li>API access validation required</li><li>Cross-case isolation validation required</li><li>Injection attack testing required</li><li>File upload attack testing required</li></ul><hr/><p>Secrets &amp; Key Management</p><p>Secrets must:</p><p>Be stored in managed secret vault</p><ul><li>Be rotated per policy</li><li>Be environment-isolated</li><li>Never be committed to source control</li></ul><p>Access to secrets must be:</p><p>Logged</p><ul><li>Role-gated</li><li>Time-bound where possible</li></ul><hr/><h4 id="zero-hallucination-enforcement-security-context">Zero Hallucination Enforcement (Security Context)</h4><p>Agents must not:</p><p>Generate unsupported facts</p><ul><li>Fabricate legal content</li><li>Infer unstated evidence</li></ul><p>Security model must treat hallucinated data as:</p><p>Integrity violation</p><ul><li>Blocking condition</li><li>Issue-generating event</li></ul><hr/><h4 id="completion-criteria-7">Completion Criteria</h4><p>Security Architecture is complete when:</p><p>RBAC defined</p><ul><li>Case isolation enforced</li><li>Encryption model defined</li><li>Portal security defined</li><li>Agent security constraints defined</li><li>Legal research gating defined</li><li>Override governance defined</li><li>Audit immutability defined</li><li>PII protections defined</li></ul><h3 id="logical-schema-contracts-authoritative-build-level-minimum">LOGICAL SCHEMA CONTRACTS (AUTHORITATIVE; BUILD-LEVEL MINIMUM)</h3><hr/><h4 id="purpose-13">Purpose</h4><p>This section defines the minimum required logical schema contracts necessary for Antigravity to implement the platform without interpretation drift.</p><p>These schemas:</p><p>Enforce case isolation</p><ul><li>Enforce immutability</li><li>Enforce versioning</li><li>Enforce deterministic replay</li><li>Enforce evidence traceability</li><li>Enforce workflow governance</li></ul><p>All tables below are mandatory unless explicitly marked optional.</p><p>All tables must include:</p><p>created_at (timestamp)</p><ul><li>created_by (actor_id or agent_type)</li><li>correlation_id (required)</li></ul><p>No silent writes permitted.</p><hr/><h4 id="core-case-tables">Core Case Tables</h4><hr/><h4 id="case">CASE</h4><p>CASE (</p><p>case_id UUID PRIMARY KEY,</p><p>status ENUM('INTAKE','ACTIVE','CLOSED','ARCHIVED'),</p><p>stage VARCHAR,</p><p>jurisdiction VARCHAR,</p><p>matter_type VARCHAR,</p><p>policy_profile_id UUID,</p><p>created_at TIMESTAMP,</p><p>closed_at TIMESTAMP NULL</p><p>)</p><p>Constraints:</p><p>case_id immutable</p><p>• stage must align with WORKFLOW_STATE</p><p>• Cannot transition to ACTIVE without approved CASE_PERSPECTIVE</p><hr/><h4 id="workflow_state">WORKFLOW_STATE</h4><p>WORKFLOW_STATE (</p><p>case_id UUID PRIMARY KEY,</p><p>stage VARCHAR,</p><p>step_state VARCHAR,</p><p>readiness_status ENUM('READY','BLOCKED','REVIEW_REQUIRED'),</p><p>last_transition_timestamp TIMESTAMP</p><p>)</p><p>Only updated via Workflow State Machine.</p><hr/><h4 id="upload-file-tables">Upload &amp; File Tables</h4><hr/><h4 id="upload_session">UPLOAD_SESSION</h4><p>UPLOAD_SESSION (</p><p>upload_session_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>status ENUM('INITIALIZED','ACTIVE','PENDING_REVIEW','CLOSED','REOPENED','ABORTED'),</p><p>session_context VARCHAR,</p><p>file_count INT,</p><p>duplicate_count INT,</p><p>thread_detected_count INT,</p><p>authoritative_flags_count INT,</p><p>created_timestamp TIMESTAMP,</p><p>closed_timestamp TIMESTAMP NULL</p><p>)</p><p>Constraints:</p><p>Cannot trigger ProcessingJob unless status = CLOSED</p><p>• Status transitions must be audited</p><hr/><h4 id="file">FILE</h4><p>FILE (</p><p>file_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>upload_session_id UUID,</p><p>original_filename VARCHAR,</p><p>mime_type VARCHAR,</p><p>file_size BIGINT,</p><p>content_hash VARCHAR,</p><p>authoritative_flag BOOLEAN DEFAULT FALSE,</p><p>version_index INT,</p><p>uploader_identity UUID,</p><p>upload_timestamp TIMESTAMP</p><p>)</p><p>Constraints:</p><p>content_hash immutable</p><p>• No overwrite; new upload = new file_id</p><p>• Duplicate detection via content_hash</p><hr/><h4 id="thread_group">THREAD_GROUP</h4><p>THREAD_GROUP (</p><p>thread_group_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>authoritative_file_id UUID,</p><p>attorney_override_flag BOOLEAN DEFAULT FALSE,</p><p>detection_basis VARCHAR,</p><p>created_timestamp TIMESTAMP</p><p>)</p><p>Supporting table:</p><p>THREAD_GROUP_MEMBER (</p><p>thread_group_id UUID,</p><p>file_id UUID</p><p>)</p><p>Constraint:</p><p>All member files retained</p><p>• authoritative_file_id default = latest cumulative file</p><hr/><h4 id="text-extraction-tables">Text Extraction Tables</h4><hr/><h4 id="text_vault">TEXT_VAULT</h4><p>TEXT_VAULT (</p><p>text_vault_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>file_id UUID,</p><p>extraction_method ENUM('OCR','STT','NATIVE'),</p><p>source_file_hash VARCHAR,</p><p>deterministic_run_metadata JSONB,</p><p>created_timestamp TIMESTAMP</p><p>)</p><p>Constraint:</p><p>Immutable</p><p>• Reprocessing creates new text_vault_id</p><hr/><h4 id="text_chunk">TEXT_CHUNK</h4><p>TEXT_CHUNK (</p><p>chunk_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>text_vault_id UUID,</p><p>chunk_index INT,</p><p>char_start INT,</p><p>char_end INT,</p><p>page_start INT NULL,</p><p>page_end INT NULL,</p><p>timestamp_start FLOAT NULL,</p><p>timestamp_end FLOAT NULL,</p><p>chunk_text TEXT,</p><p>deterministic_run_metadata JSONB,</p><p>created_timestamp TIMESTAMP</p><p>)</p><p>Constraints:</p><p>Ordered by chunk_index</p><ul><li>Must reconstruct full vault text</li><li>Never modified</li></ul><hr/><h4 id="artifact-versioning-tables">Artifact &amp; Versioning Tables</h4><hr/><h4 id="artifact">ARTIFACT</h4><p>ARTIFACT (</p><p>artifact_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>artifact_type VARCHAR,</p><p>current_version_id UUID,</p><p>status ENUM('DRAFT','FINAL','SUPERSEDED')</p><p>)</p><hr/><h4 id="artifact_version">ARTIFACT_VERSION</h4><p>ARTIFACT_VERSION (</p><p>version_id UUID PRIMARY KEY,</p><p>artifact_id UUID,</p><p>case_id UUID,</p><p>version_number INT,</p><p>deterministic_run_metadata JSONB,</p><p>payload_ref VARCHAR,</p><p>created_timestamp TIMESTAMP</p><p>)</p><p>Constraints:</p><p>Append-only</p><p>• current_version_id updated atomically</p><p>• No version overwrite</p><hr/><h4 id="fact-evidence-tables">Fact &amp; Evidence Tables</h4><hr/><h4 id="fact">FACT</h4><p>FACT (</p><p>fact_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>fact_statement TEXT,</p><p>created_by_run_id UUID,</p><p>confidence_metadata JSONB</p><p>)</p><p>Constraint:</p><p>Must have at least one EVIDENCE_REF</p><hr/><h4 id="evidence_ref">EVIDENCE_REF</h4><p>EVIDENCE_REF (</p><p>evidence_ref_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>source_type ENUM('FILE','ARTIFACT','TEXT_CHUNK'),</p><p>artifact_id UUID NULL,</p><p>artifact_version_id UUID NULL,</p><p>text_chunk_id UUID NULL,</p><p>char_start INT NULL,</p><p>char_end INT NULL,</p><p>source_file_id UUID NULL</p><p>)</p><p>Constraint:</p><p>Must reference exactly one source type</p><ul><li>No FACT may exist without EVIDENCE_REF</li></ul><hr/><h4 id="mapping-tables">Mapping Tables</h4><hr/><h4 id="mapping_link">MAPPING_LINK</h4><p>MAPPING_LINK (</p><p>mapping_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>fact_id UUID,</p><p>allegation_id UUID NULL,</p><p>element_id UUID NULL,</p><p>support_status ENUM('SUPPORTED','PARTIAL','UNSUPPORTED'),</p><p>contradiction_flag BOOLEAN DEFAULT FALSE</p><p>)</p><p>Constraint:</p><p>Must reference valid FACT</p><p>• Must not exist without traceable evidence</p><hr/><h4 id="governance-tables">Governance Tables</h4><hr/><h4 id="issue">ISSUE</h4><p>ISSUE (</p><p>issue_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>severity ENUM('LOW','MEDIUM','HIGH','BLOCKING'),</p><p>blocking_flag BOOLEAN,</p><p>status ENUM('OPEN','RESOLVED','DISMISSED'),</p><p>related_artifact_id UUID NULL</p><p>)</p><hr/><h4 id="task">TASK</h4><p>TASK (</p><p>task_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>assignee UUID,</p><p>due_date TIMESTAMP,</p><p>status ENUM('OPEN','IN_PROGRESS','COMPLETED')</p><p>)</p><hr/><h4 id="execution-audit-tables">Execution &amp; Audit Tables</h4><hr/><h4 id="job">JOB</h4><p>JOB (</p><p>job_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>agent_type VARCHAR,</p><p>status ENUM('QUEUED','RUNNING','COMPLETED','FAILED'),</p><p>idempotency_key VARCHAR,</p><p>correlation_id VARCHAR,</p><p>started_at TIMESTAMP,</p><p>completed_at TIMESTAMP</p><p>)</p><hr/><h4 id="audit_event">AUDIT_EVENT</h4><p>AUDIT_EVENT (</p><p>event_id UUID PRIMARY KEY,</p><p>case_id UUID,</p><p>actor_id UUID,</p><p>role VARCHAR,</p><p>action_type VARCHAR,</p><p>target_ref VARCHAR,</p><p>correlation_id VARCHAR,</p><p>timestamp TIMESTAMP,</p><p>result VARCHAR</p><p>)</p><p>Append-only.</p><hr/><h4 id="referential-integrity-hard-constraints">Referential Integrity &amp; Hard Constraints</h4><p>The system must enforce:</p><p>No ARTIFACT_VERSION without ARTIFACT</p><p>• No FACT without EVIDENCE_REF</p><p>• No MAPPING_LINK without FACT</p><p>• No ProcessingJob without CLOSED UPLOAD_SESSION</p><p>• No CaseActivated without approved CASE_PERSPECTIVE</p><p>• No Publish/Export without successful EVIDENCE_AUDIT</p><h3 id="event-model-workflow-state-machine-authoritative">EVENT MODEL &amp; WORKFLOW STATE MACHINE (AUTHORITATIVE)</h3><hr/><h4 id="purpose-14">Purpose</h4><p>This section defines:</p><p>The authoritative event model</p><ul><li>The case-scoped workflow state machine</li><li>Hard transition rules</li><li>Readiness gating enforcement</li><li>Deterministic workflow execution requirements</li></ul><p>No workflow transitions may occur outside this model.</p><p>Agents do not directly change workflow state.</p><p>Workflow transitions occur only via the Workflow State Machine reacting to events.</p><hr/><h4 id="architectural-principle">Architectural Principle</h4><p>The system operates as:</p><p>Event → Validation → State Machine Decision → Transition → Orchestrated Job Enqueue → Audit</p><p>No direct state mutation is allowed.</p><p>All transitions must:</p><p>Be deterministic</p><ul><li>Be auditable</li><li>Be replayable</li><li>Enforce policy constraints</li></ul><hr/><h4 id="event-model-authoritative">Event Model (Authoritative)</h4><p>All case-impacting actions must emit an event.</p><p>Events are append-only and immutable.</p><p>Each event must include:</p><p>EVENT (</p><p>event_id UUID,</p><p>case_id UUID,</p><p>event_type VARCHAR,</p><p>source_agent VARCHAR NULL,</p><p>source_user UUID NULL,</p><p>correlation_id VARCHAR,</p><p>timestamp TIMESTAMP,</p><p>payload JSONB</p><p>)</p><hr/><h4 id="event-categories">Event Categories</h4><p>A) Intake Events</p><p>InterviewStarted</p><p>• InterviewPaused</p><p>• CasePerspectiveProposed</p><p>• CasePerspectiveAmended</p><p>• CasePerspectiveApproved</p><hr/><h4 id="onboarding-events">Onboarding Events</h4><p>AttorneyAcceptedCase</p><p>• CaseActivated</p><p>• EngagementArtifactCreated</p><hr/><h4 id="upload-file-events">Upload &amp; File Events</h4><p>UploadSessionStarted</p><p>• FileUploaded</p><p>• DuplicateDetected</p><p>• ThreadGroupCreated</p><p>• UploadSessionClosed</p><p>• UploadImpactReportCreated</p><hr/><h4 id="processing-events">Processing Events</h4><p>ProcessingStarted</p><p>• TextVaultCreated</p><p>• TextChunksCreated</p><p>• ProcessingCompleted</p><p>• ContradictionFlagged</p><hr/><h4 id="mapping-events">Mapping Events</h4><p>MappingStarted</p><p>• AllegationMappingCreated</p><p>• COAElementMappingCreated</p><p>• MappingCompleted</p><hr/><h4 id="evidence-governance-events">Evidence Governance Events</h4><p>EvidenceAuditStarted</p><p>• EvidenceAuditCompleted</p><p>• ReadinessGateBlocked</p><p>• AttorneyOverrideRecorded</p><hr/><h4 id="publishexport-events">Publish/Export Events</h4><p>PublishRequested</p><p>• PublishApproved</p><p>• PublishBlocked</p><hr/><h4 id="error-integrity-events">Error &amp; Integrity Events</h4><p>IntegrityFailure</p><p>• PolicyViolation</p><p>• BlockingIssueCreated</p><hr/><h4 id="workflow-state-machine-authoritative">Workflow State Machine (Authoritative)</h4><p>Each case has exactly one active WORKFLOW_STATE.</p><p>States must align with:</p><p>INTAKE</p><p>ONBOARDING</p><p>ACTIVE</p><p>DISCOVERY</p><p>DEPOSITION</p><p>PRE_TRIAL</p><p>TRIAL_READY</p><p>CLOSED</p><p>ARCHIVED</p><p>Transitions must be event-driven.</p><hr/><p>Authoritative Transition Rules</p><hr/><h4 id="intake-onboarding">INTAKE → ONBOARDING</h4><p>Trigger:</p><p>CasePerspectiveApproved</p><p>AND</p><ul><li>AttorneyAcceptedCase</li></ul><p>Validation:</p><p>No blocking intake issues</p><ul><li>Required consents present</li></ul><p>Transition:</p><p>Create CaseActivated event</p><ul><li>Initialize WORKFLOW_STATE</li><li>Enqueue OnboardJob</li></ul><hr/><h4 id="onboarding-active">ONBOARDING → ACTIVE</h4><p>Trigger:</p><p>CaseActivated</p><p>AND</p><p>• EngagementArtifactCreated</p><p>Validation:</p><p>Encryption scope established</p><p>• Policy profile assigned</p><hr/><h4 id="active-discovery">ACTIVE → DISCOVERY</h4><p>Trigger:</p><p>ComplaintFiledArtifactCreated</p><p>OR</p><p>• DiscoveryInitiatedDirective</p><p>Validation:</p><p>EvidenceAuditCompleted (fresh)</p><p>• No blocking issues</p><hr/><h4 id="discovery-deposition">DISCOVERY → DEPOSITION</h4><p>Trigger:</p><p>DepositionScheduledDirective</p><p>Validation:</p><p>Mapping coverage current</p><p>• EvidenceAudit fresh</p><hr/><h4 id="any-stage-blocked">Any Stage → BLOCKED</h4><p>Trigger:</p><p>BlockingIssueCreated</p><p>OR</p><p>• ReadinessGateBlocked</p><p>Transition:</p><p>readiness_status = BLOCKED</p><p>Resolution:</p><p>IssueResolved → re-evaluate stage</p><hr/><h4 id="any-stage-publishexport">Any Stage → PUBLISH/EXPORT</h4><p>Trigger:</p><p>PublishRequested</p><p>Validation (Mandatory):</p><p>EvidenceAuditCompleted within freshness window</p><p>• No BLOCKING issues</p><p>• Required artifact checklist satisfied</p><p>If validation fails:</p><p>Emit PublishBlocked</p><p>• Create Issue</p><p>No agent may bypass this automatically.</p><hr/><h4 id="readiness-gate-framework-authoritative">Readiness Gate Framework (Authoritative)</h4><p>Every stage may define readiness gates.</p><p>Example:</p><p>DISCOVERY readiness requires:</p><p>MappingPackage exists</p><ul><li>EvidenceAudit current</li><li>No unsupported elements flagged as blocking</li></ul><p>DEPOSITION readiness requires:</p><p>DepositionPrepArtifact exists</p><ul><li>WitnessTracking current</li><li>EvidenceAudit current</li></ul><p>The readiness gate engine must:</p><p>Evaluate stage-specific checklist</p><ul><li>Emit readiness_status</li><li>Prevent downstream job enqueue if blocked</li></ul><hr/><h4 id="deterministic-replay-requirement-2">Deterministic Replay Requirement</h4><p>The system must support:</p><p>Replaying event log → reconstructing WORKFLOW_STATE</p><p>Requirements:</p><p>All transitions event-derived</p><ul><li>No direct state mutation</li><li>State = pure function of ordered event stream</li></ul><p>This ensures:</p><p>Audit defensibility</p><ul><li>Forensic reconstruction</li><li>Disaster recovery replay</li></ul><hr/><h4 id="orchestration-contract">Orchestration Contract</h4><p>Workflow State Machine may enqueue jobs via:</p><p>ENQUEUE_JOB(</p><p>agent_type,</p><p>case_id,</p><p>triggering_event_id,</p><p>idempotency_key</p><p>)</p><p>Agents do not directly trigger other agents.</p><p>Example:</p><p>UploadSessionClosed → Workflow State Machine → Enqueue ProcessingJob</p><p>ProcessingCompleted → Enqueue MappingJob</p><p>MappingCompleted → Enqueue EvidenceAuditJob</p><hr/><h4 id="hard-enforcement-rules">Hard Enforcement Rules</h4><p>The system must enforce:</p><p>No ProcessingJob unless UploadSessionClosed</p><ul><li>No MappingJob unless ProcessingCompleted</li><li>No Publish unless EvidenceAuditCompleted</li><li>No Stage Transition without event trigger</li><li>No Agent may mutate WORKFLOW_STATE directly</li></ul><p>Violations must emit:</p><p>PolicyViolation event</p><ul><li>BlockingIssueCreated</li></ul><hr/><h4 id="attorney-override-governance">Attorney Override Governance</h4><p>Override is allowed only when:</p><p>Role = Attorney or Partner</p><ul><li>Explicit justification entered</li><li>OverrideRecorded event emitted</li><li>Correlation_id stored</li></ul><p>Override must:</p><p>Not delete prior state</p><ul><li>Not modify artifacts</li><li>Only allow transition despite blocking issue</li></ul><p>Override must never:</p><p>Suppress audit</p><ul><li>Delete contradiction flags</li><li>Remove evidence trace</li></ul><hr/><h4 id="build-checklist-antigravity">Build Checklist (Antigravity)</h4><p>Antigravity must implement:</p><p>Event store (append-only)</p><ul><li>Workflow State Machine engine</li><li>Stage validation rule registry</li><li>Readiness gate evaluation engine</li><li>Deterministic event replay capability</li><li>Policy violation detection</li></ul><h3 id="agent-execution-contract-authoritative">AGENT EXECUTION CONTRACT (AUTHORITATIVE)</h3><hr/><h4 id="purpose-15">Purpose</h4><p>This section defines the mandatory execution contract governing:</p><p>All AI agents</p><ul><li>All deterministic job executions</li><li>All artifact-producing workflows</li><li>All state-modifying operations</li></ul><p>This contract ensures:</p><p>Deterministic reproducibility</p><ul><li>Zero hallucination enforcement</li><li>Idempotent execution</li><li>Policy enforcement</li><li>Full audit traceability</li></ul><p>No agent may execute outside this contract.</p><hr/><h4 id="agent-execution-envelope-mandatory">Agent Execution Envelope (Mandatory)</h4><p>Every agent execution must run inside a structured envelope.</p><p>Minimum structure:</p><p>AGENT_EXECUTION (</p><p>execution_id UUID,</p><p>agent_type VARCHAR,</p><p>case_id UUID,</p><p>triggering_event_id UUID,</p><p>idempotency_key VARCHAR,</p><p>correlation_id VARCHAR,</p><p>execution_mode ENUM (DETERMINISTIC, NON_DETERMINISTIC),</p><p>policy_snapshot_id UUID,</p><p>context_snapshot_id UUID NULL,</p><p>started_at TIMESTAMP,</p><p>completed_at TIMESTAMP,</p><p>status ENUM (STARTED, COMPLETED, FAILED, BLOCKED),</p><p>deterministic_run_metadata JSONB</p><p>)</p><hr/><h4 id="hard-requirements">Hard Requirements</h4><p>Every execution must have idempotency_key</p><ul><li>Every execution must have correlation_id</li><li>Every execution must reference triggering_event_id</li><li>Deterministic executions must store all reproducibility metadata</li><li>No execution may directly mutate workflow state</li></ul><hr/><h4 id="deterministic-execution-requirements">Deterministic Execution Requirements</h4><p>For all deterministic executions:</p><p>The system must capture:</p><p>Input artifact version IDs</p><ul><li>Input CASE_CONTEXT_PLAYBOOK version</li><li>Prompt template version (if applicable)</li><li>Model/provider version (if used)</li><li>Tool configuration snapshot</li><li>Policy snapshot</li><li>Hash of structured inputs</li><li>Output artifact hash</li></ul><p>The execution must be reproducible from:</p><p>Inputs + Template + Tool Metadata + Context Snapshot</p><hr/><h4 id="non-deterministic-execution-constraints">Non-Deterministic Execution Constraints</h4><p>Non-deterministic mode is allowed only for:</p><p>Question generation</p><ul><li>Advisory simulations</li><li>Candidate ranking</li><li>Strategic scenario modeling</li></ul><p>Non-deterministic execution:</p><p>May not write authoritative artifacts</p><ul><li>May not modify case record</li><li>May not advance workflow state</li><li>Must be labeled “advisory”</li></ul><p>If advisory output becomes authoritative, a deterministic run must follow.</p><hr/><h4 id="context-snapshot-contract">Context Snapshot Contract</h4><p>For any agent using CASE_CONTEXT_PLAYBOOK:</p><p>The execution must record:</p><p>context_snapshot_id</p><ul><li>rules_applied[]</li><li>unresolved_disambiguations[]</li><li>coherence_checks_reference</li><li>blocking_gaps_reference</li></ul><p>No downstream artifact may be created without recording the context snapshot used.</p><hr/><h4 id="input-validation-contract">Input Validation Contract</h4><p>Before execution begins:</p><p>The agent must validate:</p><p>Required artifact versions exist</p><ul><li>Required workflow stage permits execution</li><li>Required approvals exist</li><li>No blocking issues prevent execution</li></ul><p>If validation fails:</p><p>Emit PolicyViolation event</p><ul><li>Create BlockingIssue</li><li>Do not execute</li></ul><hr/><h4 id="output-contract">Output Contract</h4><p>For deterministic executions:</p><p>The output must:</p><p>Be stored as versioned ARTIFACT</p><ul><li>Include deterministic_run_metadata</li><li>Include evidence trace references (if applicable)</li><li>Include input artifact version references</li><li>Include context_snapshot_id (if applicable)</li><li>Include correlation_id</li></ul><p>No artifact may exist without lineage.</p><hr/><h4 id="idempotency-rules-authoritative">Idempotency Rules (Authoritative)</h4><p>Every agent job must:</p><p>Accept idempotency_key</p><ul><li>Check for prior identical execution</li><li>Return existing artifact if identical scope detected</li><li>Prevent duplicate artifact creation</li></ul><p>Idempotency key must be:</p><p>Derived from case_id + triggering_event_id + artifact_scope + policy_snapshot_id</p><hr/><h4 id="error-classification-framework">Error Classification Framework</h4><p>Each execution must classify failure as:</p><p>Retryable</p><p>Provider timeout</p><ul><li>Transient network failure</li><li>Temporary DB lock</li></ul><p>Blocking</p><p>Missing required artifact</p><ul><li>Missing required approval</li><li>Policy violation</li></ul><p>Integrity</p><p>Hash mismatch</p><ul><li>Broken artifact lineage</li><li>Context snapshot missing</li></ul><p>All blocking and integrity failures must:</p><p>Create ISSUE</p><ul><li>Emit audit event</li><li>Prevent downstream transitions</li></ul><hr/><h4 id="orchestration-interaction-rules">Orchestration Interaction Rules</h4><p>Agents:</p><p>May not directly invoke other agents</p><ul><li>May not directly update WORKFLOW_STATE</li><li>May not bypass readiness gates</li></ul><p>Agents communicate only through:</p><p>Event emission → Workflow State Machine → Job enqueue</p><hr/><p>Security Enforcement Within Execution</p><p>During execution:</p><p>Case isolation must be enforced</p><ul><li>Cross-case reads prohibited</li><li>External tools accessed only via Integration Layer</li><li>Tool calls must include correlation_id</li><li>Tool usage logged in USAGE_LEDGER</li></ul><p>No direct UI-to-tool or agent-to-tool connection allowed.</p><hr/><h4 id="zero-hallucination-enforcement-execution-level">Zero Hallucination Enforcement (Execution-Level)</h4><p>During deterministic execution:</p><p>Agent must not invent facts</p><ul><li>Agent must not fill gaps probabilistically</li><li>Agent must not fabricate relationships</li><li>Agent must not infer unsupported legal conclusions</li></ul><p>If insufficient evidence:</p><p>Create Issue</p><ul><li>Mark element unsupported</li><li>Flag ambiguity</li></ul><p>No silent inference allowed.</p><hr/><h4 id="execution-audit-requirements">Execution Audit Requirements</h4><p>Each execution must emit:</p><p>AgentExecutionStarted</p><ul><li>AgentExecutionCompleted</li><li>AgentExecutionFailed (if applicable)</li><li>ArtifactVersionCreated (if applicable)</li><li>IssueCreated (if applicable)</li><li>CaseStateUpdated (if applicable)</li></ul><p>Audit record must include:</p><p>execution_id</p><ul><li>agent_type</li><li>correlation_id</li><li>duration_ms</li><li>result</li></ul><hr/><h4 id="resource-and-cost-controls">Resource and Cost Controls</h4><p>Each execution must:</p><p>Respect cost caps (case-level or global)</p><ul><li>Respect token limits</li><li>Respect external tool rate limits</li><li>Emit USAGE_LEDGER entry</li></ul><p>Execution must halt if cost cap exceeded (policy-defined behavior).</p><hr/><h4 id="concurrency-controls-2">Concurrency Controls</h4><p>The system must prevent:</p><p>Two deterministic executions writing same artifact scope simultaneously</p><ul><li>Parallel state transitions</li></ul><p>Required:</p><p>Optimistic locking or version preconditions</p><ul><li>Execution scope locking</li><li>Conflict detection</li></ul><p>Conflict must:</p><p>Abort later execution</p><ul><li>Emit integrity event</li></ul><hr/><h4 id="execution-reproducibility-guarantee">Execution Reproducibility Guarantee</h4><p>The system must guarantee:</p><p>Given identical:</p><p>Inputs</p><ul><li>Context snapshot</li><li>Tool versions</li><li>Template versions</li></ul><p>The same deterministic execution produces identical artifact output hash.</p><p>If model/tool change occurs:</p><p>Must create new policy_snapshot_id</p><ul><li>Must not silently alter reproducibility</li></ul><hr/><h4 id="build-checklist-antigravity-2">Build Checklist (Antigravity)</h4><p>Antigravity must implement:</p><p>Agent execution envelope</p><ul><li>Deterministic metadata capture</li><li>Idempotency enforcement</li><li>Policy validation layer</li><li>Context snapshot recording</li><li>Execution audit logging</li><li>Concurrency controls</li><li>Cost governance enforcement</li></ul><h3 id="deterministic-reproducibility-model-governance-authoritative">DETERMINISTIC REPRODUCIBILITY &amp; MODEL GOVERNANCE (AUTHORITATIVE)</h3><hr/><h4 id="purpose-16">Purpose</h4><p>This section defines mandatory controls ensuring:</p><p>Deterministic reproducibility</p><p>• Model behavior stability</p><p>• Prompt and template governance</p><p>• Tool version control</p><p>• Drift detection</p><p>• Controlled model upgrades</p><p>No model, prompt, or tool change may silently alter case artifacts.</p><hr/><h4 id="deterministic-reproducibility-framework">Deterministic Reproducibility Framework</h4><p>For any execution classified as Deterministic, the system must guarantee:</p><p>Given identical:</p><p>Input artifacts</p><ul><li>Context snapshot</li><li>Policy snapshot</li><li>Prompt/template version</li><li>Model version</li><li>Tool configuration</li><li>Feature flags</li></ul><p>The execution must produce identical artifact output hash.</p><p>If this guarantee cannot be met, execution must be blocked.</p><hr/><h4 id="deterministic-run-metadata-mandatory-capture">Deterministic Run Metadata (Mandatory Capture)</h4><p>Every deterministic execution must persist:</p><p>deterministic_run_metadata = {</p><p>model_provider,</p><p>model_name,</p><p>model_version,</p><p>temperature,</p><p>top_p,</p><p>prompt_template_id,</p><p>prompt_template_version,</p><p>tool_versions[],</p><p>policy_snapshot_id,</p><p>context_snapshot_id,</p><p>input_artifact_version_ids[],</p><p>input_hash,</p><p>output_hash,</p><p>execution_timestamp</p><p>}</p><p>Temperature for deterministic mode must be:</p><p>temperature = 0.0</p><p>No probabilistic sampling permitted in deterministic mode.</p><hr/><h4 id="model-governance-rules">Model Governance Rules</h4><p>Model Version Locking</p><p>For deterministic agents:</p><p>Model version must be explicitly declared.</p><p>• “Latest” model references are prohibited.</p><p>• Silent provider upgrades must not alter execution without version update.</p><hr/><h4 id="approved-model-registry">Approved Model Registry</h4><p>System must maintain:</p><p>MODEL_REGISTRY (</p><p>model_id,</p><p>provider,</p><p>version,</p><p>approved_for_deterministic BOOLEAN,</p><p>approved_for_advisory BOOLEAN,</p><p>approval_date,</p><p>approved_by,</p><p>deprecation_date NULL</p><p>)</p><p>Agents may only use models present in MODEL_REGISTRY.</p><hr/><h4 id="model-upgrade-process">Model Upgrade Process</h4><p>When upgrading a model:</p><p>1. Create new model entry in MODEL_REGISTRY.</p><p>2. Run regression test suite against representative cases.</p><p>3. Compare artifact hashes.</p><p>4. Record drift analysis report.</p><p>5. Require approval record.</p><p>6. Update policy snapshot.</p><p>No automatic model substitution allowed.</p><hr/><h4 id="prompt-and-template-governance">Prompt and Template Governance</h4><p>All prompts used by deterministic agents must:</p><p>Be stored as versioned templates.</p><p>• Have stable template_id.</p><p>• Include template_version.</p><p>• Be immutable once published.</p><p>• Generate new version when modified.</p><p>Prompt templates must be stored in:</p><p>PROMPT_TEMPLATE (</p><p>template_id,</p><p>version,</p><p>agent_type,</p><p>purpose,</p><p>content_hash,</p><p>created_at,</p><p>approved_by,</p><p>status (Draft / Approved / Deprecated)</p><p>)</p><p>Deterministic executions must reference:</p><p>prompt_template_id + version</p><p>No inline prompt strings permitted in code.</p><hr/><h4 id="tool-version-governance">Tool Version Governance</h4><p>For OCR, STT, extraction engines, etc.:</p><p>Tool registry required:</p><p>TOOL_REGISTRY (</p><p>tool_id,</p><p>provider,</p><p>version,</p><p>approved_for_deterministic BOOLEAN,</p><p>approval_date,</p><p>deprecation_date NULL</p><p>)</p><p>Tool version must be recorded in deterministic_run_metadata.</p><p>Silent tool upgrades must trigger regression validation.</p><hr/><h4 id="drift-detection-framework">Drift Detection Framework</h4><p>The system must detect:</p><p>Model output drift</p><ul><li>Tool extraction drift</li><li>Template drift</li><li>Policy drift</li></ul><p>Drift detection required:</p><p>Hash comparison against baseline artifacts</p><ul><li>Threshold-based change alerts</li><li>Regression case set re-execution</li></ul><p>If drift detected:</p><p>Emit ModelDriftDetected event</p><ul><li>Block deployment if deterministic impact exists</li><li>Require governance review</li></ul><hr/><h4 id="advisory-vs-deterministic-separation-enforcement">Advisory vs Deterministic Separation Enforcement</h4><p>Model configurations:</p><p>Deterministic mode:</p><ul><li>temperature = 0.0</li><li>top_p = 1.0</li><li>no randomness</li><li>no sampling variability</li></ul><p>Advisory mode:</p><ul><li>temperature &gt; 0 allowed</li><li>non-binding outputs only</li><li>clearly labeled “Advisory”</li></ul><p>Advisory outputs may never directly modify case state.</p><hr/><h4 id="cross-case-knowledge-safeguard">Cross-Case Knowledge Safeguard</h4><p>Models must not:</p><p>Learn from active case data implicitly</p><ul><li>Update weights based on case data</li><li>Leak case content across cases</li></ul><p>Any DIKW knowledge promotion must:</p><p>Occur via sanitized Knowledge Store</p><ul><li>Be governance-approved</li><li>Be versioned</li><li>Be rebuildable</li></ul><p>Model training is out-of-scope unless explicitly governed.</p><hr/><h4 id="regression-testing-requirements">Regression Testing Requirements</h4><p>Before deploying:</p><p>Re-run deterministic regression suite</p><ul><li>Compare artifact hashes</li><li>Verify identical outputs</li><li>Verify identical mapping coverage</li><li>Verify identical issue counts</li></ul><p>If any artifact hash differs:</p><p>Flag as drift</p><ul><li>Require governance approval</li></ul><hr/><h4 id="artifact-hash-enforcement">Artifact Hash Enforcement</h4><p>Every deterministic artifact must include:</p><p>input_hash</p><ul><li>output_hash</li></ul><p>Artifact storage must enforce:</p><p>utput_hash immutability</p><ul><li>hash verification at retrieval</li></ul><p>Corrupt artifact detection must create IntegrityIssue.</p><hr/><h4 id="execution-replay-capability">Execution Replay Capability</h4><p>System must support:</p><p>ReplayExecution(execution_id)</p><p>Which must:</p><p>Load captured metadata</p><ul><li>Re-run execution</li><li>Compare output_hash</li><li>Emit ReplayVerified or ReplayMismatch</li></ul><p>ReplayMismatch must:</p><p>Create IntegrityIssue</p><ul><li>Prevent publish/export until resolved</li></ul><hr/><h4 id="zero-hallucination-reinforcement">Zero Hallucination Reinforcement</h4><p>In deterministic mode:</p><p>Model must operate only over structured inputs</p><ul><li>All outputs must cite source refs</li><li>No speculative completion allowed</li><li>No probability-based interpolation</li></ul><p>If evidence missing:</p><p>Output “Insufficient Evidence”</p><ul><li>Create Issue</li><li>Do not fill gap</li></ul><hr/><h4 id="build-checklist-antigravity-3">Build Checklist (Antigravity)</h4><p>Antigravity must implement:</p><p>Model registry</p><ul><li>Tool registry</li><li>Prompt template registry</li><li>Deterministic metadata capture</li><li>Artifact hashing</li><li>Drift detection</li><li>Regression execution framework</li><li>Execution replay mechanism</li><li>Advisory vs deterministic separation</li></ul><h3 id="external-integration-contract-authoritative">EXTERNAL INTEGRATION CONTRACT (AUTHORITATIVE)</h3><hr/><h4 id="purpose-17">Purpose</h4><p>This section defines the mandatory architectural, security, and governance controls governing all external system integrations.</p><p>No external system — including LLM providers, transcription services, OCR engines, legal research platforms, analytics engines, payment systems, or third-party APIs — may be accessed directly by:</p><p>Service Agents</p><ul><li>UI components</li><li>Background jobs</li><li>Database processes</li></ul><p>All integrations must pass through governed mediation layers.</p><hr/><h4 id="7integration-architecture-principle">7Integration Architecture Principle</h4><p>All external integrations must follow this enforced pattern:</p><p>Agent</p><p>↓</p><p>Orchestration Layer</p><p>↓</p><p>Tool Mediation Layer</p><p>↓</p><p>Integration Gateway</p><p>↓</p><p>External Provider</p><p>Hard Constraint:</p><p>No direct SDK calls from agents.</p><ul><li>No direct UI-to-provider API calls.</li><li>No embedded API keys in application logic.</li><li>No unmanaged outbound connections.</li></ul><hr/><h4 id="integration-gateway-requirements">Integration Gateway Requirements</h4><p>The Integration Gateway must:</p><p>Enforce authentication and authorization</p><ul><li>Enforce case isolation</li><li>Apply rate limiting</li><li>Apply cost controls</li><li>Capture full request/response metadata</li><li>Mask PII when required by policy</li><li>Record correlation_id</li><li>Store integration audit logs</li></ul><p>All calls must be traceable to:</p><p>case_id</p><ul><li>agent_id</li><li>execution_id</li><li>policy_snapshot_id</li></ul><hr/><h4 id="tool-mediation-layer-responsibilities">Tool Mediation Layer Responsibilities</h4><p>The Tool Mediation Layer must:</p><p>Validate request structure</p><ul><li>Enforce allowed tool list (from TOOL_REGISTRY)</li><li>Inject version locking</li><li>Apply temperature and deterministic flags</li><li>Capture full execution metadata</li><li>Prevent cross-case data contamination</li><li>Normalize provider-specific responses</li></ul><p>It must convert provider responses into:</p><p>Canonical internal format</p><ul><li>Schema-valid outputs</li><li>Structured error objects</li></ul><hr/><h4 id="supported-integration-categories">Supported Integration Categories</h4><p>The architecture must support, but not assume:</p><p>LLM Providers (e.g., Antigravity-managed models, Claude, others)</p><ul><li>Speech-to-Text (STT)</li><li>Optical Character Recognition (OCR)</li><li>Legal Research Libraries</li><li>Document Automation Engines</li><li>E-Discovery Systems</li><li>Calendar Systems</li><li>Payment/Billing Systems</li><li>Identity Providers (SSO, MFA)</li><li>Email Services</li><li>Secure File Storage Providers</li></ul><p>Each category must have:</p><p>A defined adapter</p><ul><li>Version control</li><li>Approved provider registry entry</li><li>Failure classification rules</li></ul><hr/><h4 id="llm-integration-contract">LLM Integration Contract</h4><p>LLM calls must:</p><p>Declare execution mode (Deterministic or Advisory)</p><ul><li>Declare model_id and version</li><li>Declare temperature explicitly</li><li>Reference prompt_template_id + version</li><li>Include case_id</li><li>Include context_snapshot_id</li></ul><p>LLM requests must never include:</p><p>Data from other cases</p><p>• System-level knowledge not approved for sharing</p><p>• Raw PII unless required and permitted</p><p>LLM responses must:</p><p>Be captured in full</p><p>• Be logged (secure store)</p><p>• Be validated against expected schema</p><p>• Be rejected if schema mismatch occurs</p><hr/><h4 id="external-data-storage-governance">External Data Storage Governance</h4><p>If the system retrieves external legal research or reference materials:</p><p>Must store normalized excerpts internally (if licensing permits)</p><ul><li>Must store citation metadata</li><li>Must track license constraints</li><li>Must not cache restricted content beyond allowed retention window</li></ul><p>Caching rules must:</p><p>Reduce repeated calls</p><ul><li>Respect provider licensing agreements</li><li>Be policy-controlled</li></ul><hr/><h4 id="api-contract-requirements-inbound-outbound">API Contract Requirements (Inbound &amp; Outbound)</h4><p>All APIs must:</p><p>Require authentication</p><ul><li>Require case-scoped authorization</li><li>Enforce role-based access control</li><li>Use HTTPS/TLS 1.2+ minimum</li><li>Support request validation</li><li>Support response schema validation</li><li>Include correlation_id in every response</li></ul><p>No anonymous endpoints permitted.</p><hr/><h4 id="integration-audit-logging-mandatory">Integration Audit Logging (Mandatory)</h4><p>Each integration call must log:</p><p>integration_call_id</p><ul><li>case_id</li><li>agent_id</li><li>provider</li><li>model/tool version</li><li>request_timestamp</li><li>response_timestamp</li><li>request_hash</li><li>response_hash</li><li>status_code</li><li>retry_count</li><li>cost_estimate (if applicable)</li></ul><p>Logs must be immutable.</p><hr/><h4 id="failure-classification-for-external-calls">Failure Classification for External Calls</h4><p>Retryable:</p><ul><li>Transient network failure</li><li>5xx provider error</li><li>Timeout within policy window</li></ul><p>Blocking:</p><ul><li>Authentication failure</li><li>Authorization violation</li><li>Provider version mismatch</li><li>Deterministic execution violation</li></ul><p>Integrity:</p><ul><li>Response schema mismatch</li><li>Hash mismatch</li><li>Cross-case contamination detection</li></ul><p>Blocking or integrity failures must:</p><p>Create Issue</p><ul><li>Emit IntegrationFailure event</li><li>Prevent downstream execution</li></ul><hr/><h4 id="cost-governance">Cost Governance</h4><p>All external integrations must support:</p><p>Cost per call tracking</p><ul><li>Cost per case tracking</li><li>Budget thresholds</li><li>Alert thresholds</li><li>Cost cap enforcement (optional per case)</li></ul><p>If budget exceeded:</p><p>Emit CostThresholdExceeded</p><ul><li>Block non-essential advisory calls</li><li>Require attorney override for continuation</li></ul><hr/><h4 id="data-privacy-controls">Data Privacy Controls</h4><p>For PII and PHI:</p><p>Apply encryption in transit</p><ul><li>Apply encryption at rest</li><li>Mask logs where required</li><li>Apply data minimization principles</li><li>Apply provider contractual privacy review</li></ul><p>Sensitive data must not be retained by providers beyond request lifecycle unless contractually governed.</p><hr/><h4 id="vendor-governance-requirements">Vendor Governance Requirements</h4><p>For each provider:</p><p>Maintain Provider Risk Profile</p><ul><li>Maintain Security Review documentation</li><li>Maintain Data Processing Agreement</li><li>Maintain SLA metrics</li><li>Maintain uptime history</li></ul><p>Vendor registry must include:</p><p>PROVIDER_REGISTRY (</p><p>provider_id,</p><p>category,</p><p>approved BOOLEAN,</p><p>security_review_date,</p><p>dpa_signed BOOLEAN,</p><p>sla_reference,</p><p>deprecation_date NULL</p><p>)</p><hr/><h4 id="cross-case-data-safeguard">Cross-Case Data Safeguard</h4><p>Integration layer must enforce:</p><p>Case-bound payload construction</p><ul><li>Automatic scrub of unrelated data</li><li>Cross-case contamination detection</li></ul><p>Violation must:</p><p>Block call</p><ul><li>Emit CrossCaseViolationDetected</li><li>Create IntegrityIssue</li></ul><hr/><h4 id="idempotency-and-replay-for-external-calls">Idempotency and Replay for External Calls</h4><p>Integration calls must support:</p><p>idempotency_key</p><ul><li>retry safe execution</li><li>duplicate detection</li></ul><p>ReplayExecution must:</p><p>Reconstruct request</p><ul><li>Re-submit under controlled environment (if allowed)</li><li>Compare response hash</li><li>Emit ReplayMismatch if deviation detected</li></ul><hr/><h4 id="build-checklist-antigravity-4">Build Checklist (Antigravity)</h4><p>Antigravity must implement:</p><p>Integration Gateway</p><ul><li>Tool Mediation Layer</li><li>Provider Registry</li><li>Model Registry enforcement</li><li>Tool Registry enforcement</li><li>Integration audit logging</li><li>Cost tracking engine</li><li>Failure classification enforcement</li><li>Cross-case data protection checks</li><li>Replay support (where feasible)</li></ul><h3 id="deployment-architecture-authoritative">DEPLOYMENT ARCHITECTURE (AUTHORITATIVE)</h3><hr/><h4 id="purpose-18">Purpose</h4><p>This section defines the required infrastructure topology, environment segmentation, isolation guarantees, and deployment standards for the AI Legal Service Web App.</p><p>This system must be deployable in:</p><p>Secure production environments</p><ul><li>Staging/pre-production environments</li><li>Development environments</li><li>Disaster recovery environments</li></ul><p>All environments must support deterministic, auditable, and reproducible execution.</p><hr/><h4 id="environment-segmentation-mandatory">Environment Segmentation (Mandatory)</h4><p>The system must support at minimum:</p><h4 id="development-dev">Development (DEV)</h4><p>Feature development</p><ul><li>Non-production data only</li><li>Synthetic or anonymized test cases</li><li>Debug logging enabled</li><li>No external provider production keys</li></ul><h4 id="staging-pre-production-stage">Staging / Pre-Production (STAGE)</h4><p>Mirrors production architecture</p><ul><li>Production-like configuration</li><li>Controlled test data</li></ul><p>Used for:</p><ul><li>Deterministic validation</li><li>Integration testing</li><li>Regression testing</li><li>Release verification</li></ul><h4 id="production-prod">Production (PROD)</h4><p>Real client data</p><ul><li>Strict access control</li><li>Production encryption keys</li><li>Readiness gating enforced</li><li>Immutable audit logging</li><li>No debug-only instrumentation exposed</li></ul><h4 id="disaster-recovery-dr">Disaster Recovery (DR)</h4><p>Real-time or near-real-time replication</p><ul><li>RPO and RTO defined</li><li>Periodic failover validation required</li></ul><hr/><h4 id="high-level-infrastructure-topology">High-Level Infrastructure Topology</h4><p>Minimum architecture must include:</p><p>Client Browser</p><p>↓</p><p>Web Application Layer</p><p>↓</p><p>API Layer</p><p>↓</p><p>Orchestration Layer</p><p>↓</p><p>Agent Execution Layer</p><p>↓</p><p>Data Layer</p><p>↓</p><p>External Integration Gateway</p><p>Components must be logically separated.</p><p>Hard Constraints:</p><p>UI and Agent execution must not share process space.</p><ul><li>Integration Gateway must be isolated from database.</li><li>No direct DB access from UI.</li></ul><hr/><h4 id="deployment-model-2">Deployment Model</h4><p>The system must be deployable using:</p><p>Containerized services (recommended)</p><ul><li>Kubernetes or equivalent orchestration</li><li>Infrastructure-as-Code (IaC) provisioning</li><li>Immutable build artifacts</li><li>Versioned deployment pipelines</li></ul><p>All builds must be:</p><p>Tagged</p><ul><li>Traceable</li><li>Rollback-capable</li></ul><hr/><h4 id="service-segmentation">Service Segmentation</h4><p>Minimum service separation required:</p><p>Web/UI Service</p><ul><li>API Service</li><li>Orchestration Service</li><li>Agent Worker Service</li><li>Integration Gateway Service</li><li>Database Service</li><li>Artifact Storage Service</li><li>Audit Log Store</li><li>Monitoring/Telemetry Service</li></ul><p>No monolithic deployment permitted.</p><hr/><h4 id="data-layer-requirements">Data Layer Requirements</h4><p>The data layer must include:</p><p>Relational database (authoritative case state)</p><ul><li>Artifact storage (immutable object store)</li><li>Log store (append-only)</li><li>Index/search layer (optional but recommended)</li><li>Queue/message broker</li></ul><p>Data separation must enforce:</p><p>Case isolation</p><ul><li>Tenant boundaries</li><li>Encryption scopes</li></ul><hr/><h4 id="encryption-requirements">Encryption Requirements</h4><p>Mandatory encryption standards:</p><p>In Transit</p><p>TLS 1.2 or higher</p><p>• HTTPS enforced</p><p>• HSTS enabled</p><p>7.27.7.2 At Rest</p><p>Database encryption</p><ul><li>Artifact store encryption</li><li>Log store encryption</li><li>Key management system (KMS)</li></ul><p>Keys must:</p><p>Be environment-specific</p><ul><li>Rotate per policy</li><li>Be centrally managed</li></ul><hr/><h4 id="secrets-management">Secrets Management</h4><p>Secrets must:</p><p>Never be stored in code</p><ul><li>Never be committed to source control</li><li>Be stored in secure secrets manager</li><li>Be environment-scoped</li><li>Be rotated regularly</li></ul><p>Includes:</p><p>API keys</p><ul><li>LLM credentials</li><li>Database credentials</li><li>Encryption keys</li><li>Integration tokens</li></ul><hr/><h4 id="network-isolation">Network Isolation</h4><p>Production must enforce:</p><p>Private subnet for database</p><ul><li>Private subnet for internal services</li><li>Public gateway only for UI/API</li><li>No inbound traffic to agent workers</li><li>Strict firewall rules</li><li>WAF protection</li></ul><p>Optional but recommended:</p><p>Zero-trust network architecture</p><hr/><h4 id="scaling-requirements">Scaling Requirements</h4><p>The system must support:</p><p>Horizontal scaling of:</p><ul><li>Agent workers</li><li>API layer</li><li>Orchestration layer</li></ul><p>Auto-scaling policies based on:</p><ul><li>CPU</li><li>Memory</li><li>Queue depth</li><li>Request volume</li></ul><p>Agent execution must:</p><p>Be stateless</p><ul><li>Pull jobs from queue</li><li>Support distributed processing</li></ul><hr/><h4 id="job-queue-asynchronous-execution">Job Queue &amp; Asynchronous Execution</h4><p>All agent jobs must execute asynchronously.</p><p>Required components:</p><p>Durable message queue</p><ul><li>Dead-letter queue</li><li>Retry policy engine</li><li>Idempotency enforcement</li><li>Correlation ID tracking</li></ul><p>Jobs must support:</p><p>Retry classification</p><ul><li>Failure escalation</li><li>Safe replay</li></ul><hr/><h4 id="logging-audit-isolation">Logging &amp; Audit Isolation</h4><p>Audit logs must:</p><p>Be append-only</p><ul><li>Be immutable</li><li>Be stored separately from operational DB</li><li>Support long-term retention</li></ul><p>Operational logs must:</p><p>Be segregated by service</p><ul><li>Support search</li><li>Be redactable for PII exposure</li></ul><p>Audit logs must not be editable.</p><hr/><h4 id="deployment-pipeline-requirements">Deployment Pipeline Requirements</h4><p>CI/CD must support:</p><p>Automated testing</p><ul><li>Static analysis</li><li>Security scanning</li><li>Deterministic regression validation</li><li>Migration validation</li><li>Artifact tagging</li></ul><p>Deployment must require:</p><p>Environment promotion controls</p><ul><li>Approval gates</li><li>Rollback capability</li></ul><p>No manual production edits permitted.</p><hr/><h4 id="backup-recovery">Backup &amp; Recovery</h4><p>Backup strategy must include:</p><p>Daily database snapshot</p><ul><li>Continuous replication</li><li>Artifact store replication</li><li>Audit log preservation</li><li>Point-in-time recovery support</li></ul><p>Recovery testing must occur:</p><p>At defined cadence</p><ul><li>With documented RTO/RPO validation</li></ul><hr/><h4 id="high-availability-requirements">High Availability Requirements</h4><p>Production must support:</p><p>Multi-AZ deployment (recommended)</p><ul><li>Automatic failover</li><li>Load balancing</li><li>Health checks</li><li>Self-healing pods/services</li></ul><p>System must not have:</p><p>Single point of failure at application tier</p><hr/><h4 id="performance-baseline-requirements">Performance Baseline Requirements</h4><p>The architecture must support:</p><p>Concurrent user sessions (policy defined target)</p><ul><li>Parallel agent execution</li><li>File upload throughput targets</li><li>Deterministic execution within SLA</li></ul><p>Latency must not:</p><p>Block UI responsiveness</p><ul><li>Prevent asynchronous job completion</li></ul><hr/><h4 id="data-retention-archival-2">Data Retention &amp; Archival</h4><p>The system must support:</p><p>Configurable retention policies</p><ul><li>Case archival process</li><li>Immutable preservation of artifacts</li><li>Secure long-term storage</li></ul><p>Archived cases must:</p><p>Remain searchable (if policy permits)</p><ul><li>Remain auditable</li><li>Not be modifiable</li></ul><hr/><h4 id="production-safeguards">Production Safeguards</h4><p>Production environment must enforce:</p><p>Publish/export gating</p><ul><li>Override logging</li><li>Readiness gate enforcement</li><li>Cross-case contamination detection</li><li>Cost control enforcement</li></ul><p>No feature flag may disable:</p><p>Evidence integrity enforcement</p><ul><li>Zero hallucination safeguards</li><li>Audit logging</li></ul><hr/><h4 id="build-checklist-antigravity-5">Build Checklist (Antigravity)</h4><p>Antigravity must implement:</p><p>Environment segmentation</p><h4 id="containerized-services">• Containerized services</h4><h4 id="infrastructure-as-code-provisioning">• Infrastructure-as-Code provisioning</h4><h4 id="secure-secrets-management">• Secure secrets management</h4><h4 id="message-queue-architecture">• Message queue architecture</h4><h4 id="artifact-object-storage">• Artifact object storage</h4><h4 id="audit-log-store">• Audit log store</h4><h4 id="integration-gateway-isolation">• Integration gateway isolation</h4><h4 id="autoscaling-configuration">• Autoscaling configuration</h4><h4 id="cicd-pipeline">• CI/CD pipeline</h4><h4 id="backup-recovery-strategy">• Backup + recovery strategy</h4><h4 id="multi-environment-deployment-support">• Multi-environment deployment support</h4><h3 id="performance-scalability-authoritative">PERFORMANCE &amp; SCALABILITY (AUTHORITATIVE)</h3><hr/><p>Purpose</p><p>This section defines performance expectations, scaling requirements, concurrency rules, workload classifications, and system-level guarantees required for production-grade operation of the AI Legal Service Web App.</p><p>Performance must support:</p><p>Concurrent client sessions</p><ul><li>Concurrent attorney sessions</li><li>Parallel agent execution</li><li>Large file ingestion</li><li>Deterministic evidence processing</li><li>Audit logging at scale</li></ul><p>Performance must never compromise:</p><p>Evidence integrity</p><ul><li>Deterministic execution</li><li>Audit traceability</li><li>Case isolation</li></ul><hr/><h4 id="performance-design-principles-2">Performance Design Principles</h4><p>The system must be engineered according to the following principles:</p><p>Asynchronous by default</p><ul><li>Horizontally scalable agent workers</li><li>Stateless execution nodes</li><li>Back-pressure aware job orchestration</li><li>Deterministic replay capability</li><li>Isolation between UI responsiveness and agent workload</li></ul><p>UI responsiveness must never depend on long-running agent tasks.</p><hr/><h4 id="workload-classification">Workload Classification</h4><p>All workloads must be classified into one of the following categories:</p><h4 id="interactive-workloads">Interactive Workloads</h4><p>Examples:</p><ul><li>Case navigation</li><li>Dashboard updates</li><li>Attorney disposition actions</li><li>Upload initiation</li></ul><p>Performance Target:</p><ul><li>Sub-second to low-second latency</li></ul><hr/><h4 id="background-processing-workloads">Background Processing Workloads</h4><p>Examples:</p><ul><li>OCR processing</li><li>STT processing</li><li>Extraction jobs</li><li>Mapping jobs</li><li>Evidence audits</li></ul><p>Performance Target:</p><ul><li>Queue-driven</li><li>Non-blocking</li><li>SLA-defined completion time</li></ul><hr/><h4 id="heavy-computational-workloads">Heavy Computational Workloads</h4><p>Examples:</p><ul><li>Large document ingestion</li><li>Multi-file mapping runs</li><li>Trial artifact preparation</li><li>Exposure simulation</li></ul><p>Performance Target:</p><ul><li>Parallelizable</li><li>Distributed worker capable</li><li>Deterministic execution preserved</li></ul><hr/><h4 id="concurrency-requirements">Concurrency Requirements</h4><p>The system must support:</p><p>Multiple concurrent cases</p><ul><li>Multiple concurrent upload sessions</li><li>Multiple simultaneous ProcessingJobs</li><li>Multiple simultaneous MappingJobs</li><li>Parallel EvidenceAuditJobs</li></ul><p>Concurrency Hard Constraints:</p><p>No shared in-memory state across cases</p><ul><li>No cross-case context contamination</li><li>No race conditions in artifact versioning</li><li>No duplicate artifact creation from job retries</li></ul><p>All concurrency must be managed through:</p><p>Message queue orchestration</p><ul><li>Idempotency keys</li><li>Correlation IDs</li><li>Transaction isolation controls</li></ul><hr/><h4 id="horizontal-scaling-model-2">Horizontal Scaling Model</h4><p>The system must support horizontal scaling of:</p><p>Agent worker services</p><ul><li>API layer</li><li>Orchestration layer</li><li>Integration gateway</li></ul><p>Scaling triggers may include:</p><p>CPU utilization</p><ul><li>Memory utilization</li><li>Queue depth</li><li>Request rate</li><li>Upload throughput</li></ul><p>Agent workers must:</p><p>Be stateless</p><ul><li>Pull jobs from queue</li><li>Support distributed deployment</li></ul><p>No agent may require singleton execution unless explicitly declared (rare case).</p><hr/><h4 id="queue-throughput-requirements">Queue &amp; Throughput Requirements</h4><p>The message queue must support:</p><p>Durable persistence</p><ul><li>High throughput</li><li>Retry classification</li><li>Dead-letter queues</li><li>Idempotent job processing</li></ul><p>The system must support:</p><p>Large file ingestion bursts</p><ul><li>High-volume email thread uploads</li><li>Bulk document ingestion (litigation scale)</li></ul><p>Back-pressure must:</p><p>Slow intake gracefully</p><ul><li>Never drop jobs</li><li>Never lose artifacts</li></ul><hr/><h4 id="large-file-handling-requirements">Large File Handling Requirements</h4><p>The system must support:</p><p>Large PDF ingestion</p><ul><li>Large transcript ingestion</li><li>Long audio/video files</li><li>Multi-GB trial record sets</li></ul><p>File handling must:</p><p>Stream uploads</p><ul><li>Avoid memory overload</li><li>Support resumable upload</li><li>Support chunk-based upload</li></ul><p>Processing must:</p><p>Be segmented</p><ul><li>Avoid blocking worker threads</li><li>Support distributed chunk processing</li></ul><hr/><h4 id="deterministic-execution-at-scale">Deterministic Execution at Scale</h4><p>Even under heavy load, the system must guarantee:</p><p>Identical inputs produce identical outputs</p><ul><li>Versioned artifacts remain stable</li><li>Mapping integrity is preserved</li><li>Audit logging remains intact</li></ul><p>Scaling must not alter:</p><p>Execution order guarantees (where required)</p><ul><li>Artifact lineage</li><li>Version traceability</li></ul><hr/><h4 id="latency-expectations-policy-defined-targets">Latency Expectations (Policy-Defined Targets)</h4><p>Antigravity must define and meet:</p><p>API response SLA (e.g., &lt; 1–2 seconds for non-heavy calls)</p><ul><li>Upload acknowledgment SLA</li><li>Processing SLA per file size category</li><li>Mapping SLA per case complexity</li><li>EvidenceAudit SLA</li></ul><p>SLA thresholds must be configurable by deployment profile.</p><hr/><h4 id="resource-isolation">Resource Isolation</h4><p>The architecture must enforce:</p><p>CPU limits per container</p><ul><li>Memory limits per container</li><li>Worker pool limits</li><li>Per-case rate limiting (if required)</li><li>Protection against denial-of-service patterns</li></ul><p>No single case may monopolize:</p><p>Agent worker capacity</p><ul><li>Queue depth</li><li>System memory</li></ul><hr/><p>Cost-Aware Scaling</p><p>The system must support:</p><p>Provider cost monitoring</p><ul><li>Token usage tracking</li><li>OCR/STT usage tracking</li><li>Budget cap enforcement</li></ul><p>Scaling policies must not:</p><p>Accidentally trigger runaway external tool costs</p><p>Cost caps must be:</p><p>Case-scoped (if policy enabled)</p><ul><li>Firm-scoped (if policy enabled)</li></ul><hr/><h4 id="peak-load-scenario-planning">Peak Load Scenario Planning</h4><p>The system must support:</p><p>Multiple simultaneous trial-prep cases</p><ul><li>High document production intake</li><li>Concurrent deposition transcript ingestion</li><li>Late-stage file bursts</li></ul><p>Antigravity must provide:</p><p>Capacity planning documentation</p><ul><li>Expected scaling curves</li><li>Recommended infrastructure sizing</li></ul><hr/><h4 id="graceful-degradation">Graceful Degradation</h4><p>Under heavy load:</p><p>The system must degrade gracefully by:</p><p>Slowing background job scheduling</p><ul><li>Preserving UI responsiveness</li><li>Maintaining deterministic safety</li><li>Maintaining audit logging</li></ul><p>The system must never:</p><p>Drop artifacts</p><ul><li>Skip audit events</li><li>Bypass readiness gates</li><li>Infer missing mappings</li></ul><hr/><p>Performance Testing Requirements</p><p>Antigravity must perform:</p><p>Load testing</p><ul><li>Stress testing</li><li>Concurrency testing</li><li>Queue depth simulation</li><li>Retry storm testing</li><li>Failover under load testing</li></ul><p>Testing must validate:</p><p>Deterministic replay</p><ul><li>Artifact immutability</li><li>No race condition in versioning</li><li>Idempotent job behavior</li></ul><hr/><h4 id="scalability-review-checklist-antigravity">Scalability Review Checklist (Antigravity)</h4><p>Antigravity must validate:</p><p>Stateless worker design</p><ul><li>Queue durability</li><li>Idempotent job execution</li><li>Horizontal scaling capability</li><li>Large file ingestion support</li><li>Concurrency isolation</li><li>Performance under litigation-scale workloads</li><li>Cost control enforcement</li></ul><h3 id="observability-monitoring-authoritative">OBSERVABILITY &amp; MONITORING (AUTHORITATIVE)</h3><hr/><h4 id="purpose-19">Purpose</h4><p>This section defines mandatory observability, monitoring, logging, alerting, and diagnostic requirements for the AI Legal Service Web App.</p><p>Observability must support:</p><p>Legal defensibility</p><ul><li>Deterministic replay validation</li><li>Security monitoring</li><li>Operational health</li><li>Cost governance</li><li>Agent behavior verification</li></ul><p>The system must never operate as a black box.</p><hr/><h4 id="observability-principles">Observability Principles</h4><p>The platform must implement:</p><p>Structured logging (machine-readable)</p><ul><li>Correlation ID tracing across all layers</li><li>Distributed tracing for agent execution</li><li>Metrics collection for performance and health</li><li>Immutable audit logging</li><li>Replay reconstruction capability</li></ul><p>Every action must be traceable to:</p><p>user_id or system actor</p><ul><li>role</li><li>case_id</li><li>correlation_id</li><li>artifact_id (if applicable)</li><li>job_id (if applicable)</li></ul><hr/><h4 id="logging-requirements">Logging Requirements</h4><p>All logs must be:</p><p>Structured (JSON format recommended)</p><ul><li>Timestamped (UTC)</li><li>Immutable once persisted</li><li>Searchable by case_id and correlation_id</li><li>Environment tagged (dev / staging / prod)</li></ul><p>Log categories must include:</p><h4 id="application-logs">Application Logs</h4><p>API requests</p><ul><li>Authentication events</li><li>Authorization checks</li><li>Validation failures</li><li>State transitions</li></ul><h4 id="agent-execution-logs">Agent Execution Logs</h4><p>Job started</p><ul><li>Job completed</li><li>Deterministic metadata captured</li><li>Artifact version created</li><li>Issues generated</li><li>Failures classified</li></ul><p>OCR provider calls</p><ul><li>STT provider calls</li><li>LLM tool mediation calls</li><li>Legal research tool access</li><li>External API interactions</li></ul><h4 id="security-logs">Security Logs</h4><p>Login attempts</p><ul><li>Failed authorization attempts</li><li>Override usage</li><li>Directive creation</li><li>Privileged access events</li></ul><h4 id="system-health-logs">System Health Logs</h4><p>Worker lifecycle</p><h4 id="queue-depth-alerts">• Queue depth alerts</h4><h4 id="memorycpu-thresholds">• Memory/CPU thresholds</h4><h4 id="database-latency">• Database latency</h4><hr/><h4 id="correlation-id-enforcement">Correlation ID Enforcement</h4><p>Every request and agent run must include:</p><p>correlation_id</p><p>The correlation_id must propagate through:</p><p>API layer</p><ul><li>Orchestration layer</li><li>Agent execution</li><li>Integration layer</li><li>Artifact creation</li><li>Audit events</li></ul><p>No job may execute without a correlation_id.</p><hr/><h4 id="distributed-tracing">Distributed Tracing</h4><p>The system must support end-to-end tracing of:</p><p>Upload → Processing → Mapping → Audit → Publish</p><ul><li>Intake → Case Activation → Workflow Transition</li><li>Attorney directive → Legal library access</li></ul><p>Tracing must allow reconstruction of:</p><p>Execution order</p><ul><li>Dependency chain</li><li>Input versions</li><li>Artifact lineage</li></ul><hr/><h4 id="metrics-collection">Metrics Collection</h4><p>The system must collect:</p><h4 id="performance-metrics">Performance Metrics</h4><p>API latency</p><ul><li>Job completion time</li><li>Queue depth</li><li>Worker utilization</li><li>Upload throughput</li></ul><h4 id="reliability-metrics">Reliability Metrics</h4><p>Job failure rate</p><ul><li>Retry count</li><li>Dead-letter queue volume</li><li>Deterministic replay mismatch count</li></ul><h4 id="security-metrics">Security Metrics</h4><p>Failed login attempts</p><ul><li>Override frequency</li><li>Privileged directive frequency</li></ul><h4 id="evidence-integrity-metrics">Evidence Integrity Metrics</h4><p>Orphan artifact rate</p><ul><li>Unsupported element rate</li><li>Contradiction flag frequency</li><li>Mapping coverage percentage</li></ul><h4 id="cost-metrics">Cost Metrics</h4><p>Token usage</p><ul><li>OCR/STT call volume</li><li>External tool call volume</li><li>Case-level cost allocation</li></ul><hr/><h4 id="alerting-requirements">Alerting Requirements</h4><p>The system must generate alerts for:</p><p>Agent job failure spikes</p><ul><li>Deterministic replay mismatch</li><li>Missing artifact creation</li><li>Audit event failure</li><li>Security anomalies</li><li>Excessive override usage</li><li>Upload session integrity failures</li><li>Database performance degradation</li><li>Queue backlog threshold breach</li><li>Alerts must:</li><li>Be role-targeted (Ops / Security / Attorney Admin)</li><li>Be logged and traceable</li><li>Include correlation_id and case_id when applicable</li></ul><hr/><h4 id="deterministic-replay-validation">Deterministic Replay Validation</h4><p>The platform must support:</p><p>Re-execution of deterministic jobs</p><ul><li>Output comparison</li><li>Replay validation flagging</li><li>Replay must verify:</li><li>Artifact equivalence</li><li>Mapping stability</li><li>Evidence audit consistency</li></ul><p>If mismatch detected:</p><p>Create Issue</p><ul><li>Flag integrity anomaly</li><li>Prevent publish/export</li></ul><hr/><h4 id="dashboard-monitoring-requirements">Dashboard Monitoring Requirements</h4><p>The system must expose:</p><h4 id="case-level-indicators">Case-Level Indicators</h4><p>Current workflow stage</p><ul><li>Open issues count</li><li>Blocking issues count</li><li>Latest EvidenceAudit status</li><li>Mapping coverage status</li><li>Upload session status</li></ul><h4 id="system-level-indicators">System-Level Indicators</h4><p>Active workers</p><ul><li>Queue backlog</li><li>Processing throughput</li><li>Error rate</li><li>Cost usage</li></ul><hr/><h4 id="audit-log-monitoring">Audit Log Monitoring</h4><p>The system must continuously validate:</p><p>Audit log append-only integrity</p><ul><li>No missing audit events</li><li>No tampering indicators</li></ul><p>Audit log must support:</p><p>Export</p><ul><li>Filtering by case</li><li>Filtering by actor</li><li>Filtering by event type</li></ul><hr/><h4 id="log-retention-policy">Log Retention Policy</h4><p>Log retention must be:</p><p>Policy-configurable</p><ul><li>Environment-specific</li><li>Compliant with legal retention standards</li></ul><p>Minimum retention must support:</p><p>Litigation defensibility</p><ul><li>Regulatory audit needs</li></ul><p>Logs must never be silently purged.</p><hr/><h4 id="privacy-redaction-observability-controls">Privacy &amp; Redaction Observability Controls</h4><p>Observability systems must:</p><p>Avoid exposing sensitive case content in raw logs</p><ul><li>Redact privileged text</li><li>Avoid storing raw document content in monitoring streams</li><li>Preserve case isolation</li></ul><p>Logs must contain identifiers and metadata — not raw evidence text.</p><hr/><h4 id="production-monitoring-architecture-requirements">Production Monitoring Architecture Requirements</h4><p>Antigravity must implement:</p><p>Centralized logging service</p><ul><li>Metrics aggregation system</li><li>Alert routing system</li><li>Dashboard visualization</li><li>Log search capability</li><li>Access-controlled observability console</li></ul><hr/><h4 id="observability-review-checklist-antigravity">Observability Review Checklist (Antigravity)</h4><p>Antigravity must validate:</p><p>All agent jobs include correlation_id</p><ul><li>Structured logs across all services</li><li>Distributed tracing enabled</li><li>Deterministic replay support</li><li>Metrics dashboards operational</li><li>Alert thresholds defined</li><li>Audit log integrity validated</li><li>Log redaction rules enforced</li></ul><h3 id="testing-validation-strategy-authoritative">TESTING &amp; VALIDATION STRATEGY (AUTHORITATIVE)</h3><hr/><h4 id="purpose-20">Purpose</h4><p>This section defines mandatory testing, validation, and verification requirements for the AI Legal Service Web App prior to production release and for all future releases.</p><p>The objective is to ensure:</p><p>Deterministic reproducibility</p><ul><li>Evidence integrity</li><li>Zero hallucination enforcement</li><li>Case isolation integrity</li><li>Workflow correctness</li><li>Security compliance</li><li>Legal defensibility</li></ul><p>No deployment may occur without satisfying this section.</p><hr/><h4 id="testing-philosophy">Testing Philosophy</h4><p>Testing must validate:</p><p>Functional correctness</p><ul><li>Deterministic replay stability</li><li>Data immutability</li><li>Artifact versioning integrity</li><li>Agent orchestration correctness</li><li>Audit completeness</li><li>Performance under load</li><li>Security boundary enforcement</li></ul><p>Testing must occur across:</p><p>Unit</p><ul><li>Integration</li><li>Orchestration</li><li>Workflow</li><li>System</li><li>Security</li><li>Performance</li><li>Replay validation</li></ul><hr/><h4 id="test-environments">Test Environments</h4><p>The system must maintain at minimum:</p><p>Development environment</p><ul><li>Staging environment (production-like)</li><li>Production environment</li></ul><p>Staging must replicate:</p><p>Data architecture</p><ul><li>Orchestration engine</li><li>Logging</li><li>Audit store</li><li>Tool mediation layer</li></ul><p>No direct production testing permitted except controlled validation scenarios.</p><hr/><h4 id="unit-testing-requirements">Unit Testing Requirements</h4><p>All system components must have unit tests covering:</p><p>Data model validation</p><ul><li>Schema enforcement</li><li>Artifact version creation</li><li>Hash computation logic</li><li>UploadSession lifecycle transitions</li><li>Thread detection logic</li><li>Mapping link creation logic</li><li>Evidence reference validation</li><li>Issue creation logic</li></ul><p>Minimum coverage threshold must be policy-defined (recommended ≥ 85%).</p><hr/><h4 id="deterministic-replay-testing-critical">Deterministic Replay Testing (Critical)</h4><p>All deterministic agents must support replay validation testing.</p><p>For each deterministic job type:</p><p>Re-execute with identical inputs</p><ul><li>Compare output artifact payloads</li><li>Compare deterministic_run_metadata</li><li>Compare mapping outputs</li></ul><p>Replay mismatch must:</p><p>Fail test</p><ul><li>Generate error log</li><li>Block release</li></ul><p>Agents requiring replay validation:</p><p>INTAKE_AGENT (approval compile phase)</p><ul><li>PROCESSING_AGENT</li><li>MAPPING_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>Deposition / discovery / publish agents</li></ul><hr/><h4 id="zero-hallucination-validation-testing">Zero Hallucination Validation Testing</h4><p>Testing must verify:</p><p>No generated artifact contains unsupported factual claims</p><ul><li>All factual statements link to evidence trace references</li><li>Missing evidence triggers Issue creation</li><li>Contradictions are flagged, not resolved</li></ul><p>Automated test cases must include:</p><p>Insufficient evidence scenarios</p><ul><li>Contradictory upload scenarios</li><li>Orphan evidence scenarios</li><li>Ambiguous entity scenarios</li></ul><p>Expected behavior must match policy.</p><hr/><h4 id="case-isolation-testing">Case Isolation Testing</h4><p>System must validate:</p><p>No cross-case reads without authorization</p><ul><li>No cross-case joins permitted by default</li><li>Encryption keys scoped per case</li><li>Artifact access restricted by case_id</li><li>No leakage of derived knowledge across cases</li></ul><p>Security tests must simulate:</p><p>Multi-tenant concurrent case execution</p><ul><li>Malicious query attempts</li><li>Unauthorized role access</li></ul><hr/><h4 id="upload-thread-governance-testing">Upload &amp; Thread Governance Testing</h4><p>FILE_INTAKE_AGENT must be tested for:</p><p>Duplicate hash detection</p><ul><li>Thread detection accuracy</li><li>Authoritative thread selection logic</li><li>Attorney override functionality</li><li>Session lifecycle enforcement</li><li>Prevention of downstream processing prior to closure</li></ul><p>Test scenarios must include:</p><p>Re-upload same file</p><ul><li>Email thread cumulative upload</li><li>Partial upload sessions</li><li>Late uploads after complaint filing</li></ul><hr/><h4 id="mapping-integrity-testing">Mapping Integrity Testing</h4><p>MAPPING_AGENT must be validated for:</p><p>Correct element mapping behavior</p><ul><li>Unsupported element detection</li><li>Orphan artifact detection</li><li>Trace reference completeness</li><li>Contradiction flag generation</li><li>Version lineage preservation</li></ul><p>Edge case scenarios must include:</p><p>Evidence removed or excluded</p><ul><li>Updated pleadings</li><li>COA revision</li><li>Late-file contradiction</li></ul><hr/><h4 id="evidence-audit-validation-testing">Evidence Audit Validation Testing</h4><p>EVIDENCE_AUDIT_AGENT must be tested to confirm:</p><p>Coverage summary correctness</p><ul><li>Missing artifact detection</li><li>Readiness gating enforcement</li><li>Issue generation</li><li>Deterministic replay consistency</li><li>Stage-specific artifact requirements</li></ul><p>Testing must simulate:</p><p>Pre-publish without audit</p><ul><li>Contradictory evidence</li><li>Missing mapping packages</li></ul><hr/><h4 id="workflow-transition-testing">Workflow Transition Testing</h4><p>Workflow engine must validate:</p><p>No stage transition without required artifacts</p><ul><li>Publish/export blocked when audit fails</li><li>Override requires audit record</li><li>State transitions logged</li><li>Task/Issue resolution rules enforced</li></ul><p>Testing must simulate:</p><p>Invalid transition attempts</p><ul><li>Unauthorized overrides</li><li>Concurrent workflow operations</li></ul><hr/><h4 id="security-testing">Security Testing</h4><p>Security testing must include:</p><p>Authentication validation</p><ul><li>Role-based authorization</li><li>Privilege escalation attempts</li><li>Directive misuse attempts</li><li>Override misuse attempts</li><li>API injection attempts</li><li>Upload of malicious files</li></ul><p>Penetration testing must be performed before production release.</p><hr/><h4 id="performance-load-testing">Performance &amp; Load Testing</h4><p>System must validate:</p><p>Concurrent upload sessions</p><ul><li>Parallel processing jobs</li><li>Mapping scalability</li><li>Audit generation speed</li><li>Dashboard responsiveness</li></ul><p>Performance benchmarks must include:</p><p>Large file ingestion</p><ul><li>Multi-thousand chunk cases</li><li>Long email threads</li><li>Complex COA mapping</li></ul><p>Performance targets must be documented and approved prior to production.</p><hr/><h4 id="cost-governance-testing">Cost Governance Testing</h4><p>System must verify:</p><p>Token usage tracking</p><ul><li>OCR/STT cost logging</li><li>Case-level cost attribution</li><li>Budget cap enforcement</li><li>Alert triggers for cost thresholds</li></ul><hr/><h4 id="failure-simulation-testing">Failure Simulation Testing</h4><p>System must simulate:</p><p>Provider outages (OCR/STT/LLM)</p><ul><li>Database outage</li><li>Queue failure</li><li>Worker crash</li><li>Hash mismatch</li><li>Corrupted upload</li></ul><p>Expected behavior:</p><p>Retry where allowed</p><ul><li>Create Issue where blocking</li><li>No data corruption</li><li>No artifact overwrite</li></ul><hr/><h4 id="data-retention-archive-testing">Data Retention &amp; Archive Testing</h4><p>Testing must validate:</p><p>Legal hold enforcement</p><ul><li>Archive store read-only behavior</li><li>Archive re-open workflow</li><li>Derived knowledge rebuild capability</li><li>No orphan artifacts after archive transition</li></ul><hr/><h4 id="audit-log-integrity-testing">Audit Log Integrity Testing</h4><p>System must verify:</p><p>Append-only behavior</p><ul><li>No deletion permitted</li><li>Tamper-evidence</li><li>Audit query correctness</li><li>Cross-layer event completeness</li></ul><hr/><h4 id="release-validation-checklist-mandatory-before-production">Release Validation Checklist (Mandatory Before Production)</h4><p>Before production release, Antigravity must certify:</p><p>Deterministic replay validation complete</p><ul><li>Zero hallucination tests passed</li><li>Case isolation tests passed</li><li>Mapping integrity tests passed</li><li>Evidence audit gating verified</li><li>Security penetration test completed</li><li>Load test passed</li><li>Cost governance validated</li><li>Observability dashboards operational</li><li>Audit log integrity verified</li></ul><p>Certification must be recorded as versioned artifact.</p><hr/><h4 id="continuous-testing-requirements">Continuous Testing Requirements</h4><p>After production launch:</p><p>Deterministic replay spot checks must run periodically</p><ul><li>Regression test suite must execute on every deployment</li><li>Agent behavior drift detection must be implemented</li><li>Security testing must be periodic</li><li>Observability alerts must be monitored</li></ul><p>No release may bypass regression validation.</p><h3 id="production-readiness-criteria-authoritative">PRODUCTION READINESS CRITERIA (AUTHORITATIVE)</h3><hr/><h4 id="purpose-21">Purpose</h4><p>This section defines the mandatory criteria that must be satisfied before the AI Legal Service Web App may be deployed to production or have production access expanded.</p><p>No production activation may occur without documented compliance with this section.</p><p>Production readiness is not technical completion alone. It is:</p><p>Legal defensibility validation</p><ul><li>Deterministic stability validation</li><li>Security validation</li><li>Governance validation</li><li>Operational sustainability validation</li></ul><hr/><h4 id="readiness-certification-model">Readiness Certification Model</h4><p>Production release requires:</p><p>Technical Certification</p><ul><li>Governance Certification</li><li>Security Certification</li><li>Deterministic Validation Certification</li><li>Legal Defensibility Review</li></ul><p>Each certification must be recorded as a versioned artifact in ARTIFACT_STORE.</p><p><strong>Artifact Type:</strong> production_readiness_certification</p><p>Attributes (minimum):</p><p>certification_version_id</p><ul><li>release_version</li><li>certification_type</li><li>certifying_role</li><li>certification_timestamp</li><li>checklist_completed[]</li><li>known_limitations[]</li><li>signoff_attestation</li><li>deterministic_validation_reference</li><li>audit_reference</li><li>security_reference</li></ul><hr/><h4 id="mandatory-production-preconditions">Mandatory Production Preconditions</h4><p>The following conditions must be satisfied prior to production release:</p><h4 id="deterministic-stability">Deterministic Stability</h4><p>All deterministic agents pass replay validation</p><ul><li>No nondeterministic artifact creation pathways exist</li><li>deterministic_run_metadata fully captured across agents</li><li>Mapping and audit outputs reproducible</li></ul><hr/><h4 id="zero-hallucination-enforcement">Zero Hallucination Enforcement</h4><p>All evidence-handling agents validated under insufficient evidence scenarios</p><ul><li>Contradiction detection tested</li><li>No unsupported claims present in test artifacts</li><li>Issue creation verified when evidence insufficient</li></ul><hr/><h4 id="case-isolation-enforcement-5">Case Isolation Enforcement</h4><p>No cross-case data access without authorization</p><ul><li>Encryption scopes validated</li><li>Case_id enforcement validated in API layer</li><li>Cross-case joins blocked by policy</li><li>Derived knowledge domain access properly gated</li></ul><hr/><h4 id="audit-trace-integrity">Audit &amp; Trace Integrity</h4><p>Audit log append-only verified</p><ul><li>All privileged actions logged</li><li>All artifact versions link to provenance</li><li>Evidence trace references validated</li><li>Correlation IDs consistent across layers</li></ul><hr/><h4 id="workflow-gating-validation">Workflow Gating Validation</h4><p>Publish/Export blocked without current Evidence Audit</p><ul><li>Override requires recorded justification</li><li>Workflow transitions require required artifacts</li><li>Stage-based artifact checklist validated</li></ul><hr/><h4 id="security-hardening">Security Hardening</h4><p>MFA/2FA enabled for privileged roles</p><ul><li>Role-based authorization validated</li><li>Privilege escalation tested</li><li>API access control verified</li><li>File upload scanning enabled</li><li>Encryption at rest verified</li><li>Encryption in transit verified</li></ul><p>Penetration testing must be completed and documented.</p><hr/><h4 id="upload-governance-validation">Upload Governance Validation</h4><p>UploadSession lifecycle validated</p><ul><li>Duplicate detection verified</li><li>Thread grouping verified</li><li>Authoritative thread logic validated</li><li>Late-upload impact detection validated</li><li>Attorney dashboard alerts verified</li></ul><hr/><h4 id="operational-monitoring-enabled">Operational Monitoring Enabled</h4><p>The following must be operational:</p><p>Structured logging</p><ul><li>Error monitoring</li><li>Alerting thresholds</li><li>Cost monitoring dashboards</li><li>Token usage tracking</li><li>Queue health monitoring</li><li>Processing backlog visibility</li></ul><hr/><h4 id="backup-disaster-recovery-verified">Backup &amp; Disaster Recovery Verified</h4><p>Active case database backup strategy implemented</p><ul><li>Archive store backup validated</li><li>Restore-from-backup tested</li><li>Recovery time objective (RTO) documented</li><li>Recovery point objective (RPO) documented</li></ul><hr/><h4 id="performance-validation">Performance Validation</h4><p>Upload throughput validated</p><ul><li>Processing scalability validated</li><li>Mapping performance validated</li><li>Audit runtime validated</li><li>Dashboard responsiveness validated</li></ul><p>Performance thresholds must be documented and approved.</p><hr/><h4 id="role-based-production-access-controls">Role-Based Production Access Controls</h4><p>Production system must enforce:</p><p>Least privilege model</p><ul><li>Explicit environment separation (Dev / Stage / Prod)</li><li>No direct production DB access without controlled role</li><li>No direct tool provider credentials in UI</li><li>Tool access only via mediated layer</li></ul><p>Administrative access must be:</p><p>Role-restricted</p><ul><li>Logged</li><li>Periodically reviewed</li></ul><hr/><h4 id="controlled-release-model">Controlled Release Model</h4><p>Production releases must follow:</p><p>Version tagging</p><ul><li>Deployment artifact generation</li><li>Migration scripts version-controlled</li><li>Rollback plan documented</li><li>Post-deployment validation checklist</li></ul><p>Deployment must be:</p><p>Repeatable</p><ul><li>Script-driven</li><li>Logged</li></ul><p>Manual production edits are prohibited.</p><hr/><h4 id="legal-defensibility-review-mandatory">Legal Defensibility Review (Mandatory)</h4><p>Prior to production activation, a structured review must confirm:</p><p>Evidence traceability design is defensible</p><ul><li>Artifact immutability enforceable</li><li>Mapping lineage reconstructable</li><li>Audit logs tamper-evident</li><li>Override governance defensible</li><li>Case isolation enforceable</li></ul><p>This review must be documented and stored as artifact.</p><hr/><h4 id="known-limitations-disclosure">Known Limitations Disclosure</h4><p>Before production release:</p><p>Any known system limitations must be documented</p><ul><li>Advisory vs deterministic boundaries must be explicit</li><li>Feature flags documented</li><li>Experimental capabilities disabled or labeled</li></ul><p>Undocumented limitations are prohibited.</p><hr/><h4 id="post-deployment-stabilization-period">Post-Deployment Stabilization Period</h4><p>After initial production release:</p><p>Deterministic replay spot checks required</p><ul><li>Elevated monitoring thresholds</li><li>Incident response standby</li><li>Daily system health validation for defined period</li></ul><p>Stabilization period duration must be defined in governance policy.</p><hr/><h4 id="production-readiness-checklist-executable">Production Readiness Checklist (Executable)</h4><p>Antigravity must complete and sign off on:</p><ul><li>Deterministic replay validation complete</li><li>Zero hallucination enforcement validated</li><li>Evidence trace enforcement validated</li><li>Workflow gating enforced</li><li>Security penetration test passed</li><li>Case isolation validated</li><li>Upload governance validated</li><li>Performance benchmark met</li><li>Disaster recovery validated</li><li>Audit integrity verified</li><li>Observability enabled</li><li>Rollback plan validated</li><li>Legal defensibility review completed</li></ul><p>Certification artifact must be created before system is marked ProductionActive.</p><hr/><h4 id="production-activation-event">Production Activation Event</h4><p>Upon successful certification:</p><p>System must emit:</p><p>ProductionActivated</p><p>ProductionVersionDeployed</p><p>ReadinessCertificationStored</p><p>These events must be audit logged.</p><h3 id="technical-specification-translation-framework-authoritative">TECHNICAL SPECIFICATION TRANSLATION FRAMEWORK (AUTHORITATIVE)</h3><hr/><h4 id="purpose-22">Purpose</h4><p>This section defines how this Architecture &amp; Governance Document is translated into build-ready technical specifications for Antigravity.</p><p>This document is the Authoritative Design Source.</p><p>The Technical Specification (Build Spec) derived from it must:</p><p>Preserve all governance rules</p><ul><li>Preserve deterministic constraints</li><li>Preserve evidence integrity enforcement</li><li>Preserve case isolation guarantees</li><li>Preserve DIKW layering architecture</li><li>Not reinterpret business logic</li></ul><p>No technical specification may contradict this document.</p><hr/><h4 id="authoritative-to-build-translation-model">Authoritative-to-Build Translation Model</h4><p>The translation from this document to build spec must follow a strict decomposition model:</p><p>Architecture Document → Build Spec → Implementation → Validation → Certification</p><p>Each layer must preserve:</p><p>Structural intent</p><ul><li>Governance constraints</li><li>Deterministic requirements</li><li>Security boundaries</li><li>Audit guarantees</li></ul><p>Any ambiguity must be resolved in writing and appended as a versioned clarification artifact.</p><hr/><h4 id="required-build-specification-sections">Required Build Specification Sections</h4><p>The Engineering Technical Specification provided to Antigravity must include the following sections.</p><hr/><h4 id="system-topology-specification">System Topology Specification</h4><p>Must define:</p><p>Service boundaries</p><ul><li>API layer structure</li><li>Agent orchestration architecture</li><li>Message/event bus design</li><li>Data store segregation</li><li>Encryption model</li><li>Environment model (Dev / Stage / Prod)</li></ul><p>Must explicitly reference:</p><p>Case isolation model</p><ul><li>Domain separation (Case / Operational / Derived / Archive)</li><li>Mediation layer requirements</li></ul><hr/><h4 id="data-schema-specification">Data Schema Specification</h4><p>Must include:</p><p>Logical schema definitions</p><ul><li>Physical schema strategy (Option A/B/C per Section 8)</li><li>Indexing strategy</li><li>Foreign key / lineage constraints</li><li>Immutable artifact model</li><li>Version tables</li><li>Audit store structure</li><li>TEXT_VAULT / TEXT_CHUNKS schema</li><li>THREAD_GROUP schema</li><li>UploadSession schema</li><li>CASE_CONTEXT_PLAYBOOK schema</li><li>Mapping link tables</li></ul><p>Must define:</p><p>Constraints</p><ul><li>Required fields</li><li>Non-null enforcement</li><li>Unique constraints</li><li>Idempotency handling</li></ul><hr/><h4 id="agent-execution-contracts">Agent Execution Contracts</h4><p>For each agent, the build spec must define:</p><p>Input contract (schema + required fields)</p><ul><li>Output contract (artifact schema + versioning rules)</li><li>Deterministic execution boundary</li><li>Non-deterministic allowance boundary</li><li>Idempotency model</li><li>Emitted events</li><li>Failure classifications</li><li>Required audit events</li><li>Downstream triggers</li></ul><p>Agents must not be implemented with implied behavior.</p><p>Every rule must map back to an authoritative section number.</p><hr/><h4 id="workflow-state-machine-specification">Workflow State Machine Specification</h4><p>Must include:</p><p>Formal state diagram</p><ul><li>Allowed transitions</li><li>Blocking conditions</li><li>Override conditions</li><li>Required artifact checks</li><li>Readiness gating logic</li><li>Publish/Export gating logic</li><li>EvidenceAudit gating logic</li></ul><p>State transitions must be machine-enforced, not UI-enforced.</p><hr/><h4 id="security-authorization-model">Security &amp; Authorization Model</h4><p>Must define:</p><ul><li>Role definitions</li><li>Permission matrices</li><li>Privilege escalation rules</li><li>MFA enforcement</li><li>Token/session management</li><li>Audit requirements</li><li>Encryption strategy</li><li>Secret management model</li></ul><p>Must prohibit:</p><p>Direct agent-to-tool connections</p><ul><li>Direct DB access from UI</li><li>Cross-case joins</li></ul><hr/><p>Deterministic Execution Specification</p><p>Must define:</p><p>Prompt versioning storage</p><ul><li>Tool provider metadata storage</li><li>Model version capture</li><li>Reproducibility requirements</li><li>Replay validation tooling</li><li>Deterministic run metadata schema</li></ul><p>Must explicitly define:</p><p>What constitutes identical input</p><ul><li>What invalidates replay</li><li>What requires artifact version increment</li></ul><hr/><h4 id="evidence-integrity-trace-enforcement-implementation">Evidence Integrity &amp; Trace Enforcement Implementation</h4><p>Must implement:</p><p>Mandatory trace reference schema</p><ul><li>Chunk offset validation</li><li>Artifact lineage enforcement</li><li>Contradiction detection mechanism</li><li>Orphan detection mechanism</li><li>Insufficient evidence issue creation</li></ul><p>Must define:</p><p>Enforcement points</p><ul><li>Rejection conditions</li><li>Required error responses</li></ul><hr/><h4 id="observability-monitoring-specification">Observability &amp; Monitoring Specification</h4><p>Must include:</p><p>Structured logging schema</p><ul><li>Correlation ID propagation</li><li>Agent job telemetry</li><li>Queue health metrics</li><li>Cost monitoring</li><li>Token consumption tracking</li><li>Failure alert thresholds</li></ul><hr/><h4 id="deployment-infrastructure-specification">Deployment &amp; Infrastructure Specification</h4><p>Must define:</p><p>Infrastructure as code model</p><ul><li>Environment separation</li><li>CI/CD gating</li><li>Migration scripts</li><li>Rollback plan</li><li>Feature flag governance</li><li>Production hardening checklist</li></ul><hr/><h4 id="traceability-matrix-requirement">Traceability Matrix Requirement</h4><p>Before build begins, Antigravity must produce a Traceability Matrix:</p><p>Columns:</p><p>Architecture Section Number</p><ul><li>Requirement Statement</li><li>Build Spec Reference</li><li>Implementation Component</li><li>Validation Test Reference</li></ul><p>No requirement may remain unmapped.</p><p>This prevents drift during development.</p><hr/><h4 id="change-control-protocol">Change Control Protocol</h4><p>After build begins:</p><p>Any change to architecture document requires version increment</p><ul><li>Impact analysis required</li><li>Deterministic implications reviewed</li><li>Security implications reviewed</li><li>Traceability matrix updated</li><li>Production readiness implications evaluated</li></ul><p>Untracked architectural changes are prohibited.</p><hr/><h4 id="definition-of-build-complete">Definition of “Build Complete”</h4><p>The system is not “complete” when features exist.</p><p>It is complete only when:</p><p>All architecture requirements implemented</p><ul><li>All agents conform to execution contracts</li><li>Deterministic replay validated</li><li>Evidence trace enforcement verified</li><li>Case isolation validated</li><li>Security penetration test passed</li><li>Production readiness certification completed</li></ul><p>Feature presence without governance enforcement does not qualify as completion.</p><hr/><h4 id="what-antigravity-must-not-decide">What Antigravity Must Not Decide</h4><p>The following are locked by this document and are not discretionary:</p><p>Zero Hallucination Rule</p><ul><li>Deterministic requirement for case-state mutation</li><li>Artifact immutability</li><li>Evidence trace requirements</li><li>Case isolation enforcement</li><li>Tool mediation requirement</li><li>UploadSession governance</li><li>THREAD_GROUP authoritative rule</li><li>Publish/Export gating</li><li>EvidenceAudit gating</li></ul><p>If Antigravity believes a rule is infeasible, it must submit a formal deviation request before implementation.</p><hr/><p>Final Output of This Section</p><p>Deliverable to Antigravity:</p><p>1. This Architecture Document (Authoritative)</p><p>2. Technical Build Specification (Derived)</p><p>3. Traceability Matrix</p><p>4. Production Readiness Checklist</p><p>5. Deterministic Validation Plan</p><p>Only after these are complete should development begin.</p></section><section><h2 id="workflow">WORKFLOW</h2><p>This section defines the authoritative end-to-end workflow for the platform. It is implementation-ready and specifies:</p><p>Workflow steps and permitted transitions</p><ul><li>Agent invocations and required inputs/outputs</li><li>Required artifacts per stage</li><li>Blocking conditions, approvals, and overrides</li><li>Event triggers (scheduled and event-driven)</li><li>Issue/Task creation and closure expectations</li><li>Deterministic vs non-deterministic boundaries for stage gating</li></ul><p>The workflow must treat all agents as first-class services. No agent is “implicit.” Any action executed by the system must map to a defined agent, API module, or governed system component.</p><hr/><h3 id="workflow-modeling-rule">Workflow Modeling Rule</h3><p>The workflow is an enforceable state machine. It must explicitly define:</p><p>Entry Conditions</p><ul><li>Actions (including Agent invocations)</li><li>Required Outputs (artifacts)</li><li>Blocking Conditions</li><li>Decisions and Approval Gates</li><li>Exit Conditions</li><li>Event Hooks</li><li>Dashboard State Updates</li><li>Deterministic vs Non-Deterministic execution boundaries</li></ul><p>No workflow progression may rely on implied behavior. All transitions must be explicitly defined and audit logged.</p><p>6.1.1 Human Oversight &amp; Attorney Control (Global Rule)</p><p>The system shall not autonomously:</p><p>Accept representation</p><ul><li>Finalize or file pleadings</li><li>Serve subpoenas</li><li>Submit discovery responses</li><li>Finalize deposition designations</li><li>Advance trial posture</li><li>Publish/export legal documents</li><li>Override blocking conditions</li></ul><p>All such actions require explicit Attorney approval and must:</p><p>Record approval event</p><ul><li>Record approving user</li><li>Record timestamp</li><li>Record artifact version approved</li><li>Record correlation identifier</li></ul><p>Non-deterministic drafting or strategic outputs must be classified as:</p><p>Advisory Only</p><ul><li>Review Required</li><li>Approval Required Before Publish</li><li>Approval Required Before Workflow Transition</li></ul><p>This classification must be encoded per the Dashboard Update Contract (Global Rule)</p><p>Each workflow step must explicitly update the following case-scoped fields:</p><p>workflow_step</p><ul><li>step_state</li><li>blocking_reasons (structured list)</li><li>pending_approvals_count</li><li>open_issues_count</li><li>evidence_audit_status</li><li>readiness_status (from CONDUCTOR_AGENT)</li><li>last_updated_timestamp</li></ul><p>Dashboard state must reflect:</p><p>Active blocking conditions</p><ul><li>Required human approvals</li><li>Evidence audit currency</li><li>Readiness to advance</li></ul><p>No step is considered Complete until dashboard state reflects exit condition truth.</p><h4 id="deterministic-vs-non-deterministic-enforcement">Deterministic vs Non-Deterministic Enforcement</h4><p>Blocking decisions, workflow transitions, and readiness gating must execute deterministically.</p><p>Non-deterministic agents may:</p><p>Draft</p><ul><li>Analyze</li><li>Recommend</li></ul><p>But may not:</p><p>Advance workflow</p><ul><li>Override blocking states</li><li>Modify authoritative artifacts without versioning</li></ul><p>Deterministic agents include (non-exhaustive):</p><p>ONBOARD_AGENT (COI enforcement)</p><ul><li>FILE_INTAKE_AGENT (authoritative file confirmation)</li><li>PROCESSING_AGENT (structured population integrity)</li><li>MAPPING_AGENT (traceability enforcement)</li><li>EVIDENCE_AUDIT_AGENT (integrity validation)</li><li>CONDUCTOR_AGENT (transition gating)</li></ul><p>6.1.4 Approval &amp; Override Model</p><p>Where policy allows override:</p><p>Override must require Attorney role</p><ul><li>Override must require structured reason entry</li><li>Override must produce audit artifact</li><li>Override must not alter historical audit trail</li></ul><p>6.1.5 Event-Driven Enforcement Rule</p><p>All significant workflow events must emit structured event hooks:</p><p>OnUploadSessionCompleted</p><ul><li>OnProcessingCompleted</li><li>OnMappingCompleted</li><li>OnDepositionProcessingCompleted</li><li>OnPrePublishExportRequested</li><li>OnApprovalRecorded</li><li>OnBlockingConditionTriggered</li></ul><p>Event hooks may enqueue deterministic agents such as:</p><p>EVIDENCE_AUDIT_AGENT</p><ul><li>CONDUCTOR_AGENT</li></ul><hr/><h3 id="canonical-workflow-states">Canonical Workflow States</h3><p>Workflow states are explicit and case-scoped. The platform must maintain:</p><p>workflow_state</p><ul><li>workflow_step</li><li>step_state (Not Started, In Progress, Blocked, Ready for Review, Approved, Complete)</li><li>blocking_reasons (structured list)</li><li>pending_approvals (structured list)</li><li>last_transition_timestamp</li></ul><hr/><h3 id="workflow-step-definitions-authoritative">Workflow Step Definitions (Authoritative)</h3><h4 id="step-1-client-contact-entry">STEP 1 — CLIENT CONTACT / ENTRY</h4><p>Primary Purpose</p><p>Client initiates contact via web application or phone.</p><p>Entry Conditions</p><ul><li>None</li><li>Actions</li><li>Presentation Layer captures baseline contact information</li><li>Application/API Layer creates a lead record (case not yet active and considered lead until firm accepts client case)</li><li>If phone intake, staff may create lead record via portal</li></ul><p>Required Outputs</p><ul><li>Lead record</li><li>Activation token (time-bound, single-use)</li><li>Terms of Use acceptance record (pending)</li><li>Audit events:</li><li>LeadCreated</li><li>ActivationLinkIssued</li></ul><p>Blocking Conditions</p><p>Activation link not used</p><ul><li>Terms of Use not accepted</li><li>Email verification not completed</li><li>Activation token expired</li></ul><p>Exit Conditions</p><ul><li>Client activates account using secure token</li><li>Client successfully authenticates</li><li>Client explicitly accepts Terms of Use and Privacy Policy</li><li>Terms acceptance is recorded as immutable audit artifact</li><li>Client account status = Active</li><li>Workflow state eligible for STEP 2 (INTERVIEW_INTAKE_AGENT invocation)</li></ul><p>Event Hooks</p><p>OnAccountActivated → enable INTERVIEW_INTAKE_AGENT scheduling</p><ul><li>OnTermsAccepted → record legal acceptance artifact</li></ul><hr/><h4 id="2-intake-interview-and-case-perspective">2 — INTAKE INTERVIEW AND CASE PERSPECTIVE</h4><p>Primary Purpose</p><p>Establish a structured, client-approved Case Perspective through a guided intake interview. This step converts a verified account into an authoritative case narrative suitable for firm review and downstream processing.</p><p>Agents Invoked</p><p>INTERVIEW_INTAKE_AGENT</p><p>Entry Conditions</p><p>Client account is activated</p><ul><li>Client has authenticated successfully</li><li>Terms of Use and Privacy Policy acceptance recorded (immutable artifact)</li><li>Lead record converted to Active Case (pre-intake state)</li><li>No unresolved compliance block from STEP 1</li></ul><p>Step State Model (Authoritative)</p><p>The platform must maintain explicit step_state values for STEP 2:</p><p>Not Started</p><ul><li>In Progress</li><li>Paused (Client Resume Required)</li><li>Blocked (Policy/Compliance Block)</li><li>Ready for Validation</li><li>Complete (Client Approved)</li></ul><p>Paused is not considered Blocked unless a configured policy threshold is exceeded.</p><p>Actions</p><p>Initiate guided intake interview session</p><ul><li>Provide interview coaching and structured question framing</li><li>Ask structured and clarifying questions until deep case understanding is achieved</li><li>Detect ambiguity, contradiction, or incomplete narrative and resolve via follow-up questioning</li><li>Persist interview responses incrementally (no data loss on session interruption)</li><li>Allow session pause and resume without loss of prior responses</li><li>Play back the client story in structured format</li><li>Generate Case Perspective summary artifact (proposed version)</li><li>Present summary for client review</li><li>Capture explicit client approval or correction</li><li>Record preliminary complaint/COA status (existing vs create)</li><li>Update dashboard status</li></ul><p>Required Outputs</p><p>Versioned Case Perspective artifact (Proposed → Approved)</p><ul><li>Intake transcript artifact (if audio/video used)</li><li>Client validation approval record</li><li>Initial issue tagging artifact (case-scoped)</li><li>Complaint/COA status flag</li><li>Audit events:</li><li>InterviewStarted</li><li>InterviewPaused</li><li>InterviewResumed</li><li>CasePerspectiveProposed</li><li>CasePerspectiveApproved (by client)</li><li>CasePerspectiveRevisionRequested (by client)</li><li>CasePerspectiveRevised</li></ul><p>Paused Conditions (Expected Behavior; Not Blocking by Default)</p><p>The step transitions to Paused (Client Resume Required) when:</p><p>Client exits interview before completion</p><ul><li>Client schedules follow-up session</li><li>Client indicates need to gather additional information</li><li>Client session times out due to inactivity (policy-defined session timeout)</li></ul><p>System Requirements:</p><p>Persist all responses prior to pause</p><ul><li>Create Task: “Resume Interview” assigned to Client (due date policy-defined)</li><li>Optional notification to Staff/Paralegal (policy-controlled)</li><li>Allow seamless resume without data loss</li></ul><p><strong>Actions:</strong> ensure the loop is explicit:</p><ul><li>Present summary for client review</li><li>Capture explicit client approval OR revision request</li><li>If revision requested, return to clarification loop and regenerate proposed version</li></ul><p>Blocking Conditions (True Blocking State)</p><p>STEP 2 transitions to Blocked only when:</p><p>Client fails to resume interview within policy-defined time window (e.g., 7/14/30 days)</p><ul><li>Client refuses required acknowledgments needed to proceed (if configured)</li><li>Client provides materially inconsistent responses and refuses clarification</li><li>Required minimum intake fields (policy-defined) remain incomplete</li><li>Compliance or identity verification failure detected</li></ul><p>Blocked state requires human disposition:</p><p>Extend deadline</p><ul><li>Close lead/case</li><li>Override block (if permitted by role)</li></ul><p>Exit Conditions</p><p>STEP 2 is considered Complete only when:</p><p>Interview fully completed</p><ul><li>Case Perspective artifact generated</li><li>Client explicitly approves Case Perspective</li><li>Case Perspective marked Authoritative</li><li>No unresolved ambiguity flags remain (or flagged for review without blocking)</li></ul><p>Workflow progression to STEP 3 (ONBOARD_AGENT) is permitted only after Case Perspective approval</p><hr/><p>Event Hooks</p><p>OnInterviewStarted → log audit event</p><ul><li>OnInterviewPaused → create Resume Interview Task</li><li>OnInterviewResumed → continue STEP 2</li><li>OnCasePerspectiveApproved → enable ONBOARD_AGENT invocation eligibility</li><li>OnInterviewTimeoutExpired → set STEP 2 to Blocked and create Disposition Task</li></ul><hr/><p>Governance Rules</p><ul><li>INTERVIEW_INTAKE_AGENT cannot access legal research</li><li>INTERVIEW_INTAKE_AGENT cannot parse legal meaning from uploaded files</li><li>INTERVIEW_INTAKE_AGENT cannot finalize case acceptance</li><li>Case Perspective becomes authoritative only after explicit client approval</li><li>All transitions must be audit logged with correlation identifier</li></ul><hr/><h4 id="step-3-firm-triage-coi-acceptance-routing">STEP 3 — FIRM TRIAGE / COI / ACCEPTANCE ROUTING</h4><p>Agent Invoked</p><ul><li>ONBOARD_AGENT</li><li>Entry Conditions</li><li>Client-approved Case Perspective exists</li><li>Actions</li><li>Conduct COI screening</li><li>Perform fit triage</li><li>Estimate projected case value</li><li>Generate recommendation to Partners</li><li>Route for acceptance or rejection</li><li>Apply system acceptance/rejection rules</li><li>Update dashboard status</li></ul><p>Required Outputs</p><ul><li>Conflict check artifact</li><li>Fit triage artifact</li><li>Advisory case value estimate artifact</li><li>Routing recommendation record</li><li>Audit events: COICheckCompleted, CaseRoutedForDecision</li></ul><p>Blocking Conditions</p><ul><li>COI detected</li><li>Partner confirmation missing</li></ul><p>Exit Conditions</p><ul><li>Partner acceptance decision recorded OR rejection recorded</li></ul><p>Event Hooks</p><ul><li>OnCaseAccepted → enable file intake and processing eligibility</li><li>OnCaseRejected → lock case to read-only and close workflow</li></ul><hr/><h4 id="step-4-file-upload-session-and-authoritative-file-set">STEP 4 — FILE UPLOAD SESSION AND AUTHORITATIVE FILE SET</h4><p>Agent Invoked</p><ul><li>FILE_INTAKE_AGENT</li></ul><p>Entry Conditions</p><ul><li>Case accepted by Partner</li><li>Client portal access active</li></ul><p>Actions</p><ul><li>Invite client to upload files (accepted file types only)</li><li>Track upload session (client may use multiple upload sessions)</li><li>Detect duplicates using file metadata, hashes, and sample content</li><li>Establish authoritative file set</li><li>Flag conflicting versions and track discrepancy corrections</li><li>Require client validation of session completion</li><li>Initiate PROCESSING_AGENT eligibility</li><li>Update dashboard status</li></ul><p>Required Outputs</p><ul><li>Upload session record</li><li>Authoritative file set artifact</li><li>Duplicate/conflict report artifact</li><li>Audit events: UploadSessionStarted, FileUploaded, UploadSessionCompleted, AuthoritativeSetConfirmed</li></ul><p>Blocking Conditions</p><ul><li>Upload session not client-confirmed complete</li><li>Conflicting file versions unresolved (policy controlled)</li></ul><p>Exit Conditions</p><ul><li>Authoritative file set exists and upload session is client-confirmed complete</li></ul><p>Event Hooks</p><ul><li>OnUploadSessionCompleted → enqueue EVIDENCE_AUDIT_AGENT run (EvidenceAuditJob)</li><li>OnUploadSessionCompleted → enqueue PROCESSING_AGENT job</li></ul><hr/><h4 id="step-5-processing-and-database-population">STEP 5 — PROCESSING AND DATABASE POPULATION</h4><p>Primary Purpose</p><p>Transform authoritative uploaded materials into a structured, case-scoped system of record. Apply the client-approved Case Perspective as a contextual interpretation schema to guide decomposition, tagging, entity resolution, and mapping readiness — without altering source evidence or inferring legal conclusions.</p><p>Agent Invoked</p><p>PROCESSING_AGENT</p><p>Entry Conditions</p><p>Client-approved Case Perspective artifact exists and is marked Authoritative</p><ul><li>Case accepted by Partner (STEP 3 Complete)</li><li>Authoritative file set confirmed (STEP 4 Complete)</li><li>No compliance or security block active</li></ul><p>Core Processing Model (Authoritative Rule)</p><p>The Case Perspective functions as a contextual interpretation schema and must be applied during processing to:</p><p>Provide entity resolution scaffolding (e.g., Person ↔ Entity ↔ Role relationships)</p><ul><li>Provide contextual narrative framing for interpreting unstructured communications</li><li>Provide tagging guidance aligned to alleged facts and preliminary COA posture</li><li>Provide relationship metadata used to connect extracted data to case constructs</li></ul><p>The Case Perspective:</p><p>May influence tagging, relationship inference suggestions, and confidence scoring</p><ul><li>May not alter raw source content</li><li>May not overwrite or reinterpret original evidence</li><li>May not infer legal conclusions</li><li>Must preserve full traceability between extracted data and source material</li></ul><p>All perspective-informed tagging must be traceable, reversible, and auditable.</p><p>Actions</p><p>Ingest authoritative file set</p><ul><li>Perform OCR, speech-to-text, and table extraction via Integration Layer</li><li>Normalize file formats and preserve originals</li><li>Extract entities (people, entities, roles, dates, locations, monetary values, communications metadata)</li></ul><p>Populate TEXT_VAULT for each authoritative file by storing extracted raw text as immutable, versioned content</p><ul><li>If raw text exceeds policy-defined thresholds, chunk the content into ordered segments</li><li>Assign each segment a CHUNK_ID and maintain an ordered sequence index so the web application can reconstruct the full file</li><li>Store chunk provenance linking:</li><li>source_file_id</li><li>source_file_hash</li><li>extraction_run_id</li><li>tool_version metadata</li><li>Support chunk-level tagging and referencing so evidence, facts, and mappings can point to:</li><li>a specific CHUNK_ID</li><li>and a specific location within the chunk (policy-defined addressing method)</li></ul><p>Apply Case Perspective contextual schema to:</p><ul><li>Resolve entity relationships (i.e. Person A connected to Entity X as Role T)</li><li>Suggest linkage of communications to contextual roles</li><li>Inform tagging candidates for evidence and fact classification</li><li>Assign canonical IDs and cryptographic hashes to all extracted objects</li><li>Generate structured fact records without altering source material</li><li>Identify potential contradictions between extracted content and Case Perspective</li><li>Identify ambiguous entities requiring human confirmation</li><li>Flag incomplete data or missing referenced artifacts</li><li>Populate case database instance</li><li>Log ingestion integrity and provenance metadata</li><li>Update dashboard status</li></ul><p>Required Outputs</p><p>Structured evidence records (case-scoped database entries)</p><ul><li>Entity registry artifact (canonicalized and hashed)</li><li>Perspective-aware tagging suggestions artifact</li><li>Parsed text artifacts (versioned, immutable)</li><li>Table extraction artifacts (versioned)</li><li>Ingestion integrity log artifact</li><li>Discrepancy and ambiguity report artifact</li></ul><p>TEXT_VAULT record(s) per file (versioned, immutable)</p><ul><li>TEXT_CHUNK record set(s) where chunking is required, including:</li><li>CHUNK_ID</li><li>file_id (or equivalent authoritative file key)</li><li>chunk_sequence_number</li><li>chunk_text</li><li>chunk_hash</li><li>chunk_start_offset and chunk_end_offset (or equivalent locator)</li><li>extraction_run_id / provenance metadata</li><li>Chunk reconstruction contract sufficient for UI:</li><li>Retrieve chunks by file_id ordered by chunk_sequence_number</li><li>Render full document by concatenation without loss</li></ul><p>Audit events:</p><ul><li>ProcessingStarted</li><li>FileParsed</li><li>EntityExtracted</li><li>PerspectiveContextApplied</li><li>ProcessingCompleted</li><li>TextVaultIngestionCompleted</li><li>ChunkIntegrityRegistered</li></ul><p>Decision Points</p><p>If extracted content conflicts with Case Perspective:</p><ul><li>Do not modify evidence</li><li>Flag contradiction</li><li>Generate structured discrepancy artifact</li><li>Create Issue (policy controlled)</li><li>If entity relationship unclear:</li><li>Mark entity as unresolved</li><li>Create human review task</li></ul><p>If required extraction output missing:</p><ul><li>Mark STEP 5 as Blocked (policy controlled)</li></ul><p>Blocking Conditions</p><p>Processing failure</p><ul><li>Required structured outputs missing</li><li>Ingestion integrity check failure</li><li>Critical entity resolution unresolved (policy-defined threshold)</li></ul><p>Exit Conditions</p><p>STEP 5 is Complete when:</p><p>Structured database populated</p><ul><li>Canonical IDs and hashes assigned</li><li>All extracted artifacts versioned and immutable</li><li>Discrepancies logged</li><li>No critical extraction failures remain</li></ul><p>Workflow eligible to proceed to STEP 6 (PLEADING) and STEP 7 (MAPPING).</p><p>Event Hooks</p><p>OnProcessingCompleted → enqueue EVIDENCE_AUDIT_AGENT (EvidenceAuditJob)</p><ul><li>OnCriticalExtractionFailure → create Blocking Issue</li><li>OnContradictionDetected → create Issue (policy controlled)</li></ul><p>Governance Rules</p><p>PROCESSING_AGENT is non-advocacy</p><ul><li>PROCESSING_AGENT cannot alter Case Perspective</li><li>PROCESSING_AGENT cannot infer legal conclusions</li><li>All contextual interpretation must be transparent and auditable</li><li>All outputs must preserve provenance to original file and page/line reference</li></ul><hr/><h4 id="step-6-pleadings-and-coa-drafting">STEP 6 — PLEADINGS AND COA DRAFTING</h4><p>Agents Invoked</p><ul><li>PLEADING_AGENT</li><li>COMPLAINT_AGENT (if Plaintiff complaint required)</li><li>COA_AGENT (if COA creation/revision required)</li><li>RESPONSE_AGENT (if Defendant response required)</li></ul><p>Entry Conditions</p><ul><li>Case database populated</li><li>Complaint/COA status known (existing vs create)</li></ul><p>Actions</p><ul><li>Ingest existing complaint/COA files if present</li><li>Draft or propose complaint/COA if “create” or revision required</li><li>Structure allegations using templates</li><li>Confirm legal elements present (structural completeness)</li><li>If legal research required: request Attorney Directive and access through Integration Layer only</li><li>Notify attorney for review</li><li>Update dashboard status</li></ul><p>Required Outputs</p><ul><li>Versioned pleadings draft artifacts</li><li>Versioned COA artifact</li><li>Element completeness report artifact</li><li>Audit events: PleadingDraftCreated, COADraftCreated, DirectiveRequested (if applicable)</li></ul><p>Blocking Conditions</p><ul><li>Attorney approval required prior to publish/export</li><li>Missing elements detected (policy controlled)</li></ul><p>Exit Conditions</p><ul><li>Pleadings/COA drafted and ready for attorney review (or approved)</li></ul><p>Event Hooks</p><ul><li>OnPleadingDraftCompleted → enqueue EVIDENCE_AUDIT_AGENT run (EvidenceAuditJob) (policy controlled)</li></ul><hr/><h4 id="step-7-mapping-and-traceability">STEP 7 — MAPPING AND TRACEABILITY</h4><p>Agent Invoked</p><ul><li>MAPPING_AGENT</li></ul><p>Entry Conditions</p><ul><li>Pleadings/COA artifact exists (draft or approved)</li><li>Structured evidence records exist</li><li>Actions</li><li>Map people, documents, evidence, and facts</li><li>Link each to complaint allegations and COA elements</li><li>Verify evidentiary support for each element</li><li>Ensure traceability from fact → evidence → pleading</li><li>If legal research required: request Attorney Directive and access through Integration Layer only</li><li>Notify attorney for review</li><li>Update dashboard status</li></ul><p>Required Outputs</p><ul><li>Mapping artifact</li><li>Traceability matrix artifact</li><li>Audit events: MappingCompleted, DirectiveRequested (if applicable)</li></ul><p>Blocking Conditions</p><ul><li>Mapping incomplete for required allegations/elements (policy controlled)</li></ul><p>Exit Conditions</p><ul><li>Mapping artifact exists and required coverage meets configured thresholds</li></ul><p>Event Hooks</p><ul><li>OnMappingCompleted → enqueue EVIDENCE_AUDIT_AGENT run (EvidenceAuditJob)</li></ul><hr/><h4 id="step-7a-case-integrity-smoke-test-non-destructive">STEP 7A — CASE INTEGRITY “SMOKE TEST” (NON-DESTRUCTIVE)</h4><p>Agent Invoked</p><ul><li>EVIDENCE_AUDIT_AGENT</li></ul><p>Entry Conditions</p><ul><li>Triggered by schedule or event hook</li><li>Case has at least one of: authoritative uploads, processing outputs, pleadings/COA, mapping</li></ul><p>Actions</p><ul><li>Validate completeness and traceability across Case Perspective, authoritative uploads, pleadings/COA, mapping, discovery artifacts, deposition artifacts, subpoena artifacts, trial prep artifacts</li><li>Identify missing required artifacts for current workflow state</li><li>Identify orphan artifacts not mapped to allegations/COA</li><li>Identify COA elements lacking evidentiary support</li><li>Identify contradictions between Case Perspective and evidence, and across evidence sources</li><li>Create Issues and Tasks (policy controlled) assigned to responsible parties with due dates and recommended dispositions</li><li>Produce evidence_audit_report artifact</li><li>Does not modify pleadings, mapping, Case Perspective, or COA taxonomy</li><li>Does not advance workflow automatically</li></ul><p>Required Outputs</p><ul><li>evidence_audit_report artifact (versioned)</li><li>Issue/Task records (policy controlled)</li><li>Audit events: EvidenceAuditCompleted</li></ul><p>Blocking Conditions</p><ul><li>None intrinsically; blocking effect is policy-controlled</li></ul><p>Exit Conditions</p><ul><li>evidence_audit_report generated and linked to current workflow stage snapshot</li></ul><hr/><h3 id="optional-conditional-workflow-steps-invoked-as-needed">OPTIONAL / CONDITIONAL WORKFLOW STEPS (INVOKED AS NEEDED)</h3><p>These steps may be executed out of sequence or not at all depending on case posture, jurisdiction, and litigation strategy. They rely on the structured case record produced by STEPS 1–7.</p><p>All steps in this section must comply with:</p><ul><li>Workflow Modeling Rule</li><li>Human Oversight &amp; Attorney Control</li><li>Dashboard Update Contract</li><li>Deterministic vs Non-Deterministic enforcement boundaries</li></ul><p>No step in this section may advance workflow stage or publish/export without CONDUCTOR_AGENT readiness validation where policy requires.</p><hr/><h4 id="step-8-interrogatories">STEP 8 — INTERROGATORIES</h4><p>Agents Invoked</p><p>INTERROGATORY_AGENT</p><ul><li>OBJECTION_LIBRARY_AGENT (Directive-gated where required)</li><li>EVIDENCE_AUDIT_AGENT (event-triggered)</li><li>CONDUCTOR_AGENT (gating where applicable)</li></ul><hr/><h4 id="entry-conditions">Entry Conditions</h4><p>Mapping artifact exists (STEP 7 complete or sufficiently populated)</p><ul><li>Relevant COA elements exist</li><li>Structured evidence inventory populated</li><li>No blocking condition preventing discovery drafting</li></ul><hr/><h4 id="actions">Actions</h4><p>Review database for existing interrogatories</p><ul><li>Draft interrogatories aligned to:</li><li>COA elements</li><li>Evidence gaps</li><li>Contradictions identified by EVIDENCE_AUDIT_AGENT</li><li>Ensure specificity and procedural compliance</li><li>Suggest objection language where appropriate</li><li>Prevent waiver of rights</li><li>Update interrogatory mapping to COA and evidence</li><li>If jurisdiction-specific rule validation required:</li><li>Request Attorney Directive</li><li>Access OBJECTION_LIBRARY_AGENT via Integration Layer</li><li>Notify Attorney for review</li><li>Update dashboard state</li></ul><hr/><h4 id="required-outputs">Required Outputs</h4><p>Versioned interrogatory artifact</p><ul><li>Interrogatory-to-COA mapping artifact</li><li>Objection suggestion artifact (if used)</li><li>Audit events:</li><li>InterrogatoryDraftCreated</li><li>InterrogatoryDirectiveRequested (if applicable)</li><li>InterrogatoryReviewRequired</li></ul><hr/><h4 id="blocking-conditions">Blocking Conditions</h4><p>Required COA mapping incomplete (policy-defined threshold)</p><ul><li>Attorney approval required prior to service</li><li>Jurisdiction rule validation missing (if configured)</li></ul><hr/><h4 id="exit-conditions">Exit Conditions</h4><ul><li>Interrogatories drafted and ready for Attorney review</li><li>If publish/export requested → CONDUCTOR_AGENT validation required</li></ul><hr/><h4 id="event-hooks">Event Hooks</h4><p>OnInterrogatoryDraftCompleted → enqueue EVIDENCE_AUDIT_AGENT</p><ul><li>OnPrePublishExportRequested → invoke CONDUCTOR_AGENT</li></ul><hr/><h4 id="step-9-deposition-prep">STEP 9 — DEPOSITION PREP</h4><p>Agents Invoked</p><p>DEPOSITION_PREP_AGENT</p><ul><li>WITNESS_TRACKING_AGENT</li><li>OBJECTION_LIBRARY_AGENT (Directive-gated)</li><li>EVIDENCE_AUDIT_AGENT</li><li>CONDUCTOR_AGENT</li></ul><hr/><h4 id="entry-conditions-2">Entry Conditions</h4><p>Pleadings and COA artifacts exist</p><ul><li>Mapping artifact exists</li><li>Relevant witnesses identified</li></ul><hr/><h4 id="actions-2">Actions</h4><p>Determine whether deposition materials already exist</p><ul><li>Build structured deposition outline:</li><li>Key inquiry areas</li><li>Exhibits</li><li>Admission targets</li><li>Statements to confirm or challenge</li><li>Anticipated objections</li><li>Prioritize and sequence depositions</li><li>Link documents and evidence directly into deposition workspace</li><li>Update witness profiles via WITNESS_TRACKING_AGENT</li><li>If admissibility research required:</li><li>Request Attorney Directive</li><li>Access OBJECTION_LIBRARY_AGENT</li><li>Notify Attorney for review</li><li>Update dashboard state</li></ul><hr/><h4 id="required-outputs-2">Required Outputs</h4><p>Versioned deposition outline artifact</p><ul><li>Exhibit linkage artifact</li><li>Deposition sequencing recommendation artifact</li><li>Witness profile updates</li><li>Audit events:</li><li>DepositionOutlineCreated</li><li>DepositionReviewRequired</li></ul><hr/><h4 id="blocking-conditions-2">Blocking Conditions</h4><p>Required evidence mapping incomplete (policy-defined threshold)</p><ul><li>Attorney approval required before formal use</li></ul><hr/><h4 id="exit-conditions-2">Exit Conditions</h4><p>Deposition outline ready for Attorney review</p><ul><li>If publish/export requested → CONDUCTOR_AGENT validation required</li></ul><hr/><h4 id="event-hooks-2">Event Hooks</h4><p>OnDepositionOutlineCompleted → enqueue EVIDENCE_AUDIT_AGENT</p><ul><li>OnPrePublishExportRequested → invoke CONDUCTOR_AGENT</li></ul><hr/><h4 id="step-10-deposition-processing">STEP 10 — DEPOSITION PROCESSING</h4><p>Agents Invoked</p><p>DEPOSITION_PROCESSING_AGENT</p><ul><li>TIMELINE_AGENT</li><li>EVIDENCE_CORRELATION_AGENT</li><li>EVIDENCE_AUDIT_AGENT</li><li>OPPOSITION_AGENT (optional; advisory)</li><li>CONDUCTOR_AGENT</li></ul><hr/><p>Entry Conditions</p><ul><li>Deposition audio/video available</li><li>Media ingested via FILE_INTAKE_AGENT</li><li>Structured case record exists</li></ul><hr/><h4 id="actions-3">Actions</h4><p>Generate transcript via STT (Integration Layer mediated)</p><ul><li>Chunk transcript and store in TEXT_VAULT (if required)</li><li>Apply semantically labeled time markers</li><li>Connect testimony to:</li><li>Complaint allegations</li><li>COA elements</li><li>Identify contradictions and inconsistencies</li><li>Identify key admissions</li><li>Identify evidence supportive or damaging to client case</li><li>Perform cross-deposition comparisons</li><li>Update event chronology via TIMELINE_AGENT</li><li>Identify cross-document patterns via EVIDENCE_CORRELATION_AGENT</li><li>Generate summaries and issue-based breakdowns</li><li>Prepare designation recommendations</li><li>Notify Attorney for review</li><li>Update dashboard state</li></ul><hr/><ul><li>Required Outputs</li><li>Versioned deposition transcript artifact</li><li>Time-marker index artifact</li><li>Contradiction report artifact</li><li>Issue-based breakdown artifact</li><li>Designation recommendation artifact</li><li>Updated timeline artifact</li><li>Audit events:</li><li>DepositionProcessingStarted</li><li>DepositionProcessingCompleted</li></ul><hr/><h4 id="blocking-conditions-3">Blocking Conditions</h4><p>Transcript generation failure</p><ul><li>Critical ingestion integrity failure</li><li>Attorney approval required before formal designation export</li></ul><hr/><h4 id="exit-conditions-3">Exit Conditions</h4><p>Transcript and structured outputs generated</p><ul><li>Advisory outputs available for Attorney review</li></ul><hr/><h4 id="event-hooks-3">Event Hooks</h4><p>OnDepositionProcessingCompleted → enqueue EVIDENCE_AUDIT_AGENT</p><ul><li>OnPrePublishExportRequested → invoke CONDUCTOR_AGENT</li></ul><hr/><h4 id="step-11-subpoenas">STEP 11 — SUBPOENAS</h4><p>Agents Invoked</p><p>SUBPOENA_AGENT</p><ul><li>EVIDENCE_AUDIT_AGENT</li><li>CONDUCTOR_AGENT</li></ul><hr/><h4 id="entry-conditions-3">Entry Conditions</h4><p>Evidence gaps identified (from Mapping or Evidence Audit)</p><ul><li>COA elements requiring additional support identified</li></ul><hr/><p>Actions</p><ul><li>Detect missing evidence/facts</li><li>Identify source of missing information</li><li>Determine appropriate subpoena type</li><li>Generate list of subpoena targets</li><li>Specify documents/information requested</li><li>Draft subpoena language</li><li>If rule validation required:</li><li>Request Attorney Directive</li><li>Validate via Integration Layer</li><li>Notify Attorney for review</li><li>Update dashboard state</li></ul><hr/><h4 id="required-outputs-3">Required Outputs</h4><p>Versioned subpoena package artifact</p><ul><li>Evidence gap justification artifact</li><li>Audit events:</li><li>SubpoenaDraftCreated</li><li>SubpoenaReviewRequired</li></ul><hr/><h4 id="blocking-conditions-4">Blocking Conditions</h4><p>Attorney approval required prior to service</p><ul><li>Required mapping evidence not identified</li></ul><hr/><h4 id="exit-conditions-4">Exit Conditions</h4><p>Subpoena package ready for Attorney review</p><ul><li>If publish/export requested → CONDUCTOR_AGENT validation required</li></ul><hr/><h4 id="event-hooks-4">Event Hooks</h4><p>OnSubpoenaDraftCompleted → enqueue EVIDENCE_AUDIT_AGENT</p><ul><li>OnPrePublishExportRequested → invoke CONDUCTOR_AGENT</li></ul><hr/><h4 id="step-12-trial-prep">STEP 12 — TRIAL PREP</h4><p>Agents Invoked</p><p>TRIAL_AGENT</p><ul><li>TRIAL_CALENDAR_AGENT</li><li>OPPOSITION_AGENT</li><li>OUTCOME_MODEL_AGENT (optional; advisory)</li><li>EVIDENCE_AUDIT_AGENT</li><li>CONDUCTOR_AGENT</li></ul><hr/><h4 id="entry-conditions-4">Entry Conditions</h4><p>Structured case record sufficiently complete</p><p>• Discovery and deposition artifacts available (if applicable)</p><p>• No unresolved blocking issues preventing trial preparation</p><hr/><p>Actions</p><p>Consume full structured case database</p><ul><li>Propose trial strategy and execution roadmap</li><li>Anticipate defense strategies</li><li>Identify weaknesses and mitigation strategies</li><li>Align depositions/interrogatories/discovery for admissible trial use</li><li>Update event chronology via TIMELINE_AGENT (if needed)</li><li>Update trial calendar milestones</li><li>Run adversarial review via OPPOSITION_AGENT (advisory)</li><li>Optionally run OUTCOME_MODEL_AGENT (advisory only)</li><li>Notify Attorney for review</li><li>Update dashboard state</li></ul><hr/><p>Required Outputs</p><p>Trial strategy artifact (advisory)</p><ul><li>Trial execution roadmap artifact</li><li>Risk and mitigation report artifact</li><li>Updated trial calendar artifact</li><li>Advisory opposition exposure report (if invoked)</li><li>Audit events:</li><li>TrialStrategyGenerated</li><li>TrialReviewRequired</li></ul><hr/><h4 id="blocking-conditions-5">Blocking Conditions</h4><p>Attorney approval required before publish/export of trial materials</p><ul><li>Required evidence coverage incomplete (policy-defined threshold)</li><li>Evidence audit not current (if policy requires gating)</li></ul><hr/><h4 id="exit-conditions-5">Exit Conditions</h4><p>Trial preparation artifacts generated</p><ul><li>Advisory outputs reviewed by Attorney</li><li>Publish/export readiness validated via CONDUCTOR_AGENT</li></ul><hr/><h4 id="event-hooks-5">Event Hooks</h4><p>OnTrialPrepCompleted → enqueue EVIDENCE_AUDIT_AGENT</p><ul><li>OnPrePublishExportRequested → invoke CONDUCTOR_AGENT</li></ul><hr/><h3 id="workflow-governance-readiness-and-publishexport-gating">Workflow Governance (Readiness and Publish/Export Gating)</h3><p>Readiness Governance Agent</p><ul><li>CONDUCTOR_AGENT</li></ul><p>Rule</p><p>Before any major workflow transition that is policy-gated — and before any Publish/Export action — the CONDUCTOR_AGENT must evaluate readiness.</p><p>Minimum Readiness Checks</p><ul><li>Required artifacts exist for the requested transition</li><li>Required approvals are recorded</li><li>Blocking issues resolved OR explicit attorney override recorded</li><li>If policy requires: most recent evidence_audit_report is current and successful</li></ul><p>Outputs</p><p>• conductor_readiness_report artifact</p><p>• Allow or block decision with structured reasons</p><h3 id="failure-taxonomy-hard-deterministic-handling-required">Failure Taxonomy (Hard) — Deterministic Handling Required</h3><p>All failures must be classified into one of the categories below, and handling must follow the rules.</p><h4 id="a-blocking-integrity-failures-no-retry-without-change">A) Blocking Integrity Failures (No Retry Without Change)</h4><p><strong>Examples:</strong> missing required artifact, failed schema validation, case isolation violation, evidence trace missing, unauthorized operation.</p><p><strong>Handling:</strong> create Issue (Blocking), halt transition/publish, require human remediation or override.</p><h4 id="b-transient-operational-failures-retry-allowed">B) Transient Operational Failures (Retry Allowed)</h4><p><strong>Examples:</strong> tool provider timeout, temporary network failure, rate limiting.</p><p><strong>Handling:</strong> automatic retry with backoff; max retry count; log each attempt; if exceeded, create Issue (Non-Blocking or Blocking based on policy).</p><h4 id="c-non-determinism-violations-hard-stop">C) Non-Determinism Violations (Hard Stop)</h4><p><strong>Examples:</strong> deterministic job executed with unpinned model/tool version; prompt drift detected; inputs not hashable.</p><p><strong>Handling:</strong> hard fail; create Blocking Issue; do not emit authoritative artifact.</p><h4 id="d-partial-completion-compensation">D) Partial Completion / Compensation</h4><p>If an operation produces partial outputs, the system must:</p><p>mark outputs as partial in metadata</p><p>prevent readiness transition that depends on them</p><p>emit audit events that show partial state and remediation path</p><h3 id="workflow-modeling-rules">Workflow Modeling Rules</h3><p>Intelligence Scaling Rule</p><p>Workflow stages must operate on case-scoped Data and Information layers.</p><p>Knowledge and Wisdom layers may provide advisory insights but cannot auto-advance workflow stages unless explicitly permitted by policy and recorded in audit logs.</p><p>Purpose</p><p>Workflow defines the ordered execution of case lifecycle stages.</p><p>Workflow must remain:</p><ul><li>Deterministic where required</li><li>Case-scoped</li><li>Audit-bound</li><li>Governed by explicit transition rules</li><li>Independent from cross-case intelligence mutation</li></ul><p>Workflow is not advisory logic.</p><p>Workflow governs execution authority.</p><h4 id="stage-definition-rule">Stage Definition Rule</h4><p>Each workflow stage must define:</p><p>Entry Conditions</p><ul><li>Actions</li><li>Required Outputs (Artifacts)</li><li>Exit Conditions</li><li>Blocking Conditions</li><li>Audit Events</li></ul><p>A stage is incomplete unless all six are defined.</p><p>No stage may implicitly assume completion of prior logic.</p><h4 id="stage-transition-rule">Stage Transition Rule</h4><p>A workflow stage may transition only when:</p><p>All Required Outputs exist</p><ul><li>All Blocking Conditions are resolved</li><li>Required approvals are recorded</li><li>CONDUCTOR_AGENT readiness validation (if configured) is satisfied</li></ul><p>No agent may auto-advance workflow without explicit transition authority.</p><h4 id="case-scoped-authority-rule">Case-Scoped Authority Rule</h4><p>Workflow operates strictly on:</p><p>Case-scoped Data</p><ul><li>Case-scoped Information</li><li>Approved Case Perspective</li></ul><p>Knowledge layer outputs are advisory unless explicitly authorized.</p><p>Cross-case knowledge may inform reasoning but cannot alter workflow state directly.</p><h4 id="deterministic-vs-non-deterministic-boundary-rule">Deterministic vs Non-Deterministic Boundary Rule</h4><p>Workflow gating stages must rely on deterministic validation where possible.</p><p>Non-deterministic agents (e.g., INTERVIEW_INTAKE_AGENT questioning logic, OPPOSITION_AGENT exposure analysis) may:</p><p>Propose</p><ul><li>Flag</li><li>Recommend</li></ul><p>They may not:</p><p>Modify stage completion state</p><ul><li>Override required artifacts</li><li>Advance workflow automatically</li></ul><p>Deterministic agents responsible for gating (e.g., EVIDENCE_AUDIT_AGENT, CONDUCTOR_AGENT) must:</p><p>Produce reproducible outputs</p><ul><li>Use version-pinned tools/models</li><li>Emit auditable validation reports</li></ul><h4 id="idempotency-rule">Idempotency Rule</h4><p>Each stage must be:</p><p>Re-runnable</p><ul><li>Idempotent</li><li>Versioned</li></ul><p>Re-running a stage must:</p><p>Produce a new artifact version</p><ul><li>Preserve prior versions</li><li>Not overwrite prior audit history</li></ul><hr/><h4 id="partial-completion-rule">Partial Completion Rule</h4><p>Workflow stages may support partial completion where:</p><p>Client interview paused</p><ul><li>File upload incomplete</li><li>Deposition processing interrupted</li></ul><p>Partial state must:</p><p>Persist safely</p><ul><li>Not invalidate prior artifacts</li><li>Resume without duplication</li></ul><p>Incomplete state must be visible in dashboard status.</p><h4 id="artifact-integrity-rule">Artifact Integrity Rule</h4><p>All workflow outputs must produce:</p><p>Versioned artifacts</p><ul><li>Provenance metadata</li><li>Correlation IDs</li><li>Tool/version registry linkage (if applicable)</li></ul><p>Workflow state must reference artifact IDs — not implicit assumptions.</p><h4 id="blocking-conditions-rule">Blocking Conditions Rule</h4><p>Blocking conditions must be explicitly declared.</p><p>Examples:</p><p>Missing client validation</p><ul><li>Unresolved Evidence_Audit critical findings</li><li>Required attorney directive not granted</li><li>Open blocking Issue flagged as “Stage Critical”</li><li>Conductor readiness failure</li></ul><p>Blocking must:</p><p>Prevent publish/export</p><ul><li>Prevent stage advancement</li><li>Emit audit log entry</li></ul><h4 id="external-dependency-resilience-rule">External Dependency Resilience Rule</h4><p>Workflow must tolerate:</p><p>Temporary research API failure</p><ul><li>Temporary tool failure</li><li>Temporary archive unavailability</li></ul><p>Fallback logic must:</p><p>Use cached knowledge where permitted</p><ul><li>Require attorney directive retry if necessary</li><li>Not corrupt workflow state</li></ul><hr/><h4 id="intelligence-containment-rule-dikw-boundary">Intelligence Containment Rule (DIKW Boundary)</h4><p>Workflow execution must operate on:</p><p>Data</p><ul><li>Information</li></ul><p>Knowledge and Wisdom layers:</p><p>May advise</p><ul><li>May flag</li><li>May simulate</li></ul><p>They may not:</p><p>Rewrite artifacts</p><ul><li>Modify case perspective</li><li>Promote cross-case heuristics</li><li>Alter gating requirements</li></ul><p>All cross-case promotion requires explicit governance outside workflow state machine.</p><h4 id="audit-completeness-rule">Audit Completeness Rule</h4><p>Every workflow stage must emit:</p><p>StageEntered</p><ul><li>StageExited</li><li>StageBlocked (if applicable)</li><li>ArtifactCreated</li><li>ApprovalRecorded</li><li>OverrideRecorded (if applicable)</li></ul><p>Audit must be immutable and reconstructable.</p><h4 id="override-rule">Override Rule</h4><p>Attorney override is permitted only when:</p><p>Override is explicitly recorded</p><ul><li>Reason is documented</li><li>Override type is classified</li><li>Audit event is generated</li><li>Impacted artifact IDs are linked</li></ul><p>Overrides must not silently alter stage readiness logic.</p><h4 id="reproducibility-rule">Reproducibility Rule</h4><p>For any historical stage execution, the system must be able to:</p><p>Reconstruct the state</p><ul><li>Identify the artifacts used</li><li>Identify tool/model versions</li><li>Reproduce deterministic outputs</li></ul><p>Workflow must be reproducible under pinned configuration.</p><h4 id="no-implicit-intelligence-mutation-rule">No Implicit Intelligence Mutation Rule</h4><p>Workflow execution must never:</p><p>Mutate heuristic registry</p><ul><li>Promote cross-case knowledge</li><li>Modify DIKW knowledge layer silently</li><li>Update intelligence parameters without versioned artifact creation</li></ul><p>All intelligence mutation must be:</p><p>Versioned</p><ul><li>Audited</li><li>Policy-gated</li></ul><h4 id="stage-independence-rule">Stage Independence Rule</h4><p>Each stage must be independently validatable.</p><p>Later stages may depend on earlier artifacts, but:</p><p>Earlier stage re-runs must not silently invalidate later stage outputs</p><ul><li>Downstream artifacts must declare dependency linkage</li><li>Evidence_Audit must detect stale downstream artifacts</li></ul></section><section><h2 id="data-architecture">DATA ARCHITECTURE</h2><p>This section defines the authoritative data model boundaries, storage domains, and minimum schema contracts required to implement the platform. The data architecture enforces case isolation, versioned artifacts, immutable audit logging, and DIKW layering through separation of authoritative case records from derived knowledge stores.</p><h3 id="data-domains-and-boundaries-authoritative">Data Domains and Boundaries (Authoritative)</h3><p>All data is partitioned into explicit domains. Cross-domain reads/writes are policy-gated and fully audited.</p><p>Case Domain (Authoritative): evidence, facts, mappings, pleadings, discovery, depositions, subpoenas, trial prep, case financial analysis.</p><p>Operational Domain (Firm Operations): users, roles, billing/cost ledgers, budgets/caps, operational metrics, operational finance.</p><p>Derived Knowledge Domain (Rebuildable): sanitized knowledge indices, research cache, pattern registries; advisory only.</p><p>Archive Domain (Closed Cases): read-only by default; may be re-opened via governed workflow.</p><h3 id="tenancy-and-case-isolation-model-authoritative">Tenancy and Case Isolation Model (Authoritative)</h3><p>Case isolation is enforced at multiple layers. Database strategy is implementation-selectable but must satisfy the following constraints.</p><p>All data access requires explicit case scope (case_id) except operational-only endpoints.</p><p>Case-scoped encryption keys are policy-defined (recommended: envelope encryption with per-case DEK).</p><p>Query isolation must be enforced in the data access layer (no cross-case joins unless explicitly authorized).</p><p>Cross-case analytics are prohibited by default and permitted only via governed Knowledge Domain processes.</p><h4 id="approved-physical-storage-strategies">Approved Physical Storage Strategies</h4><p><strong>Option A:</strong> Dedicated Case Database per case_id (strong isolation; higher ops overhead).</p><p><strong>Option B:</strong> Shared Database with strict partitioning by case_id + row-level security + separate encryption scopes.</p><p><strong>Option C:</strong> Hybrid: shared operational DB + case-per-tenant logical schemas/partitions.</p><p>Regardless of option, the platform must implement identical logical schemas and isolation guarantees.</p><h3 id="identifier-and-integrity-requirements-authoritative">Identifier and Integrity Requirements (Authoritative)</h3><p>All stored objects must be addressable, reconstructable, and integrity-protected.</p><p>case_id: stable UUID for all case-scoped objects.</p><p>artifact_id: stable UUID for each artifact instance; artifact_version_id required for version lineage.</p><p>file_id: stable UUID for each uploaded file; preserves original filename and metadata.</p><p>content_hash: cryptographic hash of original file bytes (e.g., SHA-256).</p><p>text_vault_id: stable UUID representing extracted normalized text for a file version.</p><p>chunk_id: stable UUID for each TEXT_CHUNK; includes chunk_index ordering and offsets.</p><p>correlation_id: required for all API calls, agent runs, tool calls, jobs, and audit events.</p><p>All hashes and identifiers must be immutable once written; updates produce new versions, not overwrites.</p><h3 id="evidence-traceability-hard-citation-format-validation">Evidence Traceability (Hard) — Citation Format &amp; Validation</h3><p>Any factual assertion produced by an agent that influences pleadings, COA mapping, discovery, deposition, subpoena, trial artifacts, or readiness decisions must include evidence trace references.</p><h4 id="minimum-citation-fields">Minimum Citation Fields</h4><ul><li>source_artifact_id (versioned)</li><li>source_file_id (hash-anchored)</li><li>page_number (if paginated source)</li><li>span_reference (e.g., paragraph index, timestamp range, or chunk_id)</li><li>extraction_method (OCR/STT/manual entry)</li><li>confidencequality flags (when available)</li></ul><h4 id="validation-rule">Validation Rule</h4><ul><li>If a required factual field lacks a valid citation, the agent must not infer; it must create an Issue and mark the field as unsupported.</li></ul><h4 id="output-contract-2">Output Contract</h4><ul><li>Every “publishable” artifact must include a traceability appendix or embedded trace references sufficient for later audit.</li></ul><h3 id="storage-components-logical">Storage Components (Logical)</h3><h4 id="active-case-store-authoritative">Active Case Store (Authoritative)</h4><p>Stores case-scoped structured records and linkages required for defensible outputs.</p><p><strong>Contains:</strong> parties, entities, facts, evidence references, COA elements, pleadings metadata, discovery artifacts, deposition artifacts, subpoena artifacts, trial prep artifacts.</p><p>Stores case financial analysis as evidentiary content (separate from operational finance).</p><h4 id="artifact-store-versioned-immutable">Artifact Store (Versioned; Immutable)</h4><p>Artifacts are the system’s authoritative outputs. All artifacts are versioned and immutable.</p><p><strong>Stores:</strong> Case Perspective, pleadings drafts, mapping tables, interrogatories, deposition outlines, deposition processing reports, evidence_audit_report, conductor_readiness_report, opposition_exposure_report, publish/export packages.</p><p><strong>Artifacts include provenance:</strong> inputs, source references, tool/model versions, run metadata, correlation_id.</p><p>Artifacts may reference large binary content stored in object storage with integrity hashes.</p><h4 id="audit-log-store-immutable-append-only">Audit Log Store (Immutable; Append-Only)</h4><p>Stores audit events for all privileged and case-impacting actions.</p><p>Must be append-only with tamper-evident integrity controls.</p><p>Must support audit query APIs (role-gated) and reconstruction of workflow state transitions.</p><h4 id="text-stores-text_vault-and-text_chunks">Text Stores (TEXT_VAULT and TEXT_CHUNKS)</h4><p>Large or unstructured content is normalized into TEXT_VAULT and decomposed into TEXT_CHUNKS to support scalable retrieval, tagging, and citation.</p><p>TEXT_VAULT (Authoritative Extract)</p><p>Represents normalized text extracted from a specific file version.</p><p>Must reference file_id and file_version_id; must store extraction method metadata (OCR/STT/table extraction).</p><p>May store full text if within policy size limits; otherwise stored as chunks only.</p><p>TEXT_CHUNKS (Scalable Decomposition)</p><p>Each chunk includes chunk_id, text_vault_id, chunk_index, and byte/char offsets into the normalized text.</p><p>Chunks must support ordered reconstruction into the full TEXT_VAULT text.</p><p>Chunks are the primary unit for tagging, entity extraction references, and UI deep-link citation.</p><p>Chunk sizing strategy is policy-defined (recommended: token-based sizing with overlap).</p><p>Chunk Audit Requirements</p><p>Chunk creation emits audit events (TextVaultCreated, TextChunksCreated) with counts and integrity hashes.</p><p>Chunk edits are not permitted; re-processing produces new text_vault_id and new chunk set.</p><h4 id="archive-store-closed-cases-read-only-default">Archive Store (Closed Cases; Read-Only Default)</h4><p>Stores closed cases and all associated artifacts for retention and defensibility.</p><p>Accessible for read-only operations by default; re-open requires governed workflow transition and audit.</p><p>Archive outages must not block active case execution.</p><h4 id="knowledge-store-derived-rebuildable-advisory">Knowledge Store (Derived; Rebuildable; Advisory)</h4><p>Stores derived knowledge artifacts and indices used to reduce external calls and improve advisory insights.</p><p>Must be rebuildable from authoritative case data and artifacts.</p><p>Must store source-case references and sanitization status.</p><p>Cross-case access is policy-gated; knowledge outputs are advisory only.</p><p>Legal research caching is jurisdiction-tagged, version-tagged, and expiration/revalidation policy-controlled.</p><h4 id="operational-stores-firm-operations">Operational Stores (Firm Operations)</h4><p>User identities, roles, permissions, directives registry, cost ledger, budgets/caps, system metrics.</p><p>Operational finance is separated from case evidence and not exposed to clients.</p><p>Operational reporting may attribute costs to case_id without exposing evidentiary content.</p><h3 id="high-level-entity-map-conceptual-minimum">High-Level Entity Map (Conceptual; Minimum)</h3><p>This map defines required entity groupings and relationships; detailed schemas follow in later sections.</p><h4 id="core-case-entities">Core Case Entities</h4><p>CASE (case_id, status, stage, jurisdiction, matter_type, created_at, closed_at).</p><p>PARTY (party_id, case_id, party_type, attributes).</p><p>PERSON / ENTITY (entity_id, case_id, type, names/aliases, roles, relationships).</p><p>FILE (file_id, case_id, filename, mime_type, size, content_hash, authoritative_flag, source_session_id).</p><p>TEXT_VAULT (text_vault_id, file_id, extraction_metadata, created_at).</p><p>TEXT_CHUNK (chunk_id, text_vault_id, chunk_index, offsets, text).</p><p>FACT (fact_id, case_id, statement, confidence, source_refs).</p><p>EVIDENCE_REF (evidence_id, case_id, file_id/text refs, exhibit refs).</p><p>COA (coa_id, case_id, taxonomy_id, elements).</p><p>ALLEGATION / PLEADING_ITEM (allegation_id, case_id, pleading_artifact_version_ref).</p><p>MAPPING_LINK (link_id, case_id, fact_id/evidence_id/chunk_id ↔ allegation_id/coa_element_id).</p><h4 id="governance-and-workflow-entities">Governance and Workflow Entities</h4><p>ARTIFACT (artifact_id, case_id, type, current_version_id, status).</p><p>ARTIFACT_VERSION (version_id, artifact_id, created_by, created_at, provenance, payload_ref).</p><p>ISSUE (issue_id, case_id, severity, status, links, blocking_flag).</p><p>TASK (task_id, case_id, assignee, due_date, status, links).</p><p>DIRECTIVE (directive_id, case_id, type, requested_by, approved_by, scope, status, timestamps).</p><p>APPROVAL_RECORD (approval_id, case_id, object_ref, approver, result, timestamp).</p><p>WORKFLOW_STATE (case_id, stage, step_state, transition_history_ref).</p><h4 id="audit-and-operations-entities">Audit and Operations Entities</h4><p>AUDIT_EVENT (event_id, timestamp, actor, role, case_id, action_type, target_ref, correlation_id, result).</p><p>JOB (job_id, type, case_id, status, attempts, idempotency_key, correlation_id).</p><p>USAGE_LEDGER (ledger_id, case_id, tool/provider, units, cost, timestamp, correlation_id).</p><h3 id="indexing-and-query-requirements-minimum">Indexing and Query Requirements (Minimum)</h3><p>Case-scoped full-text search over TEXT_CHUNKS (policy-defined index strategy).</p><p>Fast retrieval by file_id → text_vault_id → ordered chunks.</p><p><strong>Efficient joins for mapping:</strong> COA element ↔ allegation ↔ fact ↔ evidence ↔ chunk.</p><p>Audit query by case_id, actor_id, action_type, time range, correlation_id.</p><p>Artifact retrieval by type, status, version, and dependency lineage.</p><h3 id="data-lifecycle-retention-and-archival-hooks">Data Lifecycle (Retention and Archival Hooks)</h3><p>Retention durations are policy-defined; the data model must support effective-dated retention rules and legal holds.</p><p><strong>Retention policies apply independently to:</strong> raw files, text_vault/chunks, artifacts, audit logs, research cache, derived knowledge.</p><p>Legal hold prevents deletion and is audit-logged.</p><p>Archival moves closed cases to Archive Store with read-only default access.</p><p>Derived knowledge may persist beyond case closure only if sanitized and governance-approved.</p><h3 id="data-architecture-build-checklist-antigravity">Data Architecture Build Checklist (Antigravity)</h3><p>Implement data domains and enforce separation (case vs operational vs derived vs archive).</p><p>Implement immutable versioned artifacts + lineage + provenance.</p><p>Implement TEXT_VAULT + TEXT_CHUNKS with chunk reconstruction guarantees and audit events.</p><p>Implement mapping structures linking chunks/facts/evidence to allegations and COA elements.</p><p>Implement append-only audit store with query APIs and reconstruction support.</p><p>Implement Knowledge Store as rebuildable derived domain with sanitization and promotion controls.</p><p>Implement cost ledger attribution without evidentiary leakage.</p><h3 id="operational-data-semantics-authoritative">Operational Data Semantics (Authoritative)</h3><p>This platform enforces defensible data handling rules for all agent executions. These rules define create/append/overwrite behavior, idempotency, versioning, and event emission. They are authoritative and apply to every agent.</p><p>Artifacts are append‐only and versioned. No agent may overwrite an existing artifact version.</p><p>Edits are expressed as new ARTIFACT_VERSION rows with explicit delta metadata and audit events.</p><p><strong>Authoritative raw inputs are immutable:</strong> original uploads, media, TEXT_VAULT, and TEXT_CHUNKS must never be modified in place.</p><p>Normalized case tables support controlled upsert only when stable identifiers exist and change history is preserved (audit log or versioned snapshots).</p><p>Deterministic executions must be replayable: all inputs, templates, and tool metadata required for reproduction must be captured.</p><p>All agent jobs must be idempotent using idempotency_key + correlation_id; repeated submissions must not duplicate authoritative records.</p><p>Agents do not call other agents directly. All downstream work is triggered via orchestration events.</p><p>On job completion, the system must emit standardized events: AgentJobCompleted, ArtifactVersionCreated (if applicable), and CaseStateUpdated (if applicable).</p><p>Workflow transitions and dependent job enqueues are driven by the Workflow State Machine listening to these events.</p><p>All CRUD operations must produce auditable records including: user_id (if applicable), role, case_id, action_type, target_id, correlation_id, result.</p><h4 id="evidence-integrity-and-zero-hallucination-enforcement-authoritative">Evidence Integrity and Zero-Hallucination Enforcement (Authoritative)</h4><p>The platform operates under a strict evidence integrity mandate. All agents interacting with evidence, facts, transcripts, pleadings, mappings, discovery artifacts, or trial materials must adhere to the following:</p><h4 id="zero-hallucination-rule">Zero Hallucination Rule</h4><p>Agents must not invent facts, infer unstated evidence, fabricate relationships, or generate unsupported claims.</p><ul><li>All factual outputs must be traceable to:</li><li>CASE_PERSPECTIVE (client-asserted)</li><li>TEXT_VAULT / TEXT_CHUNKS</li><li>Authoritative uploads</li><li>Versioned artifacts in ARTIFACT_STORE</li><li>If evidence is insufficient, the agent must:</li><li>Flag insufficiency</li><li>Create Issue (policy controlled)</li><li>Recommend required evidence</li><li>Agents must never “fill gaps” with probabilistic assumptions.</li></ul><h4 id="deterministic-evidence-processing-mode">Deterministic Evidence Processing Mode</h4><p>All evidence-handling agents must operate in deterministic mode for:</p><ul><li>Extraction</li><li>Mapping</li><li>Contradiction detection</li><li>Element validation</li><li>Deposition decomposition</li><li>Trial artifact preparation</li></ul><p>Deterministic mode requires:</p><ul><li>Versioned input capture</li><li>Template version capture</li><li>Tool/provider metadata capture</li><li>Reproducible execution</li><li>Deterministic_run_metadata stored with artifact</li></ul><h4 id="evidence-traceability-requirement">Evidence Traceability Requirement</h4><p>All evidence references must include:</p><ul><li>case_id</li><li>artifact_id</li><li>artifact_version</li><li>text_chunk_id (if applicable)</li><li>byte_offset or timestamp reference (if applicable)</li></ul><p>No summary or mapping may exist without trace linkage.</p><h4 id="explicit-ambiguity-handling">Explicit Ambiguity Handling</h4><p>If ambiguity exists:</p><ul><li>The agent must flag ambiguity</li><li>Must not auto-resolve unless interpretation rule explicitly permits</li><li>Must record resolution basis if applied</li></ul><h4 id="advisory-vs-deterministic-separation">Advisory vs Deterministic Separation</h4><p>Agents may use non-deterministic reasoning only for:</p><ul><li>Question generation</li><li>Clarification prompts</li><li>Strategic advisory simulation</li></ul><p>All case-state modifying operations must be deterministic.</p><h3 id="case-perspective-operationalization-contract-authoritative">Case Perspective Operationalization Contract (Authoritative)</h3><p>The CASE_PERSPECTIVE artifact must be operationalized into structured, enforceable interpretation guidance before any downstream evidence processing or mapping occurs.</p><h4 id="required-transformation">Required Transformation</h4><p>Upon CasePerspectiveApproved, the system must generate a derived artifact: CASE_CONTEXT_PLAYBOOK.</p><p>CASE_CONTEXT_PLAYBOOK is a deterministic transformation of the approved CASE_PERSPECTIVE and is the executable interpretation contract used by downstream agents.</p><h4 id="case_context_playbook-minimum-attributes">CASE_CONTEXT_PLAYBOOK (Minimum Attributes)</h4><ul><li>derived_from_case_perspective_version_id</li><li>canonical_actor_index</li><li>role_time_bounds_index</li><li>event_anchor_index</li><li>relationship_index</li><li>document_routing_expectations</li><li>disambiguation_priority_rules</li><li>open_questions_index</li><li>coherence_checks_passed[]</li><li>blocking_gaps[]</li><li>deterministic_run_metadata</li></ul><h4 id="mandatory-downstream-enforcement">Mandatory Downstream Enforcement</h4><p>All evidence-handling agents must:</p><ul><li>Load CASE_CONTEXT_PLAYBOOK prior to processing</li><li>Record perspective_context_snapshot_id in every deterministic run</li><li>Record rules_applied[]</li><li>Record unresolved_disambiguations[]</li></ul><p>No downstream artifact may be generated without recording the context snapshot used.</p><h4 id="structural-separation-requirement">Structural Separation Requirement</h4><p>The system must maintain strict separation between:</p><ul><li>Client narrative (CASE_PERSPECTIVE)</li><li>Legal structure (COA / pleadings)</li><li>Evidence and extracted facts</li><li>Strategy/advisory reasoning</li></ul><p>These layers must remain independently versioned and traceable.</p></section><section><h2 id="agent-architecture">AGENT ARCHITECTURE</h2><h3 id="intake_agent">INTAKE_AGENT</h3><h4 id="description">Description</h4><p>INTAKE_AGENT initiates a matter, elicits a complete client narrative, resolves ambiguity through structured questioning, and produces a client-approved CASE_PERSPECTIVE artifact. CASE_PERSPECTIVE is the authoritative client-asserted lens the firm is serving. It is used as a contextual interpretation schema for downstream processing, extraction, and mapping of evidence and facts to pleadings, COA elements, discovery artifacts, depositions, and trial preparation.</p><h4 id="differentiating-capability-structured-story-elicitation-and-repackaging">Differentiating Capability — Structured Story Elicitation and Repackaging</h4><p>Clients will present information with widely varying skill and completeness. INTAKE_AGENT is responsible for prompting, clarifying, and reorganizing the client’s assertions into a coherent story aligned with attorney reasoning (who, what, when, where, why, and asserted damages/remedy), and for securing explicit client validation of the firm’s understanding.</p><p>Extract incomplete or fragmented narratives via follow-up prompts and branching question sets.</p><p>Detect contradictions and require clarification or explicit 'unknown' marking.</p><p>Repackage raw assertions into coherent attorney-ready narrative structures.</p><p>Produce machine-readable Story Graph and Interpretation Rules to guide file interpretation.</p><p>Enumerate Ambiguities/Open Questions explicitly; do not bury uncertainty in prose.</p><p>Require client validation (approve or amend) before CASE_PERSPECTIVE becomes authoritative.</p><p>Narrative Coherence Loop (Authoritative)</p><p>INTAKE_AGENT must enforce structural narrative completeness before allowing CASE_PERSPECTIVE approval. The following coherence checks are mandatory:</p><ul><li>Chronology Check — events must have ordered anchors (date or approximate range).</li><li>Actor Role Check — each actor must have a defined role and time bounds where applicable.</li><li>Causation Check — each major event must include causal linkage where known or be explicitly marked unknown.</li><li>Damages/Remedy Check — client-asserted harm/remedy must be stated or explicitly marked unknown.</li><li>Ambiguity Enumeration Check — unresolved questions must be enumerated and linked to why they matter.</li></ul><p>INTAKE_AGENT must generate and store within CASE_PERSPECTIVE and/or derived artifacts:</p><ul><li>coherence_checks_passed[]</li><li>blocking_gaps[]</li><li>coverage_scorecard</li></ul><p>Client approval must not proceed if blocking_gaps are present.</p><h4 id="where-the-story-lives-authoritative-storage-model">Where the Story Lives (Authoritative Storage Model)</h4><p>The client story is case-scoped, versioned, and stored across three coordinated data areas:</p><p><strong>ARTIFACT_STORE:</strong> CASE_PERSPECTIVE as the authoritative narrative + rules object (versioned).</p><p><strong>ACTIVE_CASE_STORE:</strong> normalized tables for parties, roles, relationships, timeline anchors, and issues.</p><p><strong>TEXT_VAULT / TEXT_CHUNKS:</strong> raw transcript (if audio/video) and any narrative text captured.</p><p>The storytelling component must always include:</p><p>Narrative (human-readable).</p><p>Story Graph + Interpretation Rules (machine-readable).</p><p>Open Questions / Ambiguities (what still needs resolution).</p><p>If any of these are missing, downstream agents cannot reliably use the Case Perspective as context.</p><h4 id="dikw-contribution">DIKW Contribution</h4><p><strong>Data:</strong> raw interview inputs (text/audio/video), transcript text, intake state, consent records.</p><p><strong>Information:</strong> structured narratives, normalized actors, relationships, events, issue tags, timeline anchors.</p><p><strong>Knowledge:</strong> case-scoped Interpretation Rules (entity/role binding and disambiguation constraints).</p><p><strong>Wisdom:</strong> advisory clarification prompts only; no legal advice or legal conclusions.</p><h4 id="execution-mode">Execution Mode</h4><p><strong>Non-Deterministic:</strong> interview questioning, ambiguity resolution prompts, iterative summarization.</p><p><strong>Deterministic:</strong> CASE_PERSPECTIVE artifact generation at the moment of client approval (versioned; reproducible from captured inputs/templates).</p><h4 id="responsibilities-authoritative">Responsibilities (Authoritative)</h4><p>Create secure client account and initiate authenticated portal access.</p><p>Obtain required consents and acknowledgements (terms, privacy, recording where applicable).</p><p>Schedule and conduct guided interview (supports pause/resume across sessions).</p><p>Ask structured clarifying questions until a complete narrative is captured or explicitly marked 'unknown'.</p><p>Detect ambiguity, contradiction, or missing narrative elements and drive client correction.</p><p>Play back the structured story in attorney-aligned format and require client validation.</p><p>Generate and version CASE_PERSPECTIVE (Proposed → Approved/Amended → Approved).</p><p>Create INITIAL_ISSUE_TAGGING artifact (case-scoped).</p><p>Record complaint/COA status flag (existing vs create) for downstream planning (does not trigger drafting).</p><p>Update dashboard state and emit required audit events.</p><h4 id="key-inputs">Key Inputs</h4><p>Client-provided narrative (web form text and/or interview responses).</p><p>Optional intake-time documents (policy-controlled).</p><p>Interview configuration template (question sets, branching rules, required fields).</p><p>Consent/authorization artifacts (terms acceptance, privacy notices, recording consent).</p><p>Policy snapshot (channels enabled, retention class, required disclosures).</p><h4 id="processing-rules-and-constraints">Processing Rules and Constraints</h4><p>Must support multi-session interviews with explicit state persistence (paused/resumed).</p><p>Must not proceed to downstream workflow steps unless CASE_PERSPECTIVE is client-approved.</p><p>Must not access legal research tools or external legal libraries.</p><p>Must not infer legal conclusions; outputs remain 'client asserts' framing.</p><p>Must not modify or parse uploaded files beyond lightweight identification unless explicitly enabled by policy.</p><p><strong>Must preserve provenance:</strong> claims, rules, and story statements must reference transcript chunks where applicable.</p><h4 id="key-outputs-authoritative">Key Outputs (Authoritative)</h4><p>Required outputs are versioned artifacts and normalized data updates:</p><p>CASE_PERSPECTIVE artifact (Proposed/Amended/Approved) with full version history.</p><p>INTAKE_TRANSCRIPT artifact (if audio/video used), backed by TEXT_VAULT / TEXT_CHUNKS.</p><p>CLIENT_VALIDATION_APPROVAL record, including amendment deltas.</p><p>INITIAL_ISSUE_TAGGING artifact (case-scoped).</p><p>COMPLAINT_COA_STATUS flag (existing vs create).</p><p><strong>Dashboard updates:</strong> workflow_step, step_state, next_required_action.</p><h4 id="case_perspective-artifact-payload-minimum-authoritative">CASE_PERSPECTIVE Artifact Payload (Minimum; Authoritative)</h4><p>CASE_PERSPECTIVE.payload is the lens all later extraction/mapping must consult.</p><ul><li>story_narrative</li><li>executive_story (1–3 paragraphs; attorney-ready).</li><li>chronological_story (ordered events summary).</li><li>theory_of_case_summary (non-advocacy framing; 'client asserts...').</li><li>story_graph</li><li>actors[] (people/entities with aliases).</li><li>relationships[] (actor ↔ actor, role, time bounds).</li><li>events[] (event_id, date/approx_range, who, what, where, why).</li><li>claims_asserted_by_client[] (not legal conclusions; 'client believes X happened').</li><li>interpretation_rules</li><li>entity_resolution_rules[] (e.g., Person A == 'Bob', 'Robert', 'R. Smith').</li><li>role_binding_rules[] (e.g., Person A is 'Officer' for Entity X during 2021–2023).</li><li>document_expectations[] (e.g., emails from domain Y likely relate to Entity X).</li><li>disambiguation_prompts[] (rules for resolving ambiguous matches).</li><li>ambiguities_and_open_questions[]</li><li>question</li><li>why_it_matters</li><li>blocking_flag</li><li>suggested_evidence</li><li>validation</li><li>client_validation_status (Proposed/Amended/Approved).</li><li>client_validation_timestamp.</li><li>client_delta_log[] (what client changed).</li><li>provenance</li><li>source_transcript_refs[] (chunk references + timestamps).</li><li>template_version_id.</li><li>deterministic_run_metadata.</li></ul><h4 id="downstream-enforcement-rule-hard-constraint">Downstream Enforcement Rule (Hard Constraint)</h4><p>PROCESSING_AGENT must consume CASE_PERSPECTIVE as a contextual Interpretation Schema to guide entity disambiguation, role binding, document interpretation, extraction, and tagging. MAPPING_AGENT must reference CASE_PERSPECTIVE Story Graph and Interpretation Rules when proposing or validating mappings of evidence/facts to pleadings, COA elements, discovery artifacts, depositions, and trial materials. No agent may modify CASE_PERSPECTIVE outside the client amendment/approval workflow; contradictions must be flagged as issues.</p><h4 id="audit-events-required">Audit Events (Required)</h4><p>InterviewStarted</p><p>InterviewPaused</p><p>InterviewResumed</p><p>CasePerspectiveProposed</p><p>CasePerspectiveAmended</p><p>CasePerspectiveApproved (by client)</p><p>IntakeTranscriptCreated (if applicable)</p><p>InitialIssueTaggingCreated</p><h4 id="failure-classification-and-handling">Failure Classification and Handling</h4><p><strong>Retryable:</strong> transient provider failures (STT), network failures, timeouts.</p><p><strong>Blocking:</strong> client non-completion of interview; missing required consents; missing required CASE_PERSPECTIVE fields.</p><p><strong>Integrity:</strong> mismatch between stored transcript/text_vault and summarized narrative; requires human review.</p><p><strong>Policy:</strong> attempting legal research access or unauthorized parsing must hard-fail and be audited.</p><p>All blocking failures create ISSUE with recommended actions and dashboard surfacing.</p><h4 id="job-types-and-triggers-minimum">Job Types and Triggers (Minimum)</h4><p><strong>Job Type:</strong> IntakeInterviewJob (pause/resume; state persistence).</p><p><strong>Job Type:</strong> IntakeTranscriptJob (if media captured; creates text_vault/text_chunks + transcript artifact).</p><p><strong>Job Type:</strong> CasePerspectiveCompileJob (deterministic on client approval).</p><p><strong>Job Type:</strong> InitialIssueTaggingJob (deterministic; case-scoped).</p><h4 id="minimum-api-endpoints-semantic">Minimum API Endpoints (Semantic)</h4><p>All endpoints are served by the Application/API Layer; agent execution occurs via Agent Orchestration Layer.</p><p>POST /api/cases (create case shell + intake state)</p><p>POST /api/cases/{case_id}/intake/start</p><p>POST /api/cases/{case_id}/intake/pause</p><p>POST /api/cases/{case_id}/intake/resume</p><p>POST /api/cases/{case_id}/case-perspective/propose</p><p>POST /api/cases/{case_id}/case-perspective/amend</p><p>POST /api/cases/{case_id}/case-perspective/approve</p><p>GET /api/cases/{case_id}/case-perspective/versions</p><p>POST /api/cases/{case_id}/issue-tagging/generate</p><p>GET /api/cases/{case_id}/issue-tagging/versions</p><h3 id="processing_agent-2">PROCESSING_AGENT</h3><h4 id="description-2">Description</h4><p>PROCESSING_AGENT is the system-of-record builder for the case record. It consumes the client-approved CASE_PERSPECTIVE as an Interpretation Schema to correctly interpret uploaded files, extract text and structure, normalize entities and events, and populate the case database with defensible provenance. PROCESSING_AGENT produces non-advocacy outputs: it does not create legal conclusions, but it does create the structured factual substrate required for mapping evidence and facts to pleadings, COA, discovery, depositions, and trial preparation.</p><hr/><h4 id="differentiating-capability-contextual-interpretation-using-case_perspective">Differentiating Capability — Contextual Interpretation Using CASE_PERSPECTIVE</h4><p>PROCESSING_AGENT must treat the Case Perspective as mandatory contextual guidance, not optional background. It uses the Case Perspective to:</p><ul><li>disambiguate people/entities/roles (aliases, titles, time bounds)</li><li>guide extraction focus (what terms, entities, and relationships matter in this case)</li><li>reduce false matches across similarly-named entities</li><li>detect contradictions between evidence and the client-asserted narrative</li><li>structure extracted facts so they are later mappable to COA/complaint elements</li><li>Context-Constrained Extraction Rules (Authoritative)</li></ul><p>PROCESSING_AGENT must treat CASE_CONTEXT_PLAYBOOK as a binding constraint set for interpreting uploads.</p><p>Mandatory rules:</p><ul><li>Entity normalization must consult canonical_actor_index before accepting generic NLP inference.</li><li>Role assignments must respect role_time_bounds_index.</li><li>Extracted events must be evaluated against event_anchor_index for alignment or contradiction.</li><li>Document tagging must consult document_routing_expectations.</li><li>Ambiguous matches must be recorded as unresolved_disambiguations[] and must create Issue when policy requires.</li><li>If extracted content contradicts Story Graph anchors or relationships, contradiction_flags must be created; silent reconciliation is prohibited.</li></ul><p>Every deterministic processing run must record:</p><ul><li>perspective_context_snapshot_id</li><li>rules_applied[]</li><li>unresolved_disambiguations[]</li><li>Extraction writes without context alignment are prohibited.</li></ul><hr/><h4 id="where-the-processing-output-lives-authoritative-storage-model">Where the Processing Output Lives (Authoritative Storage Model)</h4><p>Processing output is case-scoped and stored across:</p><ul><li>ARTIFACT_STORE: processing reports, extraction summaries, provenance indexes (versioned)</li><li>ACTIVE_CASE_STORE: normalized entities, relationships, events, issues, mappings (case record tables)</li><li>TEXT_VAULT / TEXT_CHUNKS: authoritative extracted text (immutable) for each file/transcript with chunking and linkage</li></ul><p>If any of these are missing, later mapping/audit cannot be defensible.</p><hr/><h4 id="dikw-contribution-2">DIKW Contribution</h4><ul><li>Data: raw files/media; extracted raw text in TEXT_VAULT/TEXT_CHUNKS; OCR/STT outputs; parse metadata</li><li>Information: structured document representations; normalized entities/roles; event candidates; table extraction</li><li>Knowledge: case-scoped extraction constraints and disambiguation (derived strictly from CASE_PERSPECTIVE rules; not cross-case)</li><li>Wisdom: none (no legal strategy; no legal conclusions)</li></ul><hr/><h4 id="execution-mode-2">Execution Mode</h4><ul><li>Non-Deterministic: allowed only for heuristics that do not write facts (e.g., suggesting candidate entity matches), and must be labeled “candidate/proposed.”</li><li>Deterministic: required for all persisted outputs, including TEXT_VAULT/TEXT_CHUNKS creation, normalized table updates, and versioned artifacts.</li></ul><hr/><h4 id="responsibilities-authoritative-2">Responsibilities (Authoritative)</h4><ul><li>Consume CASE_PERSPECTIVE (Approved) as Interpretation Schema</li><li>Consume authoritative file set from FILE_INTAKE_AGENT (session complete, duplicates resolved)</li><li>Perform file processing pipelines (policy controlled):</li><li>OCR (for images/scans)</li><li>STT (for audio/video)</li><li>table extraction</li><li>layout/section parsing (where available)</li><li>Create TEXT_VAULT (raw extracted text per file)</li><li>Create TEXT_CHUNKS for scalable reading, referencing, and citation</li><li>Extract and normalize:</li><li>people/entities + aliases</li><li>role bindings (case-scoped; guided by CASE_PERSPECTIVE)</li><li>dates/events candidates and anchors</li><li>document metadata (author, recipients, headers, etc. where available)</li><li>Generate structured provenance linking:</li><li>file → text_vault → chunks → extracted entities/events</li><li>Flag:</li><li>missing/failed extraction</li><li>contradictions vs CASE_PERSPECTIVE</li><li>ambiguity requiring human or INTAKE amendment</li><li>Update dashboard status and emit required audit events</li></ul><hr/><h4 id="key-inputs-2">Key Inputs</h4><ul><li>CASE_PERSPECTIVE (Approved)</li><li>Authoritative upload set (files + metadata + hashes)</li><li>File intake session records (duplication decisions, authoritative designation)</li><li>Processing policy snapshot (OCR/STT enabled, retention, allowed providers, cost caps)</li><li>Tool provider configuration (via Integration Layer mediation)</li></ul><hr/><h4 id="processing-rules-and-constraints-2">Processing Rules and Constraints</h4><ul><li>Must not generate legal conclusions or advocacy statements</li><li>Must not modify original uploaded files (immutability)</li><li>Must not overwrite TEXT_VAULT/TEXT_CHUNKS (append only; new versions/runs only)</li><li>Must capture provenance sufficient to reproduce deterministic outputs</li><li>Must produce chunking suitable for:</li><li>full-file reassembly</li><li>pinpoint citation (chunk_id + offsets/timestamps)</li><li>Must treat disambiguation as constraint-based:</li><li>prefer CASE_PERSPECTIVE rules</li><li>otherwise mark as “candidate match” and flag ambiguity</li></ul><hr/><h4 id="key-outputs-authoritative-2">Key Outputs (Authoritative)</h4><p>Required outputs are versioned artifacts and normalized data updates:</p><ul><li>TEXT_VAULT record per processed file (immutable extracted text)</li><li>TEXT_CHUNKS records per file (chunked text + positions)</li><li>PROCESSING_RUN artifact (versioned) summarizing what was processed, tools used, errors, and counts</li><li>EXTRACTION_INDEX artifact (versioned) linking chunks to entities/events candidates (traceable)</li><li>Normalized updates in ACTIVE_CASE_STORE:</li><li>entities/aliases (as candidates or confirmed per policy)</li><li>event candidates / timeline anchors (as candidates)</li><li>issues created for extraction failures, contradictions, ambiguity</li></ul><hr/><h4 id="text_vault-text_chunks-operational-definition-minimum-authoritative">TEXT_VAULT / TEXT_CHUNKS Operational Definition (Minimum; Authoritative)</h4><h4 id="text_vault-per-file">TEXT_VAULT (per file)</h4><p>Attributes (minimum):</p><ul><li>vault_id</li><li>case_id</li><li>source_file_id</li><li>source_file_hash</li><li>extraction_method (ocr/stt/native)</li><li>extracted_text_ref (internal storage reference)</li><li>created_timestamp</li><li>tool_provider_metadata</li><li>deterministic_run_metadata</li></ul><h4 id="text_chunks-per-file-required-for-scalability">TEXT_CHUNKS (per file; required for scalability)</h4><p>Attributes (minimum):</p><ul><li>chunk_id</li><li>case_id</li><li>vault_id</li><li>source_file_id</li><li>chunk_index (ordered)</li><li>char_start / char_end (or byte offsets)</li><li>page_start / page_end (if applicable)</li><li>timestamp_start / timestamp_end (if applicable for media)</li><li>chunk_text</li><li>created_timestamp</li><li>deterministic_run_metadata</li></ul><p>Chunking Rules (minimum):</p><ul><li>Chunk size policy-controlled (target tokens/characters)</li><li>Must preserve stable ordering and allow reconstruction of full file text</li><li>Must support pinpoint citations using chunk_id + offsets/timestamps</li></ul><hr/><p>Downstream Enforcement Rule (Hard Constraint)</p><ul><li>PROCESSING_AGENT outputs are the authoritative text substrate used by MAPPING_AGENT, EVIDENCE_AUDIT_AGENT, DEPOSITION_PROCESSING_AGENT, and all downstream drafting/analysis.</li><li>Any derived entity/event output must include trace references back to TEXT_CHUNKS or other authoritative artifacts.</li><li>Contradictions vs CASE_PERSPECTIVE must produce Issue, not inferred resolution.</li></ul><hr/><p>Operational Data Semantics (CRUD + Notifications + Idempotency)</p><ul><li>Create: PROCESSING_RUN (new run_id), TEXT_VAULT records, TEXT_CHUNKS records, extraction artifacts</li><li>Append-only: reruns create a new PROCESSING_RUN and new derived artifacts; prior runs remain immutable</li><li>Controlled upsert: ACTIVE_CASE_STORE candidate entity/event tables may upsert only with stable IDs and audit history; never delete prior candidates silently</li><li>Never overwrite: original uploads; existing TEXT_VAULT or TEXT_CHUNKS; prior artifact versions</li><li>Idempotency: ProcessingJob must accept idempotency_key; repeated job submission must not duplicate vault/chunk creation for the same run</li><li>Events emitted: AgentJobCompleted; ArtifactVersionCreated (processing_run, extraction_index); CaseStateUpdated</li><li>Downstream enqueue:</li><li>OnProcessingCompleted → enqueue MappingJob</li><li>OnProcessingCompleted → enqueue EvidenceAuditJob</li><li>OnProcessingCompleted → update dashboard and readiness signals</li></ul><hr/><h4 id="evidence-integrity-enforcement">Evidence Integrity Enforcement</h4><ul><li>Operates under Zero Hallucination Rule (Section 9.2B).</li><li>May not generate, infer, or imply facts not traceable to authoritative case sources.</li><li>All factual outputs must include artifact and/or text_chunk trace references.</li><li>Insufficient evidence results in Issue creation, not probabilistic inference.</li><li>Deterministic execution required for any artifact generation or case-state modification.</li></ul><hr/><h4 id="audit-events-required-2">Audit Events (Required)</h4><ul><li>ProcessingStarted</li><li>FileProcessingStarted (per file)</li><li>FileProcessingCompleted (per file)</li><li>TextVaultCreated (per file)</li><li>TextChunksCreated (per file)</li><li>ProcessingCompleted</li><li>ExtractionFailed (per file; includes reason)</li><li>ContradictionFlagged (vs CASE_PERSPECTIVE)</li><li>AmbiguityFlagged</li></ul><hr/><h4 id="failure-classification-and-handling-2">Failure Classification and Handling</h4><ul><li>Retryable: tool/provider failures, timeouts, transient network errors</li><li>Blocking: missing approved CASE_PERSPECTIVE; missing authoritative file set; policy denies required tool use</li><li>Integrity: hash mismatch, corrupted file, incomplete extraction, chunk index inconsistency</li><li>All blocking/integrity failures: create Issue + surface on dashboards + include recommended disposition</li></ul><hr/><h4 id="job-types-and-triggers-minimum-2">Job Types and Triggers (Minimum)</h4><ul><li>ProcessingJob (case_id, intake_session_id or file_set_id, run_id)</li><li>OCRJob (per file; policy controlled)</li><li>STTJob (per media item; policy controlled)</li><li>TableExtractionJob (per file; policy controlled)</li><li>ChunkingJob (required when text_vault created)</li><li>ExtractionIndexJob (build traceable chunk→entity/event candidate links)</li></ul><hr/><p>Minimum API Endpoints (Semantic)</p><p>(All served by Application/API; executed via Orchestration)</p><ul><li>POST /api/cases/{case_id}/processing/start</li><li>GET /api/cases/{case_id}/processing/runs</li><li>GET /api/cases/{case_id}/processing/runs/{run_id}</li><li>GET /api/cases/{case_id}/text-vault/{vault_id} (access controlled)</li><li>GET /api/cases/{case_id}/text-chunks?vault_id={vault_id}</li><li>GET /api/cases/{case_id}/processing/extraction-index/versions</li></ul><h3 id="mapping_agent-2">MAPPING_AGENT</h3><h4 id="description-3">Description</h4><p>MAPPING_AGENT is responsible for creating and maintaining traceable, defensible correlations between (a) evidence and facts extracted from the case record and (b) the legal structure of the matter, including pleading allegations and COA elements. It does not invent theories or facts. It produces versioned mapping artifacts that link each mapped assertion to authoritative sources (uploads, TEXT_VAULT/TEXT_CHUNKS, transcripts, and prior approved artifacts), enabling downstream discovery, deposition, subpoena, and trial preparation.</p><hr/><h4 id="differentiating-capability-evidence-to-element-traceability">Differentiating Capability — Evidence-to-Element Traceability</h4><p>MAPPING_AGENT enforces the platform’s core defensibility requirement:</p><ul><li>Every mapped allegation or COA element must have evidence trace references</li><li>Every evidence item must be either mapped or explicitly marked as orphan/unmapped</li><li>Unsupported elements must be flagged, not “filled in”</li><li>Contradictions are flagged as issues; they are not resolved through inference</li></ul><hr/><h4 id="where-mapping-output-lives-authoritative-storage-model">Where Mapping Output Lives (Authoritative Storage Model)</h4><p>Mapping outputs are case-scoped and stored across:</p><ul><li>ARTIFACT_STORE: versioned mapping packages (COA mappings, allegation mappings, element coverage reports)</li><li>ACTIVE_CASE_STORE: normalized mapping tables (entity↔evidence↔allegation/element relationships)</li><li>TEXT_VAULT / TEXT_CHUNKS: cited sources supporting each mapping decision (immutable)</li></ul><hr/><h4 id="dikw-contribution-3">DIKW Contribution</h4><ul><li>Data: candidate entities/events/facts from PROCESSING_AGENT; pleadings/COA artifacts; TEXT_CHUNKS</li><li>Information: structured mapping links (fact→evidence→allegation/element) with provenance</li><li>Knowledge: element coverage and support status by COA and allegation; contradiction flags</li><li>Wisdom: none (no legal conclusions; no advocacy)</li></ul><hr/><h4 id="execution-mode-3">Execution Mode</h4><ul><li>Non-Deterministic: allowed only for proposing candidate mappings or ranking likely support (must be marked “candidate/proposed”).</li><li>Deterministic: required for any persisted mapping artifacts, mapping table writes, coverage status, contradiction flags, and element support determinations based on current record.</li></ul><hr/><h4 id="responsibilities-authoritative-3">Responsibilities (Authoritative)</h4><ul><li>Consume:</li><li>Approved CASE_PERSPECTIVE (Interpretation Schema)</li><li>TEXT_VAULT / TEXT_CHUNKS and extraction indexes</li><li>Pleading artifacts (complaint/response) and COA artifacts (existing or proposed)</li><li>Build/maintain mapping between:</li><li>people/entities/roles and the facts asserted</li><li>evidence artifacts (documents, transcript segments) and facts</li><li>facts/evidence and pleading allegations</li><li>facts/evidence and COA elements (element-level mapping)</li><li>Produce:</li><li>element coverage summaries (supported / partially supported / unsupported)</li><li>orphan artifact lists (unmapped evidence)</li><li>contradiction and inconsistency flags</li><li>Create Issues/Tasks (policy controlled) for:</li><li>unsupported elements</li><li>missing evidence requests</li><li>ambiguity requiring attorney/client disposition</li><li>Update dashboard status and emit required audit events</li></ul><hr/><h4 id="key-inputs-3">Key Inputs</h4><ul><li>CASE_PERSPECTIVE (Approved)</li><li>Pleading artifacts (complaint/response drafts or versions)</li><li>COA artifacts (COA list + element definitions per jurisdiction where available)</li><li>TEXT_VAULT / TEXT_CHUNKS + extraction indexes</li><li>Authoritative upload metadata (file_id, hash, provenance)</li><li>Policy snapshot (jurisdiction, mapping depth required, element strictness, cost caps)</li><li>Attorney directives (only for legal library/tool access if enabled)</li></ul><hr/><h4 id="processing-rules-and-constraints-3">Processing Rules and Constraints</h4><ul><li>Must not invent facts or legal theories</li><li>Must not modify pleadings or COA taxonomy (unless explicitly delegated through attorney-approved workflow and separate agent scope)</li><li>Must not write mappings without trace references</li><li>Must treat CASE_PERSPECTIVE as contextual guidance for disambiguation, not as “evidence”</li><li>Must label mapping confidence only as metadata; confidence must never substitute for evidence</li><li>Must treat all contradictory support as contradiction_flags and create Issues</li><li>Must preserve version lineage: each mapping run produces a new versioned artifact package</li></ul><hr/><h4 id="key-outputs-authoritative-3">Key Outputs (Authoritative)</h4><ul><li>MAPPING_PACKAGE artifact (versioned; authoritative bundle) including:</li><li>allegation_mappings[]</li><li>coa_element_mappings[]</li><li>coverage_summary</li><li>orphan_artifacts</li><li>contradiction_flags</li><li>unresolved_issues</li><li>deterministic_run_metadata</li><li>Normalized mapping tables in ACTIVE_CASE_STORE:</li><li>evidence_to_fact links</li><li>fact_to_allegation links</li><li>fact_to_element links</li><li>entity_to_fact links</li><li>Issues/Tasks (policy controlled) for unsupported elements and missing evidence</li></ul><hr/><h4 id="mapping-artifact-definitions-minimum-authoritative">Mapping Artifact Definitions (Minimum; Authoritative)</h4><h4 id="allegation-mapping">Allegation Mapping</h4><p>Each allegation_mapping item must include:</p><ul><li>allegation_id (pleading reference)</li><li>fact_ids[]</li><li>evidence_refs[] (artifact_id/version_id and/or text_chunk refs)</li><li>support_status (supported / partial / unsupported)</li><li>contradiction_flags[] (if applicable)</li><li>notes (non-advocacy; descriptive only)</li></ul><h4 id="coa-element-mapping">COA Element Mapping</h4><p>Each coa_element_mapping item must include:</p><ul><li>coa_id</li><li>element_id (element definition reference)</li><li>fact_ids[]</li><li>evidence_refs[] (artifact_id/version_id and/or text_chunk refs)</li><li>support_status (supported / partial / unsupported)</li><li>gaps[] (what evidence is missing)</li><li>contradiction_flags[] (if applicable)</li></ul><h4 id="evidence-reference-format-required">Evidence Reference Format (Required)</h4><p>Every evidence_ref must include:</p><ul><li>case_id</li><li>source_type (upload/artifact/text_chunk/transcript_segment)</li><li>artifact_id + artifact_version_id (if applicable)</li><li>text_chunk_id + char_start/char_end (or timestamp_start/end for media)</li><li>source_file_id + hash (where applicable)</li></ul><hr/><h4 id="downstream-enforcement-rule-hard-constraint-2">Downstream Enforcement Rule (Hard Constraint)</h4><ul><li>Downstream drafting and analysis must use MAPPING_AGENT outputs as the authoritative mapping layer.</li><li>Unsupported COA elements and allegations must remain flagged until resolved by additional evidence, attorney decision, or explicit amendment.</li><li>Contradictions must generate Issues; no agent may silently “choose” a side without human disposition or explicit policy rule.</li></ul><hr/><h4 id="operational-data-semantics-crud-notifications-idempotency">Operational Data Semantics (CRUD + Notifications + Idempotency)</h4><ul><li>Create: MAPPING_RUN (run_id), MAPPING_PACKAGE artifact versions, coverage reports, orphan lists</li><li>Append-only:</li><li>each run creates a new mapping package version; prior versions remain immutable</li><li>Controlled upsert:</li><li>normalized mapping tables may upsert only via stable IDs; must preserve change history and support rollback/review</li><li>Never overwrite:</li><li>prior mapping artifacts, evidence references, or source text</li><li>Idempotency:</li><li>MappingJob must accept idempotency_key; repeated job submission must not duplicate mapping versions for the same run</li><li>Events emitted:</li><li>AgentJobCompleted; ArtifactVersionCreated (mapping_package); CaseStateUpdated</li><li>Downstream enqueue:</li><li>OnMappingCompleted → enqueue EvidenceAuditJob</li><li>OnMappingCompleted → update dashboard readiness signals</li></ul><hr/><h4 id="evidence-integrity-enforcement-2">Evidence Integrity Enforcement</h4><ul><li>Operates under Zero Hallucination Rule (Section 9.2B).</li><li>May not generate, infer, or imply facts not traceable to authoritative case sources.</li><li>All factual outputs must include artifact and/or text_chunk trace references.</li><li>Insufficient evidence results in Issue creation, not probabilistic inference.</li><li>Deterministic execution required for any artifact generation or case-state modification.</li></ul><hr/><h4 id="attorney-gated-legal-library-access-directive-only-optional">Attorney-Gated Legal Library Access (Directive Only; Optional)</h4><p>If enabled by policy and authorized by attorney directive, MAPPING_AGENT may:</p><ul><li>verify COA element definitions and annotated commentary</li><li>retrieve jurisdictional element phrasing and practice guide references</li><li>attach legal reference artifacts to element definitions (as references only)</li></ul><p>Controls:</p><ul><li>access requires explicit directive + audit logging</li><li>retrieved legal references are stored as versioned reference artifacts</li><li>legal references must never be treated as evidence; they are element-definition support only</li></ul><hr/><h4 id="audit-events-required-3">Audit Events (Required)</h4><ul><li>MappingStarted</li><li>MappingCandidateProposed (if used)</li><li>AllegationMappingCreated</li><li>COAElementMappingCreated</li><li>CoverageSummaryCreated</li><li>OrphanArtifactDetected</li><li>UnsupportedElementFlagged</li><li>ContradictionFlagged</li><li>MappingCompleted</li></ul><hr/><h4 id="failure-classification-and-handling-3">Failure Classification and Handling</h4><ul><li>Retryable: transient provider failures, timeouts, temporary DB locks</li><li>Blocking: missing approved CASE_PERSPECTIVE; missing TEXT_CHUNKS; missing pleading/COA references required by policy</li><li>Integrity: invalid references, missing chunk offsets, broken lineage between artifacts and sources</li><li>All blocking/integrity failures: create Issue + surface on dashboards + include recommended disposition</li></ul><hr/><h4 id="job-types-and-triggers-minimum-3">Job Types and Triggers (Minimum)</h4><ul><li>MappingJob (case_id, processing_run_id, mapping_run_id)</li><li>AllegationMappingJob (subset)</li><li>COAElementMappingJob (subset)</li><li>CoverageSummaryJob (subset)</li><li>OrphanDetectionJob (subset)</li><li>ContradictionScanJob (subset)</li></ul><hr/><h4 id="minimum-api-endpoints-semantic-2">Minimum API Endpoints (Semantic)</h4><p>(All served by Application/API; executed via Orchestration)</p><ul><li>POST /api/cases/{case_id}/mapping/start</li><li>GET /api/cases/{case_id}/mapping/runs</li><li>GET /api/cases/{case_id}/mapping/runs/{run_id}</li><li>GET /api/cases/{case_id}/mapping/package/versions</li><li>GET /api/cases/{case_id}/mapping/coverage</li><li>GET /api/cases/{case_id}/mapping/orphans</li><li>GET /api/cases/{case_id}/mapping/contradictions</li></ul><hr/><h3 id="evidence_audit_agent-2">EVIDENCE_AUDIT_AGENT</h3><h4 id="description-4">Description</h4><p>EVIDENCE_AUDIT_AGENT performs deterministic, non-destructive, case-wide integrity validation to ensure the case record is complete, traceable, and defensible. It verifies that evidence and facts derived from uploads and transcripts are correctly linked to the client’s authoritative story lens (CASE_PERSPECTIVE / CASE_CONTEXT_PLAYBOOK) and to downstream legal structure artifacts (pleadings, COA elements, discovery, deposition, subpoenas, trial prep). It produces a versioned EVIDENCE_AUDIT_REPORT artifact and creates Issues/Tasks where gaps or inconsistencies exist.</p><h4 id="differentiating-capability-defensibility-smoke-test-with-trace-enforcement">Differentiating Capability — Defensibility “Smoke Test” With Trace Enforcement</h4><p>EVIDENCE_AUDIT_AGENT enforces platform defensibility by checking:</p><ul><li>Coverage: required artifacts exist for the current workflow stage</li><li>Traceability: all mapped facts/evidence have valid trace references (artifact versions and/or text_chunk offsets)</li><li>Orphans: uploaded files, chunks, transcript segments, or derived facts that remain unmapped</li><li>Unsupported legal structure: allegations/COA elements lacking mapped evidentiary support (based on current record only)</li><li>Story coherence: contradictions between CASE_CONTEXT_PLAYBOOK anchors and extracted/mapped facts (flag only; do not “resolve”)</li><li>Blocking readiness: unresolved issues or missing approvals that prevent publish/export or stage transitions</li></ul><h4 id="where-the-audit-output-lives-authoritative-storage-model">Where the Audit Output Lives (Authoritative Storage Model)</h4><ul><li>ARTIFACT_STORE: versioned EVIDENCE_AUDIT_REPORT (append-only)</li><li>ACTIVE_CASE_STORE: Issues/Tasks created by policy; linkage records to affected artifacts/targets</li><li>AUDIT_LOG_STORE: audit events for audit runs, issue creation, readiness gates</li><li>TEXT_VAULT / TEXT_CHUNKS: referenced sources (immutable); never modified by this agent</li></ul><h4 id="dikw-contribution-4">DIKW Contribution</h4><ul><li>Data: existing case artifacts, text_chunks, mapping links, workflow state snapshot</li><li>Information: structured audit findings (missing, orphaned, unsupported, contradictions)</li><li>Knowledge: coverage patterns by workflow stage; repeatable integrity checks (case-scoped)</li><li>Wisdom: none; produces advisory recommended actions only (no legal conclusions)</li></ul><h4 id="execution-mode-4">Execution Mode</h4><ul><li>Deterministic only for:</li><li>Evidence audit report generation</li><li>Coverage scoring</li><li>Orphan detection</li><li>Unsupported element detection (based on current mapping state)</li><li>Contradiction flag generation</li><li>Issue/Task creation (policy controlled)</li></ul><h4 id="responsibilities-authoritative-4">Responsibilities (Authoritative)</h4><ul><li>Load CASE_CONTEXT_PLAYBOOK and record perspective_context_snapshot_id in every run</li><li>Load current workflow stage and required artifact checklist for that stage</li><li>Validate presence and freshness (recency policy) of:</li><li>CASE_PERSPECTIVE / CASE_CONTEXT_PLAYBOOK</li><li>authoritative uploads and processing runs</li><li>mappings and coverage summaries</li><li>downstream artifacts as applicable (interrogatories, depositions, subpoenas, trial prep)</li><li>Perform integrity checks:</li><li>trace reference validity (chunk_id + offsets/timestamps; artifact_id + version_id)</li><li>orphan artifact detection</li><li>unsupported element detection (allegations/COA elements with insufficient mapped support)</li><li>contradiction scans (flag only; no inference)</li><li>Produce EVIDENCE_AUDIT_REPORT (versioned)</li><li>Create ISSUE and/or TASK records (policy-controlled) assigned to responsible roles</li><li>Update dashboard readiness indicators (does not advance workflow)</li></ul><h4 id="key-inputs-4">Key Inputs</h4><ul><li>CASE_CONTEXT_PLAYBOOK (required)</li><li>Workflow stage snapshot (stage, step_state, jurisdiction, policy profile)</li><li>ARTIFACT_STORE: pleadings/COA artifacts, mapping packages, discovery/deposition artifacts (if present)</li><li>ACTIVE_CASE_STORE: mapping tables, issues/tasks, approval records</li><li>TEXT_VAULT / TEXT_CHUNKS references (immutable)</li><li>Policy snapshot: required artifacts by stage, run cadence, readiness gating rules</li><li>UploadImpactPreliminaryReport (if generated by FILE_INTAKE_AGENT): used to prioritize audit checks and to flag workflow-stage impact when late uploads are introduced.</li></ul><h4 id="processing-rules-and-constraints-4">Processing Rules and Constraints</h4><ul><li>Must not modify:</li><li>CASE_PERSPECTIVE / CASE_CONTEXT_PLAYBOOK</li><li>pleadings, COA taxonomy, mappings, or any evidence content</li><li>Must not infer missing facts; insufficient evidence → Issue creation</li><li>Must not “resolve” contradictions; contradictions → contradiction_flags + Issue</li><li>Must produce traceable findings only (all findings must link to targets and sources)</li><li>Must be replayable: record all inputs, templates, and metadata required for deterministic reproduction</li><li>Thread/Continuation Evidence Handling (Authoritative): If FILE_INTAKE_AGENT has grouped related files into THREAD_GROUP (e.g., email chains, SMS exports, cumulative-message threads), EVIDENCE_AUDIT_AGENT must treat the THREAD_GROUP’s authoritative_file_id as the default evidence anchor for coverage and mapping checks unless an attorney override is recorded.</li><li>Non-Additive Thread Rule: Redundant content across thread members must not inflate coverage counts or “support” determinations. Evidence support is evaluated on the authoritative representation, while preserving references to all retained thread members for provenance.</li><li>Thread Consistency Checks: The audit must detect and flag:</li><li>Mappings that cite non-authoritative thread members when an authoritative_file_id exists (unless override recorded).</li><li>Orphan thread members that are retained but never referenced (expected in many cases) — must be reported as “retained_non_authoritative” rather than treated as missing coverage.</li><li>Conflicts where multiple versions are marked authoritative within a THREAD_GROUP (integrity failure).</li></ul><h4 id="key-outputs-authoritative-4">Key Outputs (Authoritative)</h4><ul><li>EVIDENCE_AUDIT_REPORT artifact (versioned; append-only)</li><li>Policy-controlled ISSUE and TASK creation (with linkages)</li><li>Dashboard updates:</li><li>open_issues_count</li><li>blocking_issues_count</li><li>evidence_audit_current_flag</li><li>readiness_gate_status (for publish/export and stage transitions)</li></ul><h4 id="artifact-type-definition-evidence_audit_report-minimum-authoritative">Artifact Type Definition — evidence_audit_report (Minimum; Authoritative)</h4><p><strong>Artifact Type:</strong> evidence_audit_report</p><p>Attributes (minimum):</p><ul><li>version_id</li><li>generated_timestamp</li><li>workflow_stage_snapshot</li><li>coverage_summary</li><li>missing_artifacts</li><li>orphan_artifacts</li><li>unsupported_elements</li><li>contradiction_flags</li><li>unresolved_issues</li><li>recommended_actions</li><li>deterministic_run_metadata</li></ul><h4 id="downstream-enforcement-rule-hard-constraint-3">Downstream Enforcement Rule (Hard Constraint)</h4><ul><li>OnPrePublishExportRequested must require a successful, current EVIDENCE_AUDIT_JOB (policy-defined freshness window) unless an attorney override is recorded with audit logging.</li><li>Conductor/readiness governance must treat the latest evidence audit result as a primary readiness input.</li></ul><h4 id="operational-data-semantics-crud-notifications-idempotency-2">Operational Data Semantics (CRUD + Notifications + Idempotency)</h4><ul><li>Create: new EVIDENCE_AUDIT_RUN + new evidence_audit_report artifact version</li><li>Append-only: every run produces a new report version; no overwrites</li><li>Issue/Task creation: policy controlled; must include linkage to the failing check and targets</li><li>Idempotency: EvidenceAuditJob must accept idempotency_key; repeats must not duplicate identical Issue/Task creation for the same run scope (use deterministic dedupe rules)</li><li>Events emitted:</li><li>EvidenceAuditStarted</li><li>EvidenceAuditCompleted</li><li>ArtifactVersionCreated (evidence_audit_report)</li><li>IssueCreated / TaskCreated (if applicable)</li><li>CaseStateUpdated (readiness indicators only)</li></ul><h4 id="job-types-and-triggers-minimum-4">Job Types and Triggers (Minimum)</h4><p><strong>Job Type:</strong> EvidenceAuditJob</p><p>Automatic triggers (authoritative):</p><ul><li>OnUploadSessionCompleted → enqueue EvidenceAuditJob</li><li>OnProcessingCompleted → enqueue EvidenceAuditJob</li><li>OnMappingCompleted → enqueue EvidenceAuditJob</li><li>OnDepositionProcessingCompleted → enqueue EvidenceAuditJob</li><li>OnPrePublishExportRequested → require successful EvidenceAuditJob</li></ul><h4 id="audit-events-required-4">Audit Events (Required)</h4><ul><li>EvidenceAuditStarted</li><li>EvidenceAuditCompleted</li><li>EvidenceAuditReportGenerated</li><li>UnsupportedElementFlagged</li><li>OrphanArtifactDetected</li><li>ContradictionFlagged</li><li>ReadinessGateBlocked (if applicable)</li><li>AttorneyOverrideRecorded (if applicable)</li></ul><h4 id="failure-classification-and-handling-4">Failure Classification and Handling</h4><ul><li>Retryable: transient DB/tool timeouts during reads</li></ul><p><strong>Blocking:</strong> missing CASE_CONTEXT_PLAYBOOK; missing required mapping package; missing required artifacts for stage</p><p><strong>Integrity:</strong> invalid trace references; chunk offsets out of range; broken artifact lineage</p><p>All blocking/integrity failures must:</p><p>create ISSUE (policy controlled)</p><p>surface on dashboards</p><p>prevent readiness gates where applicable</p><h3 id="onboard_agent-2">ONBOARD_AGENT</h3><h4 id="description-5">Description</h4><p>ONBOARD_AGENT governs formal matter initiation after preliminary intake and attorney acceptance. It transitions a case from intake state to active case state, establishes tenancy boundaries, enforces consent and authorization requirements, initializes workflow state, and provisions case-scoped data isolation.</p><p>ONBOARD_AGENT does not interpret evidence and does not generate legal content. Its role is governance, configuration, and environment preparation.</p><h4 id="differentiating-capability-governed-case-activation">Differentiating Capability — Governed Case Activation</h4><p>ONBOARD_AGENT ensures that:</p><ul><li>Attorney acceptance is recorded and auditable.</li><li>Engagement terms are finalized and versioned.</li><li>Case tenancy boundaries (case_id, encryption scopes, policy profile) are locked.</li><li>Required compliance artifacts are stored (engagement agreement, disclosures).</li><li>Initial workflow state is deterministically initialized.</li><li>Case activation cannot occur without required approvals.</li></ul><p>This prevents unauthorized evidence processing or artifact creation before formal representation.</p><h4 id="where-onboarding-output-lives">Where Onboarding Output Lives</h4><ul><li>ACTIVE_CASE_STORE: case status, jurisdiction, matter_type, workflow_state initialization.</li><li>ARTIFACT_STORE: engagement_agreement artifact (versioned), consent artifacts.</li><li>OPERATIONAL_STORE: billing profile, cost caps, resource allocations.</li><li>AUDIT_LOG_STORE: all onboarding events.</li></ul><h4 id="dikw-contribution-5">DIKW Contribution</h4><ul><li>Data: attorney acceptance decision, engagement metadata, jurisdiction, policy profile.</li><li>Information: case activation state, workflow baseline configuration.</li><li>Knowledge: none (no interpretation).</li><li>Wisdom: none.</li></ul><h4 id="execution-mode-5">Execution Mode</h4><p>Deterministic only. All onboarding transitions must be reproducible and auditable.</p><h4 id="responsibilities-authoritative-5">Responsibilities (Authoritative)</h4><ul><li>Record attorney acceptance or rejection.</li><li>Verify CASE_PERSPECTIVE is Approved and lock the approved version reference for the matter.</li><li>Finalize case_id (if not already finalized) and initialize tenancy boundaries.</li><li>Assign jurisdiction and policy profile.</li><li>Initialize:</li><li>encryption scopes</li><li>data retention class</li><li>workflow stage baseline</li><li>required artifact checklist for baseline stage</li><li>Create ENGAGEMENT_ARTIFACT (versioned).</li><li>Initialize directives registry for the case (attorney directive authority boundaries).</li><li>Register cost ledger baseline (if enabled).</li><li>Update dashboards and emit onboarding completion events.</li></ul><h4 id="key-inputs-5">Key Inputs</h4><ul><li>Attorney acceptance decision.</li><li>Approved CASE_PERSPECTIVE (version reference).</li><li>Engagement terms template (versioned).</li><li>Jurisdiction and matter classification.</li><li>Operational billing configuration and cost caps (if enabled).</li><li>Policy profile selection (retention class, tool permissions, provider allowlist).</li></ul><p>Processing Rules and Constraints</p><ul><li>Must not activate case if CASE_PERSPECTIVE is not Approved.</li><li>Must not permit downstream agent jobs prior to activation.</li><li>Must record attorney identity, timestamp, and acceptance rationale code (policy-defined).</li><li>Must not access legal research tools.</li><li>Must not modify evidence or mapping layers.</li><li>Must emit CaseActivated only after engagement artifact creation succeeds.</li></ul><h4 id="key-outputs-authoritative-5">Key Outputs (Authoritative)</h4><ul><li>CASE_ACTIVATED state transition and baseline WORKFLOW_STATE initialization.</li><li>ENGAGEMENT_ARTIFACT (versioned).</li><li>POLICY_PROFILE snapshot stored (case-scoped).</li><li>DIRECTIVE_REGISTRY initialized (case-scoped).</li><li>Dashboard updates:</li><li>case_status = Active</li><li>onboarding_complete_flag</li><li>next_required_action (policy-driven)</li></ul><h4 id="operational-data-semantics-crud-notifications-idempotency-3">Operational Data Semantics (CRUD + Notifications + Idempotency)</h4><ul><li>Create: case activation record; engagement artifact version; workflow initialization record; directive registry record.</li><li>Append-only: engagement updates produce new artifact versions.</li><li>Never overwrite: prior acceptance records; prior engagement versions.</li><li>Idempotency: OnboardJob must accept idempotency_key; repeated calls must not reinitialize workflow or duplicate engagement artifacts.</li><li>Events emitted:</li><li>AttorneyAcceptedCase / AttorneyRejectedCase</li><li>CaseActivated</li><li>EngagementArtifactCreated</li><li>WorkflowStateInitialized</li><li>AgentJobCompleted</li><li>CaseStateUpdated</li></ul><h4 id="job-types-and-triggers-minimum-5">Job Types and Triggers (Minimum)</h4><ul><li>Job Type: OnboardCaseJob (attorney acceptance → activation).</li><li>Triggers (policy-controlled):</li><li>OnAttorneyAcceptedCase → enqueue OnboardCaseJob</li></ul><h4 id="minimum-api-endpoints-semantic-3">Minimum API Endpoints (Semantic)</h4><p>(All served by Application/API; executed via Orchestration)</p><ul><li>POST /api/cases/{case_id}/attorney/accept</li><li>POST /api/cases/{case_id}/attorney/reject</li><li>POST /api/cases/{case_id}/onboard/activate</li><li>GET /api/cases/{case_id}/onboard/status</li><li>GET /api/cases/{case_id}/engagement/versions</li></ul><h4 id="audit-events-required-5">Audit Events (Required)</h4><ul><li>AttorneyAcceptedCase</li><li>AttorneyRejectedCase</li><li>CaseActivated</li><li>EngagementArtifactCreated</li><li>WorkflowStateInitialized</li><li>PolicyProfileLocked</li><li>DirectiveRegistryInitialized</li></ul><h4 id="failure-classification-and-handling-5">Failure Classification and Handling</h4><ul><li>Blocking: missing attorney approval; missing required consent artifacts; CASE_PERSPECTIVE not Approved.</li><li>Integrity: mismatch between CASE_PERSPECTIVE version and approval record; missing engagement artifact lineage.</li><li>All failures: create Issue and prevent activation.</li></ul><hr/><h3 id="file_intake_agent-authoritative">FILE_INTAKE_AGENT (Authoritative)</h3><h4 id="description-6">Description</h4><p>FILE_INTAKE_AGENT is responsible for secure, auditable, and deterministic ingestion of case-scoped files and media into the platform. It preserves original evidence immutability, establishes upload session governance, detects duplicates and threaded/continuation content, and prepares an authoritative file set for downstream deterministic processing.</p><p>FILE_INTAKE_AGENT does not perform extraction, interpretation, chunking, mapping, or legal reasoning. Its responsibility is controlled intake, governance, integrity protection, attorney visibility, and orchestration triggers.</p><hr/><h4 id="core-mandate-authoritative">Core Mandate (Authoritative)</h4><p>FILE_INTAKE_AGENT must ensure:</p><ul><li>All uploaded files are immutable and integrity-protected.</li><li>Uploads are governed by an explicit UPLOAD_SESSION lifecycle with deterministic closure rules.</li><li>Duplicates are detected deterministically (hash-based) and never overwrite prior evidence.</li><li>Threaded and redundant content is identified and grouped under THREAD_GROUP governance.</li><li>Attorney review and impact notification occurs when required by stage and policy.</li><li>No downstream processing begins without policy-compliant session closure and preconditions.</li><li>All actions are auditable, reproducible, and case-scoped.</li></ul><hr/><h4 id="upload_session-governance-model-authoritative">UPLOAD_SESSION Governance Model (Authoritative)</h4><p>All uploads occur within an explicit UPLOAD_SESSION.</p><p>UPLOAD_SESSION Attributes (Minimum)</p><ul><li>upload_session_id</li><li>case_id</li><li>uploader_identity (user_id + role)</li><li>session_status</li><li>session_context (pre-complaint / post-complaint / discovery / deposition / pre-trial / other)</li><li>file_count_received</li><li>duplicate_count</li><li>thread_detected_count</li><li>authoritative_flags_count</li><li>created_timestamp</li><li>closed_timestamp</li><li>correlation_id</li><li>UPLOAD_SESSION.status States (Authoritative)</li><li>Initialized (session created; no files yet)</li><li>Active (files being uploaded)</li><li>PendingReview (policy requires attorney/staff disposition before closure)</li><li>Closed (session confirmed closed; eligible for downstream orchestration)</li><li>Reopened (new uploads appended under governance; triggers impact rules)</li><li>Aborted (session terminated; no downstream execution)</li><li>Session Rules (Hard Constraints)</li><li>Each uploaded file must be linked to exactly one upload_session_id at ingest time.</li><li>Session may remain Active across multiple uploads.</li><li>Closing a session emits UploadSessionCompleted event.</li><li>Downstream ProcessingJob cannot begin until:</li><li>UPLOAD_SESSION.status = Closed</li><li>all file hashes validated</li><li>no blocking intake Issues exist</li><li>CASE_PERSPECTIVE is Approved and CASE_CONTEXT_PLAYBOOK exists (see 9.6.6)</li><li>If policy requires attorney review, the session must transition:</li><li>Active → PendingReview → Closed (after disposition recorded)</li></ul><hr/><h4 id="file-integrity-and-immutability-rules-authoritative">File Integrity and Immutability Rules (Authoritative)</h4><p>For every uploaded file:</p><p>Required Metadata (Minimum)</p><ul><li>file_id (UUID)</li><li>case_id</li><li>original_filename</li><li>mime_type</li><li>file_size</li><li>content_hash (SHA-256 or stronger)</li><li>upload_timestamp</li><li>upload_session_id</li><li>uploader_identity</li><li>authoritative_flag (default false)</li><li>version_index (if same filename re-uploaded)</li><li>Hard Constraints</li><li>Original file bytes must never be modified.</li><li>content_hash must be immutable once written.</li><li>Re-uploads of identical hash must:</li><li>link to existing file record (do not duplicate evidence bytes)</li><li>increment duplicate_count</li><li>emit DuplicateDetected event</li><li>Overwrites are prohibited; a new upload that is not byte-identical creates a new file_id (even if filename matches).</li><li>File admission must enforce policy: allowed types, size limits, malware scanning, and quarantine workflows (policy-controlled) before session closure.</li></ul><hr/><h4 id="thread-and-redundant-content-governance-authoritative">Thread and Redundant Content Governance (Authoritative)</h4><p>The system must detect threaded or cumulative content, including:</p><ul><li>Email reply chains with quoted prior messages.</li><li>Text message exports containing repeated conversation history.</li><li>Forwarded message blocks containing prior content.</li><li>Thread Detection Requirements (Minimum)</li><li>The system must:</li><li>identify overlapping content segments</li><li>detect repeated quoted blocks</li><li>detect cumulative inclusion patterns across files</li><li>group related files into THREAD_GROUP</li><li>THREAD_GROUP Attributes (Minimum)</li><li>thread_group_id</li><li>case_id</li><li>detection_basis (hash overlap / quote-block detection / provider export type / other)</li><li>canonical_subject (if applicable)</li><li>participants[] (if available from headers/metadata)</li><li>time_range (if derivable from metadata)</li><li>member_file_ids[]</li><li>authoritative_file_id (default latest cumulative unless overridden)</li><li>attorney_override_flag</li><li>redundant_content_refs[] (optional; internal references only)</li><li>created_timestamp</li><li>Default Rule (Hard Constraint)</li><li>The latest cumulative thread file is the default authoritative representation.</li><li>Earlier thread members remain preserved (immutability).</li><li>Redundant content must not inflate:</li><li>evidence counts</li><li>element coverage</li><li>fact frequency</li><li>Downstream agents must treat authoritative_file_id as the default anchor for extraction/mapping unless attorney override is recorded.</li><li>Attorney Override (Authoritative)</li><li>Attorney may:</li><li>designate a different authoritative_file_id</li><li>mark a file as non-authoritative but preserved</li><li>flag privileged segments (policy-controlled)</li><li>All overrides must be audited and must emit AttorneyOverrideRecorded event.</li></ul><hr/><p>Interaction With TEXT_VAULT and Downstream Processing (Authoritative)</p><p>FILE_INTAKE_AGENT does not create TEXT_VAULT or TEXT_CHUNKS. However, it must enforce a deterministic handoff contract.</p><p>Processing Preconditions (Hard Constraint)</p><p>PROCESSING_AGENT may execute only when:</p><ul><li>CASE_PERSPECTIVE is Approved</li><li>CASE_CONTEXT_PLAYBOOK is generated</li><li>UPLOAD_SESSION is Closed</li><li>file hashes validated</li><li>no blocking Issues exist</li><li>attorney/staff disposition completed if policy required PendingReview</li></ul><p>Deterministic Handoff Contract (Minimum Inputs to ProcessingJob)</p><p>ProcessingJob must receive:</p><ul><li>upload_session_id</li><li>file_set_version (stable identifier for the authoritative file set derived from the session)</li><li>file_ids[]</li><li>thread_group_ids[]</li><li>authoritative_file_flags[] (including authoritative_file_id per THREAD_GROUP)</li><li>session_context</li><li>correlation_id</li></ul><p>This ensures deterministic replay and complete context capture for extraction and later citation.</p><hr/><h4 id="attorney-review-and-late-upload-impact-governance-authoritative">Attorney Review and Late-Upload Impact Governance (Authoritative)</h4><p>Upon UploadSessionCompleted, the system must generate:</p><p>UploadImpactPreliminaryReport (Artifact; Versioned; Deterministic Generation)</p><p>Minimum contents:</p><ul><li>new_actor_candidates[] (candidate only; no factual assertion)</li><li>new_event_candidates[] (candidate only; no factual assertion)</li><li>contradiction_risk_indicator (advisory flag only)</li><li>potential_COA_element_impact[] (candidate impacts only)</li><li>thread_groups_detected[]</li><li>duplicate_summary</li><li>case_stage_context</li><li>recommended_next_actions</li><li>deterministic_run_metadata</li></ul><p>Case Stage Sensitivity Rules (Hard Constraints)</p><p>If case stage is:</p><ul><li>Pre-Complaint → normal processing allowed.</li><li>Complaint Filed → must trigger MappingRevalidation recommendation.</li><li>COA Finalized → must recommend CoverageSummary re-run.</li><li>Discovery Phase → flag interrogatory implications.</li><li>Deposition Phase → flag witness relevance.</li><li>Pre-Trial → trigger trial artifact recheck recommendation.</li></ul><p>If new files introduce any of the following indicators:</p><ul><li>contradiction vs filed pleading</li><li>new support for previously unsupported element</li><li>exposure risk</li></ul><p>System must:</p><ul><li>create Issue</li><li>notify attorney</li><li>require explicit disposition before any drafting updates occur</li></ul><p>System must never automatically modify pleadings.</p><hr/><h4 id="dashboard-integration-requirements-authoritative">Dashboard Integration Requirements (Authoritative)</h4><p>UI must display (case-scoped):</p><ul><li>UPLOAD_SESSION timeline + status</li><li>duplicate detection summary</li><li>THREAD_GROUP summary + authoritative indicators</li><li>authoritative file indicators and attorney overrides</li><li>contradiction risk flags (advisory)</li><li>case-stage impact badge</li><li>attorney disposition required indicator (when policy requires)</li></ul><p>Attorney actions (role-gated; all audited):</p><ul><li>approve Processing enqueue (when policy requires)</li><li>mark file: Non-Evidentiary / Privileged / Excluded / Authoritative Override</li><li>trigger reprocessing workflow (or enqueue recommended jobs)</li><li>assign follow-up Task / Issue disposition notes</li></ul><hr/><h4 id="responsibilities-authoritative-6">Responsibilities (Authoritative)</h4><p>FILE_INTAKE_AGENT must:</p><ul><li>create and manage UPLOAD_SESSION lifecycle</li><li>compute and validate content_hash for each file</li><li>detect duplicates deterministically</li><li>detect threaded content and create THREAD_GROUP</li><li>apply default authoritative thread rules</li><li>support attorney override controls</li><li>generate UploadImpactPreliminaryReport</li><li>emit required audit events</li><li>trigger ProcessingJob via orchestration (policy-gated)</li><li>prevent unauthorized file parsing, summarization, or interpretation</li><li>preserve all original uploads immutably</li></ul><hr/><h4 id="operational-data-semantics-crud-notifications-idempotency-authoritative">Operational Data Semantics (CRUD + Notifications + Idempotency) (Authoritative)</h4><ul><li>Create:</li><li>FILE records</li><li>THREAD_GROUP records</li><li>UPLOAD_SESSION records</li><li>UploadImpactPreliminaryReport artifact versions</li><li>Append-only:</li><li>UPLOAD_SESSION state transitions (audit/transition history)</li><li>THREAD_GROUP membership/authoritative updates (as versioned state)</li><li>Never overwrite:</li><li>original file bytes</li><li>content_hash</li><li>prior UPLOAD_SESSION records</li><li>Idempotency:</li><li>FileUploadJob must accept idempotency_key</li><li>duplicate upload attempts must not create duplicate file records for the same bytes</li><li>Events emitted (minimum):</li><li>FileUploaded</li><li>DuplicateDetected</li><li>ThreadGroupCreated</li><li>UploadSessionCompleted</li><li>UploadImpactReportCreated</li><li>AttorneyOverrideRecorded (if applicable)</li><li>AgentJobCompleted</li><li>CaseStateUpdated</li></ul><hr/><h4 id="evidence-integrity-enforcement-authoritative">Evidence Integrity Enforcement (Authoritative)</h4><p>FILE_INTAKE_AGENT operates under Zero Hallucination Rule and governance-only scope. It must:</p><ul><li>never infer factual meaning from file contents</li><li>never summarize file substance</li><li>never classify evidentiary weight</li><li>never perform element mapping</li><li>never modify file content</li><li>never resolve contradictions</li></ul><p>Its role is governance, integrity, visibility, and orchestration only.</p><hr/><h4 id="failure-classification-and-handling-authoritative">Failure Classification and Handling (Authoritative)</h4><p>Retryable:</p><p>• network interruption</p><p>• temporary storage failure</p><p>• hash computation failure (retriable)</p><p>Blocking:</p><p>• corrupt file</p><p>• hash mismatch</p><p>• storage integrity failure</p><p>• policy-based upload denial</p><p>Integrity:</p><ul><li>duplicate hash mismatch</li><li>thread detection anomaly (invalid grouping lineage)</li><li>file version lineage inconsistency</li><li>multiple authoritative_file_id values within same THREAD_GROUP without attorney override record</li></ul><p>All blocking/integrity failures must:</p><ul><li>create Issue</li><li>surface in dashboard</li><li>emit audit event</li><li>prevent downstream processing</li></ul><hr/><h4 id="job-types-and-triggers-minimum-6">Job Types and Triggers (Minimum)</h4><ul><li>FileUploadJob</li><li>UploadSessionCloseJob</li><li>DuplicateDetectionJob</li><li>ThreadDetectionJob</li><li>UploadImpactAnalysisJob</li><li>AttorneyDispositionJob (policy-gated)</li><li>ProcessingEnqueueJob (policy-gated)</li></ul><hr/><h4 id="minimum-api-endpoints-semantic-4">Minimum API Endpoints (Semantic)</h4><p>(All served by Application/API; executed via Orchestration)</p><ul><li>POST /api/cases/{case_id}/uploads/start-session</li><li>POST /api/cases/{case_id}/uploads/{upload_session_id}/file</li><li>POST /api/cases/{case_id}/uploads/{upload_session_id}/close</li><li>GET /api/cases/{case_id}/uploads/sessions</li><li>GET /api/cases/{case_id}/uploads/{upload_session_id}</li><li>GET /api/cases/{case_id}/uploads/{upload_session_id}/impact-report</li><li>POST /api/cases/{case_id}/uploads/{upload_session_id}/attorney-disposition</li><li>POST /api/cases/{case_id}/processing/enqueue</li></ul><p>The agent must not auto-advance workflow based on late uploads. It must create Issues/Tasks and surface readiness impacts.</p><p>Text_Vault / Chunking Reference Clarification</p><p><strong>Location instruction:</strong> Insert as a bridging note near the end of 9.6 (since Text_Vault is built by Processing, but intake must hand off requirements).</p><p>FILE_INTAKE_AGENT does not create TEXT_VAULT/TEXT_CHUNKS. However, it must enforce prerequisites required for deterministic downstream extraction:</p><p>stable file_id and content_hash at upload time</p><p>authoritative_file_set designation (including thread authoritative_file_id)</p><p>immutable storage of original bytes</p><p>session_id linkage for all uploaded files</p><p>These prerequisites are required inputs for PROCESSING_AGENT to create TEXT_VAULT and TEXT_CHUNKS with reconstructable ordering and citation offsets.</p><h3 id="pleading_agent-2">PLEADING_AGENT</h3><h4 id="description-7">Description</h4><p>PLEADING_AGENT is responsible for drafting and maintaining pleading artifacts (complaint/COA package for plaintiffs; response/answer and related pleadings for defendants) using the structured case record. It proposes pleading language and structures allegations in a template-compliant manner. PLEADING_AGENT does not finalize filings. All pleadings require attorney approval prior to use.</p><p>PLEADING_AGENT must treat CASE_PERSPECTIVE / CASE_CONTEXT_PLAYBOOK as the authoritative “client asserts” narrative lens and must treat MAPPING_AGENT outputs as the authoritative evidence-to-element linkage layer. It may not create factual assertions that are not traceable to authoritative sources and mapped support.</p><h4 id="differentiating-capability-template-driven-pleading-generation-with-evidentiary-support-controls">Differentiating Capability — Template-Driven Pleading Generation With Evidentiary Support Controls</h4><p>PLEADING_AGENT enforces:</p><ul><li>pleading structure consistency (jurisdiction/template)</li><li>allegations decomposed into discrete pleading items (allegation_id)</li><li>every factual assertion must be traceable to sources and/or explicitly labeled as client-asserted and unmapped</li><li>unsupported elements generate Issues; they do not become “filled in”</li></ul><h4 id="where-pleading-output-lives-authoritative-storage-model">Where Pleading Output Lives (Authoritative Storage Model)</h4><ul><li>ARTIFACT_STORE: versioned PLEADING_PACKAGE artifacts (append-only)</li><li>ACTIVE_CASE_STORE: ALLEGATION / PLEADING_ITEM index tables + linkages to mappings</li><li>AUDIT_LOG_STORE: attorney approvals, directive-based research access, publish/export actions</li><li>TEXT_VAULT / TEXT_CHUNKS: referenced sources (immutable)</li></ul><h4 id="dikw-contribution-6">DIKW Contribution</h4><ul><li>Data: CASE_PERSPECTIVE, TEXT_CHUNKS, mappings, COA definitions, templates</li><li>Information: structured allegations + pleadings drafts + pleading item index</li><li>Knowledge: pleading coverage status and deficiency flags by COA element/allegation</li><li>Wisdom: none (no legal conclusions beyond structured drafting; advisory only)</li></ul><h4 id="execution-mode-6">Execution Mode</h4><ul><li>Non-Deterministic: allowed only for drafting language suggestions; must be marked “proposed draft text”</li><li>Deterministic: required for persisted PLEADING_PACKAGE artifact generation, allegation indexing, and all linkages</li></ul><h4 id="responsibilities-authoritative-7">Responsibilities (Authoritative)</h4><ul><li>Consume:</li><li>CASE_CONTEXT_PLAYBOOK (required; record perspective_context_snapshot_id)</li><li>mapping package(s) (required for evidence-supported drafting)</li><li>COA artifacts + element definitions (jurisdiction policy)</li><li>pleading template package (versioned)</li><li>Produce:</li><li>complaint draft (plaintiff) and/or answer/response drafts (defendant)</li><li>allegation list with unique allegation_id per pleading item</li><li>pleading-to-element coverage summary (supported/partial/unsupported)</li><li>Create Issues/Tasks (policy-controlled) for:</li><li>unsupported elements/allegations</li><li>contradictions with CASE_CONTEXT_PLAYBOOK anchors</li><li>missing required statutory/template components</li><li>Route drafts to attorney for approval; do not finalize</li></ul><h4 id="key-inputs-6">Key Inputs</h4><ul><li>CASE_CONTEXT_PLAYBOOK</li><li>MAPPING_PACKAGE (latest or attorney-selected version)</li><li>COA artifact and/or element-definition references (jurisdiction profile)</li><li>pleading template package + formatting rules</li><li>policy snapshot (jurisdiction, pleading types allowed, required sections)</li><li>attorney directives (for legal library access if enabled)</li></ul><h4 id="processing-rules-and-constraints-5">Processing Rules and Constraints</h4><ul><li>Must not invent facts; factual allegations require evidence trace refs and/or explicit client-asserted labels</li><li>Must not treat CASE_PERSPECTIVE as evidence; it is a lens (client asserts)</li><li>Must not finalize pleadings; requires attorney approval record</li><li>Must preserve allegation granularity: each allegation is a discrete indexed object</li><li>Must generate contradiction flags when draft conflicts with CASE_CONTEXT_PLAYBOOK anchors or mapping contradictions</li></ul><h4 id="key-outputs-authoritative-6">Key Outputs (Authoritative)</h4><ul><li>PLEADING_PACKAGE artifact (versioned) including:</li><li>pleading_type (complaint/answer/etc.)</li><li>allegations[] (allegation_id, text, client_asserted_flag, evidence_refs[])</li><li>COA coverage summary</li><li>contradiction_flags</li><li>unresolved_issues</li><li>deterministic_run_metadata</li><li>ACTIVE_CASE_STORE updates: allegation index tables + linkage references</li><li>Attorney review packet (dashboard surfacing + disposition workflow)</li></ul><h4 id="operational-data-semantics-crud-notifications-idempotency-4">Operational Data Semantics (CRUD + Notifications + Idempotency)</h4><ul><li>Create: PLEADING_RUN, PLEADING_PACKAGE artifact version, allegation index records</li><li>Append-only: all revised drafts are new artifact versions</li><li>Controlled upsert: allegation index may evolve with version history preserved</li><li>Idempotency: PleadingJob must accept idempotency_key; repeats must not duplicate versions for same run</li><li>Events: PleadingDraftStarted, PleadingDraftCompleted, ArtifactVersionCreated (pleading_package), CaseStateUpdated, IssueCreated (if applicable)</li></ul><h4 id="evidence-integrity-enforcement-3">Evidence Integrity Enforcement</h4><ul><li>Zero Hallucination Rule applies</li><li>Every factual allegation must include evidence trace refs or be explicitly labeled “client asserts / unmapped”</li><li>Insufficient evidence → Issue creation; do not infer or fabricate</li><li>Deterministic required for any persisted draft artifact generation</li></ul><h4 id="attorney-gated-legal-library-access-directive-only-optional-2">Attorney-Gated Legal Library Access (Directive Only; Optional)</h4><p>If enabled and attorney-directed, PLEADING_AGENT may retrieve:</p><ul><li>jurisdictional pleading standards/checklists</li><li>statutory elements and mandatory pleading content guidance</li></ul><p><strong>Controls:</strong> explicit directive + audit logging; references stored as legal_reference artifacts; never treated as evidence.</p><h4 id="audit-events-required-6">Audit Events (Required)</h4><ul><li>PleadingDraftStarted</li><li>PleadingDraftCompleted</li><li>AllegationsIndexed</li><li>UnsupportedElementFlagged</li><li>ContradictionFlagged</li><li>AttorneyApprovalRecorded (when approved)</li><li>AttorneyDirectiveRecorded (if legal research enabled)</li></ul><h4 id="failure-classification-and-handling-6">Failure Classification and Handling</h4><ul><li>Blocking: missing CASE_CONTEXT_PLAYBOOK; missing mapping package when policy requires evidence-supported draft</li><li>Integrity: missing trace refs; broken allegation indexing lineage</li><li>All blocking/integrity failures create Issue and prevent publish/export readiness</li></ul><h4 id="job-types-and-triggers-minimum-7">Job Types and Triggers (Minimum)</h4><ul><li>PleadingDraftJob</li><li>AllegationIndexJob</li><li>PleadingCoverageJob</li><li>AttorneyReviewRoutingJob</li></ul><h4 id="minimum-api-endpoints-semantic-5">Minimum API Endpoints (Semantic)</h4><ul><li>POST /api/cases/{case_id}/pleadings/draft</li><li>GET /api/cases/{case_id}/pleadings/versions</li><li>GET /api/cases/{case_id}/pleadings/coverage</li><li>POST /api/cases/{case_id}/pleadings/{version_id}/route-attorney</li><li>POST /api/cases/{case_id}/approvals/pleadings/{version_id}</li></ul><hr/><h3 id="interrogatory_agent-2">INTERROGATORY_AGENT</h3><h4 id="description-8">Description</h4><p>INTERROGATORY_AGENT drafts interrogatories based on the structured case record and mapping gaps. It produces versioned interrogatory packages aligned to jurisdictional procedure (e.g., FRCP 33 or state equivalents) and flags issues requiring attorney disposition. It does not finalize service; attorney review is mandatory.</p><h4 id="differentiating-capability-gap-driven-discovery-drafting">Differentiating Capability — Gap-Driven Discovery Drafting</h4><ul><li>Uses MAPPING_AGENT outputs and EVIDENCE_AUDIT_REPORT findings to draft interrogatories targeting missing facts/evidence and clarifying contradictions</li><li>Prevents waiver risks by recommending objections where appropriate (directive-gated)</li></ul><h4 id="where-output-lives">Where Output Lives</h4><ul><li>ARTIFACT_STORE: INTERROGATORY_PACKAGE (versioned)</li><li>ACTIVE_CASE_STORE: interrogatory index + mapping to COA elements/allegations</li><li>AUDIT_LOG_STORE: approvals, directives</li></ul><h4 id="dikw-contribution-7">DIKW Contribution</h4><ul><li>Data: mapping gaps, issues, text_chunks references</li><li>Information: interrogatory set with targets and linked rationale</li><li>Knowledge: discovery coverage status by element and witness/entity</li><li>Wisdom: advisory only</li></ul><h4 id="execution-mode-7">Execution Mode</h4><ul><li>Non-Deterministic: drafting suggestions only</li><li>Deterministic: persisted artifact generation and linkages</li></ul><h4 id="responsibilities">Responsibilities</h4><ul><li>Load CASE_CONTEXT_PLAYBOOK (record perspective_context_snapshot_id)</li><li>Load latest mapping + evidence audit outputs</li><li>Draft interrogatories:</li><li>element-driven (COA/allegation gaps)</li><li>contradiction-driven (inconsistency clarification)</li><li>identification/production targeting (facts-to-evidence gaps)</li><li>Link each interrogatory to: COA element(s), allegation_id(s), issue_id(s), evidence gaps</li><li>Route to attorney review</li></ul><h4 id="inputs">Inputs</h4><ul><li>CASE_CONTEXT_PLAYBOOK</li><li>MAPPING_PACKAGE</li><li>EVIDENCE_AUDIT_REPORT</li><li>jurisdiction policy profile</li><li>attorney directives (optional for objections library/legal rules)</li></ul><h4 id="rulesconstraints">Rules/Constraints</h4><ul><li>Must not assert facts; must frame requests as information seeking</li><li>Must not infer missing evidence; must target gaps explicitly</li><li>Must include rationale and linkage per interrogatory</li><li>Must not finalize service</li></ul><h4 id="outputs">Outputs</h4><ul><li>INTERROGATORY_PACKAGE artifact including:</li><li>interrogatories[] (id, text, linked_elements, linked_issues, rationale, trace_refs where applicable)</li><li>objection_suggestions[] (directive-gated)</li><li>deterministic_run_metadata</li><li>Discovery dashboard updates + attorney routing</li></ul><h4 id="operational-data-semantics">Operational Data Semantics</h4><ul><li>Create: InterrogatoryRun, InterrogatoryPackage version</li><li>Append-only: revisions are new versions</li><li>Idempotency: InterrogatoryJob idempotent by key</li><li>Events: InterrogatoryDraftStarted/Completed, ArtifactVersionCreated, IssueCreated (if applicable)</li></ul><h4 id="evidence-integrity-enforcement-4">Evidence Integrity Enforcement</h4><ul><li>Zero Hallucination Rule applies; no invented factual premises</li><li>Deterministic required for persisted packages</li></ul><h4 id="attorney-gated-legal-library-access-directive-only">Attorney-Gated Legal Library Access (Directive Only)</h4><p><strong>If enabled:</strong> procedure rules, objection standards. Store as reference artifacts; never evidence.</p><h4 id="audit-events">Audit Events</h4><ul><li>InterrogatoryDraftStarted/Completed</li><li>ObjectionSuggestionGenerated (if applicable)</li><li>AttorneyApprovalRecorded</li></ul><h4 id="failure-handling-3">Failure Handling</h4><ul><li>Blocking: missing mapping/evidence audit outputs required by policy</li><li>Integrity: broken linkage references</li><li>Create Issue and block readiness if required</li></ul><h4 id="jobstriggers">Jobs/Triggers</h4><ul><li>InterrogatoryDraftJob (often after MappingCompleted or EvidenceAuditCompleted)</li><li>InterrogatoryLinkageJob</li><li>AttorneyReviewRoutingJob</li></ul><h4 id="apis">APIs</h4><ul><li>POST /api/cases/{case_id}/discovery/interrogatories/draft</li><li>GET /api/cases/{case_id}/discovery/interrogatories/versions</li><li>POST /api/cases/{case_id}/approvals/interrogatories/{version_id}</li></ul><hr/><h3 id="deposition_prep_agent-2">DEPOSITION_PREP_AGENT</h3><h4 id="description-9">Description</h4><p>DEPOSITION_PREP_AGENT builds deposition outlines and exhibit plans using the structured case record. It sequences topics and questions aligned to mapped COA elements/allegations and evidence gaps. Outputs are advisory and require attorney review.</p><h4 id="differentiating-capability-admission-targeted-evidence-linked-outlines">Differentiating Capability — Admission-Targeted, Evidence-Linked Outlines</h4><ul><li>Links each outline section to mapped elements and supporting/contradictory evidence</li><li>Explicitly marks admission targets and contradiction resolution objectives</li><li>Produces exhibit lists with chunk-level trace pointers</li></ul><h4 id="where-output-lives-2">Where Output Lives</h4><ul><li>ARTIFACT_STORE: DEPOSITION_OUTLINE_PACKAGE (versioned)</li><li>ACTIVE_CASE_STORE: witness/deponent linkage and exhibit indices</li><li>AUDIT_LOG_STORE: approvals</li></ul><h4 id="dikw">DIKW</h4><ul><li>Data: mapping package, text_chunks, issues, witness profiles</li><li>Information: outline structure + exhibits + admission targets</li><li>Knowledge: deposition coverage vs COA elements/allegations</li><li>Wisdom: advisory only</li></ul><h4 id="execution-mode-8">Execution Mode</h4><ul><li>Non-Deterministic: drafting suggestions only</li><li>Deterministic: persisted outline artifact generation and linkage indices</li></ul><h4 id="responsibilities-2">Responsibilities</h4><ul><li>Load CASE_CONTEXT_PLAYBOOK (record snapshot id)</li><li>Load mapping + evidence audit + pleadings (as applicable)</li><li>Build outline: topics → questions → admission targets</li><li>Select exhibits: evidence refs + chunk offsets</li><li>Create issues for missing exhibits or unresolved contradictions</li><li>Route to attorney review</li></ul><h4 id="inputs-2">Inputs</h4><ul><li>CASE_CONTEXT_PLAYBOOK</li><li>MAPPING_PACKAGE</li><li>EVIDENCE_AUDIT_REPORT</li><li>witness tracking inputs (if available)</li><li>jurisdiction procedural policy (optional)</li></ul><h4 id="rulesconstraints-2">Rules/Constraints</h4><ul><li>Must not invent testimony expectations; mark as “objective” not “fact”</li><li>Must not alter evidence; must cite exhibits by trace refs</li><li>Must not finalize deposition strategy without attorney approval</li></ul><h4 id="outputs-2">Outputs</h4><ul><li>DEPOSITION_OUTLINE_PACKAGE artifact including:</li><li>deponent profile ref</li><li>outline_sections[] (topic, objectives, linked_elements, linked_evidence_refs)</li><li>exhibit_list[] (evidence refs + chunk pointers)</li><li>contradiction_targets[]</li><li>deterministic_run_metadata</li></ul><h4 id="operational-semantics">Operational Semantics</h4><ul><li>Create: DepositionPrepRun, OutlinePackage version</li><li>Append-only revisions</li><li>Idempotency enforced</li><li>Events: DepositionPrepStarted/Completed, ArtifactVersionCreated, IssueCreated</li></ul><h4 id="evidence-integrity">Evidence Integrity</h4><ul><li>Zero Hallucination Rule: no invented facts; exhibits must be traceable</li><li>Deterministic for persisted outputs</li></ul><h4 id="attorney-gated-legal-library-access-directive-only-optional-3">Attorney-Gated Legal Library Access (Directive Only; Optional)</h4><p>Admissibility/procedure reference materials only; stored as reference artifacts.</p><h4 id="audit-events-2">Audit Events</h4><ul><li>DepositionPrepStarted/Completed</li><li>ExhibitLinked</li><li>AttorneyApprovalRecorded</li></ul><h4 id="failure-handling-4">Failure Handling</h4><ul><li>Blocking: missing mapping package when required</li><li>Integrity: broken exhibit trace refs</li><li>Create Issue + surface on dashboard</li></ul><h4 id="jobstriggers-2">Jobs/Triggers</h4><ul><li>DepositionPrepJob</li><li>ExhibitLinkageJob</li><li>AttorneyReviewRoutingJob</li></ul><h4 id="apis-2">APIs</h4><ul><li>POST /api/cases/{case_id}/depositions/prep/draft</li><li>GET /api/cases/{case_id}/depositions/prep/versions</li><li>POST /api/cases/{case_id}/approvals/depositions/prep/{version_id}</li></ul><hr/><h3 id="deposition_processing_agent-authoritative-consolidated">DEPOSITION_PROCESSING_AGENT (Authoritative; Consolidated)</h3><h4 id="description-10">Description</h4><p>DEPOSITION_PROCESSING_AGENT ingests deposition audio/video, generates transcripts (STT), creates TEXT_VAULT/TEXT_CHUNKS, and deterministically connects testimony segments to allegations/COA elements via traceable mapping references. It flags contradictions, admissions, and inconsistencies as issues without resolving them.</p><h4 id="differentiating-capability-testimony-to-element-traceability-with-contradiction-detection">Differentiating Capability — Testimony-to-Element Traceability With Contradiction Detection</h4><ul><li>Builds semantically labeled time markers and segment IDs</li><li>Links testimony segments to mapped elements/allegations and exhibits</li><li>Generates admissibility-relevant designation candidates (advisory) without legal conclusions</li></ul><h4 id="where-output-lives-3">Where Output Lives</h4><ul><li>TEXT_VAULT / TEXT_CHUNKS: transcript text + time/offset pointers</li><li>ARTIFACT_STORE: DEPOSITION_PROCESSING_REPORT (versioned)</li><li>ACTIVE_CASE_STORE: testimony segment indices + linkage to mappings/issues</li><li>AUDIT_LOG_STORE: ingestion integrity and approvals</li></ul><h4 id="data-media-files-transcript-chunks-segment-markers">Data: media files, transcript chunks, segment markers</h4><ul><li>Information: linked testimony segments, admissions flags, contradiction flags</li><li>Knowledge: cross-deposition comparisons and coverage status (case-scoped)</li><li>Wisdom: advisory only</li></ul><h4 id="execution-mode-9">Execution Mode</h4><ul><li>Deterministic required for: transcript artifact creation, chunking, segment indexing, persisted reports and linkages</li><li>Non-Deterministic allowed only for candidate topic labeling (must be labeled “candidate”)</li></ul><h4 id="responsibilities-3">Responsibilities</h4><ul><li>Load CASE_CONTEXT_PLAYBOOK (record snapshot id)</li><li>Ingest deposition media (immutable)</li><li>Run STT → create TEXT_VAULT and TEXT_CHUNKS with timestamps</li><li>Create testimony segments with time bounds and segment_id</li><li>Link segments to:</li><li>allegations/elements (via mapping layer)</li><li>exhibits (via evidence refs)</li><li>Flag: admissions, contradictions, inconsistencies, missing follow-up needs</li><li>Produce report + issues/tasks and update dashboard readiness indicators</li></ul><h4 id="inputs-3">Inputs</h4><ul><li>CASE_CONTEXT_PLAYBOOK</li><li>deposition media upload(s) + hashes</li><li>MAPPING_PACKAGE</li><li>policy snapshot (STT provider, accuracy thresholds, privacy constraints)</li></ul><h4 id="rulesconstraints-3">Rules/Constraints</h4><ul><li>Must not alter original media</li><li>Must not infer facts; all flags must reference transcript segments and/or evidence refs</li><li>Contradictions must be flagged, not reconciled</li><li>All persisted outputs must include trace pointers: chunk_id + timestamp ranges</li></ul><h4 id="outputs-3">Outputs</h4><ul><li>TEXT_VAULT + TEXT_CHUNKS for transcript</li><li>DEPOSITION_PROCESSING_REPORT artifact including:</li><li>segment_index_summary</li><li>admissions_candidates[] (trace refs)</li><li>contradiction_flags[] (trace refs)</li><li>element/allegation linkage summary</li><li>deterministic_run_metadata</li><li>Issues/Tasks (policy controlled) + dashboard updates</li></ul><h4 id="operational-semantics-2">Operational Semantics</h4><ul><li>Create: DepositionProcessingRun, TranscriptVault/Chunks, ProcessingReport version</li><li>Append-only: reprocessing creates new vault/chunks and new report version</li><li>Idempotency: prevents duplicate transcript creation for same run scope</li><li>Events: DepositionProcessingStarted/Completed, TextVaultCreated, TextChunksCreated, ArtifactVersionCreated, IssueCreated</li></ul><h4 id="evidence-integrity-2">Evidence Integrity</h4><ul><li>Zero Hallucination Rule applies</li><li>Deterministic required for persisted evidence-handling outputs</li></ul><h4 id="attorney-gated-legal-library-access-directive-only-optional-4">Attorney-Gated Legal Library Access (Directive Only; Optional)</h4><p>Admissibility standards references only; stored as reference artifacts; never evidence.</p><h4 id="audit-events-3">Audit Events</h4><ul><li>DepositionProcessingStarted/Completed</li><li>TranscriptCreated</li><li>AdmissionsFlagged</li><li>ContradictionFlagged</li></ul><h4 id="failure-handling-5">Failure Handling</h4><ul><li>Blocking: missing mapping package (if required by policy)</li><li>Integrity: transcript offset mismatch, broken segment timestamps</li><li>Create Issue + prevent readiness where applicable</li></ul><h4 id="jobstriggers-3">Jobs/Triggers</h4><ul><li>DepositionSTTJob</li><li>TranscriptChunkingJob</li><li>TestimonySegmentationJob</li><li>DepositionLinkageJob</li><li>EvidenceAuditEnqueueJob (post-processing)</li></ul><h4 id="apis-3">APIs</h4><ul><li>POST /api/cases/{case_id}/depositions/processing/start</li><li>GET /api/cases/{case_id}/depositions/processing/runs</li><li>GET /api/cases/{case_id}/depositions/transcripts/chunks</li><li>GET /api/cases/{case_id}/depositions/processing/reports/versions</li></ul><hr/><h3 id="subpoena_agent-authoritative">SUBPOENA_AGENT (Authoritative)</h3><h4 id="description-11">Description</h4><p>SUBPOENA_AGENT identifies evidence gaps and drafts subpoena requests (targets and document categories) based on the mapped case record and unresolved gaps. It produces advisory drafts and requires attorney approval prior to use or service.</p><h4 id="differentiating-capability-source-oriented-gap-closure">Differentiating Capability — Source-Oriented Gap Closure</h4><ul><li>Converts unmapped/unsupported elements and open questions into subpoena targets and categories</li><li>Preserves defensibility by linking each request to a gap rationale and element/allegation linkage</li></ul><h4 id="where-output-lives-4">Where Output Lives</h4><ul><li>ARTIFACT_STORE: SUBPOENA_PACKAGE (versioned)</li><li>ACTIVE_CASE_STORE: subpoena targets and linkage indices</li><li>AUDIT_LOG_STORE: directives and approvals</li></ul><h4 id="dikw-2">DIKW</h4><ul><li>Data: mapping gaps, issues, open_questions_index</li><li>Information: subpoena draft targets + requested categories</li><li>Knowledge: gap-to-source registry for the case</li><li>Wisdom: advisory only</li></ul><h4 id="execution-mode-10">Execution Mode</h4><ul><li>Non-Deterministic drafting allowed (marked proposed)</li><li>Deterministic required for persisted artifact generation and linkages</li></ul><h4 id="responsibilities-4">Responsibilities</h4><ul><li>Load CASE_CONTEXT_PLAYBOOK (record snapshot id)</li><li>Load mapping + evidence audit + open questions</li><li>Identify subpoena targets and request scopes</li><li>Draft subpoena language (template-based)</li><li>Route for attorney approval</li></ul><h4 id="inputs-4">Inputs</h4><ul><li>CASE_CONTEXT_PLAYBOOK</li><li>MAPPING_PACKAGE</li><li>EVIDENCE_AUDIT_REPORT</li><li>policy/jurisdiction profile + templates</li><li>attorney directives (optional legal library)</li></ul><h4 id="rulesconstraints-4">Rules/Constraints</h4><ul><li>Must not assume the existence of documents not supported by evidence; frame as requests</li><li>Must not finalize or serve; attorney approval required</li><li>Must include linkage rationale per request</li></ul><h4 id="outputs-4">Outputs</h4><ul><li>SUBPOENA_PACKAGE artifact including: targets[], requests[], rationale links, deterministic_run_metadata</li><li>Issues/Tasks (optional) + dashboard updates</li></ul><h4 id="operational-semantics-3">Operational Semantics</h4><ul><li>Create: SubpoenaRun, SubpoenaPackage version</li><li>Append-only revisions</li><li>Idempotent job behavior</li><li>Events: SubpoenaDraftStarted/Completed, ArtifactVersionCreated, AttorneyApprovalRecorded</li></ul><p>Evidence Integrity</p><ul><li>Zero Hallucination Rule; no invented factual premises</li></ul><h4 id="attorney-gated-legal-library-directive-only-optional">Attorney-Gated Legal Library (Directive Only; Optional)</h4><p>Procedure rules (FRCP 45 or state equivalents) stored as reference artifacts.</p><h4 id="audit-events-4">Audit Events</h4><ul><li>SubpoenaDraftStarted/Completed</li><li>AttorneyDirectiveRecorded (if used)</li><li>AttorneyApprovalRecorded</li></ul><h4 id="failure-handling-6">Failure Handling</h4><ul><li>Blocking: missing required gap inputs by policy</li><li>Integrity: broken linkage references</li><li>Create Issue + surface on dashboard</li></ul><h4 id="jobstriggers-4">Jobs/Triggers</h4><ul><li>SubpoenaDraftJob</li><li>TargetRationalizationJob</li><li>AttorneyReviewRoutingJob</li></ul><h4 id="apis-4">APIs</h4><p>• POST /api/cases/{case_id}/subpoenas/draft</p><p>• GET /api/cases/{case_id}/subpoenas/versions</p><p>• POST /api/cases/{case_id}/approvals/subpoenas/{version_id}</p><hr/><h3 id="trial_agent-authoritative">TRIAL_AGENT (Authoritative)</h3><p>Description</p><p>TRIAL_AGENT produces advisory trial preparation artifacts: trial theme summaries, exhibit plans, witness/exhibit sequencing, and risk checklists using the structured case record. It does not replace attorney strategy and cannot finalize trial plans. All outputs are advisory and require attorney review.</p><h4 id="differentiating-capability-readiness-driven-trial-packaging">Differentiating Capability — Readiness-Driven Trial Packaging</h4><ul><li>Uses mapping coverage, evidence audits, deposition outputs, and open issues to generate trial-readiness views</li><li>Identifies weaknesses and mitigation tasks without inventing facts</li></ul><h4 id="where-output-lives-5">Where Output Lives</h4><ul><li>ARTIFACT_STORE: TRIAL_PREP_PACKAGE (versioned)</li><li>ACTIVE_CASE_STORE: exhibit/witness sequencing indices</li><li>AUDIT_LOG_STORE: approvals and overrides</li></ul><h4 id="dikw-3">DIKW</h4><ul><li>Data: all case artifacts + mappings + audits</li><li>Information: trial package + sequencing + checklists</li><li>Knowledge: readiness status by element/allegation and evidentiary support</li><li>Wisdom: advisory only</li></ul><p>Execution Mode</p><ul><li>Non-Deterministic allowed for advisory structuring language only</li><li>Deterministic required for persisted package generation and indices</li></ul><p>Responsibilities</p><ul><li>Load CASE_CONTEXT_PLAYBOOK (record snapshot id)</li><li>Load mapping + latest evidence audit + deposition artifacts + discovery artifacts</li><li>Produce: exhibit plan, witness list, sequencing recommendations, risks, unresolved issues list</li><li>Trigger evidence audit freshness requirement prior to publish/export</li></ul><p>Inputs</p><ul><li>CASE_CONTEXT_PLAYBOOK</li><li>MAPPING_PACKAGE</li><li>EVIDENCE_AUDIT_REPORT (current)</li><li>deposition/discovery/subpoena artifacts (if available)</li><li>policy snapshot (trial package requirements)</li></ul><h4 id="rulesconstraints-5">Rules/Constraints</h4><ul><li>Must not invent facts or claims; must cite evidence refs and/or mapped outputs</li><li>Must not finalize trial strategy; advisory only</li><li>Must require current evidence audit unless attorney override recorded</li></ul><h4 id="outputs-5">Outputs</h4><ul><li>TRIAL_PREP_PACKAGE artifact including: sequencing, exhibit plan, witness plan, risks, deterministic_run_metadata</li><li>Issues/Tasks (policy controlled)</li></ul><h4 id="operational-semantics-4">Operational Semantics</h4><ul><li>Create: TrialPrepRun, TrialPrepPackage version</li><li>Append-only revisions</li><li>Idempotency enforced</li><li>Events: TrialPrepStarted/Completed, ArtifactVersionCreated, CaseStateUpdated</li></ul><h4 id="evidence-integrity-3">Evidence Integrity</h4><ul><li>Zero Hallucination Rule</li><li>Deterministic persisted outputs</li></ul><h4 id="attorney-gated-legal-library-directive-only-optional-2">Attorney-Gated Legal Library (Directive Only; Optional)</h4><p>Admissibility standards and trial procedure references only; stored as reference artifacts.</p><h4 id="audit-events-5">Audit Events</h4><ul><li>TrialPrepStarted/Completed</li><li>ReadinessGateBlocked (if applicable)</li><li>AttorneyOverrideRecorded (if applicable)</li></ul><h4 id="failure-handling-7">Failure Handling</h4><ul><li>Blocking: missing current evidence audit where policy requires</li><li>Integrity: broken exhibit trace refs</li><li>Create Issue + block readiness gates</li></ul><h4 id="jobstriggers-5">Jobs/Triggers</h4><ul><li>TrialPrepJob</li><li>ExhibitPlanJob</li><li>ReadinessCheckJob (often via Conductor/EvidenceAudit)</li></ul><h4 id="apis-5">APIs</h4><ul><li>POST /api/cases/{case_id}/trial/prep/generate</li><li>GET /api/cases/{case_id}/trial/prep/versions</li><li>POST /api/cases/{case_id}/approvals/trial/prep/{version_id}</li></ul><hr/><h3 id="supporting-evidence-strategy-agents-authoritative-case-scoped">SUPPORTING EVIDENCE &amp; STRATEGY AGENTS (Authoritative; Case-Scoped)</h3><h3 id="evidence_correlation_agent-2">EVIDENCE_CORRELATION_AGENT</h3><h4 id="description-12">Description</h4><p>EVIDENCE_CORRELATION_AGENT performs advanced cross-referencing across documents, transcripts, and testimony to propose correlation candidates (fact clusters, repeated motifs, cross-document link candidates) for mapping review. It does not finalize mappings and must not invent facts.</p><p>Execution Mode</p><ul><li>Non-Deterministic allowed for candidate correlation proposals only (marked candidate)</li><li>Deterministic required for persisted correlation_candidate_report artifact generation</li></ul><p>Key Outputs</p><ul><li>CORRELATION_CANDIDATE_REPORT artifact (versioned) including candidate links with trace refs</li><li>Issues/Tasks (optional) recommending mapping review</li></ul><h4 id="constraints">Constraints</h4><ul><li>Must load CASE_CONTEXT_PLAYBOOK and record snapshot id</li><li>Must not write facts or mappings; propose candidates only</li><li>All candidates must include trace refs to TEXT_CHUNKS/artifacts</li></ul><h4 id="events-jobs-apis-minimum">Events / Jobs / APIs (Minimum)</h4><ul><li>Events: CorrelationScanStarted/Completed, ArtifactVersionCreated</li><li>Jobs: CorrelationScanJob</li><li>API: POST /api/cases/{case_id}/evidence/correlations/scan ; GET /versions</li></ul><hr/><p>WITNESS_TRACKING_AGENT</p><h4 id="description-13">Description</h4><p>WITNESS_TRACKING_AGENT maintains witness/deponent profiles, testimony history, linked exhibits, and credibility-relevant notes derived strictly from existing evidence and transcripts (no speculation). It supports deposition prep, trial sequencing, and contradiction tracking.</p><h4 id="execution-mode-11">Execution Mode</h4><p>Deterministic for persisted witness profile artifact versions and linkage indices.</p><h4 id="outputs-6">Outputs</h4><ul><li>WITNESS_PROFILE_PACKAGE (versioned)</li><li>witness-to-exhibit and witness-to-event linkage indices (traceable)</li></ul><h4 id="constraints-2">Constraints</h4><ul><li>Must load CASE_CONTEXT_PLAYBOOK</li><li>Must not infer motives or facts; only derive from traceable sources</li><li>Credibility indicators must be non-determinative and linked to transcript/evidence refs</li></ul><h4 id="events-jobs-apis">Events / Jobs / APIs</h4><ul><li>Events: WitnessProfileUpdated, ArtifactVersionCreated</li><li>Jobs: WitnessProfileBuildJob, WitnessUpdateJob</li><li>API: POST /api/cases/{case_id}/witnesses/build ; GET /witnesses ; GET /witnesses/{id}/versions</li></ul><hr/><h3 id="timeline_agent-2">TIMELINE_AGENT</h3><h4 id="description-14">Description</h4><p>TIMELINE_AGENT constructs a case chronology tied to evidence and testimony. It supports visualization, contradiction detection, and sequencing. Timeline entries must be traceable and must respect CASE_CONTEXT_PLAYBOOK anchors and role time bounds.</p><h4 id="execution-mode-12">Execution Mode</h4><p>Deterministic for persisted timeline artifacts and indices.</p><h4 id="outputs-7">Outputs</h4><ul><li>TIMELINE_PACKAGE artifact (versioned)</li><li>event entries linked to evidence refs and text_chunk pointers</li></ul><h4 id="constraints-3">Constraints</h4><ul><li>Must not guess dates; approximate ranges must be labeled as such</li><li>Conflicts create contradiction flags and Issues; do not reconcile silently</li></ul><h4 id="events-jobs-apis-2">Events / Jobs / APIs</h4><ul><li>Events: TimelineBuildStarted/Completed, ContradictionFlagged, ArtifactVersionCreated</li><li>Jobs: TimelineBuildJob, TimelineRebuildJob</li><li>API: POST /api/cases/{case_id}/timeline/build ; GET /timeline/versions</li></ul><hr/><h3 id="trial_calendar_agent-2">TRIAL_CALENDAR_AGENT</h3><h4 id="description-15">Description</h4><p>TRIAL_CALENDAR_AGENT tracks court deadlines and procedural milestones (case-scoped). It supports reminders, readiness gating, and task assignments aligned to trial readiness. It does not generate legal conclusions.</p><h4 id="execution-mode-13">Execution Mode</h4><p>Deterministic for persisted calendar milestone artifacts and notifications.</p><h4 id="outputs-8">Outputs</h4><ul><li>TRIAL_CALENDAR_PACKAGE artifact (versioned)</li><li>Tasks and reminders (policy controlled)</li></ul><h4 id="constraints-4">Constraints</h4><ul><li>All deadlines must have provenance (court order, docket entry, attorney input)</li><li>Missing provenance creates Issue</li></ul><h4 id="events-jobs-apis-3">Events / Jobs / APIs</h4><ul><li>Events: CalendarUpdated, TaskCreated, ArtifactVersionCreated</li><li>Jobs: CalendarSyncJob, MilestoneUpdateJob</li><li>API: POST /api/cases/{case_id}/calendar/update ; GET /calendar/versions</li></ul><hr/><h3 id="objection_library_agent-directive-gated">OBJECTION_LIBRARY_AGENT (Directive-Gated)</h3><h4 id="description-16">Description</h4><p>OBJECTION_LIBRARY_AGENT is a structured repository of objection language and standards used to support discovery and deposition drafting. Jurisdiction-specific content retrieval is directive-gated and stored as reference artifacts. It never acts as evidence.</p><h4 id="outputs-9">Outputs</h4><ul><li>OBJECTION_LIBRARY_REFERENCE artifact set (versioned; jurisdiction-tagged)</li></ul><h4 id="constraints-5">Constraints</h4><ul><li>Must require attorney directive for jurisdiction-specific retrieval</li><li>Must store references with expiration/revalidation policy controls</li></ul><h4 id="events-jobs-apis-4">Events / Jobs / APIs</h4><ul><li>Events: ObjectionLibraryUpdated, AttorneyDirectiveRecorded</li><li>Jobs: ObjectionLibraryFetchJob</li><li>API: POST /api/cases/{case_id}/references/objections/fetch ; GET /references/objections</li></ul><hr/><h3 id="outcome_model_agent-optional-non-determinative">OUTCOME_MODEL_AGENT (Optional; Non-Determinative)</h3><h4 id="description-17">Description</h4><p>OUTCOME_MODEL_AGENT performs scenario modeling based on the structured case record. Outputs are advisory only and cannot be used to auto-advance workflow or generate publishable legal conclusions. It must never fabricate facts; it must cite assumptions explicitly.</p><h4 id="execution-mode-14">Execution Mode</h4><p>Non-Deterministic advisory modeling permitted; any persisted scenario artifacts must store: inputs, assumptions, and deterministic_run_metadata if deterministic generation is used.</p><h4 id="outputs-10">Outputs</h4><ul><li>OUTCOME_SCENARIO_REPORT artifact (versioned) including assumptions + trace refs</li></ul><h4 id="constraints-6">Constraints</h4><ul><li>Must not present probabilities as facts</li><li>Must not be used for stage transitions or pleadings without attorney review</li></ul><h4 id="events-jobs-apis-5">Events / Jobs / APIs</h4><ul><li>Events: OutcomeModelRunCompleted, ArtifactVersionCreated</li><li>Jobs: OutcomeModelJob</li><li>API: POST /api/cases/{case_id}/advisory/outcomes/run ; GET /versions</li></ul><hr/><h3 id="opposition_agent-deterministic-non-destructive-adversarial-analysis">OPPOSITION_AGENT (Deterministic; Non-Destructive; Adversarial Analysis)</h3><h4 id="description-18">Description</h4><p>OPPOSITION_AGENT simulates opposing counsel strategy using the current structured case record. It produces a versioned OPPOSITION_EXPOSURE_REPORT identifying exposure risks, credibility vulnerabilities, procedural weaknesses, counterarguments, and evidence insufficiencies. Advisory only. It may not modify any case artifacts.</p><h4 id="execution-mode-15">Execution Mode</h4><ul><li>Deterministic only for persisted report generation</li><li>Must record CASE_CONTEXT_PLAYBOOK snapshot id and inputs used</li></ul><h4 id="outputs-11">Outputs</h4><ul><li>OPPOSITION_EXPOSURE_REPORT artifact (versioned) with trace refs and cited weaknesses</li><li>Issues/Tasks (optional; policy controlled)</li></ul><h4 id="constraints-7">Constraints</h4><ul><li>Must not invent facts; all critique must be traceable to record contents</li><li>Must not auto-advance workflow or modify pleadings</li></ul><h4 id="events-jobs-apis-6">Events / Jobs / APIs</h4><ul><li>Events: OppositionAnalysisStarted/Completed, ArtifactVersionCreated</li><li>Jobs: OppositionAnalysisJob</li><li>API: POST /api/cases/{case_id}/advisory/opposition/run ; GET /versions</li></ul><hr/><h3 id="conductor_agent-deterministic-workflow-integrity-governor">CONDUCTOR_AGENT (Deterministic; Workflow Integrity Governor)</h3><h4 id="description-19">Description</h4><p>CONDUCTOR_AGENT validates readiness conditions before major workflow transitions and before publish/export. It ensures required artifacts exist, evidence audits are current, approvals are recorded, and blocking issues are resolved. It produces a versioned CONDUCTOR_READINESS_REPORT and may block transitions unless an attorney override is recorded.</p><h4 id="differentiating-capability-stage-gate-enforcement">Differentiating Capability — Stage Gate Enforcement</h4><ul><li>Enforces artifact checklists by stage</li><li>Requires current EVIDENCE_AUDIT_REPORT within freshness window</li><li>Requires explicit approvals for attorney-gated transitions</li><li>Prevents silent progression when contradictions or gaps exist</li></ul><h4 id="where-output-lives-6">Where Output Lives</h4><ul><li>ARTIFACT_STORE: CONDUCTOR_READINESS_REPORT (versioned)</li><li>ACTIVE_CASE_STORE: readiness gate statuses + linkage to blocking Issues/Approvals</li><li>AUDIT_LOG_STORE: stage transitions and overrides</li></ul><h4 id="execution-mode-16">Execution Mode</h4><ul><li>Deterministic only.</li></ul><h4 id="responsibilities-5">Responsibilities</h4><ul><li>Load workflow state snapshot and required artifact checklist</li><li>Validate:</li><li>required artifacts exist and are current</li><li>evidence audit is current</li><li>required approvals recorded</li><li>blocking issues resolved or overridden</li><li>Emit readiness report</li><li>Block transition unless override recorded</li></ul><h4 id="inputs-5">Inputs</h4><ul><li>workflow state snapshot</li><li>artifact checklist rules by stage</li><li>EVIDENCE_AUDIT_REPORT (current)</li><li>approvals and directives registry</li><li>issues/tasks status</li></ul><h4 id="outputs-12">Outputs</h4><ul><li>CONDUCTOR_READINESS_REPORT artifact including:</li><li>checklist results</li><li>missing/expired artifacts</li><li>blocking issues</li><li>required approvals missing</li><li>override requirements</li><li>deterministic_run_metadata</li><li>readiness gate status updates (dashboard)</li></ul><h4 id="operational-semantics-5">Operational Semantics</h4><ul><li>Create: ConductorRun, readiness report version</li><li>Append-only versions</li><li>Idempotent by stage transition request correlation_id</li><li>Events: ReadinessCheckStarted/Completed, ReadinessGateBlocked/Passed, AttorneyOverrideRecorded (if applicable)</li></ul><h4 id="constraints-8">Constraints</h4><ul><li>Cannot modify case artifacts</li><li>Can only block/unblock transitions via readiness status and explicit overrides</li></ul><h4 id="apis-6">APIs</h4><ul><li>POST /api/cases/{case_id}/readiness/check</li><li>GET /api/cases/{case_id}/readiness/versions</li><li>POST /api/cases/{case_id}/workflow/transition (blocked unless readiness passed or override)</li></ul><hr/></section><section><h2 id="appendix-appendices">APPENDIX / APPENDICES</h2><h3 id="appendix-a-case_context_playbook-schema-authoritative-build-level-contract">APPENDIX A — CASE_CONTEXT_PLAYBOOK Schema (Authoritative; Build-Level Contract)</h3><h4 id="a-1-purpose-authoritative">A.1 Purpose (Authoritative)</h4><p>CASE_CONTEXT_PLAYBOOK is the case-scoped, client-validated, attorney-approved intelligence anchor that defines the case narrative lens and governs interpretation of extracted facts/evidence.</p><p>All downstream agents that interpret, map, draft, or audit must reference a specific playbook_version_id and record it in deterministic_run_metadata.</p><h4 id="a-2-storage-immutability">A.2 Storage + Immutability</h4><ul><li>Stored as ARTIFACT_TYPE = case_context_playbook</li><li>Versioned: append-only (no overwrites)</li><li>Each version must have:</li><li>playbook_version_id (UUID)</li><li>content_hash (SHA-256)</li><li>created_at, created_by, approval_status, approved_by, approved_at</li><li>Any change requires new version and new approval.</li></ul><h4 id="a-3-canonical-json-schema-authoritative">A.3 Canonical JSON Schema (Authoritative)</h4><p><strong>Artifact Type:</strong> case_context_playbook</p><p><strong>Serialization:</strong> JSON (UTF-8)</p><p>Minimum top-level shape:</p><p>{</p><p>"playbook_version_id": "UUID",</p><p>"case_id": "UUID",</p><p>"schema_version": "1.0",</p><p>"status": "DRAFT|CLIENT_VALIDATED|ATTORNEY_APPROVED|DEPRECATED",</p><p>"created_at": "ISO-8601",</p><p>"created_by": { "user_id": "UUID", "role": "CLIENT|STAFF|ATTORNEY|SYSTEM" },</p><p>"approved_at": "ISO-8601|null",</p><p>"approved_by": { "user_id": "UUID", "role": "ATTORNEY|PARTNER" },</p><p>"source_lineage": {</p><p>"case_perspective_version_id": "UUID",</p><p>"intake_session_id": "UUID",</p><p>"inputs": [</p><p>{ "type": "transcript_segment", "ref": { "transcript_id": "UUID", "segment_id": "UUID" } },</p><p>{ "type": "artifact_version", "ref": { "artifact_id": "UUID", "version_id": "UUID" } }</p><p>]</p><p>},</p><p>"narrative": {</p><p>"case_theory_summary": "string",</p><p>"case_story": "string",</p><p>"client_objectives": ["string"],</p><p>"non_negotiables": ["string"],</p><p>"known_unknowns": ["string"],</p><p>"risk_posture": "LOW|MEDIUM|HIGH|UNKNOWN",</p><p>"tone_guidance": "NEUTRAL|ASSERTIVE|CONCILIATORY|FORMAL"</p><p>},</p><p>"parties": {</p><p>"roles": [</p><p>{</p><p>"party_id": "UUID",</p><p>"role": "PLAINTIFF|DEFENDANT|THIRD_PARTY|WITNESS|ENTITY",</p><p>"display_name": "string",</p><p>"entity_type": "PERSON|ORGANIZATION|GOVERNMENT|UNKNOWN",</p><p>"identifiers": {</p><p>"emails": ["string"],</p><p>"phones": ["string"],</p><p>"addresses": ["string"],</p><p>"external_ids": [{ "system": "string", "value": "string" }]</p><p>},</p><p>"confidence": "HIGH|MEDIUM|LOW",</p><p>"disambiguation_status": "RESOLVED|AMBIGUOUS|CONFLICT",</p><p>"notes": "string"</p><p>}</p><p>],</p><p>"relationships": [</p><p>{</p><p>"relationship_id": "UUID",</p><p>"from_party_id": "UUID",</p><p>"to_party_id": "UUID",</p><p>"relationship_type": "OWNER|OFFICER|EMPLOYEE|AGENT|CONTRACTOR|FAMILY|COUNSEL|OTHER",</p><p>"time_range": { "start": "ISO-8601|null", "end": "ISO-8601|null" },</p><p>"support_refs": [</p><p>{ "type": "text_chunk", "ref": { "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 } }</p><p>],</p><p>"status": "ASSERTED|DISPUTED|UNKNOWN"</p><p>}</p><p>]</p><p>},</p><p>"timeline": {</p><p>"anchors": [</p><p>{</p><p>"anchor_id": "UUID",</p><p>"label": "string",</p><p>"date": "YYYY-MM-DD|null",</p><p>"date_precision": "DAY|MONTH|YEAR|UNKNOWN",</p><p>"description": "string",</p><p>"importance": "CRITICAL|HIGH|MEDIUM|LOW",</p><p>"support_refs": [</p><p>{ "type": "text_chunk", "ref": { "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 } }</p><p>],</p><p>"status": "CONFIRMED|ASSERTED|DISPUTED|UNKNOWN"</p><p>}</p><p>]</p><p>},</p><p>"claims_model": {</p><p>"matter_type": "CIVIL|CRIMINAL|ADMIN|UNKNOWN",</p><p>"jurisdiction": { "state": "string", "county": "string|null", "court": "string|null" },</p><p>"causes_of_action": [</p><p>{</p><p>"coa_id": "UUID",</p><p>"coa_code": "string",</p><p>"coa_name": "string",</p><p>"status": "CANDIDATE|SELECTED|FILED|DROPPED",</p><p>"elements": [</p><p>{</p><p>"element_id": "UUID",</p><p>"element_label": "string",</p><p>"element_statement": "string",</p><p>"burden_notes": "string|null",</p><p>"support_requirement": "MUST_HAVE|SHOULD_HAVE|NICE_TO_HAVE",</p><p>"current_support_status": "SUPPORTED|PARTIAL|UNSUPPORTED|UNKNOWN"</p><p>}</p><p>],</p><p>"notes": "string|null"</p><p>}</p><p>],</p><p>"requested_relief": [</p><p>{ "type": "DAMAGES|INJUNCTION|DECLARATORY|FEES|OTHER", "description": "string" }</p><p>]</p><p>},</p><p>"facts_registry": [</p><p>{</p><p>"fact_id": "UUID",</p><p>"fact_statement": "string",</p><p>"fact_type": "EVENT|TRANSACTION|COMMUNICATION|DOCUMENT|ADMISSION|OTHER",</p><p>"status": "CONFIRMED|ASSERTED|DISPUTED|UNKNOWN",</p><p>"owner": "CLIENT|OPPOSING|THIRD_PARTY|UNKNOWN",</p><p>"time_range": { "start": "ISO-8601|null", "end": "ISO-8601|null" },</p><p>"linked_parties": ["UUID"],</p><p>"support_refs": [</p><p>{ "type": "text_chunk", "ref": { "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 } },</p><p>{ "type": "artifact_version", "ref": { "artifact_id": "UUID", "version_id": "UUID" } }</p><p>],</p><p>"contradiction_refs": [</p><p>{ "conflict_with_fact_id": "UUID", "conflict_type": "DIRECT|TIMELINE|IDENTITY|AMOUNT|OTHER" }</p><p>],</p><p>"notes": "string|null"</p><p>}</p><p>],</p><p>"disambiguation_registry": {</p><p>"open_items": [</p><p>{</p><p>"item_id": "UUID",</p><p>"type": "PARTY_IDENTITY|DATE|AMOUNT|DOCUMENT_VERSION|THREAD_AUTHORITY|OTHER",</p><p>"description": "string",</p><p>"created_at": "ISO-8601",</p><p>"severity": "BLOCKING|HIGH|MEDIUM|LOW",</p><p>"required_for": ["MAPPING|PLEADING|DISCOVERY|DEPOSITION|TRIAL|AUDIT"],</p><p>"proposed_resolutions": ["string"],</p><p>"status": "OPEN|IN_REVIEW|RESOLVED",</p><p>"resolved_at": "ISO-8601|null",</p><p>"resolved_by": { "user_id": "UUID|null", "role": "ATTORNEY|STAFF|SYSTEM|null" }</p><p>}</p><p>]</p><p>},</p><p>"guardrails": {</p><p>"privilege_flags": [</p><p>{ "pattern_type": "PARTY|DOC_TYPE|TAG", "pattern_value": "string", "handling": "RESTRICT|REDACT|HOLD" }</p><p>],</p><p>"sensitive_topics": ["string"],</p><p>"do_not_assert": ["string"],</p><p>"required_language": ["string"]</p><p>},</p><p>"deterministic_metadata": {</p><p>"content_hash": "SHA-256",</p><p>"generated_by_agent": "string",</p><p>"prompt_template_id": "string|null",</p><p>"prompt_template_version": "string|null",</p><p>"model": {</p><p>"provider": "string|null",</p><p>"name": "string|null",</p><p>"version": "string|null",</p><p>"temperature": 0.0</p><p>}</p><p>}</p><p>}</p><h4 id="a-4-hard-constraints-authoritative">A.4 Hard Constraints (Authoritative)</h4><ul><li>Playbook must never include invented facts. Every non-trivial assertion must reference at least one support_ref OR be explicitly labeled ASSERTED/UNKNOWN with no support refs.</li><li>All support_refs must be valid and resolvable:</li><li>text_chunk.ref.chunk_id must exist</li><li>start_offset/end_offset must be in-range for that chunk</li><li>Downstream enforcement: No deterministic artifact may be created without recording playbook_version_id in execution metadata.</li></ul><h4 id="a-5-mutation-rules-authoritative">A.5 Mutation Rules (Authoritative)</h4><ul><li>Client edits → create new version → status returns to DRAFT or CLIENT_VALIDATED.</li><li>Attorney approval required to reach ATTORNEY_APPROVED.</li><li>If new uploads introduce contradictions, the system must:</li><li>create a Disambiguation item (severity policy-based)</li><li>optionally require playbook revision before publish/export (policy-based gate)</li></ul><h4 id="a-6-minimal-what-agents-must-use">A.6 Minimal “What Agents Must Use”</h4><ul><li>MAPPING_AGENT uses: facts_registry, claims_model.causes_of_action.elements, parties, timeline.anchors</li><li>PLEADING_AGENT uses: narrative.case_theory_summary, claims_model, facts_registry (only CONFIRMED + supported, unless attorney override)</li><li>EVIDENCE_AUDIT_AGENT uses: disambiguation_registry.open_items, facts_registry.support_refs, claims_model.elements.current_support_status</li></ul><h3 id="appendix-b-canonical-artifact-schemas-authoritative-build-level-minimum">APPENDIX B — CANONICAL ARTIFACT SCHEMAS (Authoritative; Build-Level Minimum)</h3><p>Rule (Hard): Every artifact below is stored as a versioned, immutable ARTIFACT_VERSION payload. No overwrites. Any modification → new version.</p><p>Rule (Hard): Every deterministic artifact must include:</p><ul><li>artifact_id, version_id, case_id, artifact_type</li><li>created_at, created_by</li><li>workflow_stage_snapshot</li><li>lineage (input versions + playbook version)</li><li>deterministic_run_metadata (or explicit execution_mode = ADVISORY if non-deterministic)</li><li>content_hash (SHA-256 of canonical JSON serialization)</li></ul><hr/><h4 id="b-0-common-artifact-envelope-mandatory-for-all-artifacts">B.0 Common Artifact Envelope (Mandatory for ALL artifacts)</h4><p>{</p><p>"artifact_id": "UUID",</p><p>"version_id": "UUID",</p><p>"case_id": "UUID",</p><p>"artifact_type": "string",</p><p>"schema_version": "1.0",</p><p>"title": "string|null",</p><p>"status": "DRAFT|REVIEW_REQUIRED|APPROVED|FILED|DEPRECATED|VOID",</p><p>"created_at": "ISO-8601",</p><p>"created_by": { "user_id": "UUID", "role": "CLIENT|STAFF|ATTORNEY|SYSTEM" },</p><p>"workflow_stage_snapshot": {</p><p>"stage": "INTAKE|ONBOARDING|ACTIVE|DISCOVERY|DEPOSITION|PRE_TRIAL|TRIAL|POST_TRIAL|ARCHIVED|BLOCKED",</p><p>"step": "string|null",</p><p>"jurisdiction": { "state": "string", "county": "string|null", "court": "string|null" }</p><p>},</p><p>"lineage": {</p><p>"context": { "playbook_version_id": "UUID|null" },</p><p>"input_artifacts": [</p><p>{ "artifact_id": "UUID", "version_id": "UUID", "artifact_type": "string" }</p><p>],</p><p>"input_upload_sessions": [</p><p>{ "upload_session_id": "UUID", "file_set_version": "string|null" }</p><p>],</p><p>"input_hashes": { "inputs_hash": "SHA-256|null" }</p><p>},</p><p>"execution": {</p><p>"execution_id": "UUID|null",</p><p>"agent_type": "string|null",</p><p>"execution_mode": "DETERMINISTIC|ADVISORY|MANUAL",</p><p>"correlation_id": "string",</p><p>"idempotency_key": "string|null"</p><p>},</p><p>"deterministic_run_metadata": {</p><p>"model_provider": "string|null",</p><p>"model_name": "string|null",</p><p>"model_version": "string|null",</p><p>"temperature": 0.0,</p><p>"prompt_template_id": "string|null",</p><p>"prompt_template_version": "string|null",</p><p>"tool_versions": [{ "tool": "string", "provider": "string", "version": "string" }],</p><p>"policy_snapshot_id": "UUID|null",</p><p>"context_snapshot_id": "UUID|null",</p><p>"input_artifact_version_ids": ["UUID"],</p><p>"input_hash": "SHA-256|null",</p><p>"output_hash": "SHA-256|null",</p><p>"executed_at": "ISO-8601|null"</p><p>},</p><p>"content_hash": "SHA-256",</p><p>"payload": {}</p><p>}</p><p>Hard constraints</p><p>• payload must conform to the artifact-specific schema below.</p><p>• execution.execution_mode = DETERMINISTIC is mandatory for any artifact that gates publish/export, workflow transitions, or “authoritative” downstream usage (policy-defined).</p><hr/><h4 id="b-1-upload_impact_preliminary_report-deterministic-advisory">B.1 upload_impact_preliminary_report (Deterministic; Advisory)</h4><p><strong>Purpose:</strong> Deterministic impact summary after an UploadSession closes. No legal conclusions. Candidate impacts only.</p><p>artifact_type: upload_impact_preliminary_report</p><p>payload schema (minimum):</p><p>{</p><p>"upload_session_id": "UUID",</p><p>"file_set": {</p><p>"file_ids_new": ["UUID"],</p><p>"duplicate_file_links": [</p><p>{ "new_file_id": "UUID", "existing_file_id": "UUID", "content_hash": "SHA-256" }</p><p>],</p><p>"thread_groups_detected": [</p><p>{ "thread_group_id": "UUID", "authoritative_file_id": "UUID", "member_file_ids": ["UUID"] }</p><p>],</p><p>"authoritative_decisions": [</p><p>{ "scope": "THREAD_GROUP|FILE", "scope_id": "UUID", "authoritative_file_id": "UUID", "basis": "DEFAULT_LATEST|ATTORNEY_OVERRIDE" }</p><p>]</p><p>},</p><p>"candidates": {</p><p>"new_actor_candidates": [</p><p>{ "name": "string", "type": "PERSON|ORG|UNKNOWN", "support_refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }] }</p><p>],</p><p>"new_event_candidates": [</p><p>{ "description": "string", "date_candidate": "YYYY-MM-DD|null", "support_refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }] }</p><p>],</p><p>"contradiction_risk_indicator": "NONE|LOW|MEDIUM|HIGH",</p><p>"potential_artifact_impacts": [</p><p>{ "artifact_type": "MAPPING|PLEADING|DISCOVERY|DEPOSITION|TRIAL|AUDIT", "impact_reason": "string", "severity": "LOW|MEDIUM|HIGH" }</p><p>]</p><p>},</p><p>"required_actions": {</p><p>"attorney_disposition_required": true,</p><p>"recommended_jobs": ["ProcessingJob", "MappingJob", "EvidenceAuditJob"]</p><p>}</p><p>}</p><p>Example payload (short):</p><p>{</p><p>"upload_session_id": "6e...c1",</p><p>"file_set": {</p><p>"file_ids_new": ["a1...01", "a1...02"],</p><p>"duplicate_file_links": [],</p><p>"thread_groups_detected": [{ "thread_group_id": "t9...aa", "authoritative_file_id": "a1...02", "member_file_ids": ["a1...01","a1...02"] }],</p><p>"authoritative_decisions": [{ "scope": "THREAD_GROUP", "scope_id": "t9...aa", "authoritative_file_id": "a1...02", "basis": "DEFAULT_LATEST" }]</p><p>},</p><p>"candidates": {</p><p>"new_actor_candidates": [{ "name": "John Doe", "type": "PERSON", "support_refs": [{ "chunk_id": "c3...11", "start_offset": 120, "end_offset": 160 }] }],</p><p>"new_event_candidates": [],</p><p>"contradiction_risk_indicator": "LOW",</p><p>"potential_artifact_impacts": [{ "artifact_type": "MAPPING", "impact_reason": "New emails may add support refs", "severity": "MEDIUM" }]</p><p>},</p><p>"required_actions": { "attorney_disposition_required": true, "recommended_jobs": ["ProcessingJob","MappingJob","EvidenceAuditJob"] }</p><p>}</p><hr/><h4 id="b-2-mapping_package-deterministic-authoritative-for-trace">B.2 mapping_package (Deterministic; Authoritative for trace)</h4><p><strong>Purpose:</strong> The authoritative mapping outputs that link facts/elements/claims to evidence refs.</p><p>artifact_type: mapping_package</p><p>payload schema (minimum):</p><p>{</p><p>"mapping_package_id": "UUID",</p><p>"playbook_version_id": "UUID",</p><p>"coa_taxonomy_version_id": "UUID",</p><p>"scope": {</p><p>"stage": "string",</p><p>"includes": ["FACTS", "COA_ELEMENTS", "DAMAGES", "WITNESSES"]</p><p>},</p><p>"coverage_summary": {</p><p>"elements_total": 0,</p><p>"elements_supported": 0,</p><p>"elements_partial": 0,</p><p>"elements_unsupported": 0,</p><p>"confidence": "HIGH|MEDIUM|LOW"</p><p>},</p><p>"links": [</p><p>{</p><p>"link_id": "UUID",</p><p>"link_type": "COA_ELEMENT_SUPPORT|FACT_SUPPORT|DAMAGE_SUPPORT|WITNESS_SUPPORT",</p><p>"target": {</p><p>"target_type": "COA_ELEMENT|FACT|DAMAGE_ITEM|WITNESS",</p><p>"target_id": "UUID",</p><p>"target_label": "string"</p><p>},</p><p>"support": [</p><p>{</p><p>"evidence_ref_id": "UUID",</p><p>"ref_type": "TEXT_CHUNK|FILE|ARTIFACT_VERSION",</p><p>"ref": {</p><p>"chunk_id": "UUID|null",</p><p>"start_offset": 0,</p><p>"end_offset": 0,</p><p>"file_id": "UUID|null",</p><p>"artifact_id": "UUID|null",</p><p>"version_id": "UUID|null"</p><p>},</p><p>"quote": "string|null",</p><p>"note": "string|null"</p><p>}</p><p>],</p><p>"support_strength": "STRONG|MODERATE|WEAK|UNKNOWN",</p><p>"status": "SUPPORTED|PARTIAL|UNSUPPORTED"</p><p>}</p><p>],</p><p>"orphan_refs": [</p><p>{ "ref_type": "FILE|TEXT_CHUNK", "ref_id": "UUID", "reason": "Unmapped evidence" }</p><p>],</p><p>"contradiction_flags": [</p><p>{ "flag_id": "UUID", "type": "DIRECT|TIMELINE|IDENTITY|AMOUNT", "description": "string", "refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }] }</p><p>]</p><p>}</p><hr/><h4 id="b-3-evidence_audit_report-deterministic-readiness-gating">B.3 evidence_audit_report (Deterministic; Readiness-Gating)</h4><p>artifact_type: evidence_audit_report</p><p>payload schema (minimum):</p><p>{</p><p>"audit_run_id": "UUID",</p><p>"playbook_version_id": "UUID",</p><p>"workflow_stage_snapshot": { "stage": "string", "step": "string|null" },</p><p>"coverage_summary": {</p><p>"required_artifacts_present": true,</p><p>"mapping_current": true,</p><p>"orphan_count": 0,</p><p>"unsupported_elements_count": 0,</p><p>"blocking_issues_count": 0</p><p>},</p><p>"missing_artifacts": [</p><p>{ "artifact_type": "string", "reason": "string", "severity": "BLOCKING|HIGH|MEDIUM|LOW" }</p><p>],</p><p>"orphan_artifacts": [</p><p>{ "ref_type": "FILE|TEXT_CHUNK|ARTIFACT_VERSION", "ref_id": "UUID", "reason": "string" }</p><p>],</p><p>"unsupported_elements": [</p><p>{ "coa_code": "string", "element_label": "string", "status": "UNSUPPORTED|PARTIAL", "notes": "string|null" }</p><p>],</p><p>"contradiction_flags": [</p><p>{ "flag_id": "UUID", "description": "string", "severity": "HIGH|MEDIUM|LOW", "refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }] }</p><p>],</p><p>"unresolved_issues": [{ "issue_id": "UUID", "severity": "BLOCKING|HIGH|MEDIUM|LOW" }],</p><p>"readiness_gate_status": {</p><p>"publish_export_allowed": false,</p><p>"stage_transition_allowed": false,</p><p>"override_required": true</p><p>},</p><p>"recommended_actions": ["string"]</p><p>}</p><hr/><h4 id="b-4-pleading_artifact-deterministic-authoritative-export-gated">B.4 pleading_artifact (Deterministic; Authoritative; Export-Gated)</h4><p>artifact_type: pleading_artifact</p><p>payload schema (minimum):</p><p>{</p><p>"pleading_type": "COMPLAINT|ANSWER|CROSS_COMPLAINT|MOTION|OPPOSITION|REPLY|OTHER",</p><p>"jurisdiction": { "state": "string", "court": "string", "county": "string|null" },</p><p>"caption": {</p><p>"plaintiff_names": ["string"],</p><p>"defendant_names": ["string"],</p><p>"case_number": "string|null"</p><p>},</p><p>"sections": [</p><p>{</p><p>"section_id": "UUID",</p><p>"heading": "string",</p><p>"content": "string",</p><p>"support_links": [</p><p>{</p><p>"mapping_link_id": "UUID|null",</p><p>"support_refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }]</p><p>}</p><p>]</p><p>}</p><p>],</p><p>"coa_assertions": [</p><p>{</p><p>"coa_code": "string",</p><p>"coa_name": "string",</p><p>"elements_asserted": [</p><p>{ "element_label": "string", "assertion_text": "string", "support_status": "SUPPORTED|PARTIAL|UNSUPPORTED" }</p><p>]</p><p>}</p><p>],</p><p>"export_bundle_refs": {</p><p>"rendered_pdf_artifact_version_id": "UUID|null",</p><p>"filing_packet_id": "UUID|null"</p><p>},</p><p>"attorney_signoff": {</p><p>"required": true,</p><p>"approved": false,</p><p>"approved_by": "UUID|null",</p><p>"approved_at": "ISO-8601|null"</p><p>}</p><p>}</p><hr/><h4 id="b-5-interrogatory_set-deterministic-draft-attorney-gated">B.5 interrogatory_set (Deterministic; Draft; Attorney-Gated)</h4><p>artifact_type: interrogatory_set</p><p>payload schema (minimum):</p><p>{</p><p>"set_type": "FORM|SPECIAL|REQUEST_FOR_ADMISSION|REQUEST_FOR_PRODUCTION|OTHER",</p><p>"jurisdiction_profile": "string",</p><p>"questions": [</p><p>{</p><p>"question_id": "UUID",</p><p>"number": "string",</p><p>"text": "string",</p><p>"purpose": "string|null",</p><p>"support_refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }],</p><p>"targets": { "party_ids": ["UUID"], "topics": ["string"] },</p><p>"status": "DRAFT|REVIEW_REQUIRED|APPROVED|SERVED"</p><p>}</p><p>],</p><p>"service_metadata": {</p><p>"deadline_candidate": "YYYY-MM-DD|null",</p><p>"served_at": "ISO-8601|null"</p><p>}</p><p>}</p><hr/><h4 id="b-6-deposition_outline-deterministic-draft-attorney-gated">B.6 deposition_outline (Deterministic; Draft; Attorney-Gated)</h4><p>artifact_type: deposition_outline</p><p>payload schema (minimum):</p><p>{</p><p>"deponent": { "party_id": "UUID", "display_name": "string" },</p><p>"purpose": "string",</p><p>"sections": [</p><p>{</p><p>"section_id": "UUID",</p><p>"topic": "string",</p><p>"goals": ["string"],</p><p>"questions": [</p><p>{</p><p>"q_id": "UUID",</p><p>"text": "string",</p><p>"expected_admission": "string|null",</p><p>"support_refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }]</p><p>}</p><p>]</p><p>}</p><p>],</p><p>"exhibit_candidates": [</p><p>{ "file_id": "UUID", "label": "string", "reason": "string", "thread_group_id": "UUID|null" }</p><p>]</p><p>}</p><hr/><h4 id="b-7-deposition_transcript_digest-deterministic-authoritative-input-to-mapping">B.7 deposition_transcript_digest (Deterministic; Authoritative Input to Mapping)</h4><p>artifact_type: deposition_transcript_digest</p><p>payload schema (minimum):</p><p>{</p><p>"deposition_id": "UUID",</p><p>"deponent_party_id": "UUID",</p><p>"transcript_artifact_version_id": "UUID",</p><p>"segments": [</p><p>{</p><p>"segment_id": "UUID",</p><p>"page_line": "string|null",</p><p>"text": "string",</p><p>"key_points": ["string"],</p><p>"support_refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }],</p><p>"admissions": [{ "admission_text": "string", "topic": "string|null" }],</p><p>"contradictions": [{ "description": "string", "severity": "LOW|MEDIUM|HIGH" }]</p><p>}</p><p>]</p><p>}</p><hr/><h4 id="b-8-subpoena_packet-deterministic-draft-attorney-gated">B.8 subpoena_packet (Deterministic; Draft; Attorney-Gated)</h4><p>artifact_type: subpoena_packet</p><p>payload schema (minimum):</p><p>{</p><p>"subpoena_type": "CIVIL_SUBPOENA|SUBPOENA_DUCES_TECUM|DEPOSITION_SUBPOENA|OTHER",</p><p>"recipient": { "name": "string", "address": "string|null", "contact": "string|null" },</p><p>"requested_items": [</p><p>{ "item_id": "UUID", "description": "string", "rationale": "string|null", "support_refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }] }</p><p>],</p><p>"scope_limits": { "date_range": { "start": "YYYY-MM-DD|null", "end": "YYYY-MM-DD|null" } },</p><p>"status": "DRAFT|REVIEW_REQUIRED|APPROVED|SERVED"</p><p>}</p><hr/><h4 id="b-9-trial_bundle-deterministic-export-gated">B.9 trial_bundle (Deterministic; Export-Gated)</h4><p>artifact_type: trial_bundle</p><p>payload schema (minimum):</p><p>{</p><p>"bundle_id": "UUID",</p><p>"components": {</p><p>"exhibit_list": [</p><p>{ "exhibit_id": "UUID", "file_id": "UUID", "label": "string", "admissibility_notes": "string|null" }</p><p>],</p><p>"witness_list": [</p><p>{ "party_id": "UUID", "name": "string", "topics": ["string"], "support_refs": [{ "chunk_id": "UUID", "start_offset": 0, "end_offset": 0 }] }</p><p>],</p><p>"theme_statement": "string|null",</p><p>"opening_outline": "string|null",</p><p>"closing_outline": "string|null"</p><p>},</p><p>"readiness_gate": {</p><p>"evidence_audit_required": true,</p><p>"audit_version_id": "UUID|null",</p><p>"publish_export_allowed": false</p><p>}</p><p>}</p><hr/><h4 id="b-10-issue_record-governance-artifact-deterministic-creation">B.10 issue_record (Governance Artifact; Deterministic creation)</h4><p>artifact_type: issue_record</p><p>payload schema (minimum):</p><p>{</p><p>"issue_id": "UUID",</p><p>"category": "POLICY|INTEGRITY|SECURITY|EVIDENCE_GAP|WORKFLOW_BLOCKER|OTHER",</p><p>"severity": "BLOCKING|HIGH|MEDIUM|LOW",</p><p>"title": "string",</p><p>"description": "string",</p><p>"created_at": "ISO-8601",</p><p>"created_by": { "user_id": "UUID", "role": "SYSTEM|STAFF|ATTORNEY" },</p><p>"status": "OPEN|IN_PROGRESS|RESOLVED|WAIVED",</p><p>"links": [</p><p>{ "ref_type": "ARTIFACT_VERSION|FILE|TEXT_CHUNK|WORKFLOW_STAGE", "ref_id": "UUID", "note": "string|null" }</p><p>],</p><p>"required_actions": ["string"],</p><p>"resolution": { "resolved_at": "ISO-8601|null", "resolved_by": "UUID|null", "notes": "string|null" }</p><p>Cross-Agent Data Contracts + Mutation Authority Matrix (Authoritative)</p><p><strong>Purpose:</strong> Eliminate “implied behavior.” Antigravity must implement strict write/read boundaries so agents cannot silently mutate state, artifacts, or evidence. This matrix is the single source of truth for:</p><p>1. Who may write what, 2) Where it is stored, 3) What gates are required, 4) What events must be emitted, 5) What is forbidden.</p><p>Hard Rule (No Exceptions):</p><ul><li>Agents do not call agents. Agents only emit events. Orchestrator enqueues jobs.</li><li>UI does not mutate authoritative stores directly. UI requests go through API → policy checks → events/jobs.</li><li>Evidence bytes are immutable. Only references, mappings, and artifacts may be created.</li></ul><hr/><h4 id="authoritative-data-domains-locked">Authoritative Data Domains (Locked)</h4><p>A) Authoritative Case Record (Write-restricted)</p><ul><li>ACTIVE_CASE_STORE (case status, workflow state, issues/tasks, approvals, directives registry)</li><li>ARTIFACT_STORE (artifact versions; append-only)</li><li>TEXT_VAULT / TEXT_CHUNKS (immutable extraction outputs; append-only)</li></ul><p>B) Operational Stores (Not case facts; still audited)</p><ul><li>OPERATIONAL_STORE (billing ledger, cost caps, usage ledger)</li><li>QUEUE/BROKER (jobs/events; durable)</li></ul><p>C) Derived/Advisory Stores (Never authoritative)</p><ul><li>DERIVED_STORE (indices, embeddings, caches, ranking outputs)</li><li>Must be rebuildable from authoritative sources; no gating depends solely on derived state.</li></ul><hr/><h4 id="mutation-authority-matrix-agent-writes-prohibitions-gates">Mutation Authority Matrix (Agent → Writes / Prohibitions / Gates)</h4><p>Legend</p><ul><li>Writes: allowed creations/updates (never overwrites of artifact versions)</li><li>Forbidden: hard constraints</li><li>Gates: approvals/readiness/policy required before write</li><li>Events: mandatory emitted events</li></ul><hr/><h4 id="core-governance-agents">Core Governance Agents</h4><h4 id="intake_agent-2">INTAKE_AGENT</h4><p>Writes</p><ul><li>ARTIFACT_STORE: CASE_PERSPECTIVE (versioned)</li><li>ACTIVE_CASE_STORE: intake status flags, intake checklist items, client validation checkpoints</li></ul><p>Forbidden</p><ul><li>No file ingestion</li><li>No text extraction</li></ul><p>• No mapping/COA assertions</p><p>• No workflow stage transitions beyond intake flags</p><p>Gates</p><p>• Client confirmation required to mark CASE_PERSPECTIVE as “ClientConfirmed”</p><p>• Attorney acceptance required to proceed to onboarding trigger</p><p>Events</p><p>• CasePerspectiveDrafted</p><p>• CasePerspectiveClientConfirmed</p><p>• AttorneyReviewRequested</p><hr/><h4 id="onboard_agent-3">ONBOARD_AGENT</h4><p>Writes</p><p>• ACTIVE_CASE_STORE: CASE.status = Active, initialize WORKFLOW_STATE</p><p>• ARTIFACT_STORE: ENGAGEMENT_ARTIFACT (versioned), consent artifacts</p><p>• ACTIVE_CASE_STORE: POLICY_PROFILE snapshot pointer, DIRECTIVE_REGISTRY initialized</p><p>Forbidden</p><p>• No evidence interpretation</p><p>• No extraction/chunking</p><p>• No legal drafting</p><p>Gates</p><p>• Attorney acceptance recorded</p><p>• Required consents present</p><p>• CASE_PERSPECTIVE must be Approved</p><p>Events</p><p>• AttorneyAcceptedCase</p><p>• CaseActivated</p><p>• WorkflowStateInitialized</p><p>• PolicyProfileLocked</p><hr/><h4 id="conductor_agent-workflow-integrity-governor">CONDUCTOR_AGENT (Workflow Integrity Governor)</h4><p>Writes</p><p>• ACTIVE_CASE_STORE: workflow transition proposals, readiness gate statuses, stage blocking flags</p><p>• May enqueue jobs via orchestration events only (no direct calls)</p><p>Forbidden</p><p>• No artifact drafting</p><p>• No mapping/evidence edits</p><p>• No changing file/thread authoritative flags (attorney only)</p><p>Gates</p><p>• Must validate readiness gate inputs (latest Evidence Audit, approvals, blocking issues)</p><p>• Overrides must be attorney recorded</p><p>Events</p><p>• WorkflowTransitionRequested</p><p>• WorkflowTransitionApproved</p><p>• ReadinessGateBlocked</p><ul><li>AttorneyOverrideRecorded</li></ul><hr/><h4 id="file-text-pipeline-agents">File &amp; Text Pipeline Agents</h4><h4 id="file_intake_agent-2">FILE_INTAKE_AGENT</h4><p>Writes</p><ul><li>ACTIVE_CASE_STORE: UPLOAD_SESSION records + state transitions</li><li>ACTIVE_CASE_STORE: FILE metadata records (hash, size, mime, session_id)</li><li>ACTIVE_CASE_STORE: THREAD_GROUP records + authoritative default</li><li>ARTIFACT_STORE: upload_impact_preliminary_report (versioned)</li></ul><p>Forbidden</p><ul><li>No OCR/STT/extraction</li><li>No TEXT_VAULT/TEXT_CHUNKS creation</li><li>No evidence summarization, no legal reasoning</li></ul><p>Gates</p><ul><li>UploadSession must be Closed to emit UploadSessionCompleted</li><li>If policy requires attorney review → PendingReview must be resolved before closing</li></ul><p>Events</p><ul><li>UploadSessionStarted</li><li>FileUploaded</li><li>DuplicateDetected</li><li>ThreadGroupCreated</li><li>UploadSessionClosed</li><li>UploadImpactReportCreated</li><li>ProcessingEnqueueRequested</li></ul><hr/><h4 id="processing_agent-3">PROCESSING_AGENT</h4><p>Writes</p><ul><li>TEXT_VAULT: immutable extracted text objects</li><li>TEXT_CHUNKS: immutable chunk records with offsets, provenance</li><li>ACTIVE_CASE_STORE: processing run records (job status only)</li><li>Optional: DERIVED_STORE indices/embeddings (rebuildable)</li></ul><p>Forbidden</p><ul><li>No modifying files</li><li>No changing authoritative thread decisions</li><li>No mapping or COA linkage</li><li>No workflow transition</li></ul><p>Gates</p><ul><li>Case must be Active</li><li>CASE_CONTEXT_PLAYBOOK must exist</li><li>UploadSession must be Closed</li><li>No blocking issues for processing</li></ul><p>Events</p><ul><li>ProcessingStarted</li><li>TextVaultRecordCreated</li><li>TextChunksCreated</li><li>ProcessingCompleted</li><li>ProcessingFailed</li></ul><hr/><h4 id="mapping-evidence-integrity">Mapping &amp; Evidence Integrity</h4><h4 id="mapping_agent-3">MAPPING_AGENT</h4><p>Writes</p><ul><li>ARTIFACT_STORE: mapping_package (versioned)</li><li>ACTIVE_CASE_STORE: mapping coverage summaries (read-only mirrors of artifact stats allowed)</li></ul><p>Forbidden</p><ul><li>No file/text mutation</li><li>No pleading edits</li><li>No “filling gaps” without support refs</li><li>No workflow transition</li></ul><p>Gates</p><ul><li>Requires CASE_CONTEXT_PLAYBOOK version</li><li>Requires TEXT_CHUNKS for referenced materials</li><li>Must enforce trace refs for every link</li></ul><p>Events</p><ul><li>MappingStarted</li><li>MappingPackageCreated</li><li>MappingCompleted</li><li>UnsupportedElementDetected</li><li>ContradictionFlagged</li></ul><hr/><h4 id="evidence_audit_agent-3">EVIDENCE_AUDIT_AGENT</h4><p>Writes</p><ul><li>ARTIFACT_STORE: evidence_audit_report (versioned)</li><li>ACTIVE_CASE_STORE: readiness indicators (counts/flags only), issues/tasks (policy-controlled)</li></ul><p>Forbidden</p><ul><li>No editing mappings or pleadings</li><li>No resolving contradictions</li><li>No inference of missing facts</li></ul><p>Gates</p><ul><li>Requires current CASE_CONTEXT_PLAYBOOK</li><li>Requires latest mapping_package for stage (policy-defined)</li><li>Must block publish/export if audit not current (freshness window)</li></ul><p>Events</p><ul><li>EvidenceAuditStarted</li><li>EvidenceAuditReportGenerated</li><li>EvidenceAuditCompleted</li><li>ReadinessGateBlocked (if applicable)</li></ul><hr/><h4 id="drafting-litigation-output-agents-all-attorney-gated">Drafting / Litigation Output Agents (All Attorney-Gated)</h4><h4 id="pleading_agent-3">PLEADING_AGENT</h4><p>Writes</p><ul><li>ARTIFACT_STORE: pleading_artifact (draft versions)</li><li>ACTIVE_CASE_STORE: “requires attorney signoff” flags</li></ul><p>Forbidden</p><ul><li>No auto-file</li><li>No silent updates to “Filed”</li><li>No altering COA taxonomy</li></ul><p>Gates</p><ul><li>Must require latest Evidence Audit “publish/export allowed”</li><li>Attorney signoff required to mark APPROVED / FILED</li><li>Must reference mapping_package + trace refs for assertions</li></ul><p>Events</p><ul><li>PleadingDraftCreated</li><li>PleadingReviewRequested</li><li>AttorneyApprovedPleading</li><li>PleadingExportRequested</li><li>PleadingExportCompleted</li></ul><hr/><h4 id="interrogatory_agent-3">INTERROGATORY_AGENT</h4><p>Writes</p><ul><li>ARTIFACT_STORE: interrogatory_set (draft versions)</li></ul><p>Forbidden</p><ul><li>No service without attorney approval</li></ul><p>Gates</p><ul><li>Must reference mapping links / trace refs</li><li>If late upload after service milestone → require attorney disposition + revalidation flags</li></ul><p>Events</p><ul><li>InterrogatoryDraftCreated</li><li>InterrogatoryReviewRequested</li><li>AttorneyApprovedDiscovery</li><li>DiscoveryExportRequested</li></ul><hr/><h4 id="deposition_prep_agent-deposition_processing_agent">DEPOSITION_PREP_AGENT / DEPOSITION_PROCESSING_AGENT</h4><p>Writes</p><ul><li>Prep: ARTIFACT_STORE: deposition_outline</li><li>Processing: ARTIFACT_STORE: deposition_transcript_digest (+ optionally transcript artifact version)</li><li>ACTIVE_CASE_STORE: witness/deposition scheduling metadata (if part of workflow module)</li></ul><p>Forbidden</p><ul><li>No altering original transcript bytes</li><li>No mapping edits (mapping agent only)</li></ul><p>Gates</p><ul><li>Attorney gating for final outline</li><li>Transcript processing must produce traceable segment refs</li></ul><p>Events</p><ul><li>DepositionOutlineCreated</li><li>DepositionTranscriptUploaded</li><li>DepositionProcessingCompleted</li><li>DepositionDigestCreated</li></ul><hr/><h4 id="subpoena_agent-2">SUBPOENA_AGENT</h4><p>Writes</p><ul><li>ARTIFACT_STORE: subpoena_packet (draft versions)</li></ul><p>Forbidden</p><ul><li>No issuance/serving without attorney approval</li></ul><p>Gates</p><ul><li>Trace refs required for requested items rationale</li><li>If disclosure/privilege risk flagged → attorney disposition required</li></ul><p>Events</p><ul><li>SubpoenaDraftCreated</li><li>SubpoenaReviewRequested</li><li>AttorneyApprovedSubpoena</li><li>SubpoenaExportRequested</li></ul><hr/><h4 id="trial_agent-2">TRIAL_AGENT</h4><p>Writes</p><ul><li>ARTIFACT_STORE: trial_bundle (draft/approved versions)</li></ul><p>Forbidden</p><ul><li>No export if Evidence Audit not current/passing</li><li>No overriding exhibit admissibility rules without attorney directive</li></ul><p>Gates</p><ul><li>Latest Evidence Audit required</li><li>Attorney approval required for final bundle</li></ul><p>Events</p><ul><li>TrialBundleCreated</li><li>TrialBundleReviewRequested</li><li>AttorneyApprovedTrialBundle</li><li>TrialExportRequested</li></ul><hr/><h4 id="mutation-authority-matrix-human-roles-uiapi">Mutation Authority Matrix — Human Roles (UI/API)</h4><h4 id="attorney-privileged">Attorney (Privileged)</h4><p>May</p><ul><li>Approve/override: readiness gates, filing/export, authoritative thread selection</li><li>Mark files: privileged / excluded / non-evidentiary / authoritative override</li><li>Approve artifacts: pleadings/discovery/deposition/trial outputs</li><li>Record directives: legal research gating, privileged tool operations</li></ul><p>Must emit</p><ul><li>AttorneyOverrideRecorded</li><li>AttorneyDispositionRecorded</li><li>AttorneyApproved* events for each artifact type</li></ul><h4 id="staff-paralegal">Staff / Paralegal</h4><p>May</p><ul><li>Upload files (within policy)</li><li>Propose taxonomy edits (requires attorney approval)</li><li>Assign tasks/issues, request reprocessing</li></ul><p>May not</p><ul><li>Approve publish/export</li><li>Override readiness gates</li><li>Mark privileged segments without attorney validation (policy-defined)</li></ul><h4 id="client">Client</h4><p>May</p><p>• Provide intake narrative, validate perspective, upload files (policy-defined)</p><p>• View own artifacts (role-scoped)</p><p>May not</p><p>• Approve legal drafts for filing</p><p>• Override evidence or workflow gates</p><hr/><h4 id="write-once-append-only-enforcement-rules-hard">“Write-Once / Append-Only” Enforcement Rules (Hard)</h4><p>1. FILE bytes: immutable. Stored once. Re-uploads → new file_id, hashes link duplicates.</p><p>2. TEXT_VAULT / TEXT_CHUNKS: append-only. Never modified; corrections become new records with lineage.</p><p>3. ARTIFACT_VERSION: append-only. Any change → new version.</p><p>4. AUDIT_LOG_STORE: append-only and tamper-evident (hash chaining recommended).</p><p>5. WORKFLOW_STATE: changes only via state machine transitions (events + conductor governance).</p><p>6. Derived indices: rebuildable, non-authoritative.</p><hr/><h4 id="cross-agent-read-contracts-who-may-read-what">Cross-Agent Read Contracts (Who may read what)</h4><p>Universal read (case-scoped only):</p><ul><li>CASE, WORKFLOW_STATE, ISSUE/TASK, POLICY_PROFILE, ARTIFACT_STORE (within permission)</li></ul><p>Restricted read:</p><ul><li>Privileged segments and attorney-only artifacts require role gate + audit log entry.</li><li>Any external tool usage requires directive (policy-defined) + integration mediation.</li></ul><p>Hard prohibition:</p><ul><li>No cross-case joins, no cross-case embeddings/search unless governance authorizes a sanitized global corpus (separate and versioned).</li></ul><hr/><h4 id="no-surprise-writes-required-preflight-validation-mandatory">“No Surprise Writes” — Required Preflight Validation (Mandatory)</h4><p>Before any agent writes:</p><ul><li>Validate workflow stage allows the job</li><li>Validate required approvals exist</li><li>Validate no blocking issues</li><li>Validate input artifacts exist and are current per policy</li><li>Validate case isolation scope / encryption scope loaded</li><li>Validate idempotency key (dedupe check)</li></ul><p>On failure:</p><ul><li>Emit PolicyViolation or IntegrityViolation</li><li>Create ISSUE (policy-controlled)</li><li>Do not execute</li></ul><hr/><h3 id="build-requirements-antigravity-what-must-be-implemented">Build Requirements (Antigravity) — What MUST Be Implemented</h3><p>Antigravity must implement:</p><p>• A server-side Permission &amp; Mutation Firewall enforcing this matrix</p><p>• A single Event-driven orchestration path for all mutations</p><p>• Append-only artifact/version storage with lineage + hashes</p><p>• Case-scoped isolation guards at DB + service layer</p><p>• A validator that rejects any write attempt not allowed by the matrix</p></section>
    <section id="architecture-visuals">
  <h2>Architecture Visuals</h2>

  <h3>Section 7 — Authoritative Architecture Map</h3>
  <div style="margin: 12px 0 28px 0;">
    <img
      src="assets/svg/section7-authoritative.svg"
      alt="Section 7 Authoritative Architecture Map"
      style="max-width:100%;height:auto;border:1px solid #ddd;border-radius:8px;"
    />
  </div>

  <h3>3 Layers — Figma Simplified Map</h3>
  <div style="margin: 12px 0 28px 0;">
    <img
      src="assets/svg/layer3-figma.svg"
      alt="3 Layers Figma Simplified Map"
      style="max-width:100%;height:auto;border:1px solid #ddd;border-radius:8px;"
    />
  </div>

  <h3>Bridge Map — Section 7 ↔ 3 Layers Mapping</h3>
  <div style="margin: 12px 0 40px 0;">
    <img
      src="assets/svg/bridge-mapping.svg"
      alt="Bridge Map Between Authoritative and Simplified Architecture"
      style="max-width:100%;height:auto;border:1px solid #ddd;border-radius:8px;"
    />
  </div>

  <hr/>
</section>
<p class="small">End of document.</p>
  </div>
  <script>
(function () {
  function isHeading(el) { return el && /^H[1-6]$/i.test(el.tagName); }
  function level(h) { return parseInt(h.tagName.substring(1), 10); }

  function wrapSectionContent(startHeading) {
    const lvl = level(startHeading);
    const wrapper = document.createElement('div');
    wrapper.className = 'hx-section-content';

    let n = startHeading.nextElementSibling;
    while (n && !(isHeading(n) && level(n) <= lvl)) {
      const next = n.nextElementSibling;
      wrapper.appendChild(n);
      n = next;
    }
    startHeading.insertAdjacentElement('afterend', wrapper);
    return wrapper;
  }

  function setCollapsed(h, content, collapsed) {
    if (collapsed) {
      content.classList.add('hx-hidden');
      h.classList.add('hx-collapsed');
      h.setAttribute('aria-expanded', 'false');
    } else {
      content.classList.remove('hx-hidden');
      h.classList.remove('hx-collapsed');
      h.setAttribute('aria-expanded', 'true');
    }
  }

  function makeToggle(h, defaultCollapsed) {
    // Avoid double-wrapping if script runs twice
    if (h.dataset.hxBound === '1') return;
    h.dataset.hxBound = '1';

    h.classList.add('hx-toggle');
    const content = wrapSectionContent(h);

    setCollapsed(h, content, !!defaultCollapsed);

    h.addEventListener('click', function (e) {
      // Ignore clicks on TOC anchors etc.
      if (e.target && e.target.tagName === 'A') return;
      const nowCollapsed = !content.classList.contains('hx-hidden'); // toggle
      setCollapsed(h, content, nowCollapsed);
    });

    return content;
  }

  function addControls() {
    if (document.getElementById('doc-controls')) return;

    const bar = document.createElement('div');
    bar.id = 'doc-controls';
    bar.innerHTML = `
      <div class="row">
        <strong>View:</strong>
        <label><input type="checkbox" id="show-h2" checked> H2</label>
        <label><input type="checkbox" id="show-h3" checked> H3</label>
        <label><input type="checkbox" id="show-h4" checked> H4</label>

        <button id="expand-all" type="button">Expand all</button>
        <button id="collapse-all" type="button">Collapse all</button>
      </div>
    `;

		// Insert at top of container if present; otherwise at top of body
		const container = document.querySelector('.container') || document.body;
		container.insertBefore(bar, container.firstChild);

		const showH2 = document.getElementById('show-h2');
		const showH3 = document.getElementById('show-h3');
		const showH4 = document.getElementById('show-h4');

		function applyVisibility() {
		  const h2 = showH2.checked;
		  const h3 = showH3.checked;
		  const h4 = showH4.checked;

		  // Show/hide the headings themselves
		  document.querySelectorAll('h2').forEach(el => el.classList.toggle('hx-hidden', !h2));
		  document.querySelectorAll('h3').forEach(el => el.classList.toggle('hx-hidden', !h3));
		  document.querySelectorAll('h4').forEach(el => el.classList.toggle('hx-hidden', !h4));

		  // Also hide the content wrappers that immediately follow hidden headings
		  document.querySelectorAll('h2,h3,h4').forEach(h => {
			const content = h.nextElementSibling;
			if (content && content.classList && content.classList.contains('hx-section-content')) {
			  const hide = h.classList.contains('hx-hidden');
			  content.classList.toggle('hx-hidden', hide);
			}
		  });
		}

		document.getElementById('expand-all').addEventListener('click', function () {
		  document.querySelectorAll('h2,h3,h4').forEach(h => {
			const c = h.nextElementSibling;
			if (c && c.classList && c.classList.contains('hx-section-content')) {
			  setCollapsed(h, c, false);
			}
		  });
		});

		document.getElementById('collapse-all').addEventListener('click', function () {
		  document.querySelectorAll('h2,h3,h4').forEach(h => {
			const c = h.nextElementSibling;
			if (c && c.classList && c.classList.contains('hx-section-content')) {
			  setCollapsed(h, c, true);
			}
		  });
		});

		showH2.addEventListener('change', applyVisibility);
		showH3.addEventListener('change', applyVisibility);
		showH4.addEventListener('change', applyVisibility);

		applyVisibility();
	  }

	  document.addEventListener('DOMContentLoaded', function () {
		// Make H2/H3/H4 collapsible (default: H2 open, H3+H4 collapsed)
		document.querySelectorAll('h2').forEach(h => makeToggle(h, false));
		document.querySelectorAll('h3').forEach(h => makeToggle(h, true));
		document.querySelectorAll('h4').forEach(h => makeToggle(h, true));

		addControls();

		// Debug line (optional)
		console.log("Collapsible/controls enabled:",
		  "H2", document.querySelectorAll('h2').length,
		  "H3", document.querySelectorAll('h3').length,
		  "H4", document.querySelectorAll('h4').length
		);
	  });
	})();
	function addControls() {
	  const bar = document.getElementById('doc-controls');
	  if (!bar) return; // bar is now static in HTML

	  const showH2 = document.getElementById('show-h2');
	  const showH3 = document.getElementById('show-h3');
	  const showH4 = document.getElementById('show-h4');

	  function applyVisibility() {
		const h2 = showH2.checked;
		const h3 = showH3.checked;
		const h4 = showH4.checked;

		document.querySelectorAll('h2').forEach(el => el.classList.toggle('hx-hidden', !h2));
		document.querySelectorAll('h3').forEach(el => el.classList.toggle('hx-hidden', !h3));
		document.querySelectorAll('h4').forEach(el => el.classList.toggle('hx-hidden', !h4));

		document.querySelectorAll('h2,h3,h4').forEach(h => {
		  const content = h.nextElementSibling;
		  if (content && content.classList && content.classList.contains('hx-section-content')) {
			const hide = h.classList.contains('hx-hidden');
			content.classList.toggle('hx-hidden', hide);
		  }
		});
	  }

	  document.getElementById('expand-all').addEventListener('click', function () {
		document.querySelectorAll('h2,h3,h4').forEach(h => {
		  const c = h.nextElementSibling;
		  if (c && c.classList && c.classList.contains('hx-section-content')) {
			setCollapsed(h, c, false);
		  }
		});
	  });

	  document.getElementById('collapse-all').addEventListener('click', function () {
		document.querySelectorAll('h2,h3,h4').forEach(h => {
		  const c = h.nextElementSibling;
		  if (c && c.classList && c.classList.contains('hx-section-content')) {
			setCollapsed(h, c, true);
		  }
		});
	  });

	  showH2.addEventListener('change', applyVisibility);
	  showH3.addEventListener('change', applyVisibility);
	  showH4.addEventListener('change', applyVisibility);

	  applyVisibility();
	}
</script>
  </body>
</html>
